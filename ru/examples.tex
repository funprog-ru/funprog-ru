0000000: 5c63 6861 7074 6572 7bf0 d2c9 cdc5 d2d9  \chapter{.......
0000010: 7d0a 0aeb c1cb 20cd d920 c7cf d7cf d2c9  }..... .. ......
0000020: ccc9 2c20 4d4c 20c9 dace c1de c1cc d8ce  .., ML .........
0000030: cf20 c2d9 cc20 d3d0 d2cf c5cb d4c9 d2cf  . ... ..........
0000040: d7c1 ce20 cbc1 cb20 cdc5 d4c1 d1da d9cb  ... ... ........
0000050: 20c4 ccd1 20c1 d7d4 cfcd c1d4 c9da c9d2   ... ...........
0000060: cfd7 c1ce cecf c7cf 200a c4cf cbc1 dac1  ........ .......
0000070: d4c5 ccd8 d3d4 d7c1 20d4 c5cf d2c5 cd2e  ........ .......
0000080: 20ef c4ce c1cb cf20 cfce 20d0 d2c9 c7cf   ...... .. .....
0000090: c4c5 ce20 c920 c4cc d120 cdce cfc7 c9c8  ... . ... ......
00000a0: 20c4 d2d5 c7c9 c820 d0d2 c9cc cfd6 c5ce   ...... ........
00000b0: c9ca 2c20 d0cf 20c2 cfcc d8db c5ca 0ade  .., .. .........
00000c0: c1d3 d4c9 20c9 da20 cfc2 ccc1 d3d4 c920  .... .. ....... 
00000d0: 203c 3cd3 c9cd d7cf ccd8 ced9 c820 d7d9   <<.......... ..
00000e0: dec9 d3cc c5ce c9ca 3e3e 2e20 f720 dcd4  ........>>. . ..
00000f0: cfca 20c7 ccc1 d7c5 20cd d920 c4c1 c4c9  .. ..... .. ....
0000100: cd20 cec5 d3cb cfcc d8cb cf20 c8c1 d2c1  . ......... ....
0000110: cbd4 c5d2 ced9 c820 0ad0 d2c9 cdc5 d2cf  ....... ........
0000120: d720 c9d3 d0cf ccd8 dacf d7c1 cec9 d120  . ............. 
0000130: 4d4c 2e20 efd4 20de c9d4 c1d4 c5cc d120  ML. .. ........ 
0000140: cec5 20d4 d2c5 c2d5 c5d4 d3d1 20c4 cfd3  .. ......... ...
0000150: cbcf cec1 ccd8 cecf c7cf 0ada cec1 cec9  ................
0000160: d120 d7d3 c5c8 20c4 c5d4 c1cc c5ca 2c20  . .... ......., 
0000170: cbc1 cb2c 20ce c1d0 d2c9 cdc5 d22c 20d7  ..., ........, .
0000180: 20d3 ccd5 dec1 c520 c1ce c1cc c9da c120   ...... ....... 
0000190: 20d0 d2c9 c2cc c9d6 c5ce c9d1 20d7 c5dd   ........... ...
00001a0: c5d3 d4d7 c5ce ced9 c80a dec9 d3c5 cc2c  ...............,
00001b0: 20d0 d2c9 d7c5 c4a3 cece cfcd 20c4 c1cc   ........... ...
00001c0: c5c5 2e20 efc4 cec1 cbcf 2c20 d7c1 d6ce  ... ......, ....
00001d0: cf20 c9d3 d0d9 d4c1 d4d8 20dc d4c9 20d0  . ........ ... .
00001e0: d2cf c7d2 c1cd cdd9 20c9 20d0 cfc8 cfd6  ........ . .....
00001f0: c9c5 20d0 d2c9 cdc5 d2d9 2c20 c120 d4c1  .. ......., . ..
0000200: cbd6 c52c 200a d5d0 d2c1 d6ce c5ce c9d1  ..., ...........
0000210: 2e20 f0cf d3cb cfcc d8cb d520 cec5 d420  . ......... ... 
0000220: ccd5 dedb c5c7 cf20 d3d0 cfd3 cfc2 c12c  ....... .......,
0000230: 20de d4cf c2d9 20d0 cfde d5d7 d3d4 d7cf   ..... .........
0000240: d7c1 d4d8 20cb c1cb 2020 4d4c 20c9 d3d0  .... ...  ML ...
0000250: cfcc d8da d5c5 d4d3 d120 0ad7 20c4 c5ca  ......... .. ...
0000260: d3d4 d7c9 d4c5 ccd8 cecf d3d4 c92e 0a0a  ................
0000270: 2525 4173 2077 6520 6861 7665 2073 6169  %%As we have sai
0000280: 642c 204d 4c20 7761 7320 6f72 6967 696e  d, ML was origin
0000290: 616c 6c79 2064 6573 6967 6e65 6420 6173  ally designed as
00002a0: 2061 206d 6574 616c 616e 6775 6167 6520   a metalanguage 
00002b0: 666f 7220 6120 636f 6d70 7574 6572 0a25  for a computer.%
00002c0: 2574 6865 6f72 656d 2070 726f 7665 722e  %theorem prover.
00002d0: 2048 6f77 6576 6572 2069 7420 6973 2073   However it is s
00002e0: 7569 7461 626c 6520 666f 7220 706c 656e  uitable for plen
00002f0: 7479 206f 6620 6f74 6865 7220 6170 706c  ty of other appl
0000300: 6963 6174 696f 6e73 2c20 6d6f 7374 6c79  ications, mostly
0000310: 0a25 2566 726f 6d20 7468 6520 7361 6d65  .%%from the same
0000320: 2067 656e 6572 616c 2066 6965 6c64 206f   general field o
0000330: 6620 6073 796d 626f 6c69 6320 636f 6d70  f `symbolic comp
0000340: 7574 6174 696f 6e27 2e20 496e 2074 6869  utation'. In thi
0000350: 7320 6368 6170 7465 7220 7765 2077 696c  s chapter we wil
0000360: 6c0a 2525 6769 7665 2073 6f6d 6520 6578  l.%%give some ex
0000370: 616d 706c 6573 206f 6620 6368 6172 6163  amples of charac
0000380: 7465 7269 7374 6963 2075 7365 7320 6f66  teristic uses of
0000390: 204d 4c2e 2049 7420 6973 206e 6f74 206e   ML. It is not n
00003a0: 6563 6573 7361 7279 2074 6861 7420 7468  ecessary that th
00003b0: 650a 2525 7265 6164 6572 2073 686f 756c  e.%%reader shoul
00003c0: 6420 756e 6465 7273 7461 6e64 2065 7665  d understand eve
00003d0: 7279 2064 6574 6169 6c20 6f66 2074 6865  ry detail of the
00003e0: 2070 6172 7469 6375 6c61 7220 6578 616d   particular exam
00003f0: 706c 6573 2c20 652e 672e 2074 6865 0a25  ples, e.g. the.%
0000400: 2561 6e61 6c79 7365 7320 6f66 2072 6561  %analyses of rea
0000410: 6c20 6e75 6d62 6572 2061 7070 726f 7869  l number approxi
0000420: 6d61 7469 6f6e 7320 6769 7665 6e20 6265  mations given be
0000430: 6c6f 772e 2048 6f77 6576 6572 2069 7420  low. However it 
0000440: 6973 2077 6f72 7468 2074 7279 696e 670a  is worth trying.
0000450: 2525 6f75 7420 7468 6573 6520 7072 6f67  %%out these prog
0000460: 7261 6d73 2061 6e64 2073 696d 696c 6172  rams and similar
0000470: 2065 7861 6d70 6c65 7320 666f 7220 796f   examples for yo
0000480: 7572 7365 6c66 2c20 616e 6420 646f 696e  urself, and doin
0000490: 6720 736f 6d65 206f 6620 7468 650a 2525  g some of the.%%
00004a0: 6578 6572 6369 7365 732e 2054 6865 7265  exercises. There
00004b0: 2069 7320 6e6f 2062 6574 7465 7220 7761   is no better wa
00004c0: 7920 6f66 2067 6574 7469 6e67 2061 2066  y of getting a f
00004d0: 6565 6c20 666f 7220 686f 7720 4d4c 2069  eel for how ML i
00004e0: 7320 6163 7475 616c 6c79 0a25 2575 7365  s actually.%%use
00004f0: 642e 0a0a 5c73 6563 7469 6f6e 7bf3 c9cd  d...\section{...
0000500: d7cf ccd8 cecf c520 c4c9 c6c6 c5d2 c5ce  ....... ........
0000510: c3c9 d2cf d7c1 cec9 c57d 0a0a 2525 5c73  .........}..%%\s
0000520: 6563 7469 6f6e 7b53 796d 626f 6c69 6320  ection{Symbolic 
0000530: 6469 6666 6572 656e 7469 6174 696f 6e7d  differentiation}
0000540: 0a0a e6d2 c1da c120 3c3c d3c9 cdd7 cfcc  ....... <<......
0000550: d8ce cfc5 20d7 d9de c9d3 ccc5 cec9 c53e  .... ..........>
0000560: 3e20 c4cf d7cf ccd8 cecf 20ce c5cf d0d2  > ........ .....
0000570: c5c4 c5cc a3ce cec1 2c20 cecf 20c7 d2d5  ........, .. ...
0000580: c2cf 20c7 cfd7 cfd2 d12c 20cf cec1 200a  .. ......, ... .
0000590: cfc8 d7c1 d4d9 d7c1 c5d4 20d0 d2c9 cccf  .......... .....
00005a0: d6c5 cec9 d120 dac1 cec9 cdc1 c0dd c9c5  ..... ..........
00005b0: d3d1 2c20 cdc1 cec9 d0d5 ccd1 c3c9 d1cd  .., ............
00005c0: c920 cec1 c420 cdc1 d4c5 cdc1 d4c9 dec5  . ... ..........
00005d0: d3cb c9cd c920 0a7b 5c65 6d20 d7d9 d2c1  ..... .{\em ....
00005e0: d6c5 cec9 d1cd c97d 2c20 d720 cfc2 ddc5  .......}, . ....
00005f0: cd20 d3cc d5de c1c5 20d3 cfc4 c5d2 d6c1  . ...... .......
0000600: ddc9 cdc9 20d0 c5d2 c5cd c5ce ced9 c52c  .... ..........,
0000610: 20c1 20ce c520 d0d2 cfd3 d4cf 20de c9d3   . .. ...... ...
0000620: ccc5 cece d9cd c90a d2c1 d3de a3d4 c1cd  ................
0000630: c92e 20e5 d3d4 d820 cec5 d3cb cfcc d8cb  .. .... ........
0000640: cf20 d5d3 d0c5 dbce d9c8 203c 3cd3 c9d3  . ........ <<...
0000650: d4c5 cd20 cbcf cdd0 d8c0 d4c5 d2ce cfca  ... ............
0000660: 20c1 ccc7 c5c2 d2d9 3e3e 20d4 c1cb c9c8   .......>> .....
0000670: 20cb c1cb 0a4d 6178 696d 612c 204d 6170   ....Maxima, Map
0000680: 6c65 2061 6e64 204d 6174 6865 6d61 7469  le and Mathemati
0000690: 6361 2e20 efce c920 cfce c920 cdcf c7d5  ca. ... ... ....
00006a0: d420 d7d9 d0cf ccce d1d4 d820 d0cf ccc5  . ......... ....
00006b0: dace d9c5 0acd c1d4 c5cd c1d4 c9de c5d3  ................
00006c0: cbc9 c520 cfd0 c5d2 c1c3 c9c9 2c20 d4c1  ... ........, ..
00006d0: cbc9 c520 cbc1 cb20 d2c1 dacc cfd6 c5ce  ... ... ........
00006e0: c9c5 20cd cecf c7cf decc c5ce cfd7 20ce  .. ........... .
00006f0: c120 cdce cfd6 c9d4 c5cc c92c 200a c4c9  . ........., ...
0000700: c6c6 c5d2 c5ce c3c9 d2cf d7c1 cec9 c520  ............... 
0000710: c920 c9ce d4c5 c7d2 c9d2 cfd7 c1ce c9c5  . ..............
0000720: 20d7 d9d2 c1d6 c5ce c9ca 2e20 28ef cec9   .......... (...
0000730: 20d4 c1cb d6c5 20d0 d2c9 c7cf c4ce d920   ..... ........ 
0000740: c920 c4cc d10a cfc2 d9de ced9 c820 d7d9  . ........... ..
0000750: dec9 d3cc c5ce c9ca 2e29 20ed d920 d0cf  .........) .. ..
0000760: cbc1 d6c5 cd20 cbc1 cb20 dac1 c4c1 dec9  ..... ... ......
0000770: 20d4 c1cb cfc7 cf20 d2cf c4c1 20cd cfc7   ...... .... ...
0000780: d5d4 20c2 d9d4 d820 d2c5 dbc5 ced9 20d3  .. .... ...... .
0000790: 20d0 cfcd cfdd d8c0 204d 4c2e 0a0a 2525   ....... ML...%%
00007a0: 5468 6520 7068 7261 7365 2060 7379 6d62  The phrase `symb
00007b0: 6f6c 6963 2063 6f6d 7075 7461 7469 6f6e  olic computation
00007c0: 2720 6973 2061 2062 6974 2076 6167 7565  ' is a bit vague
00007d0: 2c20 6275 7420 726f 7567 686c 7920 7370  , but roughly sp
00007e0: 6561 6b69 6e67 2069 740a 2525 636f 7665  eaking it.%%cove
00007f0: 7273 2061 7070 6c69 6361 7469 6f6e 7320  rs applications 
0000800: 7768 6572 6520 6d61 6e69 7075 6c61 7469  where manipulati
0000810: 6f6e 206f 6620 6d61 7468 656d 6174 6963  on of mathematic
0000820: 616c 207b 5c65 6d20 6578 7072 6573 7369  al {\em expressi
0000830: 6f6e 737d 2c20 696e 0a25 2567 656e 6572  ons}, in.%%gener
0000840: 616c 2063 6f6e 7461 696e 696e 6720 7661  al containing va
0000850: 7269 6162 6c65 732c 2069 7320 656d 7068  riables, is emph
0000860: 6173 697a 6564 2061 7420 7468 6520 6578  asized at the ex
0000870: 7065 6e73 6520 6f66 2061 6374 7561 6c20  pense of actual 
0000880: 6e75 6d65 7269 6361 6c0a 2525 6361 6c63  numerical.%%calc
0000890: 756c 6174 696f 6e2e 2054 6865 7265 2061  ulation. There a
00008a0: 7265 2073 6576 6572 616c 2073 7563 6365  re several succe
00008b0: 7373 6675 6c20 6063 6f6d 7075 7465 7220  ssful `computer 
00008c0: 616c 6765 6272 6120 7379 7374 656d 7327  algebra systems'
00008d0: 2073 7563 6820 6173 0a25 2541 7869 6f6d   such as.%%Axiom
00008e0: 2c20 4d61 706c 6520 616e 6420 4d61 7468  , Maple and Math
00008f0: 656d 6174 6963 612c 2077 6869 6368 2063  ematica, which c
0000900: 616e 2064 6f20 6365 7274 6169 6e20 7379  an do certain sy
0000910: 6d62 6f6c 6963 206f 7065 7261 7469 6f6e  mbolic operation
0000920: 7320 7468 6174 2061 7265 0a25 2575 7365  s that are.%%use
0000930: 6675 6c20 696e 206d 6174 6865 6d61 7469  ful in mathemati
0000940: 6373 2c20 652e 672e 2066 6163 746f 7269  cs, e.g. factori
0000950: 7a69 6e67 2070 6f6c 796e 6f6d 6961 6c73  zing polynomials
0000960: 2061 6e64 2064 6966 6665 7265 6e74 6961   and differentia
0000970: 7469 6e67 2061 6e64 0a25 2569 6e74 6567  ting and.%%integ
0000980: 7261 7469 6e67 2065 7870 7265 7373 696f  rating expressio
0000990: 6e73 2e20 2854 6865 7920 6172 6520 616c  ns. (They are al
00009a0: 736f 2063 6170 6162 6c65 206f 6620 7075  so capable of pu
00009b0: 7265 6c79 206e 756d 6572 6963 616c 2077  rely numerical w
00009c0: 6f72 6b2e 2920 5765 0a25 2577 696c 6c20  ork.) We.%%will 
00009d0: 696c 6c75 7374 7261 7465 2068 6f77 2074  illustrate how t
00009e0: 6869 7320 736f 7274 206f 6620 6170 706c  his sort of appl
00009f0: 6963 6174 696f 6e20 6361 6e20 6265 2074  ication can be t
0000a00: 6163 6b6c 6564 2075 7369 6e67 204d 4c2e  ackled using ML.
0000a10: 0a0a edd9 20d7 d9c2 d2c1 ccc9 20d3 c9cd  .... ....... ...
0000a20: d7cf ccd8 cecf c520 c4c9 c6c6 c5d2 c5ce  ....... ........
0000a30: c3c9 d2cf d7c1 cec9 c520 c4cc d120 cec1  ......... ... ..
0000a40: dbc5 c7cf 20d0 d2c9 cdc5 d2c1 2c20 d0cf  .... ......., ..
0000a50: d4cf cdd5 20de d4cf 20c4 ccd1 20ce c5c7  .... ... ... ...
0000a60: cf0a c5d3 d4d8 20c4 cfd7 cfcc d8ce cf20  ...... ........ 
0000a70: d0d2 cfd3 d4cf ca20 c920 c9da d7c5 d3d4  ....... . ......
0000a80: ced9 ca20 c1cc c7cf d2c9 d4cd 2e20 fec9  ... ......... ..
0000a90: d4c1 d4c5 ccd8 2c20 d7cf dacd cfd6 cecf  ......, ........
0000aa0: 2c20 dace c1cb cfcd 0ad3 20cf d0d2 c5c4  , ........ .....
0000ab0: c5cc a3ce ced9 cdc9 20d0 d2cf c9da d7cf  ........ .......
0000ac0: c4ce d9cd c920 cfd3 cecf d7ce d9c8 20c6  ..... ........ .
0000ad0: d5ce cbc3 c9ca 2c20 cec1 d0d2 c9cd c5d2  ......, ........
0000ae0: 2024 7b64 205c 6f76 6572 2064 787d 2073   ${d \over dx} s
0000af0: 696e 2878 2920 3d0a 636f 7328 7829 242c  in(x) =.cos(x)$,
0000b00: 20c1 20d4 c1cb d6c5 20d3 20d0 d2c1 d7c9   . ..... . .....
0000b10: ccc1 cdc9 20c4 c9c6 c6c5 d2c5 cec3 c9d2  .... ...........
0000b20: cfd7 c1ce c9d1 20d0 d2cf c9da d7c5 c4c5  ...... .........
0000b30: cec9 d120 c920 cbcf cdd0 cfda c9c3 c9c9  ... . ..........
0000b40: 200a c6d5 cecb c3c9 ca2e 20f0 cfd3 cbcf   ......... .....
0000b50: ccd8 cbd5 20cb c1d6 c4d9 ca20 cdcf d6c5  .... ...... ....
0000b60: d420 d3c9 d3d4 c5cd c1d4 c9de c5d3 cbc9  . ..............
0000b70: 20c9 d3d0 cfcc d8da cfd7 c1d4 d820 20dc   ............  .
0000b80: d4c9 20d0 d2c1 d7c9 ccc1 0ac4 ccd1 20ce  .. ........... .
0000b90: c1c8 cfd6 c4c5 cec9 d120 d0d2 cfc9 dad7  ......... ......
0000ba0: cfc4 ced9 c82c 20d4 cf20 d7cf dacd cfd6  ....., .. ......
0000bb0: cecf 20c9 20da c1d0 d2cf c7d2 c1cd cdc9  .. . ...........
0000bc0: d2cf d7c1 d4d8 20c9 c820 cec1 204d 4c2e  ...... .. .. ML.
0000bd0: 200a 0a25 2557 6520 7573 6520 7379 6d62   ..%%We use symb
0000be0: 6f6c 6963 2064 6966 6665 7265 6e74 6961  olic differentia
0000bf0: 7469 6f6e 2061 7320 6f75 7220 6578 616d  tion as our exam
0000c00: 706c 652c 2062 6563 6175 7365 2074 6865  ple, because the
0000c10: 7265 2069 7320 616e 2061 6c67 6f72 6974  re is an algorit
0000c20: 686d 0a25 2574 6f20 646f 2069 7420 7768  hm.%%to do it wh
0000c30: 6963 6820 6973 2066 6169 726c 7920 7369  ich is fairly si
0000c40: 6d70 6c65 2061 6e64 2077 656c 6c20 6b6e  mple and well kn
0000c50: 6f77 6e2e 2054 6865 2072 6561 6465 7220  own. The reader 
0000c60: 6973 2070 726f 6261 626c 7920 6661 6d69  is probably fami
0000c70: 6c69 6172 0a25 2577 6974 6820 6365 7274  liar.%%with cert
0000c80: 6169 6e20 6465 7269 7661 7469 7665 7320  ain derivatives 
0000c90: 6f66 2062 6173 6963 206f 7065 7261 7469  of basic operati
0000ca0: 6f6e 732c 2065 2e67 2024 7b64 205c 6f76  ons, e.g ${d \ov
0000cb0: 6572 2064 787d 2073 696e 2878 2920 3d0a  er dx} sin(x) =.
0000cc0: 2525 636f 7328 7829 242c 2061 7320 7765  %%cos(x)$, as we
0000cd0: 6c6c 2061 7320 7265 7375 6c74 7320 7375  ll as results su
0000ce0: 6368 2061 7320 7468 6520 4368 6169 6e20  ch as the Chain 
0000cf0: 5275 6c65 2061 6e64 2050 726f 6475 6374  Rule and Product
0000d00: 2052 756c 6520 666f 720a 2525 6361 6c63   Rule for.%%calc
0000d10: 756c 6174 696e 6720 7468 6520 6465 7269  ulating the deri
0000d20: 7661 7469 7665 7320 6f66 2063 6f6d 706f  vatives of compo
0000d30: 7369 7465 2065 7870 7265 7373 696f 6e73  site expressions
0000d40: 2069 6e20 7465 726d 7320 6f66 2074 6865   in terms of the
0000d50: 0a25 2564 6572 6976 6174 6976 6573 206f  .%%derivatives o
0000d60: 6620 7468 6520 636f 6d70 6f6e 656e 7473  f the components
0000d70: 2e20 4a75 7374 2061 7320 6f6e 6520 6361  . Just as one ca
0000d80: 6e20 7573 6520 7468 6573 6520 7379 7374  n use these syst
0000d90: 656d 6174 6963 616c 6c79 2069 6e0a 2525  ematically in.%%
0000da0: 6f72 6465 7220 746f 2066 696e 6420 6465  order to find de
0000db0: 7269 7661 7469 7665 732c 2069 7420 6973  rivatives, it is
0000dc0: 2070 6f73 7369 626c 6520 746f 2070 726f   possible to pro
0000dd0: 6772 616d 2061 2066 6169 726c 7920 7374  gram a fairly st
0000de0: 7261 6967 6874 666f 7277 6172 640a 2525  raightforward.%%
0000df0: 616c 676f 7269 7468 6d20 746f 2064 6f20  algorithm to do 
0000e00: 6974 2069 6e20 4d4c 2e0a 0a0a 5c73 7562  it in ML....\sub
0000e10: 7365 6374 696f 6e7b f4c5 d2cd d920 d0c5  section{..... ..
0000e20: d2d7 cfc7 cf20 d0cf d2d1 c4cb c13f 3f3f  ..... .......???
0000e30: 7d0a 0a5c 2342 5547 3a20 eec9 20cf 20cb  }..\#BUG: .. . .
0000e40: c1cb c9c8 20d4 c5d2 cdc1 c820 c920 d2c5  .... ...... . ..
0000e50: dec9 20ce c5d4 2e20 f3cc cfd6 cecf d3d4  .. .... ........
0000e60: c920 d0c5 d2c5 d7cf c4c1 3f3f 3f0a 2525  . ........???.%%
0000e70: 5c73 7562 7365 6374 696f 6e7b 4669 7273  \subsection{Firs
0000e80: 7420 6f72 6465 7220 7465 726d 737d 0a0a  t order terms}..
0000e90: edd9 20c2 d5c4 c5cd 20c4 cfd0 d5d3 cbc1  .. ..... .......
0000ea0: d4d8 20cd c1d4 c5cd c1d4 c9de c5d3 cbc9  .. .............
0000eb0: c520 d7d9 d2c1 d6c5 cec9 d120 d720 d7c5  . ......... . ..
0000ec0: d3d8 cdc1 20cf c2dd c5ca 20c6 cfd2 cdc5  .... ..... .....
0000ed0: 2e20 efce c920 cdcf c7d5 d40a c2d9 d4d8  . ... ..........
0000ee0: 20d0 cfd3 d4d2 cfc5 ced9 20c9 da20 d0c5   ......... .. ..
0000ef0: d2c5 cdc5 cece d9c8 20c9 20cb cfce d3d4  ........ . .....
0000f00: c1ce d42c 20d3 20c9 d3d0 cfcc d8da cfd7  ..., . .........
0000f10: c1ce c9c5 cd20 cfd0 c5d2 c1d4 cfd2 cfd7  ..... ..........
0000f20: 2e20 efd0 c5d2 c1d4 cfd2 d90a cdcf c7d5  . ..............
0000f30: d420 c2d9 d4d8 20d5 cec1 d2ce d9cd c92c  . .... ........,
0000f40: 20c2 c9ce c1d2 ced9 cdc9 2c20 d4c5 d2ce   ........., ....
0000f50: c1d2 ced9 cdc9 2c20 c9cc c92c 20d7 20cf  ......, ..., . .
0000f60: c2dd c5cd 20d3 ccd5 dec1 c52c 20c1 d2ce  .... ......, ...
0000f70: cfd3 d4c9 2024 6e24 2e0a edd9 20d7 d9d2  .... $n$.... ...
0000f80: c1d6 c1c5 cd20 dcd4 cf20 d320 d0cf cdcf  ..... ... . ....
0000f90: ddd8 c020 d3cc c5c4 d5c0 ddc5 c7cf 20d2  ... .......... .
0000fa0: c5cb d5d2 d3c9 d7ce cfc7 cf20 d4c9 d0c1  ........... ....
0000fb0: 20c4 c1ce ced9 c83a 0a0a 2525 5765 2077   ......:..%%We w
0000fc0: 696c 6c20 616c 6c6f 7720 6d61 7468 656d  ill allow mathem
0000fd0: 6174 6963 616c 2065 7870 7265 7373 696f  atical expressio
0000fe0: 6e73 2069 6e20 6120 6661 6972 6c79 2067  ns in a fairly g
0000ff0: 656e 6572 616c 2066 6f72 6d2e 2054 6865  eneral form. The
0001000: 7920 6d61 7920 6265 0a25 2562 7569 6c74  y may be.%%built
0001010: 2075 7020 6672 6f6d 2076 6172 6961 626c   up from variabl
0001020: 6573 2061 6e64 2063 6f6e 7374 616e 7473  es and constants
0001030: 2062 7920 7468 6520 6170 706c 6963 6174   by the applicat
0001040: 696f 6e20 6f66 206f 7065 7261 746f 7273  ion of operators
0001050: 2e20 5468 6573 650a 2525 6f70 6572 6174  . These.%%operat
0001060: 6f72 7320 6d61 7920 6265 2075 6e61 7279  ors may be unary
0001070: 2c20 6269 6e61 7279 2c20 7465 726e 6172  , binary, ternar
0001080: 792c 206f 7220 696e 2067 656e 6572 616c  y, or in general
0001090: 2024 6e24 2d61 7279 2e20 5765 2072 6570   $n$-ary. We rep
00010a0: 7265 7365 6e74 0a25 2574 6869 7320 7573  resent.%%this us
00010b0: 696e 6720 7468 6520 666f 6c6c 6f77 696e  ing the followin
00010c0: 6720 7265 6375 7273 6976 6520 6461 7461  g recursive data
00010d0: 7479 7065 3a0a 0a5c 6265 6769 6e7b 626f  type:..\begin{bo
00010e0: 7865 647d 5c62 6567 696e 7b76 6572 6261  xed}\begin{verba
00010f0: 7469 6d7d 0a20 2023 7479 7065 2074 6572  tim}.  #type ter
0001100: 6d20 3d20 5661 7220 6f66 2073 7472 696e  m = Var of strin
0001110: 670a 2020 2020 2020 2020 2020 2020 207c  g.             |
0001120: 2043 6f6e 7374 206f 6620 7374 7269 6e67   Const of string
0001130: 0a20 2020 2020 2020 2020 2020 2020 7c20  .             | 
0001140: 466e 206f 6620 7374 7269 6e67 202a 2028  Fn of string * (
0001150: 7465 726d 206c 6973 7429 3b3b 0a20 2054  term list);;.  T
0001160: 7970 6520 7465 726d 2064 6566 696e 6564  ype term defined
0001170: 2e0a 5c65 6e64 7b76 6572 6261 7469 6d7d  ..\end{verbatim}
0001180: 5c65 6e64 7b62 6f78 6564 7d0a 0a5c 6e6f  \end{boxed}..\no
0001190: 696e 6465 6e74 20ee c1d0 d2c9 cdc5 d22c  indent ........,
00011a0: 20d7 d9d2 c1d6 c5ce c9c5 3a0a 255c 6e6f   .........:.%\no
00011b0: 696e 6465 6e74 2046 6f72 2065 7861 6d70  indent For examp
00011c0: 6c65 2c20 7468 6520 6578 7072 6573 7369  le, the expressi
00011d0: 6f6e 3a0a 0a24 2420 7369 6e28 7820 2b20  on:..$$ sin(x + 
00011e0: 7929 202f 2063 6f73 2878 202d 2065 7870  y) / cos(x - exp
00011f0: 2879 2929 202d 206c 6e28 3120 2b20 7829  (y)) - ln(1 + x)
0001200: 2024 240a 0a5c 6e6f 696e 6465 6e74 20d0   $$..\noindent .
0001210: d2c5 c4d3 d4c1 d7cc d1c5 d4d3 d13a 0a25  .............:.%
0001220: 255c 6e6f 696e 6465 6e74 2069 7320 7265  %\noindent is re
0001230: 7072 6573 656e 7465 6420 6279 3a0a 0a5c  presented by:..\
0001240: 6265 6769 6e7b 626f 7865 647d 5c62 6567  begin{boxed}\beg
0001250: 696e 7b76 6572 6261 7469 6d7d 0a20 2046  in{verbatim}.  F
0001260: 6e28 222d 222c 5b46 6e28 222f 222c 5b46  n("-",[Fn("/",[F
0001270: 6e28 2273 696e 222c 5b46 6e28 222b 222c  n("sin",[Fn("+",
0001280: 5b56 6172 2022 7822 3b20 5661 7220 2279  [Var "x"; Var "y
0001290: 225d 295d 293b 0a20 2020 2020 2020 2020  "])]);.         
00012a0: 2020 2020 2020 2020 2046 6e28 2263 6f73           Fn("cos
00012b0: 222c 5b46 6e28 222d 222c 5b56 6172 2022  ",[Fn("-",[Var "
00012c0: 7822 3b20 466e 2822 6578 7022 2c5b 5661  x"; Fn("exp",[Va
00012d0: 7220 2279 225d 295d 295d 295d 293b 0a20  r "y"])])])]);. 
00012e0: 2020 2020 2020 2020 2046 6e28 226c 6e22           Fn("ln"
00012f0: 2c5b 466e 2822 2b22 2c5b 436f 6e73 7420  ,[Fn("+",[Const 
0001300: 2231 223b 2056 6172 2022 7822 5d29 5d29  "1"; Var "x"])])
0001310: 5d29 3b3b 0a5c 656e 647b 7665 7262 6174  ]);;.\end{verbat
0001320: 696d 7d5c 656e 647b 626f 7865 647d 0a0a  im}\end{boxed}..
0001330: 5c73 7562 7365 6374 696f 6e7b f0c5 dec1  \subsection{....
0001340: d4d8 7d0a 0afe d4c5 cec9 c520 c920 dac1  ..}........ . ..
0001350: d0c9 d3d8 20d7 d9d2 c1d6 c5ce c9ca 20d7  .... ......... .
0001360: 20d3 d9d2 cfcd 20d7 c9c4 c520 c4cf d7cf   ..... .... ....
0001370: ccd8 cecf 20ce c5d5 c4cf c2ce d92e 20fc  .... ......... .
0001380: d4cf 20cf c2dd c1d1 20d0 d2cf c2cc c5cd  .. ..... .......
0001390: c10a c4cc d120 d7d3 c5c8 20d3 c9d3 d4c5  ..... .... .....
00013a0: cd20 d3c9 cdd7 cfcc d8ce d9c8 20d7 d9de  . .......... ...
00013b0: c9d3 ccc5 cec9 ca2c 20c9 20cf c2d9 dece  ......., . .....
00013c0: cf20 c9ce d4c5 d2c6 c5ca d320 d3c9 d3d4  . ......... ....
00013d0: c5cd d920 d3cf c4c5 d2d6 c9d4 0a7b 5c65  ... .........{\e
00013e0: 6d20 d3c9 ced4 c1cb d3c9 dec5 d3cb c9ca  m ..............
00013f0: 20c1 cec1 ccc9 dac1 d4cf d220 28d0 c1d2   .......... (...
0001400: d3c5 d229 7d20 c920 7b5c 656d 20d3 c9d3  ...)} . {\em ...
0001410: d4c5 cdd9 20d7 d9d7 cfc4 c17d 2c20 d0cf  .... ......}, ..
0001420: dad7 cfcc d1c0 ddc9 c50a d7d7 cfc4 c9d4  ................
0001430: d820 c920 d7d9 d7cf c4c9 d4d8 20c4 c1ce  . . ........ ...
0001440: ced9 c520 d720 dec9 d4c1 c5cd cfca 20c6  ... . ........ .
0001450: cfd2 cdc5 2e20 f0cf c4d2 cfc2 cecf c520  ..... ......... 
0001460: cfc2 d3d5 d6c4 c5ce c9c5 20d3 c9ce d4c1  .......... .....
0001470: cbd3 c9de c5d3 cbcf c7cf 200a d2c1 dac2  .......... .....
0001480: cfd2 c120 cdd9 20cf d4cc cfd6 c9cd 2c20  ... .. ......., 
0001490: d0cf d3cb cfcc d8cb d520 dcd4 c12c 20d3  ......... ..., .
00014a0: c1cd c120 d0cf 20d3 c5c2 c520 d7c1 d6ce  ... .. .... ....
00014b0: c1d1 20d4 c5cd c12c 20c2 d5c4 c5d4 20cf  .. ...., ..... .
00014c0: c2d3 d5d6 c4c1 d4d8 d3d1 200a c4c1 ccc5  .......... .....
00014d0: c52c 20c1 20d3 c5ca dec1 d320 cdd9 20ce  ., . ...... .. .
00014e0: c1d0 c9db c5cd 20d0 d2cf d3d4 c5ce d8cb  ...... .........
00014f0: d5c0 20d3 c9d3 d4c5 cdd5 20d7 d9d7 cfc4  .. ....... .....
0001500: c120 c4cc d120 cec1 dbc9 c820 d7d9 d2c1  . ... ..... ....
0001510: d6c5 cec9 ca2e 20f4 c1cb d5c0 200a ded4  ...... ..... ...
0001520: cfc2 d92c 20d0 cf20 cbd2 c1ca cec5 ca20  ..., .. ....... 
0001530: cdc5 d2c5 2c20 cdd9 20cd cfc7 ccc9 20d7  ...., .. ..... .
0001540: c9c4 c5d4 d820 ded4 cf20 d0d2 cfc9 d3c8  ..... ... ......
0001550: cfc4 c9d4 2e20 edd9 20c8 cfd4 c9cd 2c20  ..... .. ....., 
0001560: ded4 cfc2 d920 0ad0 cfc4 c4c5 d2d6 c9d7  ..... ..........
0001570: c1cc c9d3 d820 cfc2 d9de ced9 c520 d3cf  ..... ....... ..
0001580: c7cc c1db c5ce c9d1 2c20 cbc1 cb20 d4cf  ........, ... ..
0001590: 3a0a 0a25 2552 6561 6469 6e67 2061 6e64  :..%%Reading and
00015a0: 2077 7269 7469 6e67 2065 7870 7265 7373   writing express
00015b0: 696f 6e73 2069 6e20 7468 6569 7220 7261  ions in their ra
00015c0: 7720 666f 726d 2069 7320 7261 7468 6572  w form is rather
00015d0: 2075 6e70 6c65 6173 616e 742e 2054 6869   unpleasant. Thi
00015e0: 7320 6973 0a25 2561 2067 656e 6572 616c  s is.%%a general
00015f0: 2070 726f 626c 656d 2069 6e20 616c 6c20   problem in all 
0001600: 7379 6d62 6f6c 6963 2063 6f6d 7075 7461  symbolic computa
0001610: 7469 6f6e 2073 7973 7465 6d73 2c20 616e  tion systems, an
0001620: 6420 7479 7069 6361 6c6c 7920 7468 650a  d typically the.
0001630: 2525 7379 7374 656d 2773 2069 6e74 6572  %%system's inter
0001640: 6661 6365 2063 6f6e 7461 696e 7320 6120  face contains a 
0001650: 7b5c 656d 2070 6172 7365 727d 2061 6e64  {\em parser} and
0001660: 207b 5c65 6d20 7072 6574 7479 7072 696e   {\em prettyprin
0001670: 7465 727d 2074 6f20 616c 6c6f 770a 2525  ter} to allow.%%
0001680: 7265 7370 6563 7469 7665 6c79 2069 6e70  respectively inp
0001690: 7574 2061 6e64 206f 7574 7075 7420 696e  ut and output in
00016a0: 2061 2072 6561 6461 626c 6520 666f 726d   a readable form
00016b0: 2e20 4120 6465 7461 696c 6564 2064 6973  . A detailed dis
00016c0: 6375 7373 696f 6e20 6f66 0a25 2570 6172  cussion of.%%par
00016d0: 7369 6e67 2069 7320 706f 7374 706f 6e65  sing is postpone
00016e0: 642c 2073 696e 6365 2069 7420 6973 2077  d, since it is w
00016f0: 6f72 7468 2061 2073 6563 7469 6f6e 206f  orth a section o
0001700: 6620 6974 7320 6f77 6e2c 2062 7574 2077  f its own, but w
0001710: 6520 7769 6c6c 206e 6f77 0a25 2577 7269  e will now.%%wri
0001720: 7465 2061 2076 6572 7920 7369 6d70 6c65  te a very simple
0001730: 2070 7269 6e74 6572 2066 6f72 2065 7870   printer for exp
0001740: 7265 7373 696f 6e73 2c20 736f 2074 6861  ressions, so tha
0001750: 7420 6174 206c 6561 7374 2077 6520 6361  t at least we ca
0001760: 6e20 7365 6520 7768 6174 2773 0a25 2567  n see what's.%%g
0001770: 6f69 6e67 206f 6e2e 2057 6520 7761 6e74  oing on. We want
0001780: 2074 6865 2070 7269 6e74 6572 2074 6f20   the printer to 
0001790: 7375 7070 6f72 7420 6f72 6469 6e61 7279  support ordinary
00017a0: 2068 756d 616e 2063 6f6e 7665 6e74 696f   human conventio
00017b0: 6e73 2c20 692e 652e 0a0a 5c62 6567 696e  ns, i.e...\begin
00017c0: 7b69 7465 6d69 7a65 7d0a 0a5c 6974 656d  {itemize}..\item
00017d0: 20f0 c5d2 c5cd c5ce ced9 c520 c920 cbcf   .......... . ..
00017e0: ced3 d4c1 ced4 d920 dac1 d0c9 d3d9 d7c1  ....... ........
00017f0: c0d4 d3d1 20d0 cf20 c9c8 20c9 cdc5 cec1  .... .. .. .....
0001800: cd2e 0a25 255c 6974 656d 2056 6172 6961  ...%%\item Varia
0001810: 626c 6573 2061 6e64 2063 6f6e 7374 616e  bles and constan
0001820: 7473 2061 7265 206a 7573 7420 7772 6974  ts are just writ
0001830: 7465 6e20 6173 2074 6865 6972 206e 616d  ten as their nam
0001840: 6573 2e0a 0a5c 6974 656d 20ef c2d9 dece  es...\item .....
0001850: d9c5 2024 6e24 2dc1 d2ce d9c5 20c6 d5ce  .. $n$-..... ...
0001860: cbc3 c9c9 2c20 d7d9 d7cf c4d1 d4d3 d120  ...., ......... 
0001870: d720 d7c9 c4c5 200a 2466 2878 5f31 2c5c  . .... .$f(x_1,\
0001880: 6c64 6f74 732c 785f 6e29 242c 20d4 2ec5  ldots,x_n)$, ...
0001890: 2e20 dac1 d0c9 d3d9 d7c1 c5d4 d3d1 20c9  . ............ .
00018a0: cdd1 20c6 d5ce cbc3 c9c9 20c9 20d2 d1c4  .. ....... . ...
00018b0: cfcd 2c20 d720 d3cb cfc2 cbc1 c80a d3d0  .., . ..........
00018c0: c9d3 cfcb 20c1 d2c7 d5cd c5ce d4cf d72e  .... ...........
00018d0: 0a0a 2525 5c69 7465 6d20 4f72 6469 6e61  ..%%\item Ordina
00018e0: 7279 2024 6e24 2d61 7279 2066 756e 6374  ry $n$-ary funct
00018f0: 696f 6e73 2061 7070 6c69 6564 2074 6f20  ions applied to 
0001900: 6172 6775 6d65 6e74 7320 6172 6520 7772  arguments are wr
0001910: 6974 7465 6e20 6279 0a25 256a 7578 7461  itten by.%%juxta
0001920: 706f 7369 6e67 2074 6865 2066 756e 6374  posing the funct
0001930: 696f 6e20 616e 6420 6120 6272 6163 6b65  ion and a bracke
0001940: 7465 6420 6c69 7374 206f 6620 6172 6775  ted list of argu
0001950: 6d65 6e74 732c 2065 2e67 2e0a 2525 2466  ments, e.g..%%$f
0001960: 2878 5f31 2c5c 6c64 6f74 732c 785f 6e29  (x_1,\ldots,x_n)
0001970: 242e 0a0a 5c69 7465 6d20 e9ce c6c9 cbd3  $...\item ......
0001980: ced9 c520 c2c9 cec1 d2ce d9c5 20c6 d5ce  ... ........ ...
0001990: cbc3 c9c9 2c20 d4c1 cbc9 c520 cbc1 cb20  ...., ..... ... 
00019a0: 242b 2420 dac1 d0c9 d3d9 d7c1 c0d4 d3d1  $+$ ............
00019b0: 20cd c5d6 c4d5 0ad3 d7cf c9cd c920 c1d2   ............ ..
00019c0: c7d5 cdc5 ced4 c1cd c92e 0a0a 2525 5c69  ............%%\i
00019d0: 7465 6d20 496e 6669 7820 6269 6e61 7279  tem Infix binary
00019e0: 2066 756e 6374 696f 6e73 206c 696b 6520   functions like 
00019f0: 242b 2420 6172 6520 7772 6974 7465 6e20  $+$ are written 
0001a00: 696e 2062 6574 7765 656e 2074 6865 6972  in between their
0001a10: 0a25 2561 7267 756d 656e 7473 2e0a 0a5c  .%%arguments...\
0001a20: 6974 656d 20f3 cbcf c2cb c920 c9d3 d0cf  item ...... ....
0001a30: ccd8 dad5 c0d4 d3d1 20d0 cf20 cec5 cfc2  ........ .. ....
0001a40: c8cf c4c9 cdcf d3d4 c92e 0a0a 2525 5c69  ............%%\i
0001a50: 7465 6d20 4272 6163 6b65 7473 2061 7265  tem Brackets are
0001a60: 2075 7365 6420 7768 6572 6520 6e65 6365   used where nece
0001a70: 7373 6172 7920 666f 7220 6469 7361 6d62  ssary for disamb
0001a80: 6967 7561 7469 6f6e 2e0a 0a5c 6974 656d  iguation...\item
0001a90: 20f7 20c3 c5cc d1c8 20d3 cfcb d2c1 ddc5   . ..... .......
0001aa0: cec9 d120 c9d3 d0cf ccd8 dacf d7c1 cec9  ... ............
0001ab0: d120 d3cb cfc2 cfcb 2c20 c4cc d120 c9ce  . ......, ... ..
0001ac0: c6c9 cbd3 ced9 c820 cfd0 c5d2 c1d4 cfd2  ....... ........
0001ad0: cfd7 2020 0acf d0d2 c5c4 c5cc a3ce 20d0  ..  .......... .
0001ae0: d2c9 cfd2 c9d4 c5d4 2e20 200a 2020 0a25  .........  .  .%
0001af0: 255c 6974 656d 2049 6e66 6978 206f 7065  %\item Infix ope
0001b00: 7261 746f 7273 2068 6176 6520 6120 6e6f  rators have a no
0001b10: 7469 6f6e 206f 6620 7072 6563 6564 656e  tion of preceden
0001b20: 6365 2074 6f20 7265 6475 6365 2074 6865  ce to reduce the
0001b30: 206e 6565 6420 666f 720a 2525 6272 6163   need for.%%brac
0001b40: 6b65 7473 2e0a 0a5c 656e 647b 6974 656d  kets...\end{item
0001b50: 697a 657d 0a0a f3ce c1de c1cc c120 cdd9  ize}......... ..
0001b60: 20cf c2df d1d7 c9cd 20d3 d0c9 d3cf cb20   ....... ...... 
0001b70: c9ce c6c9 cbd3 ced9 c820 cfd0 c5d2 c1d4  ......... ......
0001b80: cfd2 cfd7 202d 20d3 d0c9 d3cf cb20 d0c1  .... - ...... ..
0001b90: d220 c9da 20c9 cdc5 cec9 20cf d0c5 d2c1  . .. ..... .....
0001ba0: d4cf d2c1 0ac9 20c5 c7cf 20d0 d2c9 cfd2  ...... ... .....
0001bb0: c9d4 c5d4 c12e 0a0a 2525 4669 7273 7420  ........%%First 
0001bc0: 7765 2064 6563 6c61 7265 2061 206c 6973  we declare a lis
0001bd0: 7420 6f66 2069 6e66 6978 6573 2c20 7768  t of infixes, wh
0001be0: 6963 6820 6973 2061 206c 6973 7420 6f66  ich is a list of
0001bf0: 2070 6169 7273 3a20 6561 6368 206f 7065   pairs: each ope
0001c00: 7261 746f 720a 2525 6e61 6d65 2074 6f67  rator.%%name tog
0001c10: 6574 6865 7220 7769 7468 2069 7473 2070  ether with its p
0001c20: 7265 6365 6465 6e63 652e 0a0a 5c62 6567  recedence...\beg
0001c30: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
0001c40: 7665 7262 6174 696d 7d0a 2020 236c 6574  verbatim}.  #let
0001c50: 2069 6e66 6978 6573 203d 205b 222b 222c   infixes = ["+",
0001c60: 3130 3b20 222d 222c 3130 3b20 222a 222c  10; "-",10; "*",
0001c70: 3230 3b20 222f 222c 3230 5d3b 3b0a 5c65  20; "/",20];;.\e
0001c80: 6e64 7b76 6572 6261 7469 6d7d 5c65 6e64  nd{verbatim}\end
0001c90: 7b62 6f78 6564 7d0a 0ae9 d3d0 cfcc d8da  {boxed}.........
0001ca0: cfd7 c1ce c9c5 20d3 d0c9 d3cb cfd7 20c4  ...... ....... .
0001cb0: ccd1 20d0 d2c5 c4d3 d4c1 d7cc c5ce c9d1  .. .............
0001cc0: 20cb cfce c5de ced9 c820 dec1 d3d4 c9de   ........ ......
0001cd0: ced9 c820 c6d5 cecb c3c9 ca20 d1d7 ccd1  ... ....... ....
0001ce0: c5d4 d3d1 200a d3d4 c1ce c4c1 d2d4 cecf  .... ...........
0001cf0: ca20 d0d2 c1cb d4c9 cbcf ca2e 20ef cec9  . .......... ...
0001d00: 20cf c2d9 dece cf20 cec1 dad9 d7c1 c0d4   ...... ........
0001d10: d3d1 207b 5c65 6d20 c1d3 d3cf c3c9 c1d4  .. {\em ........
0001d20: c9d7 ced9 cdc9 20d3 d0c9 d3cb c1cd c97d  ...... ........}
0001d30: 2c20 0ac9 20d7 c5d3 d8cd c120 d2c1 d3d0  , .. ...... ....
0001d40: d2cf d3d4 d2c1 cec5 ced9 20d7 20c6 d5ce  .......... . ...
0001d50: cbc3 c9cf cec1 ccd8 cecf cd20 d0d2 cfc7  ........... ....
0001d60: d2c1 cdcd c9d2 cfd7 c1ce c9c9 2e5c 666f  .............\fo
0001d70: 6f74 6e6f 7465 7be4 ccd1 20c2 cfcc c5c5  otnote{... .....
0001d80: 0ad4 d1d6 c5cc cfd7 c5d3 ced9 c820 d0d2  ............. ..
0001d90: c9cc cfd6 c5ce c9ca 2c20 c2cf ccd8 dbc5  ........, ......
0001da0: 20d0 cfc4 cfca c4d5 d420 c1cc d8d4 c5d2   ........ ......
0001db0: cec1 d4c9 d7d9 2c20 d4c1 cbc9 c520 cbc1  ......, ..... ..
0001dc0: cb20 c8c5 db20 2d20 d4c1 c2cc c9c3 d92c  . ... - .......,
0001dd0: 0ace cf20 c4cc d120 d0d2 cfd3 d4d9 c820  ... ... ....... 
0001de0: d0d2 c9cc cfd6 c5ce c9ca 2c20 d720 cbcf  .........., . ..
0001df0: d4cf d2cf d9c8 20d3 d0c9 d3cb c920 cec5  ...... ...... ..
0001e00: 20d3 ccc9 dbcb cfcd 20c4 ccc9 cece d92c   ....... ......,
0001e10: 20d2 c5db c5ce c9c5 20d7 20d7 c9c4 c520   ....... . .... 
0001e20: ccc9 cec5 cace cfc7 cf20 0ad3 d0c9 d3cb  ......... ......
0001e30: c120 d1d7 ccd1 c5d4 d3d1 20d0 d2cf d3d4  . ........ .....
0001e40: d9cd 20c9 20c1 c4c5 cbd7 c1d4 ced9 cd2e  .. . ...........
0001e50: 7d20 e4cc d120 d4cf c7cf 20de d4cf c2d9  } ... .... .....
0001e60: 20cb cfce d7c5 d2d4 c9d2 cfd7 c1d4 d820   .............. 
0001e70: d3d0 c9d3 cfcb 20d7 0ade c1d3 d4c9 dece  ...... .........
0001e80: d5c0 20c6 d5ce cbc3 c9c0 20cd d920 c9d3  .. ....... .. ..
0001e90: d0cf ccd8 dad5 c5cd 207b 5c74 7420 6173  ........ {\tt as
0001ea0: 736f 637d 3a0a 0a25 2549 7420 6973 2063  soc}:..%%It is c
0001eb0: 6f6d 6d6f 6e20 746f 2075 7365 206c 6973  ommon to use lis
0001ec0: 7473 2069 6e20 7468 6973 2077 6179 2074  ts in this way t
0001ed0: 6f20 7265 7072 6573 656e 7420 6669 6e69  o represent fini
0001ee0: 7465 2070 6172 7469 616c 2066 756e 6374  te partial funct
0001ef0: 696f 6e73 2c0a 2525 7369 6e63 6520 6974  ions,.%%since it
0001f00: 2061 6c6c 6f77 7320 6d6f 7265 2066 6c65   allows more fle
0001f10: 7869 6269 6c69 7479 2e20 5468 6579 2061  xibility. They a
0001f20: 7265 2063 6f6d 6d6f 6e6c 7920 6361 6c6c  re commonly call
0001f30: 6564 207b 5c65 6d20 6173 736f 6369 6174  ed {\em associat
0001f40: 696f 6e0a 2525 6c69 7374 737d 2c20 616e  ion.%%lists}, an
0001f50: 6420 6172 6520 7665 7279 2063 6f6d 6d6f  d are very commo
0001f60: 6e20 696e 2066 756e 6374 696f 6e61 6c20  n in functional 
0001f70: 7072 6f67 7261 6d6d 696e 672e 5c66 6f6f  programming.\foo
0001f80: 746e 6f74 657b 466f 7220 6d6f 7265 0a25  tnote{For more.%
0001f90: 2568 6561 7679 7765 6967 6874 2061 7070  %heavyweight app
0001fa0: 6c69 6361 7469 6f6e 732c 2073 6f6d 6520  lications, some 
0001fb0: 616c 7465 726e 6174 6976 6520 7375 6368  alternative such
0001fc0: 2061 7320 6861 7368 2074 6162 6c65 7320   as hash tables 
0001fd0: 6973 206d 7563 6820 6265 7474 6572 2c0a  is much better,.
0001fe0: 2525 6275 7420 666f 7220 7369 6d70 6c65  %%but for simple
0001ff0: 2061 7070 6c69 6361 7469 6f6e 7320 7768   applications wh
0002000: 6572 6520 7468 6520 6c69 7374 7320 646f  ere the lists do
0002010: 6e27 7420 6765 7420 746f 6f20 6c6f 6e67  n't get too long
0002020: 2c20 7468 6973 206b 696e 6420 6f66 0a25  , this kind of.%
0002030: 256c 696e 6561 7220 6c69 7374 2069 7320  %linear list is 
0002040: 7369 6d70 6c65 2061 6e64 2061 6465 7175  simple and adequ
0002050: 6174 652e 7d20 496e 206f 7264 6572 2074  ate.} In order t
0002060: 6f20 636f 6e76 6572 7420 7468 6520 6c69  o convert the li
0002070: 7374 2069 6e74 6f20 610a 2525 7061 7274  st into a.%%part
0002080: 6961 6c20 6675 6e63 7469 6f6e 2077 6520  ial function we 
0002090: 7573 6520 7b5c 7474 2061 7373 6f63 7d3a  use {\tt assoc}:
00020a0: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
00020b0: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
00020c0: 2020 236c 6574 2072 6563 2061 7373 6f63    #let rec assoc
00020d0: 2061 2028 2878 2c79 293a 3a72 6573 7429   a ((x,y)::rest)
00020e0: 203d 2069 6620 6120 3d20 7820 7468 656e   = if a = x then
00020f0: 2079 2065 6c73 6520 6173 736f 6320 6120   y else assoc a 
0002100: 7265 7374 3b3b 0a20 2054 6f70 6c65 7665  rest;;.  Topleve
0002110: 6c20 696e 7075 743a 0a20 203e 6c65 7420  l input:.  >let 
0002120: 7265 6320 6173 736f 6320 6120 2828 782c  rec assoc a ((x,
0002130: 7929 3a3a 7265 7374 2920 3d20 6966 2061  y)::rest) = if a
0002140: 203d 2078 2074 6865 6e20 7920 656c 7365   = x then y else
0002150: 2061 7373 6f63 2061 2072 6573 743b 3b0a   assoc a rest;;.
0002160: 2020 3e20 2020 2020 2020 205e 5e5e 5e5e    >        ^^^^^
0002170: 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e  ^^^^^^^^^^^^^^^^
0002180: 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e  ^^^^^^^^^^^^^^^^
0002190: 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e 5e5e  ^^^^^^^^^^^^^^^^
00021a0: 5e5e 5e5e 0a20 2057 6172 6e69 6e67 3a20  ^^^^.  Warning: 
00021b0: 7468 6973 206d 6174 6368 696e 6720 6973  this matching is
00021c0: 206e 6f74 2065 7868 6175 7374 6976 652e   not exhaustive.
00021d0: 0a20 2061 7373 6f63 203a 2027 6120 2d3e  .  assoc : 'a ->
00021e0: 2028 2761 202a 2027 6229 206c 6973 7420   ('a * 'b) list 
00021f0: 2d3e 2027 6220 3d20 3c66 756e 3e0a 5c65  -> 'b = <fun>.\e
0002200: 6e64 7b76 6572 6261 7469 6d7d 5c65 6e64  nd{verbatim}\end
0002210: 7b62 6f78 6564 7d0a 0aeb cfcd d0c9 ccd1  {boxed}.........
0002220: d4cf d220 d0d2 c5c4 d5d0 d2c5 d6c4 c1c5  ... ............
0002230: d420 cec1 d320 2d20 d7d9 dec9 d3cc c5ce  . ... - ........
0002240: c9c5 20c6 d5ce cbc3 c9c9 20cd cfd6 c5d4  .. ....... .....
0002250: 20d0 d2c5 d2d7 c1d4 d8d3 d12c 20c5 d3cc   .........., ...
0002260: c920 d0cf c4c8 cfc4 d1dd c9c5 200a c4c1  . .......... ...
0002270: cece d9c5 20ce c520 c2d5 c4d5 d420 cec1  .... .. ..... ..
0002280: cac4 c5ce d920 d720 d3d0 c9d3 cbc5 2e20  ..... . ....... 
0002290: f4c5 d0c5 d2d8 20cd d920 cdcf d6c5 cd20  ...... .. ..... 
00022a0: cfd0 d2c5 c4c5 ccc9 d4d8 20c6 d5ce cbc3  .......... .....
00022b0: c9c0 2c20 d7cf dad7 d2c1 ddc1 c0dd d5c0  .., ............
00022c0: 200a d0d2 c9cf d2c9 d4c5 d420 cfd0 c5d2   .......... ....
00022d0: c1d4 cfd2 c13a 0a0a 2525 5468 6520 636f  .....:..%%The co
00022e0: 6d70 696c 6572 2077 6172 6e73 2075 7320  mpiler warns us 
00022f0: 7468 6174 2069 6620 7468 6520 6170 7072  that if the appr
0002300: 6f70 7269 6174 6520 6461 7461 2069 7320  opriate data is 
0002310: 6e6f 7420 666f 756e 6420 696e 2074 6865  not found in the
0002320: 206c 6973 742c 0a25 2574 6865 2066 756e   list,.%%the fun
0002330: 6374 696f 6e20 7769 6c6c 2066 6169 6c2e  ction will fail.
0002340: 204e 6f77 2077 6520 6361 6e20 6465 6669   Now we can defi
0002350: 6e65 2061 2066 756e 6374 696f 6e20 746f  ne a function to
0002360: 2067 6574 2074 6865 2069 6e66 6978 0a25   get the infix.%
0002370: 2570 7265 6365 6465 6e63 6520 6f66 2061  %precedence of a
0002380: 2066 756e 6374 696f 6e3a 0a0a 5c62 6567   function:..\beg
0002390: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
00023a0: 7665 7262 6174 696d 7d0a 2020 236c 6574  verbatim}.  #let
00023b0: 2067 6574 5f70 7265 6365 6465 6e63 6520   get_precedence 
00023c0: 7320 3d20 6173 736f 6320 7320 696e 6669  s = assoc s infi
00023d0: 7865 733b 3b0a 2020 6765 745f 7072 6563  xes;;.  get_prec
00023e0: 6564 656e 6365 203a 2073 7472 696e 6720  edence : string 
00023f0: 2d3e 2069 6e74 203d 203c 6675 6e3e 0a20  -> int = <fun>. 
0002400: 2023 6765 745f 7072 6563 6564 656e 6365   #get_precedence
0002410: 2022 2b22 3b3b 0a20 202d 203a 2069 6e74   "+";;.  - : int
0002420: 203d 2031 300a 2020 2367 6574 5f70 7265   = 10.  #get_pre
0002430: 6365 6465 6e63 6520 222f 223b 3b0a 2020  cedence "/";;.  
0002440: 2d20 3a20 696e 7420 3d20 3230 0a20 2023  - : int = 20.  #
0002450: 6765 745f 7072 6563 6564 656e 6365 2022  get_precedence "
0002460: 2522 3b3b 0a20 2055 6e63 6175 6768 7420  %";;.  Uncaught 
0002470: 6578 6365 7074 696f 6e3a 204d 6174 6368  exception: Match
0002480: 5f66 6169 6c75 7265 2028 2222 2c20 3635  _failure ("", 65
0002490: 3434 2c20 3636 3031 290a 5c65 6e64 7b76  44, 6601).\end{v
00024a0: 6572 6261 7469 6d7d 5c65 6e64 7b62 6f78  erbatim}\end{box
00024b0: 6564 7d0a 0aef c2d2 c1d4 c9d4 c520 d7ce  ed}.......... ..
00024c0: c9cd c1ce c9c5 2c20 c5d3 ccc9 20cd d920  ......, .... .. 
00024d0: cbcf c7c4 c120 2d20 ccc9 c2cf 20c9 dacd  ..... - .... ...
00024e0: c5ce c9cd 20dc d4cf d420 d3d0 c9d3 cfcb  .... .... ......
00024f0: 20cf d0c5 d2c1 d4cf d2cf d72c 200a d4cf   .........., ...
0002500: 20d7 d3d1 cbd5 c020 c6d5 cecb c3c9 c02c   ...... .......,
0002510: 20d7 d2cf c4c5 207b 5c74 7420 6765 745c   ..... {\tt get\
0002520: 5f70 7265 6365 6465 6e63 657d 2c20 c9d3  _precedence}, ..
0002530: d0cf ccd8 dad5 c0dd d5c0 20c5 c7cf 2c20  .......... ..., 
0002540: d0cf d4d2 c5c2 d5c5 d4d3 d120 0ad0 c5d2  ........... ....
0002550: c5cf d0d2 c5c4 c5cc c9d4 d82e 20fc d4cf  ............ ...
0002560: 20d1 d7cc d1c5 d4d3 d120 cfd3 cecf d7ce   ........ ......
0002570: cfca 20d0 d2c9 dec9 cecf ca2c 20d0 cf20  .. ........, .. 
0002580: cbcf d4cf d2cf ca20 cdce cfc7 c9c5 2020  ....... ......  
0002590: 4c49 5350 20d0 d2cf c7d2 c1cd cdc9 d3d4  LISP ...........
00025a0: d920 0ad0 d2c5 c4d0 cfde c9d4 c1c0 d420  . ............. 
00025b0: c4c9 cec1 cdc9 dec5 d3cb cfc5 20d3 d7d1  ............ ...
00025c0: dad9 d7c1 cec9 c52e 20ed d920 cdcf d6c5  ........ .. ....
00025d0: cd20 d3c4 c5cc c1d4 d820 cdce cfd6 c5d3  . ....... ......
00025e0: d4d7 cf20 c9ce c6c9 cbd3 ced9 c820 cfd0  ... ......... ..
00025f0: c5d2 c1d4 cfd2 cfd7 200a d0d2 cfc9 dad7  ........ .......
0002600: cfcc d8ce cf20 d2c1 d3db c9d2 d1c5 cdd9  ..... ..........
0002610: cd2c 20c9 d3d0 cfcc d8da d5d1 20cf c2d2  ., ......... ...
0002620: c1dd c5ce c9c5 20d0 cf20 d3d3 d9cc cbc5  ...... .. ......
0002630: 3a0a 0a25 254e 6f74 6520 7468 6174 2069  :..%%Note that i
0002640: 6620 7765 2065 7665 7220 6368 616e 6765  f we ever change
0002650: 2074 6869 7320 6c69 7374 206f 6620 696e   this list of in
0002660: 6669 7865 732c 2074 6865 6e20 616e 7920  fixes, then any 
0002670: 6675 6e63 7469 6f6e 7320 7375 6368 2061  functions such a
0002680: 730a 2525 7b5c 7474 2067 6574 5c5f 7072  s.%%{\tt get\_pr
0002690: 6563 6564 656e 6365 7d20 7468 6174 2075  ecedence} that u
00026a0: 7365 2069 7420 6e65 6564 2074 6f20 6265  se it need to be
00026b0: 2072 6564 6563 6c61 7265 642e 2054 6869   redeclared. Thi
00026c0: 7320 6973 2074 6865 206d 6169 6e0a 2525  s is the main.%%
00026d0: 7265 6173 6f6e 2077 6879 206d 616e 7920  reason why many 
00026e0: 4c49 5350 2070 726f 6772 616d 6d65 7273  LISP programmers
00026f0: 2070 7265 6665 7220 6479 6e61 6d69 6320   prefer dynamic 
0002700: 6269 6e64 696e 672e 2048 6f77 6576 6572  binding. However
0002710: 2077 6520 6361 6e20 6d61 6b65 0a25 2574   we can make.%%t
0002720: 6865 2073 6574 206f 6620 696e 6669 7865  he set of infixe
0002730: 7320 6172 6269 7472 6172 696c 7920 6578  s arbitrarily ex
0002740: 7465 6e73 6962 6c65 2062 7920 6d61 6b69  tensible by maki
0002750: 6e67 2069 7420 696e 746f 2061 2072 6566  ng it into a ref
0002760: 6572 656e 6365 2061 6e64 0a25 2564 6572  erence and.%%der
0002770: 6566 6572 656e 6369 6e67 2069 7420 6f6e  eferencing it on
0002780: 2065 6163 6820 6170 706c 6963 6174 696f   each applicatio
0002790: 6e3a 0a0a 0a5c 6265 6769 6e7b 626f 7865  n:...\begin{boxe
00027a0: 647d 5c62 6567 696e 7b76 6572 6261 7469  d}\begin{verbati
00027b0: 6d7d 0a20 2023 6c65 7420 696e 6669 7865  m}.  #let infixe
00027c0: 7320 3d20 7265 6620 5b22 2b22 2c31 303b  s = ref ["+",10;
00027d0: 2022 2d22 2c31 303b 2022 2a22 2c32 303b   "-",10; "*",20;
00027e0: 2022 2f22 2c32 305d 3b3b 0a20 2069 6e66   "/",20];;.  inf
00027f0: 6978 6573 203a 2028 7374 7269 6e67 202a  ixes : (string *
0002800: 2069 6e74 2920 6c69 7374 2072 6566 203d   int) list ref =
0002810: 0a20 2020 2072 6566 205b 222b 222c 2031  .    ref ["+", 1
0002820: 303b 2022 2d22 2c20 3130 3b20 222a 222c  0; "-", 10; "*",
0002830: 2032 303b 2022 2f22 2c20 3230 5d0a 2020   20; "/", 20].  
0002840: 236c 6574 2067 6574 5f70 7265 6365 6465  #let get_precede
0002850: 6e63 6520 7320 3d20 6173 736f 6320 7320  nce s = assoc s 
0002860: 2821 696e 6669 7865 7329 3b3b 0a20 2067  (!infixes);;.  g
0002870: 6574 5f70 7265 6365 6465 6e63 6520 3a20  et_precedence : 
0002880: 7374 7269 6e67 202d 3e20 696e 7420 3d20  string -> int = 
0002890: 3c66 756e 3e0a 2020 2367 6574 5f70 7265  <fun>.  #get_pre
00028a0: 6365 6465 6e63 6520 225e 223b 3b0a 2020  cedence "^";;.  
00028b0: 556e 6361 7567 6874 2065 7863 6570 7469  Uncaught excepti
00028c0: 6f6e 3a20 4d61 7463 685f 6661 696c 7572  on: Match_failur
00028d0: 6520 2822 222c 2036 3534 342c 2036 3630  e ("", 6544, 660
00028e0: 3129 0a20 2023 696e 6669 7865 7320 3a3d  1).  #infixes :=
00028f0: 2028 225e 222c 3330 293a 3a28 2169 6e66   ("^",30)::(!inf
0002900: 6978 6573 293b 3b0a 2020 2d20 3a20 756e  ixes);;.  - : un
0002910: 6974 203d 2028 290a 2020 2367 6574 5f70  it = ().  #get_p
0002920: 7265 6365 6465 6e63 6520 225e 223b 3b0a  recedence "^";;.
0002930: 2020 2d20 3a20 696e 7420 3d20 3330 0a5c    - : int = 30.\
0002940: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
0002950: 647b 626f 7865 647d 0a0a fac1 cdc5 d4d8  d{boxed}........
0002960: d4c5 2c20 d0cf 20d0 d2c1 d7c9 ccc1 cd20  .., .. ........ 
0002970: d7d9 dec9 d3cc c5ce c9d1 20d7 204d 4c2c  .......... . ML,
0002980: 20d2 c1da d9cd c5ce cfd7 c1ce c9c5 20d5   ............. .
0002990: cbc1 dac1 d4c5 ccd1 20d0 d2c9 cdc5 ced1  ........ .......
00029a0: c5d4 d3d1 20d4 cfcc d8cb cf0a d0cf d3cc  .... ...........
00029b0: c520 d4cf c7cf 2c20 cbc1 cb20 7b5c 7474  . ...., ... {\tt
00029c0: 2067 6574 5c5f 7072 6563 6564 656e 6365   get\_precedence
00029d0: 7d20 d0cf ccd5 dec1 c5d4 20d3 d7cf c920  } ........ .... 
00029e0: c1d2 c7d5 cdc5 ced4 d92c 20c9 2c20 d3cc  ........., ., ..
00029f0: c5c4 cfd7 c1d4 c5cc d8ce cf2c 200a d2c5  ..........., ...
0002a00: dad5 ccd8 d4c1 d4d9 20d7 20cd cecf d6c5  ........ . .....
0002a10: d3d4 d7c5 20cf d0c5 d2c1 d4cf d2cf d72e  .... ...........
0002a20: 20ed d920 d4c1 cbd6 c520 cdcf d6c5 cd20   .. ..... ..... 
0002a30: cfd0 d2c5 c4c5 ccc9 d4d8 20c6 d5ce cbc3  .......... .....
0002a40: c9c0 2c20 cfd0 d2c5 c4c5 ccd1 c0dd d5c0  .., ............
0002a50: 2c0a d1d7 ccd1 c5d4 d3d1 20cc c920 cec5  ,......... .. ..
0002a60: cbcf d4cf d2c1 d120 c6d5 cecb c3c9 d120  ....... ....... 
0002a70: c9ce c6c9 cbd3 ced9 cd20 cfd0 c5d2 c1d4  ......... ......
0002a80: cfd2 cfcd 2e20 edcf d6ce cf20 d0d2 cfd3  ..... ..... ....
0002a90: d4cf 20c9 d3d0 cfcc d8da cfd7 c1d4 d820  .. ............ 
0002aa0: 0a7b 5c74 7420 6765 745c 5f70 7265 6365  .{\tt get\_prece
0002ab0: 6465 6e63 657d 20c9 20d3 cdcf d4d2 c5d4  dence} . .......
0002ac0: d820 d3d2 c1c2 cfd4 c1cc c120 ccc9 20cf  . ......... .. .
0002ad0: cec1 3a0a 0a25 254e 6f74 6520 7468 6174  ..:..%%Note that
0002ae0: 2062 7920 7468 6520 4d4c 2065 7661 6c75   by the ML evalu
0002af0: 6174 696f 6e20 7275 6c65 732c 2074 6865  ation rules, the
0002b00: 2064 6572 6566 6572 656e 6369 6e67 2069   dereferencing i
0002b10: 7320 6f6e 6c79 2061 7070 6c69 6564 2061  s only applied a
0002b20: 6674 6572 0a25 2574 6865 2066 756e 6374  fter.%%the funct
0002b30: 696f 6e20 7b5c 7474 2067 6574 5c5f 7072  ion {\tt get\_pr
0002b40: 6563 6564 656e 6365 7d20 7265 6365 6976  ecedence} receiv
0002b50: 6573 2069 7473 2061 7267 756d 656e 742c  es its argument,
0002b60: 2061 6e64 2068 656e 6365 2072 6573 756c   and hence resul
0002b70: 7473 2069 6e0a 2525 7468 6520 7365 7420  ts in.%%the set 
0002b80: 6f66 2069 6e66 6978 6573 2061 7420 7468  of infixes at th
0002b90: 6174 2074 696d 652e 2057 6520 6361 6e20  at time. We can 
0002ba0: 616c 736f 2064 6566 696e 6520 6120 6675  also define a fu
0002bb0: 6e63 7469 6f6e 2074 6f20 6465 6369 6465  nction to decide
0002bc0: 0a25 2577 6865 7468 6572 2061 2066 756e  .%%whether a fun
0002bd0: 6374 696f 6e20 6861 7320 616e 7920 6461  ction has any da
0002be0: 7461 2061 7373 6f63 6961 7465 6420 7769  ta associated wi
0002bf0: 7468 2069 742e 204f 6e65 2077 6179 2069  th it. One way i
0002c00: 7320 7369 6d70 6c79 2074 6f20 7472 790a  s simply to try.
0002c10: 2525 7468 6520 6675 6e63 7469 6f6e 207b  %%the function {
0002c20: 5c74 7420 6765 745c 5f70 7265 6365 6465  \tt get\_precede
0002c30: 6e63 657d 2061 6e64 2073 6565 2069 6620  nce} and see if 
0002c40: 6974 2077 6f72 6b73 3a0a 0a5c 6265 6769  it works:..\begi
0002c50: 6e7b 626f 7865 647d 5c62 6567 696e 7b76  n{boxed}\begin{v
0002c60: 6572 6261 7469 6d7d 0a20 2023 6c65 7420  erbatim}.  #let 
0002c70: 6973 5f69 6e66 6978 2073 203d 0a20 2020  is_infix s =.   
0002c80: 2020 7472 7920 6765 745f 7072 6563 6564    try get_preced
0002c90: 656e 6365 2073 3b20 7472 7565 0a20 2020  ence s; true.   
0002ca0: 2020 7769 7468 205f 202d 3e20 6661 6c73    with _ -> fals
0002cb0: 653b 3b0a 5c65 6e64 7b76 6572 6261 7469  e;;.\end{verbati
0002cc0: 6d7d 5c65 6e64 7b62 6f78 6564 7d0a 0ae1  m}\end{boxed}...
0002cd0: ccd8 d4c5 d2ce c1d4 c9d7 c120 dac1 cbcc  ........... ....
0002ce0: c0de c1c5 d4d3 d120 d720 c9d3 d0cf ccd8  ....... . ......
0002cf0: dacf d7c1 cec9 c920 cfc2 ddc5 ca20 c6d5  ....... ..... ..
0002d00: cecb c3c9 c920 7b5c 7474 2063 616e 7d2c  ..... {\tt can},
0002d10: 20cb cfd4 cfd2 c1d1 20d0 d2cf d7c5 d2d1   ....... .......
0002d20: c5d4 20d5 d3d0 c5db cec1 20cc c90a c4d2  .. ....... .....
0002d30: d5c7 c1d1 20c6 d5ce cbc3 c9d1 3a0a 0a25  .... .......:..%
0002d40: 2541 6e20 616c 7465 726e 6174 6976 6520  %An alternative 
0002d50: 6973 2074 6f20 7573 6520 6120 6765 6e65  is to use a gene
0002d60: 7261 6c20 6675 6e63 7469 6f6e 207b 5c74  ral function {\t
0002d70: 7420 6361 6e7d 2074 6861 7420 6669 6e64  t can} that find
0002d80: 7320 6f75 7420 7768 6574 6865 720a 2525  s out whether.%%
0002d90: 616e 6f74 6865 7220 6675 6e63 7469 6f6e  another function
0002da0: 2073 7563 6365 6564 733a 0a0a 5c62 6567   succeeds:..\beg
0002db0: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
0002dc0: 7665 7262 6174 696d 7d0a 2020 236c 6574  verbatim}.  #let
0002dd0: 2063 616e 2066 2078 203d 2074 7279 2066   can f x = try f
0002de0: 2078 3b20 7472 7565 2077 6974 6820 5f20   x; true with _ 
0002df0: 2d3e 2066 616c 7365 3b3b 0a20 2063 616e  -> false;;.  can
0002e00: 203a 2028 2761 202d 3e20 2762 2920 2d3e   : ('a -> 'b) ->
0002e10: 2027 6120 2d3e 2062 6f6f 6c20 3d20 3c66   'a -> bool = <f
0002e20: 756e 3e0a 2020 236c 6574 2069 735f 696e  un>.  #let is_in
0002e30: 6669 7820 3d20 6361 6e20 6765 745f 7072  fix = can get_pr
0002e40: 6563 6564 656e 6365 3b3b 0a20 2069 735f  ecedence;;.  is_
0002e50: 696e 6669 7820 3a20 7374 7269 6e67 202d  infix : string -
0002e60: 3e20 626f 6f6c 203d 203c 6675 6e3e 0a5c  > bool = <fun>.\
0002e70: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
0002e80: 647b 626f 7865 647d 0a0a 5c6e 6f69 6e64  d{boxed}..\noind
0002e90: 656e 7420 edd9 20c2 d5c4 c5cd 20c9 d3d0  ent .. ..... ...
0002ea0: cfcc d8da cfd7 c1d4 d820 d3cc c5c4 d5c0  ......... ......
0002eb0: ddc9 c520 c6d5 cecb c3c9 c920 c9da 20d5  ... ....... .. .
0002ec0: d6c5 20d2 c1d3 d3cd cfd4 d2c5 cece d9c8  .. .............
0002ed0: 3a0a 0a25 5c6e 6f69 6e64 656e 7420 5765  :..%\noindent We
0002ee0: 2077 696c 6c20 7573 6520 7468 6520 666f   will use the fo
0002ef0: 6c6c 6f77 696e 6720 6675 6e63 7469 6f6e  llowing function
0002f00: 7320 7468 6174 2077 6520 6861 7665 2061  s that we have a
0002f10: 6c72 6561 6479 2063 6f6e 7369 6465 7265  lready considere
0002f20: 643a 0a0a 5c62 6567 696e 7b62 6f78 6564  d:..\begin{boxed
0002f30: 7d5c 6265 6769 6e7b 7665 7262 6174 696d  }\begin{verbatim
0002f40: 7d0a 2020 236c 6574 2068 6428 683a 3a74  }.  #let hd(h::t
0002f50: 2920 3d20 683b 3b0a 2020 236c 6574 2074  ) = h;;.  #let t
0002f60: 6c28 683a 3a74 2920 3d20 743b 3b0a 2020  l(h::t) = t;;.  
0002f70: 236c 6574 2072 6563 206c 656e 6774 6820  #let rec length 
0002f80: 6c20 3d20 6966 206c 203d 205b 5d20 7468  l = if l = [] th
0002f90: 656e 2030 2065 6c73 6520 3120 2b20 6c65  en 0 else 1 + le
0002fa0: 6e67 7468 2874 6c20 6c29 3b3b 0a5c 656e  ngth(tl l);;.\en
0002fb0: 647b 7665 7262 6174 696d 7d5c 656e 647b  d{verbatim}\end{
0002fc0: 626f 7865 647d 0a0a 5c6e 6f69 6e64 656e  boxed}..\noinden
0002fd0: 7420 e2c5 da20 c4c1 ccd8 cec5 cadb c9c8  t ... ..........
0002fe0: 20c8 cccf d0cf d42c 20d7 cfd4 20c6 d5ce   ......, ... ...
0002ff0: cbc3 c9d1 20c4 ccd1 20cb cfce d7c5 d2d4  .... ... .......
0003000: c1c3 c9c9 20d4 c5d2 cdc1 20d7 20d3 d4d2  .... ..... . ...
0003010: cfcb d52e 0a0a 2525 5c6e 6f69 6e64 656e  ......%%\noinden
0003020: 7420 5769 7468 6f75 7420 6675 7274 6865  t Without furthe
0003030: 7220 6164 6f2c 2068 6572 6520 6973 2061  r ado, here is a
0003040: 2066 756e 6374 696f 6e20 746f 2063 6f6e   function to con
0003050: 7665 7274 2061 2074 6572 6d20 696e 746f  vert a term into
0003060: 2061 0a25 2573 7472 696e 672e 0a0a 5c62   a.%%string...\b
0003070: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
0003080: 6e7b 7665 7262 6174 696d 7d0a 2020 236c  n{verbatim}.  #l
0003090: 6574 2072 6563 2073 7472 696e 675f 6f66  et rec string_of
00030a0: 5f74 6572 6d20 7072 6563 203d 0a20 2020  _term prec =.   
00030b0: 2020 6675 6e20 2856 6172 2073 2920 2d3e    fun (Var s) ->
00030c0: 2073 0a20 2020 2020 2020 7c20 2843 6f6e   s.       | (Con
00030d0: 7374 2063 2920 2d3e 2063 0a20 2020 2020  st c) -> c.     
00030e0: 2020 7c20 2846 6e28 662c 6172 6773 2929    | (Fn(f,args))
00030f0: 202d 3e0a 2020 2020 2020 2020 2020 2069   ->.           i
0003100: 6620 6c65 6e67 7468 2061 7267 7320 3d20  f length args = 
0003110: 3220 2620 6973 5f69 6e66 6978 2066 2074  2 & is_infix f t
0003120: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
0003130: 206c 6574 2070 7265 6327 203d 2067 6574   let prec' = get
0003140: 5f70 7265 6365 6465 6e63 6520 6620 696e  _precedence f in
0003150: 0a20 2020 2020 2020 2020 2020 2020 6c65  .             le
0003160: 7420 7331 203d 2073 7472 696e 675f 6f66  t s1 = string_of
0003170: 5f74 6572 6d20 7072 6563 2720 2868 6420  _term prec' (hd 
0003180: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
0003190: 2020 2061 6e64 2073 3220 3d20 7374 7269     and s2 = stri
00031a0: 6e67 5f6f 665f 7465 726d 2070 7265 6327  ng_of_term prec'
00031b0: 2028 6864 2874 6c20 6172 6773 2929 2069   (hd(tl args)) i
00031c0: 6e0a 2020 2020 2020 2020 2020 2020 206c  n.             l
00031d0: 6574 2073 7320 3d20 7331 5e22 2022 5e66  et ss = s1^" "^f
00031e0: 5e22 2022 5e73 3220 696e 0a20 2020 2020  ^" "^s2 in.     
00031f0: 2020 2020 2020 2020 6966 2070 7265 6327          if prec'
0003200: 203c 3d20 7072 6563 2074 6865 6e20 2228   <= prec then "(
0003210: 225e 7373 5e22 2922 2065 6c73 6520 7373  "^ss^")" else ss
0003220: 0a20 2020 2020 2020 2020 2020 656c 7365  .           else
0003230: 0a20 2020 2020 2020 2020 2020 2020 665e  .             f^
0003240: 2228 225e 2873 7472 696e 675f 6f66 5f74  "("^(string_of_t
0003250: 6572 6d73 2061 7267 7329 5e22 2922 0a0a  erms args)^")"..
0003260: 2020 2061 6e64 2073 7472 696e 675f 6f66     and string_of
0003270: 5f74 6572 6d73 2074 203d 0a20 2020 2020  _terms t =.     
0003280: 6d61 7463 6820 7420 7769 7468 0a20 2020  match t with.   
0003290: 2020 2020 2020 5b5d 202d 3e20 2222 0a20        [] -> "". 
00032a0: 2020 2020 2020 7c20 5b74 5d20 2d3e 2073        | [t] -> s
00032b0: 7472 696e 675f 6f66 5f74 6572 6d20 3020  tring_of_term 0 
00032c0: 740a 2020 2020 2020 207c 2028 683a 3a74  t.       | (h::t
00032d0: 2920 2d3e 2028 7374 7269 6e67 5f6f 665f  ) -> (string_of_
00032e0: 7465 726d 2030 2068 295e 222c 225e 2873  term 0 h)^","^(s
00032f0: 7472 696e 675f 6f66 5f74 6572 6d73 2074  tring_of_terms t
0003300: 293b 3b0a 5c65 6e64 7b76 6572 6261 7469  );;.\end{verbati
0003310: 6d7d 5c65 6e64 7b62 6f78 6564 7d0a 0af0  m}\end{boxed}...
0003320: c5d2 d7d9 ca20 c1d2 c7d5 cdc5 ced4 207b  ..... ........ {
0003330: 5c74 7420 7072 6563 7d20 cfc2 cfda cec1  \tt prec} ......
0003340: dec1 c5d4 20d5 d2cf d7c5 ced8 20d0 d2c9  .... ....... ...
0003350: cfd2 c9d4 c5d4 c120 cfd0 c5d2 c1d4 cfd2  ....... ........
0003360: c12c 20c4 ccd1 20cb cfd4 cfd2 cfc7 cf0a  ., ... .........
0003370: d4c5 cbd5 ddc5 c520 d2c1 d3d3 cdc1 d4d2  ....... ........
0003380: c9d7 c1c5 cdcf c520 d7d9 d2c1 d6c5 cec9  ....... ........
0003390: c520 d1d7 ccd1 c5d4 d3d1 20ce c5d0 cfd3  . ........ .....
00033a0: d2c5 c4d3 d4d7 c5ce ced9 cd20 d0cf c4d4  ........... ....
00033b0: c5d2 cdcf cd2e 200a f4c1 cb20 ded4 cf20  ...... .... ... 
00033c0: c5d3 ccc9 20d4 c5cb d5dd c5c5 20d7 d9d2  .... ....... ...
00033d0: c1d6 c5ce c9c5 20c9 cdc5 c5d4 20c9 cec6  ...... ..... ...
00033e0: c9cb d3ce d9ca 20cf d0c5 d2c1 d4cf d220  ...... ........ 
00033f0: d320 cec5 cbcf d4cf d2d9 cd20 d0d2 c9cf  . ......... ....
0003400: d2c9 d4c5 d4cf cd2c 20d4 cf20 0ad3 cbcf  ......., .. ....
0003410: c2cb c920 cec5 cfc2 c8cf c4c9 cdd9 20c5  ... .......... .
0003420: d3cc c920 d0d2 c9cf d2c9 d4c5 d420 dcd4  ... ......... ..
0003430: cfc7 cf20 cfd0 c5d2 c1d4 cfd2 c120 cec9  ... ......... ..
0003440: d6c5 207b 5c74 7420 7072 6563 7d2c 20c9  .. {\tt prec}, .
0003450: ced9 cdc9 20d3 cccf d7c1 cdc9 2c20 c5d3  .... ......., ..
0003460: ccc9 20cd d90a d2c1 d3d3 cdc1 d4d2 c9d7  .. .............
0003470: c1c5 cd20 d0d2 c1d7 d5c0 20de c1d3 d4d8  ... ...... .....
0003480: 2020 2478 202a 2028 7920 2b20 7a29 242e    $x * (y + z)$.
0003490: 20e4 c5ca d3d4 d7c9 d4c5 ccd8 cecf 2c20   ............., 
00034a0: cdd9 20c9 d3d0 cfcc d8da d5c5 cd20 0ad3  .. .......... ..
00034b0: cbcf c2cb c920 c4c1 d6c5 20cb cfc7 c4c1  ..... .... .....
00034c0: 20cf cec9 20d2 c1d7 ced9 2c20 c4cc d120   ... ....., ... 
00034d0: c2cf ccc5 c520 cec1 c7cc d1c4 cecf ca20  ..... ......... 
00034e0: c7d2 d5d0 d0c9 d2cf d7cb c92e 200a f720  ............ .. 
00034f0: d3cc d5de c1c5 20c1 d3d3 cfc3 c9c1 d4c9  ...... .........
0003500: d7ce d9c8 20cf d0c5 d2c1 d4cf d2cf d72c  .... ..........,
0003510: 20d7 d2cf c4c5 2024 2b24 20dc d4cf 20ce   ..... $+$ ... .
0003520: c520 d7c1 d6ce cf2c 20ce cf20 cdd9 20c4  . ....., .. .. .
0003530: cfcc d6ce d920 d2c1 dacc c9de c1d4 d820  ..... ......... 
0003540: 0a24 7820 2d20 2879 202d 207a 2924 20c9  .$x - (y - z)$ .
0003550: 2024 2878 202d 2079 2920 2d20 7a24 2e20   $(x - y) - z$. 
0003560: 28e2 cfcc c5c5 20d5 d3cc cfd6 cea3 cece  (..... .........
0003570: c1d1 20d3 c8c5 cdc1 20cd cfc7 ccc1 20c2  .. ..... ..... .
0003580: d920 d3d7 d1da d9d7 c1d4 d820 d320 cbc1  . ......... . ..
0003590: d6c4 d9cd 0acf d0c5 d2c1 d4cf d2cf cd20  ............... 
00035a0: c1d3 d3cf c3c9 c1d4 c9d7 cecf d3d4 d82e  ................
00035b0: 2920 f7d4 cfd2 c1d1 2c20 d7da c1c9 cdce  ) ......, ......
00035c0: cf20 d2c5 cbd5 d2d3 c9d7 cec1 d12c 20c6  . ..........., .
00035d0: d5ce cbc3 c9d1 0a7b 5c74 7420 7374 7269  .......{\tt stri
00035e0: 6e67 5c5f 6f66 5c5f 7465 726d 737d 20c9  ng\_of\_terms} .
00035f0: d3d0 cfcc d8da d5c5 d4d3 d120 c4cc d120  ........... ... 
0003600: d0c5 dec1 d4c9 20d3 d0c9 d3cb c120 d4c5  ...... ...... ..
0003610: d2cd cfd7 20de c5d2 c5da 20da c1d0 d1d4  .... ..... .....
0003620: d5c0 2c20 cbc1 cb20 0acf cec9 20c9 c4d5  .., ... .... ...
0003630: d420 d720 cec5 c9ce c6c5 cbd3 cecf ca20  . . ........... 
0003640: c6cf d2cd c520 2466 2874 5f31 2c5c 6c64  ..... $f(t_1,\ld
0003650: 6f74 732c 745f 6e29 242e 0ae4 c1d7 c1ca  ots,t_n)$.......
0003660: d4c5 20d0 cfd3 cdcf d4d2 c9cd 20dc d4cf  .. ......... ...
0003670: 20d7 20c4 c5ca d3d4 d7c9 c93a 0a0a 2525   . ........:..%%
0003680: 5468 6520 6669 7273 7420 6172 6775 6d65  The first argume
0003690: 6e74 207b 5c74 7420 7072 6563 7d20 696e  nt {\tt prec} in
00036a0: 6469 6361 7465 7320 7468 6520 7072 6563  dicates the prec
00036b0: 6564 656e 6365 206c 6576 656c 206f 6620  edence level of 
00036c0: 7468 6520 6f70 6572 6174 6f72 206f 660a  the operator of.
00036d0: 2525 7768 6963 6820 7468 6520 6375 7272  %%which the curr
00036e0: 656e 746c 7920 636f 6e73 6964 6572 6564  ently considered
00036f0: 2065 7870 7265 7373 696f 6e20 6973 2061   expression is a
0003700: 6e20 696d 6d65 6469 6174 6520 7375 6274  n immediate subt
0003710: 6572 6d2e 204e 6f77 2069 6620 7468 650a  erm. Now if the.
0003720: 2525 6375 7272 656e 7420 6578 7072 6573  %%current expres
0003730: 7369 6f6e 2068 6173 2061 6e20 696e 6669  sion has an infi
0003740: 7820 6269 6e61 7279 206f 7065 7261 746f  x binary operato
0003750: 7220 6174 2074 6865 2074 6f70 206c 6576  r at the top lev
0003760: 656c 2c20 7061 7265 6e74 6865 7365 730a  el, parentheses.
0003770: 2525 6172 6520 6e65 6564 6564 2069 6620  %%are needed if 
0003780: 7468 6520 7072 6563 6564 656e 6365 206f  the precedence o
0003790: 6620 7468 6973 206f 7065 7261 746f 7220  f this operator 
00037a0: 6973 206c 6f77 6572 2c20 652e 672e 2069  is lower, e.g. i
00037b0: 6620 7765 2061 7265 0a25 2563 6f6e 7369  f we are.%%consi
00037c0: 6465 7269 6e67 2074 6865 2072 6967 6874  dering the right
00037d0: 2068 616e 6420 7375 6265 7870 7265 7373   hand subexpress
00037e0: 696f 6e20 6f66 2024 7820 2a20 2879 202b  ion of $x * (y +
00037f0: 207a 2924 2e20 4163 7475 616c 6c79 2077   z)$. Actually w
0003800: 6520 7573 650a 2525 7061 7265 6e74 6865  e use.%%parenthe
0003810: 7365 7320 6576 656e 2077 6865 6e20 7468  ses even when th
0003820: 6579 2061 7265 2065 7175 616c 2c20 696e  ey are equal, in
0003830: 206f 7264 6572 2074 6f20 6d61 6b65 2067   order to make g
0003840: 726f 7570 696e 6773 2063 6c65 6172 2e20  roupings clear. 
0003850: 496e 2074 6865 0a25 2563 6173 6520 6f66  In the.%%case of
0003860: 2061 7373 6f63 6961 7469 7665 206f 7065   associative ope
0003870: 7261 746f 7273 206c 696b 6520 242b 2420  rators like $+$ 
0003880: 7468 6973 2064 6f65 736e 2774 206d 6174  this doesn't mat
0003890: 7465 722c 2062 7574 2077 6520 6d75 7374  ter, but we must
00038a0: 0a25 2564 6973 7469 6e67 7569 7368 2024  .%%distinguish $
00038b0: 7820 2d20 2879 202d 207a 2924 2061 6e64  x - (y - z)$ and
00038c0: 2024 2878 202d 2079 2920 2d20 7a24 2e20   $(x - y) - z$. 
00038d0: 2841 206d 6f72 6520 736f 7068 6973 7469  (A more sophisti
00038e0: 6361 7465 6420 7363 6865 6d65 2077 6f75  cated scheme wou
00038f0: 6c64 0a25 2567 6976 6520 6561 6368 206f  ld.%%give each o
0003900: 7065 7261 746f 7220 616e 2061 7373 6f63  perator an assoc
0003910: 6961 7469 7669 7479 2e29 2054 6865 2073  iativity.) The s
0003920: 6563 6f6e 642c 206d 7574 7561 6c6c 7920  econd, mutually 
0003930: 7265 6375 7273 6976 652c 2066 756e 6374  recursive, funct
0003940: 696f 6e0a 2525 7b5c 7474 2073 7472 696e  ion.%%{\tt strin
0003950: 675c 5f6f 665c 5f74 6572 6d73 7d20 6973  g\_of\_terms} is
0003960: 2075 7365 6420 746f 2070 7269 6e74 2061   used to print a
0003970: 2063 6f6d 6d61 2d73 6570 6172 6174 6564   comma-separated
0003980: 206c 6973 7420 6f66 2074 6572 6d73 2c20   list of terms, 
0003990: 6173 0a25 7468 6579 206f 6363 7572 2066  as.%they occur f
00039a0: 6f72 206e 6f6e 2d69 6e66 6978 2066 756e  or non-infix fun
00039b0: 6374 696f 6e20 6170 706c 6963 6174 696f  ction applicatio
00039c0: 6e73 206f 6620 7468 6520 666f 726d 2024  ns of the form $
00039d0: 6628 745f 312c 5c6c 646f 7473 2c74 5f6e  f(t_1,\ldots,t_n
00039e0: 2924 2e0a 2525 4c65 7420 7573 2073 6565  )$..%%Let us see
00039f0: 2074 6869 7320 696e 2061 6374 696f 6e3a   this in action:
0003a00: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
0003a10: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
0003a20: 2020 236c 6574 2074 203d 0a20 2020 2046    #let t =.    F
0003a30: 6e28 222d 222c 5b46 6e28 222f 222c 5b46  n("-",[Fn("/",[F
0003a40: 6e28 2273 696e 222c 5b46 6e28 222b 222c  n("sin",[Fn("+",
0003a50: 5b56 6172 2022 7822 3b20 5661 7220 2279  [Var "x"; Var "y
0003a60: 225d 295d 293b 0a20 2020 2020 2020 2020  "])]);.         
0003a70: 2020 2020 2020 2020 2020 2046 6e28 2263             Fn("c
0003a80: 6f73 222c 5b46 6e28 222d 222c 5b56 6172  os",[Fn("-",[Var
0003a90: 2022 7822 3b0a 2020 2020 2020 2020 2020   "x";.          
0003aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0003ab0: 2020 2020 2020 2020 2020 2020 466e 2822              Fn("
0003ac0: 6578 7022 2c5b 5661 7220 2279 225d 295d  exp",[Var "y"])]
0003ad0: 295d 295d 293b 0a20 2020 2020 2020 2020  )])]);.         
0003ae0: 2020 2046 6e28 226c 6e22 2c5b 466e 2822     Fn("ln",[Fn("
0003af0: 2b22 2c5b 436f 6e73 7420 2231 223b 2056  +",[Const "1"; V
0003b00: 6172 2022 7822 5d29 5d29 5d29 3b3b 0a20  ar "x"])])]);;. 
0003b10: 2074 203a 2074 6572 6d20 3d0a 2020 2046   t : term =.   F
0003b20: 6e0a 2020 2020 2822 2d22 2c0a 2020 2020  n.    ("-",.    
0003b30: 205b 466e 0a20 2020 2020 2020 2822 2f22   [Fn.       ("/"
0003b40: 2c0a 2020 2020 2020 2020 5b46 6e20 2822  ,.        [Fn ("
0003b50: 7369 6e22 2c20 5b46 6e20 2822 2b22 2c20  sin", [Fn ("+", 
0003b60: 5b56 6172 2022 7822 3b20 5661 7220 2279  [Var "x"; Var "y
0003b70: 225d 295d 293b 0a20 2020 2020 2020 2020  "])]);.         
0003b80: 466e 2028 2263 6f73 222c 205b 466e 2028  Fn ("cos", [Fn (
0003b90: 222d 222c 205b 5661 7220 2278 223b 2046  "-", [Var "x"; F
0003ba0: 6e20 2822 6578 7022 2c20 5b56 6172 2022  n ("exp", [Var "
0003bb0: 7922 5d29 5d29 5d29 5d29 3b0a 2020 2020  y"])])])]);.    
0003bc0: 2020 466e 2028 226c 6e22 2c20 5b46 6e20    Fn ("ln", [Fn 
0003bd0: 2822 2b22 2c20 5b43 6f6e 7374 2022 3122  ("+", [Const "1"
0003be0: 3b20 5661 7220 2278 225d 295d 295d 290a  ; Var "x"])])]).
0003bf0: 2020 2373 7472 696e 675f 6f66 5f74 6572    #string_of_ter
0003c00: 6d20 3020 743b 3b0a 2020 2d20 3a20 7374  m 0 t;;.  - : st
0003c10: 7269 6e67 203d 2022 7369 6e28 7820 2b20  ring = "sin(x + 
0003c20: 7929 202f 2063 6f73 2878 202d 2065 7870  y) / cos(x - exp
0003c30: 2879 2929 202d 206c 6e28 3120 2b20 7829  (y)) - ln(1 + x)
0003c40: 220a 5c65 6e64 7b76 6572 6261 7469 6d7d  ".\end{verbatim}
0003c50: 5c65 6e64 7b62 6f78 6564 7d0a 0aee c120  \end{boxed}.... 
0003c60: 20d3 c1cd cfcd 20c4 c5cc c52c 20ce c1cd   ..... ...., ...
0003c70: 20c4 c1d6 c520 cec5 20d4 d2c5 c2d5 c5d4   .... .. .......
0003c80: d3d1 20d3 c1cd cfd3 d4cf d1d4 c5cc d8ce  .. .............
0003c90: cf20 cbcf ced7 c5d2 d4c9 d2cf d7c1 d4d8  . ..............
0003ca0: 20d4 c5d2 cd20 d720 d3d4 d2cf cbd5 2e20   .... . ....... 
0003cb0: 4341 4d4c 204c 6967 6874 0ad0 cfda d7cf  CAML Light......
0003cc0: ccd1 c5d4 20ce c1cd 20ce c1d3 d4d2 cfc9  .... ... .......
0003cd0: d4d8 20d3 d7cf c020 d3c9 d3d4 c5cd d520  .. .... ....... 
0003ce0: d7d9 d7cf c4c1 2e20 fcd4 cf20 d0cf d4d2  ....... ... ....
0003cf0: c5c2 d5c5 d420 cec5 d3cb cfcc d8cb cf20  ..... ......... 
0003d00: d3d0 c5c3 c9c1 ccd8 ced9 c820 cbcf cdc1  ........... ....
0003d10: cec4 3a0a 0a25 2549 6e20 6661 6374 2c20  ..:..%%In fact, 
0003d20: 7765 2064 6f6e 2774 206e 6565 6420 746f  we don't need to
0003d30: 2063 6f6e 7665 7274 2061 2074 6572 6d20   convert a term 
0003d40: 746f 2061 2073 7472 696e 6720 6f75 7273  to a string ours
0003d50: 656c 7665 732e 2043 414d 4c20 4c69 6768  elves. CAML Ligh
0003d60: 740a 2525 616c 6c6f 7773 2075 7320 746f  t.%%allows us to
0003d70: 2073 6574 2075 7020 6f75 7220 6f77 6e20   set up our own 
0003d80: 7072 696e 7465 7220 736f 2074 6861 7420  printer so that 
0003d90: 6974 2069 7320 7573 6564 2074 6f20 7072  it is used to pr
0003da0: 696e 7420 616e 7974 6869 6e67 206f 660a  int anything of.
0003db0: 2525 7479 7065 207b 5c74 7420 7465 726d  %%type {\tt term
0003dc0: 7d20 696e 2074 6865 2073 7461 6e64 6172  } in the standar
0003dd0: 6420 7265 6164 2d65 7661 6c2d 7072 696e  d read-eval-prin
0003de0: 7420 6c6f 6f70 2e20 5468 6973 206e 6565  t loop. This nee
0003df0: 6473 2061 2066 6577 2073 7065 6369 616c  ds a few special
0003e00: 0a25 2563 6f6d 6d61 6e64 7320 746f 2065  .%%commands to e
0003e10: 6e73 7572 6520 7468 6174 2077 6520 696e  nsure that we in
0003e20: 7465 7261 6374 2070 726f 7065 726c 7920  teract properly 
0003e30: 7769 7468 2074 6865 2074 6f70 6c65 7665  with the topleve
0003e40: 6c0a 2525 6c6f 6f70 3a0a 0a5c 6265 6769  l.%%loop:..\begi
0003e50: 6e7b 626f 7865 647d 5c62 6567 696e 7b76  n{boxed}\begin{v
0003e60: 6572 6261 7469 6d7d 0a20 2023 236f 7065  erbatim}.  ##ope
0003e70: 6e20 2266 6f72 6d61 7422 3b3b 0a20 2023  n "format";;.  #
0003e80: 6c65 7420 7072 696e 745f 7465 726d 2073  let print_term s
0003e90: 203d 0a20 2020 2020 6f70 656e 5f68 7662   =.     open_hvb
0003ea0: 6f78 2030 3b0a 2020 2020 2070 7269 6e74  ox 0;.     print
0003eb0: 5f73 7472 696e 6728 2260 225e 2873 7472  _string("`"^(str
0003ec0: 696e 675f 6f66 5f74 6572 6d20 3020 7329  ing_of_term 0 s)
0003ed0: 5e22 6022 293b 0a20 2020 2020 636c 6f73  ^"`");.     clos
0003ee0: 655f 626f 7828 293b 3b0a 2020 7072 696e  e_box();;.  prin
0003ef0: 745f 7465 726d 203a 2074 6572 6d20 2d3e  t_term : term ->
0003f00: 2075 6e69 7420 3d20 3c66 756e 3e0a 2020   unit = <fun>.  
0003f10: 2369 6e73 7461 6c6c 5f70 7269 6e74 6572  #install_printer
0003f20: 2022 7072 696e 745f 7465 726d 223b 3b0a   "print_term";;.
0003f30: 2020 2d20 3a20 756e 6974 203d 2028 290a    - : unit = ().
0003f40: 5c65 6e64 7b76 6572 6261 7469 6d7d 5c65  \end{verbatim}\e
0003f50: 6e64 7b62 6f78 6564 7d0a 0a5c 6e6f 696e  nd{boxed}..\noin
0003f60: 6465 6e74 204e 6f77 2063 6f6d 7061 7265  dent Now compare
0003f70: 2074 6865 2065 6666 6563 743a 0a0a 255c   the effect:..%\
0003f80: 6e6f 696e 6465 6e74 20f0 cfde d5d7 d3d4  noindent .......
0003f90: d7d5 cad4 c520 d2c1 dace c9c3 d53a 0a0a  ..... .......:..
0003fa0: 5c62 6567 696e 7b62 6f78 6564 7d5c 6265  \begin{boxed}\be
0003fb0: 6769 6e7b 7665 7262 6174 696d 7d0a 2020  gin{verbatim}.  
0003fc0: 236c 6574 2074 203d 0a20 2020 2020 2046  #let t =.      F
0003fd0: 6e28 222d 222c 5b46 6e28 222f 222c 5b46  n("-",[Fn("/",[F
0003fe0: 6e28 2273 696e 222c 5b46 6e28 222b 222c  n("sin",[Fn("+",
0003ff0: 5b56 6172 2022 7822 3b20 5661 7220 2279  [Var "x"; Var "y
0004000: 225d 295d 293b 0a20 2020 2020 2020 2020  "])]);.         
0004010: 2020 2020 2020 2020 2020 2020 2046 6e28               Fn(
0004020: 2263 6f73 222c 5b46 6e28 222d 222c 5b56  "cos",[Fn("-",[V
0004030: 6172 2022 7822 3b0a 2020 2020 2020 2020  ar "x";.        
0004040: 2020 2020 2020 2020 2020 2020 2020 2020                  
0004050: 2020 2020 2020 2020 2020 2020 2020 2020                  
0004060: 466e 2822 6578 7022 2c5b 5661 7220 2279  Fn("exp",[Var "y
0004070: 225d 295d 295d 295d 293b 0a20 2020 2020  "])])])]);.     
0004080: 2020 2020 2020 2020 2046 6e28 226c 6e22           Fn("ln"
0004090: 2c5b 466e 2822 2b22 2c5b 436f 6e73 7420  ,[Fn("+",[Const 
00040a0: 2231 223b 2056 6172 2022 7822 5d29 5d29  "1"; Var "x"])])
00040b0: 5d29 3b3b 0a20 2074 203a 2074 6572 6d20  ]);;.  t : term 
00040c0: 3d20 6073 696e 2878 202b 2079 2920 2f20  = `sin(x + y) / 
00040d0: 636f 7328 7820 2d20 6578 7028 7929 2920  cos(x - exp(y)) 
00040e0: 2d20 6c6e 2831 202b 2078 2960 0a20 2023  - ln(1 + x)`.  #
00040f0: 6c65 7420 7820 3d20 740a 2020 7820 3a20  let x = t.  x : 
0004100: 7465 726d 203d 2060 7369 6e28 7820 2b20  term = `sin(x + 
0004110: 7929 202f 2063 6f73 2878 202d 2065 7870  y) / cos(x - exp
0004120: 2879 2929 202d 206c 6e28 3120 2b20 7829  (y)) - ln(1 + x)
0004130: 600a 5c65 6e64 7b76 6572 6261 7469 6d7d  `.\end{verbatim}
0004140: 5c65 6e64 7b62 6f78 6564 7d0a 0af0 cfd3  \end{boxed}.....
0004150: ccc5 20d4 cfc7 cf20 cbc1 cb20 cecf d7d9  .. .... ... ....
0004160: ca20 d0d2 c9ce d4c5 d220 d5d3 d4c1 cecf  . ....... ......
0004170: d7cc c5ce 2c20 cfce 20c2 d5c4 c5d4 20c9  ...., .. ..... .
0004180: d3d0 cfcc d8da cfd7 c1d4 d8d3 d120 d7d3  ............. ..
0004190: d1cb c9ca 20d2 c1da 0ad0 d2c9 20d0 c5de  .... ....... ...
00041a0: c1d4 c920 d4c9 d0c1 207b 5c74 7420 7465  ... .... {\tt te
00041b0: 726d 7d2c 20c4 c1d6 c520 c5d3 ccc9 20cf  rm}, .... .... .
00041c0: ce20 d0d2 c5c4 d3d4 c1d7 ccd1 c5d4 20d3  . ............ .
00041d0: cfc2 cfca 20d3 cfd3 d4c1 d7ce cfca 200a  .... ......... .
00041e0: d4c9 d020 c4c1 cece d9c8 2c20 cbc1 cb20  ... ......, ... 
00041f0: cec1 d0d2 c9cd c5d2 20cb cfd2 d4c5 d63a  ........ ......:
0004200: 0a0a 4f6e 6365 2074 6865 206e 6577 2070  ..Once the new p
0004210: 7269 6e74 6572 2069 7320 696e 7374 616c  rinter is instal
0004220: 6c65 642c 2069 7420 6973 2075 7365 6420  led, it is used 
0004230: 7768 656e 6576 6572 2043 414d 4c20 7761  whenever CAML wa
0004240: 6e74 7320 746f 2070 7269 6e74 0a73 6f6d  nts to print.som
0004250: 6574 6869 6e67 206f 6620 7479 7065 207b  ething of type {
0004260: 5c74 7420 7465 726d 7d2c 2065 7665 6e20  \tt term}, even 
0004270: 6966 2069 7420 6973 2061 2063 6f6d 706f  if it is a compo
0004280: 7369 7465 2064 6174 6173 7472 7563 7475  site datastructu
0004290: 7265 0a73 7563 6820 6173 2061 2070 6169  re.such as a pai
00042a0: 723a 0a0a 5c62 6567 696e 7b62 6f78 6564  r:..\begin{boxed
00042b0: 7d5c 6265 6769 6e7b 7665 7262 6174 696d  }\begin{verbatim
00042c0: 7d0a 2020 2328 782c 7429 3b3b 0a20 202d  }.  #(x,t);;.  -
00042d0: 203a 2074 6572 6d20 2a20 7465 726d 203d   : term * term =
00042e0: 0a20 2020 6073 696e 2878 202b 2079 2920  .   `sin(x + y) 
00042f0: 2f20 636f 7328 7820 2d20 6578 7028 7929  / cos(x - exp(y)
0004300: 2920 2d20 6c6e 2831 202b 2078 2960 2c0a  ) - ln(1 + x)`,.
0004310: 2020 2060 7369 6e28 7820 2b20 7929 202f     `sin(x + y) /
0004320: 2063 6f73 2878 202d 2065 7870 2879 2929   cos(x - exp(y))
0004330: 202d 206c 6e28 3120 2b20 7829 600a 5c65   - ln(1 + x)`.\e
0004340: 6e64 7b76 6572 6261 7469 6d7d 5c65 6e64  nd{verbatim}\end
0004350: 7b62 6f78 6564 7d0a 0a5c 6e6f 696e 6465  {boxed}..\noinde
0004360: 6e74 20c9 ccc9 20d3 d0c9 d3cf cb3a 0a0a  nt ... ......:..
0004370: 5c62 6567 696e 7b62 6f78 6564 7d5c 6265  \begin{boxed}\be
0004380: 6769 6e7b 7665 7262 6174 696d 7d0a 2020  gin{verbatim}.  
0004390: 235b 783b 2074 3b20 785d 3b3b 0a20 202d  #[x; t; x];;.  -
00043a0: 203a 2074 6572 6d20 6c69 7374 203d 0a20   : term list =. 
00043b0: 2020 5b60 7369 6e28 7820 2b20 7929 202f    [`sin(x + y) /
00043c0: 2063 6f73 2878 202d 2065 7870 2879 2929   cos(x - exp(y))
00043d0: 202d 206c 6e28 3120 2b20 7829 603b 0a20   - ln(1 + x)`;. 
00043e0: 2020 2060 7369 6e28 7820 2b20 7929 202f     `sin(x + y) /
00043f0: 2063 6f73 2878 202d 2065 7870 2879 2929   cos(x - exp(y))
0004400: 202d 206c 6e28 3120 2b20 7829 603b 0a20   - ln(1 + x)`;. 
0004410: 2020 2060 7369 6e28 7820 2b20 7929 202f     `sin(x + y) /
0004420: 2063 6f73 2878 202d 2065 7870 2879 2929   cos(x - exp(y))
0004430: 202d 206c 6e28 3120 2b20 7829 605d 0a5c   - ln(1 + x)`].\
0004440: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
0004450: 647b 626f 7865 647d 0a0a f0cf c4cf c2ce  d{boxed}........
0004460: c1d1 20d0 c5de c1d4 d820 d7d3 a320 d6c5  .. ...... ... ..
0004470: 20c4 cfd7 cfcc d8ce cf20 c7d2 d5c2 c12c   ........ .....,
0004480: 20d0 cfd3 cbcf ccd8 cbd5 20c2 cfcc d8db   ......... .....
0004490: c9c5 20d7 d9d2 c1d6 c5ce c9d1 20ce c520  .. ......... .. 
00044a0: d2c1 dac2 c9d7 c1c0 d4d3 d120 c1cb cbd5  ........... ....
00044b0: d2c1 d4ce cf0a cec1 20cc c9ce c9c9 2e20  ........ ...... 
00044c0: e2c9 c2cc c9cf d4c5 cbc1 207b 5c74 7420  .......... {\tt 
00044d0: 666f 726d 6174 7d2c 20c9 da20 cbcf d4cf  format}, .. ....
00044e0: d2cf ca20 cdd9 20c9 d3d0 cfcc d8da cfd7  ... .. .........
00044f0: c1cc c920 cec5 d3cb cfcc d8cb cf20 c6d5  ... ......... ..
0004500: cecb c3c9 ca20 d7d9 dbc5 2c20 0ad0 d2c5  ..... ...., ....
0004510: c4cc c1c7 c1c5 d420 ccd5 dedb c5c5 20d2  ....... ...... .
0004520: c5db c5ce c9c5 2e20 f7cd c5d3 d4cf 20cb  ....... ...... .
0004530: cfce d7c5 d2d4 c1c3 c9c9 20d4 c5d2 cdc1  .......... .....
0004540: 20d7 20d3 d4d2 cfcb d520 c920 d0c5 dec1   . ...... . ....
0004550: d4c9 2c20 cdd9 20cd cfd6 c5cd 200a d7d9  .., .. ..... ...
0004560: d0cf ccce c9d4 d820 cfd4 c4c5 ccd8 ced9  ....... ........
0004570: c520 d7d9 dacf d7d9 20d0 c5de c1d4 c920  . ...... ...... 
0004580: c4cc d120 cbc1 d6c4 cfca 20c5 c7cf 20de  ... ...... ... .
0004590: c1d3 d4c9 2c20 d320 d0cf cdcf ddd8 c00a  ...., . ........
00045a0: d3d0 c5c3 c9c1 ccd8 cecf ca20 c6d5 cecb  ........... ....
00045b0: c3c9 c92c 20d0 cfcd cfc7 c1c0 ddc5 ca20  ..., .......... 
00045c0: d3c9 d3d4 c5cd c520 d0c5 dec1 d4c9 20d2  ....... ...... .
00045d0: c1da c2c9 d7c1 d4d8 20d3 d4d2 cfcb c92e  ........ .......
00045e0: 200a edce cfc7 c9c5 20c9 da20 d0d2 c9ce   ....... .. ....
00045f0: c3c9 d0cf d72c 20c9 d3d0 cfcc d8da d5c0  ....., .........
0004600: ddc9 c5d3 d120 d720 dcd4 cfca 20c9 20d0  ..... . .... . .
0004610: cfc4 cfc2 ced9 c820 d3c9 d3d4 c5cd c1c8  ....... ........
0004620: 20c6 cfd2 cdc1 d4c9 d2cf d7c1 cece cfc7   ...............
0004630: cf0a d7d9 d7cf c4c1 20d2 c1d3 d3cd c1d4  ........ .......
0004640: d2c9 d7c1 c0d4 d3d1 20d7 205c 6369 7465  ........ . \cite
0004650: 4e7b 6f70 7065 6e2d 7072 6574 7479 7d2e  N{oppen-pretty}.
0004660: 20ed d920 cec5 20c2 d5c4 c5cd 20d2 c1d3   .. .. ..... ...
0004670: d3cd c1d4 d2c9 d7c1 d4d8 20c9 c820 d720  .......... .. . 
0004680: cbce c9c7 c52c 0ada c120 d0cf c4d2 cfc2  .....,... ......
0004690: cecf d3d4 d1cd c920 cfc2 d2c1 ddc1 cad4  ....... ........
00046a0: c5d3 d820 cb20 d2d5 cbcf d7cf c4d3 d4d7  ... . ..........
00046b0: d520 d0cf 2043 414d 4c2e 5c66 6f6f 746e  . .. CAML.\footn
00046c0: 6f74 657b f4c1 cd20 d4c1 cbd6 c520 c5d3  ote{... ..... ..
00046d0: d4d8 20d5 dec5 c2ce c9cb 20ce c120 dcd4  .. ....... .. ..
00046e0: d520 d4c5 cdd5 2c0a cec1 d0c9 d3c1 cece  . ....,.........
00046f0: d9ca 2050 6965 7272 6520 5765 6973 2e20  .. Pierre Weis. 
0004700: e1c4 d2c5 d33a 7e7b 5c74 7420 6874 7470  .....:~{\tt http
0004710: 3a2f 2f63 616d 6c2e 696e 7269 612e 6672  ://caml.inria.fr
0004720: 2f69 6e64 6578 2d65 6e67 2e68 746d 6c7d  /index-eng.html}
0004730: 7d0a 0a25 2554 6869 7320 7072 696e 7465  }..%%This printe
0004740: 7220 6973 2072 6174 6865 7220 6372 7564  r is rather crud
0004750: 6520 696e 2074 6861 7420 6974 2077 696c  e in that it wil
0004760: 6c20 6e6f 7420 6272 6561 6b20 7570 206c  l not break up l
0004770: 6172 6765 2065 7870 7265 7373 696f 6e73  arge expressions
0004780: 0a25 2569 6e74 656c 6c69 6765 6e74 6c79  .%%intelligently
0004790: 2061 6372 6f73 7320 6c69 6e65 732e 2054   across lines. T
00047a0: 6865 2043 414d 4c20 6c69 6272 6172 7920  he CAML library 
00047b0: 7b5c 7474 2066 6f72 6d61 747d 2c20 6672  {\tt format}, fr
00047c0: 6f6d 2077 6869 6368 2077 6520 7573 6564  om which we used
00047d0: 2061 0a25 2566 6577 2066 756e 6374 696f   a.%%few functio
00047e0: 6e73 2061 626f 7665 2c20 7072 6f76 6964  ns above, provid
00047f0: 6573 2066 6f72 2061 2062 6574 7465 7220  es for a better 
0004800: 6170 7072 6f61 6368 2e20 496e 7374 6561  approach. Instea
0004810: 6420 6f66 2063 6f6e 7665 7274 696e 6720  d of converting 
0004820: 7468 650a 2525 7465 726d 2069 6e74 6f20  the.%%term into 
0004830: 6120 7374 7269 6e67 2074 6865 6e20 7072  a string then pr
0004840: 696e 7469 6e67 2069 7420 696e 206f 6e65  inting it in one
0004850: 2070 6965 6365 2c20 7765 2063 616e 206d   piece, we can m
0004860: 616b 6520 7365 7061 7261 7465 2070 7269  ake separate pri
0004870: 6e74 696e 670a 2525 6361 6c6c 7320 666f  nting.%%calls fo
0004880: 7220 6469 6666 6572 656e 7420 7061 7274  r different part
0004890: 7320 6f66 2069 742c 2061 6e64 2069 6e74  s of it, and int
00048a0: 6572 7370 6572 7365 2074 6865 7365 2077  ersperse these w
00048b0: 6974 6820 736f 6d65 2073 7065 6369 616c  ith some special
00048c0: 0a25 2566 756e 6374 696f 6e20 6361 6c6c  .%%function call
00048d0: 7320 7468 6174 2068 656c 7020 7468 6520  s that help the 
00048e0: 7072 696e 7469 6e67 206d 6563 6861 6e69  printing mechani
00048f0: 736d 2074 6f20 756e 6465 7273 7461 6e64  sm to understand
0004900: 2077 6865 7265 2074 6f20 6272 6561 6b0a   where to break.
0004910: 2525 7468 6520 6c69 6e65 732e 204d 616e  %%the lines. Man
0004920: 7920 6f66 2074 6865 2070 7269 6e63 6970  y of the princip
0004930: 6c65 7320 7573 6564 2069 6e20 7468 6973  les used in this
0004940: 2061 6e64 2073 696d 696c 6172 2060 7072   and similar `pr
0004950: 6574 7479 7072 696e 7469 6e67 0a25 2565  ettyprinting.%%e
0004960: 6e67 696e 6573 2720 6172 6520 6475 6520  ngines' are due 
0004970: 746f 205c 6369 7465 4e7b 6f70 7065 6e2d  to \citeN{oppen-
0004980: 7072 6574 7479 7d2e 2057 6520 7769 6c6c  pretty}. We will
0004990: 206e 6f74 2063 6f6e 7369 6465 7220 7468   not consider th
00049a0: 6973 2069 6e20 6465 7461 696c 0a25 2568  is in detail.%%h
00049b0: 6572 6520 2d2d 2d20 7365 6520 7468 6520  ere --- see the 
00049c0: 4341 4d4c 206d 616e 7561 6c20 666f 7220  CAML manual for 
00049d0: 6465 7461 696c 732e 5c66 6f6f 746e 6f74  details.\footnot
00049e0: 657b 5468 6572 6520 6973 2061 6c73 6f20  e{There is also 
00049f0: 6120 7475 746f 7269 616c 2c0a 2525 7772  a tutorial,.%%wr
0004a00: 6974 7465 6e20 6279 2050 6965 7272 6520  itten by Pierre 
0004a10: 5765 6973 2c20 756e 6176 6169 6c61 626c  Weis, unavailabl
0004a20: 6520 6f6e 6c69 6e65 2061 7320 7061 7274  e online as part
0004a30: 206f 6620 7468 6520 4341 4d4c 2070 6167   of the CAML pag
0004a40: 653a 2060 7b5c 7474 0a25 2568 7474 703a  e: `{\tt.%%http:
0004a50: 2f2f 7061 7569 6c6c 6163 2e69 6e72 6961  //pauillac.inria
0004a60: 2e66 722f 6361 6d6c 2f46 4151 2f66 6f72  .fr/caml/FAQ/for
0004a70: 6d61 742d 656e 672e 6874 6d6c 7d27 2e7d  mat-eng.html}'.}
0004a80: 0a0a 5c73 7562 7365 6374 696f 6e7b e4c9  ..\subsection{..
0004a90: c6c6 c5d2 c5ce c3c9 d2cf d7c1 cec9 c57d  ...............}
0004aa0: 0a0a f0c5 d2c5 cac4 a3cd 20d4 c5d0 c5d2  .......... .....
0004ab0: d820 cb20 c4cf d7cf ccd8 cecf 20d0 d2cf  . . ........ ...
0004ac0: d3d4 cfca 20da c1c4 c1de c520 cec1 c8cf  .... ...... ....
0004ad0: d6c4 c5ce c9d1 20d0 d2cf c9da d7cf c4ce  ...... .........
0004ae0: cfca 20cf d420 c6d5 cecb c3c9 c92e 200a  .. .. ........ .
0004af0: f3ce c1de c1cc c120 c4c1 d7c1 cad4 c520  ....... ....... 
0004b00: d7d3 d0cf cdce c9cd 2c20 dec5 cdd5 20ce  ........, .... .
0004b10: c1d3 20cf c2d5 dec1 ccc9 20d7 20db cbcf  .. ....... . ...
0004b20: ccc5 3a0a 0a25 254e 6f77 2069 7420 6973  ..:..%%Now it is
0004b30: 2061 2066 6169 726c 7920 7369 6d70 6c65   a fairly simple
0004b40: 206d 6174 7465 7220 746f 2064 6566 696e   matter to defin
0004b50: 6520 7468 6520 6465 7269 7661 7469 7665  e the derivative
0004b60: 2066 756e 6374 696f 6e2e 2046 6972 7374   function. First
0004b70: 206c 6574 0a25 2575 7320 7265 6361 6c6c   let.%%us recall
0004b80: 2074 6865 2073 7973 7465 6d61 7469 6320   the systematic 
0004b90: 6d65 7468 6f64 2077 6520 6172 6520 7461  method we are ta
0004ba0: 7567 6874 2069 6e20 7363 686f 6f6c 3a0a  ught in school:.
0004bb0: 0a5c 6265 6769 6e7b 6974 656d 697a 657d  .\begin{itemize}
0004bc0: 0a0a 2020 5c69 7465 6d20 e5d3 ccc9 20d7  ..  \item .... .
0004bd0: d9d2 c1d6 c5ce c9c5 202d 20cf c4ce c120  ........ - .... 
0004be0: c9da 20dc ccc5 cdc5 ced4 c1d2 ced9 c820  .. ............ 
0004bf0: c6d5 cecb c3c9 ca20 c4c9 c6c6 c5d2 c5ce  ....... ........
0004c00: c3c9 d2d5 c5cd cfc7 cf20 c1d2 c7d5 cdc5  ......... ......
0004c10: ced4 c12c 200a 2020 cec1 d0d2 c9cd c5d2  ..., .  ........
0004c20: 205c 616c 6572 747b 2473 696e 2878 2924   \alert{$sin(x)$
0004c30: 7d2c 20d4 cf20 d2c5 dad5 ccd8 d4c1 d420  }, .. ......... 
0004c40: c4c9 c6c6 c5d2 c5ce c3c9 d2cf d7c1 cec9  ................
0004c50: d120 2d20 c9da d7c5 d3d4 cec1 d120 d0d2  . - ......... ..
0004c60: cfc9 dad7 cfc4 cec1 d120 dcd4 cfca 20c6  ......... .... .
0004c70: d5ce cbc3 c9c9 2e0a 0a20 2025 5c69 7465  .........  %\ite
0004c80: 6d20 4966 2074 6865 2065 7870 7265 7373  m If the express
0004c90: 696f 6e20 6973 206f 6e65 206f 6620 7468  ion is one of th
0004ca0: 6520 7374 616e 6461 7264 2066 756e 6374  e standard funct
0004cb0: 696f 6e73 2061 7070 6c69 6564 2074 6f20  ions applied to 
0004cc0: 616e 0a20 2025 6172 6775 6d65 6e74 2c20  an.  %argument, 
0004cd0: 652e 672e 205c 616c 6572 747b 2473 696e  e.g. \alert{$sin
0004ce0: 2878 2924 7d2c 2072 6574 7572 6e20 7468  (x)$}, return th
0004cf0: 6520 6b6e 6f77 6e20 6465 7269 7661 7469  e known derivati
0004d00: 7665 2e0a 0a20 205c 6974 656d 20e5 d3cc  ve...  \item ...
0004d10: c920 d7d9 d2c1 d6c5 cec9 c520 d0d2 c5c4  . ......... ....
0004d20: d3d4 c1d7 c9cd cf20 d720 c6cf d2cd c520  ....... . ..... 
0004d30: 5c61 6c65 7274 7b24 6628 7829 202b 2067  \alert{$f(x) + g
0004d40: 2878 2924 7d2c 20d4 cf20 d0cf 20d0 d2c1  (x)$}, .. .. ...
0004d50: d7c9 ccd5 200a 2020 d3d5 cdcd d92c 20d2  .... .  ....., .
0004d60: c5da d5cc d8d4 c1d4 20c4 c9c6 c6c5 d2c5  ........ .......
0004d70: cec3 c9d2 cfd7 c1ce c9d1 20c5 d3d4 d820  .......... .... 
0004d80: 205c 616c 6572 747b 2466 2728 7829 202b   \alert{$f'(x) +
0004d90: 2067 2728 7829 247d 2e20 0a20 20e1 cec1   g'(x)$}. .  ...
0004da0: cccf c7c9 dece cf20 c4cc d120 d2c1 dace  ....... ... ....
0004db0: cfd3 d4c9 2e0a 0a20 2025 5c69 7465 6d20  .......  %\item 
0004dc0: 4966 2074 6865 2065 7870 7265 7373 696f  If the expressio
0004dd0: 6e20 6973 206f 6620 7468 6520 666f 726d  n is of the form
0004de0: 205c 616c 6572 747b 2466 2878 2920 2b20   \alert{$f(x) + 
0004df0: 6728 7829 247d 2074 6865 6e20 6170 706c  g(x)$} then appl
0004e00: 7920 0a20 2025 7468 6520 7275 6c65 2066  y .  %the rule f
0004e10: 6f72 2073 756d 732c 2072 6574 7572 6e69  or sums, returni
0004e20: 6e67 205c 616c 6572 747b 2466 2728 7829  ng \alert{$f'(x)
0004e30: 202b 2067 2728 7829 247d 2e20 4c69 6b65   + g'(x)$}. Like
0004e40: 7769 7365 2066 6f72 200a 2020 2573 7562  wise for .  %sub
0004e50: 7472 6163 7469 6f6e 2065 7463 2e0a 0a20  traction etc... 
0004e60: 205c 6974 656d 20e5 d3cc c920 d7d9 d2c1   \item .... ....
0004e70: d6c5 cec9 c520 dac1 c4c1 cecf 20d7 20c6  ..... ...... . .
0004e80: cfd2 cdc5 205c 616c 6572 747b 2466 2878  .... \alert{$f(x
0004e90: 2920 2a20 6728 7829 247d 2c20 d0d2 c9cd  ) * g(x)$}, ....
0004ea0: c5ce d1c5 d4d3 d120 7b5c 656d 20d0 d2c1  ....... {\em ...
0004eb0: d7c9 cccf 0a20 20ec c5ca c2ce c9c3 c17d  .....  ........}
0004ec0: 2c20 d42e c52e 20d7 cfda d7d2 c1dd c1c5  , .... .........
0004ed0: d4d3 d120 5c61 6c65 7274 7b24 6627 2878  ... \alert{$f'(x
0004ee0: 2920 2a20 6728 7829 202b 2066 2878 2920  ) * g(x) + f(x) 
0004ef0: 2a20 6727 2878 2924 7d2e 0a0a 2020 255c  * g'(x)$}...  %\
0004f00: 6974 656d 2049 6620 7468 6520 6578 7072  item If the expr
0004f10: 6573 7369 6f6e 2069 7320 6f66 2074 6865  ession is of the
0004f20: 2066 6f72 6d20 5c61 6c65 7274 7b24 6628   form \alert{$f(
0004f30: 7829 202a 2067 2878 2924 7d20 7468 656e  x) * g(x)$} then
0004f40: 2061 7070 6c79 2074 6865 0a20 2025 7072   apply the.  %pr
0004f50: 6f64 7563 7420 7275 6c65 2c20 692e 652e  oduct rule, i.e.
0004f60: 2072 6574 7572 6e20 5c61 6c65 7274 7b24   return \alert{$
0004f70: 6627 2878 2920 2a20 6728 7829 202b 2066  f'(x) * g(x) + f
0004f80: 2878 2920 2a20 6727 2878 2924 7d2e 0a0a  (x) * g'(x)$}...
0004f90: 2020 5c69 7465 6d20 e5d3 ccc9 20d7 d9d2    \item .... ...
0004fa0: c1d6 c5ce c9c5 20d1 d7cc d1c5 d4d3 d120  ...... ........ 
0004fb0: cfc4 cecf ca20 c9da 20cb cfcd d0cf dac9  ..... .. .......
0004fc0: c3c9 c5ca 20d3 d4c1 cec4 c1d2 d4ce d9c8  .... ...........
0004fd0: 20c6 d5ce cbc3 c9ca 3a20 200a 2020 5c61   .......:  .  \a
0004fe0: 6c65 7274 7b24 6628 6728 7829 2924 7d2c  lert{$f(g(x))$},
0004ff0: 20d4 cf20 d0d2 c9cd c5ce d1c5 d4d3 d120   .. ........... 
0005000: d0d2 c1d7 c9cc cf20 d0cf d3cc c5c4 cfd7  ....... ........
0005010: c1d4 c5cc d8ce cfc7 cf20 0a20 20c4 c9c6  ......... .  ...
0005020: c6c5 d2c5 cec3 c9d2 cfd7 c1ce c9d1 2c20  .............., 
0005030: d2c5 dad5 ccd8 d4c1 d420 cbcf d4cf d2cf  ......... ......
0005040: c7cf 3a20 5c61 6c65 7274 7b24 6727 2878  ..: \alert{$g'(x
0005050: 2920 2a20 6627 2867 2878 2929 247d 2e0a  ) * f'(g(x))$}..
0005060: 0a20 2025 5c69 7465 6d20 4966 2074 6865  .  %\item If the
0005070: 2065 7870 7265 7373 696f 6e20 6973 206f   expression is o
0005080: 6e65 206f 6620 7468 6520 7374 616e 6461  ne of the standa
0005090: 7264 2066 756e 6374 696f 6e73 2061 7070  rd functions app
00050a0: 6c69 6564 2074 6f20 6120 0a20 2025 636f  lied to a .  %co
00050b0: 6d70 6f73 6974 6520 6172 6775 6d65 6e74  mposite argument
00050c0: 2c20 7361 7920 5c61 6c65 7274 7b24 6628  , say \alert{$f(
00050d0: 6728 7829 2924 7d20 7468 656e 2061 7070  g(x))$} then app
00050e0: 6c79 2074 6865 2043 6861 696e 2052 756c  ly the Chain Rul
00050f0: 6520 616e 6420 736f 2020 0a20 2025 6769  e and so  .  %gi
0005100: 7665 205c 616c 6572 747b 2467 2728 7829  ve \alert{$g'(x)
0005110: 202a 2066 2728 6728 7829 2924 7d2e 0a0a   * f'(g(x))$}...
0005120: 5c65 6e64 7b69 7465 6d69 7a65 7d0a 0af4  \end{itemize}...
0005130: c1cb c9cd 20cf c2d2 c1da cfcd 2c20 dcd4  .... ......., ..
0005140: c920 d0d2 c1d7 c9cc c120 d0d2 c5c4 d3d4  . ....... ......
0005150: c1d7 ccd1 c0d4 20d3 cfc2 cfca 20d2 c5cb  ...... ..... ...
0005160: d5d2 d3c9 d7ce d9ca 20c1 ccc7 cfd2 c9d4  ........ .......
0005170: cd2c 20c8 cfd4 d120 d4c1 cbc1 d120 0ad4  ., .... ..... ..
0005180: c5d2 cdc9 cecf cccf c7c9 d120 d2c5 c4cb  ........... ....
0005190: cf20 c9d3 d0cf ccd8 dad5 c5d4 d3d1 20d7  . ............ .
00051a0: 20db cbcf ccc1 c82e 20ed d920 cdcf d6c5   ....... .. ....
00051b0: cd20 c4cf d3cc cfd7 cecf 20da c1d0 d2cf  . ........ .....
00051c0: c7d2 c1cd cdc9 d2cf d7c1 d4d8 20c5 c7cf  ............ ...
00051d0: 20d7 204d 4c3a 0a0a 2525 5468 6973 2069   . ML:..%%This i
00051e0: 7320 6e6f 7468 696e 6720 6275 7420 6120  s nothing but a 
00051f0: 7265 6375 7273 6976 6520 616c 676f 7269  recursive algori
0005200: 7468 6d2c 2074 686f 7567 6820 7468 6174  thm, though that
0005210: 2074 6572 6d69 6e6f 6c6f 6779 2069 7320   terminology is 
0005220: 7365 6c64 6f6d 0a25 2575 7365 6420 696e  seldom.%%used in
0005230: 2073 6368 6f6f 6c73 2e20 5765 2063 616e   schools. We can
0005240: 2070 726f 6772 616d 2069 7420 696e 204d   program it in M
0005250: 4c20 7665 7279 2064 6972 6563 746c 793a  L very directly:
0005260: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
0005270: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
0005280: 2020 236c 6574 2072 6563 2064 6966 6665    #let rec diffe
0005290: 7265 6e74 6961 7465 2078 2074 6d20 3d20  rentiate x tm = 
00052a0: 6d61 7463 6820 746d 2077 6974 680a 2020  match tm with.  
00052b0: 2020 2020 2056 6172 2079 202d 3e20 6966       Var y -> if
00052c0: 2079 203d 2078 2074 6865 6e20 436f 6e73   y = x then Cons
00052d0: 7420 2231 2220 656c 7365 2043 6f6e 7374  t "1" else Const
00052e0: 2022 3022 0a20 2020 2020 7c20 436f 6e73   "0".     | Cons
00052f0: 7420 6320 2d3e 2043 6f6e 7374 2022 3022  t c -> Const "0"
0005300: 0a20 2020 2020 7c20 466e 2822 2d22 2c5b  .     | Fn("-",[
0005310: 745d 2920 2d3e 2046 6e28 222d 222c 5b64  t]) -> Fn("-",[d
0005320: 6966 6665 7265 6e74 6961 7465 2078 2074  ifferentiate x t
0005330: 5d29 0a20 2020 2020 7c20 466e 2822 2b22  ]).     | Fn("+"
0005340: 2c5b 7431 3b74 325d 2920 2d3e 2046 6e28  ,[t1;t2]) -> Fn(
0005350: 222b 222c 5b64 6966 6665 7265 6e74 6961  "+",[differentia
0005360: 7465 2078 2074 313b 0a20 2020 2020 2020  te x t1;.       
0005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
0005380: 2020 2020 2020 2020 2020 2020 6469 6666              diff
0005390: 6572 656e 7469 6174 6520 7820 7432 5d29  erentiate x t2])
00053a0: 0a20 2020 2020 7c20 466e 2822 2d22 2c5b  .     | Fn("-",[
00053b0: 7431 3b74 325d 2920 2d3e 2046 6e28 222d  t1;t2]) -> Fn("-
00053c0: 222c 5b64 6966 6665 7265 6e74 6961 7465  ",[differentiate
00053d0: 2078 2074 313b 0a20 2020 2020 2020 2020   x t1;.         
00053e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00053f0: 2020 2020 2020 2020 2020 6469 6666 6572            differ
0005400: 656e 7469 6174 6520 7820 7432 5d29 0a20  entiate x t2]). 
0005410: 2020 2020 7c20 466e 2822 2a22 2c5b 7431      | Fn("*",[t1
0005420: 3b74 325d 2920 2d3e 0a20 2020 2020 2020  ;t2]) ->.       
0005430: 2046 6e28 222b 222c 5b46 6e28 222a 222c   Fn("+",[Fn("*",
0005440: 5b64 6966 6665 7265 6e74 6961 7465 2078  [differentiate x
0005450: 2074 313b 2074 325d 293b 0a20 2020 2020   t1; t2]);.     
0005460: 2020 2020 2020 2020 2020 2046 6e28 222a             Fn("*
0005470: 222c 5b74 313b 2064 6966 6665 7265 6e74  ",[t1; different
0005480: 6961 7465 2078 2074 325d 295d 290a 2020  iate x t2])]).  
0005490: 2020 207c 2046 6e28 2269 6e76 222c 5b74     | Fn("inv",[t
00054a0: 5d29 202d 3e20 6368 6169 6e20 7820 740a  ]) -> chain x t.
00054b0: 2020 2020 2020 2020 2846 6e28 222d 222c          (Fn("-",
00054c0: 5b46 6e28 2269 6e76 222c 5b46 6e28 225e  [Fn("inv",[Fn("^
00054d0: 222c 5b74 3b43 6f6e 7374 2022 3222 5d29  ",[t;Const "2"])
00054e0: 5d29 5d29 290a 2020 2020 207c 2046 6e28  ])])).     | Fn(
00054f0: 225e 222c 5b74 3b6e 5d29 202d 3e20 6368  "^",[t;n]) -> ch
0005500: 6169 6e20 7820 740a 2020 2020 2020 2028  ain x t.       (
0005510: 466e 2822 2a22 2c5b 6e3b 2046 6e28 225e  Fn("*",[n; Fn("^
0005520: 222c 5b74 3b20 466e 2822 2d22 2c5b 6e3b  ",[t; Fn("-",[n;
0005530: 2043 6f6e 7374 2022 3122 5d29 5d29 5d29   Const "1"])])])
0005540: 290a 2020 2020 207c 2046 6e28 2265 7870  ).     | Fn("exp
0005550: 222c 5b74 5d29 202d 3e20 6368 6169 6e20  ",[t]) -> chain 
0005560: 7820 7420 746d 0a20 2020 2020 7c20 466e  x t tm.     | Fn
0005570: 2822 6c6e 222c 5b74 5d29 202d 3e20 6368  ("ln",[t]) -> ch
0005580: 6169 6e20 7820 7420 2846 6e28 2269 6e76  ain x t (Fn("inv
0005590: 222c 5b74 5d29 290a 2020 2020 207c 2046  ",[t])).     | F
00055a0: 6e28 2273 696e 222c 5b74 5d29 202d 3e20  n("sin",[t]) -> 
00055b0: 6368 6169 6e20 7820 7420 2846 6e28 2263  chain x t (Fn("c
00055c0: 6f73 222c 5b74 5d29 290a 2020 2020 207c  os",[t])).     |
00055d0: 2046 6e28 2263 6f73 222c 5b74 5d29 202d   Fn("cos",[t]) -
00055e0: 3e20 6368 6169 6e20 7820 740a 2020 2020  > chain x t.    
00055f0: 2020 2020 2846 6e28 222d 222c 5b46 6e28      (Fn("-",[Fn(
0005600: 2273 696e 222c 5b74 5d29 5d29 290a 2020  "sin",[t])])).  
0005610: 2020 207c 2046 6e28 222f 222c 5b74 313b     | Fn("/",[t1;
0005620: 7432 5d29 202d 3e20 6469 6666 6572 656e  t2]) -> differen
0005630: 7469 6174 6520 780a 2020 2020 2020 2020  tiate x.        
0005640: 2846 6e28 222a 222c 5b74 313b 2046 6e28  (Fn("*",[t1; Fn(
0005650: 2269 6e76 222c 5b74 325d 295d 2929 0a20  "inv",[t2])])). 
0005660: 2020 2020 7c20 466e 2822 7461 6e22 2c5b      | Fn("tan",[
0005670: 745d 2920 2d3e 2064 6966 6665 7265 6e74  t]) -> different
0005680: 6961 7465 2078 0a20 2020 2020 2020 2028  iate x.        (
0005690: 466e 2822 2f22 2c5b 466e 2822 7369 6e22  Fn("/",[Fn("sin"
00056a0: 2c5b 745d 293b 2046 6e28 2263 6f73 222c  ,[t]); Fn("cos",
00056b0: 5b74 5d29 5d29 290a 2020 2061 6e64 2063  [t])])).   and c
00056c0: 6861 696e 2078 2074 2075 203d 2020 466e  hain x t u =  Fn
00056d0: 2822 2a22 2c5b 6469 6666 6572 656e 7469  ("*",[differenti
00056e0: 6174 6520 7820 743b 2075 5d29 3b3b 0a5c  ate x t; u]);;.\
00056f0: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
0005700: 647b 626f 7865 647d 0a0a 5468 6520 7b5c  d{boxed}..The {\
0005710: 7474 2063 6861 696e 7d20 6675 6e63 7469  tt chain} functi
0005720: 6f6e 206a 7573 7420 6176 6f69 6473 2072  on just avoids r
0005730: 6570 6561 7469 6e67 2074 6865 2063 6861  epeating the cha
0005740: 696e 2072 756c 6520 636f 6e73 7472 7563  in rule construc
0005750: 7469 6f6e 2066 6f72 0a6d 616e 7920 6f70  tion for.many op
0005760: 6572 6174 696f 6e73 2e20 4170 6172 7420  erations. Apart 
0005770: 6672 6f6d 2074 6861 742c 2077 6520 6a75  from that, we ju
0005780: 7374 2073 7973 7465 6d61 7469 6361 6c6c  st systematicall
0005790: 7920 6170 706c 7920 7275 6c65 7320 666f  y apply rules fo
00057a0: 7220 7375 6d73 2c0a 7072 6f64 7563 7473  r sums,.products
00057b0: 2065 7463 2e20 616e 6420 7468 6520 6b6e   etc. and the kn
00057c0: 6f77 6e20 6465 7269 7661 7469 7665 7320  own derivatives 
00057d0: 6f66 2073 7461 6e64 6172 6420 6675 6e63  of standard func
00057e0: 7469 6f6e 732e 204f 6620 636f 7572 7365  tions. Of course
00057f0: 2c20 7765 0a63 6f75 6c64 2061 6464 206f  , we.could add o
0005800: 7468 6572 2066 756e 6374 696f 6e73 2073  ther functions s
0005810: 7563 6820 6173 2074 6865 2068 7970 6572  uch as the hyper
0005820: 626f 6c69 6320 6675 6e63 7469 6f6e 7320  bolic functions 
0005830: 616e 6420 696e 7665 7273 650a 7472 6967  and inverse.trig
0005840: 6f6e 6f6d 6574 7269 6320 6675 6e63 7469  onometric functi
0005850: 6f6e 7320 6966 2064 6573 6972 6564 2e20  ons if desired. 
0005860: 4120 636f 7570 6c65 206f 6620 6361 7365  A couple of case
0005870: 732c 206e 616d 656c 7920 6469 7669 7369  s, namely divisi
0005880: 6f6e 2061 6e64 0a24 7461 6e24 2c20 6176  on and.$tan$, av
0005890: 6f69 6420 6120 636f 6d70 6c69 6361 7465  oid a complicate
00058a0: 6420 6465 6669 6e69 7469 6f6e 2062 7920  d definition by 
00058b0: 6170 706c 7969 6e67 2074 6865 2064 6966  applying the dif
00058c0: 6665 7265 6e74 6961 746f 7220 746f 2061  ferentiator to a
00058d0: 6e0a 616c 7465 726e 6174 6976 6520 666f  n.alternative fo
00058e0: 726d 756c 6174 696f 6e2e 0a0a 2525 5468  rmulation...%%Th
00058f0: 6520 7b5c 7474 2063 6861 696e 7d20 6675  e {\tt chain} fu
0005900: 6e63 7469 6f6e 206a 7573 7420 6176 6f69  nction just avoi
0005910: 6473 2072 6570 6561 7469 6e67 2074 6865  ds repeating the
0005920: 2063 6861 696e 2072 756c 6520 636f 6e73   chain rule cons
0005930: 7472 7563 7469 6f6e 2066 6f72 0a25 256d  truction for.%%m
0005940: 616e 7920 6f70 6572 6174 696f 6e73 2e20  any operations. 
0005950: 4170 6172 7420 6672 6f6d 2074 6861 742c  Apart from that,
0005960: 2077 6520 6a75 7374 2073 7973 7465 6d61   we just systema
0005970: 7469 6361 6c6c 7920 6170 706c 7920 7275  tically apply ru
0005980: 6c65 7320 666f 7220 7375 6d73 2c0a 2525  les for sums,.%%
0005990: 7072 6f64 7563 7473 2065 7463 2e20 616e  products etc. an
00059a0: 6420 7468 6520 6b6e 6f77 6e20 6465 7269  d the known deri
00059b0: 7661 7469 7665 7320 6f66 2073 7461 6e64  vatives of stand
00059c0: 6172 6420 6675 6e63 7469 6f6e 732e 204f  ard functions. O
00059d0: 6620 636f 7572 7365 2c20 7765 0a25 2563  f course, we.%%c
00059e0: 6f75 6c64 2061 6464 206f 7468 6572 2066  ould add other f
00059f0: 756e 6374 696f 6e73 2073 7563 6820 6173  unctions such as
0005a00: 2074 6865 2068 7970 6572 626f 6c69 6320   the hyperbolic 
0005a10: 6675 6e63 7469 6f6e 7320 616e 6420 696e  functions and in
0005a20: 7665 7273 650a 2525 7472 6967 6f6e 6f6d  verse.%%trigonom
0005a30: 6574 7269 6320 6675 6e63 7469 6f6e 7320  etric functions 
0005a40: 6966 2064 6573 6972 6564 2e20 4120 636f  if desired. A co
0005a50: 7570 6c65 206f 6620 6361 7365 732c 206e  uple of cases, n
0005a60: 616d 656c 7920 6469 7669 7369 6f6e 2061  amely division a
0005a70: 6e64 0a25 2524 7461 6e24 2c20 6176 6f69  nd.%%$tan$, avoi
0005a80: 6420 6120 636f 6d70 6c69 6361 7465 6420  d a complicated 
0005a90: 6465 6669 6e69 7469 6f6e 2062 7920 6170  definition by ap
0005aa0: 706c 7969 6e67 2074 6865 2064 6966 6665  plying the diffe
0005ab0: 7265 6e74 6961 746f 7220 746f 2061 6e0a  rentiator to an.
0005ac0: 2525 616c 7465 726e 6174 6976 6520 666f  %%alternative fo
0005ad0: 726d 756c 6174 696f 6e2e 0a0a 5c73 7562  rmulation...\sub
0005ae0: 7365 6374 696f 6e7b f5d0 d2cf ddc5 cec9  section{........
0005af0: c57d 0a0a 4966 2077 6520 7472 7920 7468  .}..If we try th
0005b00: 6520 6469 6666 6572 656e 7469 6174 6f72  e differentiator
0005b10: 206f 7574 206f 6e20 6f75 7220 7275 6e6e   out on our runn
0005b20: 696e 6720 6578 616d 706c 652c 2074 6865  ing example, the
0005b30: 6e20 6974 2077 6f72 6b73 2071 7569 7465  n it works quite
0005b40: 0a77 656c 6c3a 0a0a 5c62 6567 696e 7b62  .well:..\begin{b
0005b50: 6f78 6564 7d5c 6265 6769 6e7b 7665 7262  oxed}\begin{verb
0005b60: 6174 696d 7d0a 2020 2374 3b3b 0a20 202d  atim}.  #t;;.  -
0005b70: 203a 2074 6572 6d20 3d20 6073 696e 2878   : term = `sin(x
0005b80: 202b 2079 2920 2f20 636f 7328 7820 2d20   + y) / cos(x - 
0005b90: 6578 7028 7929 2920 2d20 6c6e 2831 202b  exp(y)) - ln(1 +
0005ba0: 2078 2960 0a20 2023 6469 6666 6572 656e   x)`.  #differen
0005bb0: 7469 6174 6520 2278 2220 743b 3b0a 2020  tiate "x" t;;.  
0005bc0: 2d20 3a20 7465 726d 203d 0a20 2020 6028  - : term =.   `(
0005bd0: 2828 3120 2b20 3029 202a 2063 6f73 2878  ((1 + 0) * cos(x
0005be0: 202b 2079 2929 202a 2069 6e76 2863 6f73   + y)) * inv(cos
0005bf0: 2878 202d 2065 7870 2879 2929 2920 2b0a  (x - exp(y))) +.
0005c00: 2020 2020 7369 6e28 7820 2b20 7929 202a      sin(x + y) *
0005c10: 2028 2828 3120 2d20 3020 2a20 6578 7028   (((1 - 0 * exp(
0005c20: 7929 2920 2a20 2d28 7369 6e28 7820 2d20  y)) * -(sin(x - 
0005c30: 6578 7028 7929 2929 2920 2a0a 2020 2020  exp(y)))) *.    
0005c40: 2d28 696e 7628 636f 7328 7820 2d20 6578  -(inv(cos(x - ex
0005c50: 7028 7929 2920 5e20 3229 2929 2920 2d20  p(y)) ^ 2)))) - 
0005c60: 2830 202b 2031 2920 2a20 696e 7628 3120  (0 + 1) * inv(1 
0005c70: 2b20 7829 600a 2020 2364 6966 6665 7265  + x)`.  #differe
0005c80: 6e74 6961 7465 2022 7922 2074 3b3b 0a20  ntiate "y" t;;. 
0005c90: 202d 203a 2074 6572 6d20 3d0a 2020 2060   - : term =.   `
0005ca0: 2828 2830 202b 2031 2920 2a20 636f 7328  (((0 + 1) * cos(
0005cb0: 7820 2b20 7929 2920 2a20 696e 7628 636f  x + y)) * inv(co
0005cc0: 7328 7820 2d20 6578 7028 7929 2929 202b  s(x - exp(y))) +
0005cd0: 0a20 2020 2073 696e 2878 202b 2079 2920  .    sin(x + y) 
0005ce0: 2a20 2828 2830 202d 2031 202a 2065 7870  * (((0 - 1 * exp
0005cf0: 2879 2929 202a 202d 2873 696e 2878 202d  (y)) * -(sin(x -
0005d00: 2065 7870 2879 2929 2929 202a 0a20 2020   exp(y)))) *.   
0005d10: 202d 2869 6e76 2863 6f73 2878 202d 2065   -(inv(cos(x - e
0005d20: 7870 2879 2929 205e 2032 2929 2929 202d  xp(y)) ^ 2)))) -
0005d30: 2028 3020 2b20 3029 202a 2069 6e76 2831   (0 + 0) * inv(1
0005d40: 202b 2078 2960 0a20 2023 6469 6666 6572   + x)`.  #differ
0005d50: 656e 7469 6174 6520 227a 2220 743b 3b0a  entiate "z" t;;.
0005d60: 2020 2d20 3a20 7465 726d 203d 0a20 2020    - : term =.   
0005d70: 6028 2828 3020 2b20 3029 202a 2063 6f73  `(((0 + 0) * cos
0005d80: 2878 202b 2079 2929 202a 2069 6e76 2863  (x + y)) * inv(c
0005d90: 6f73 2878 202d 2065 7870 2879 2929 2920  os(x - exp(y))) 
0005da0: 2b0a 2020 2020 7369 6e28 7820 2b20 7929  +.    sin(x + y)
0005db0: 202a 2028 2828 3020 2d20 3020 2a20 6578   * (((0 - 0 * ex
0005dc0: 7028 7929 2920 2a20 2d28 7369 6e28 7820  p(y)) * -(sin(x 
0005dd0: 2d20 6578 7028 7929 2929 2920 2a0a 2020  - exp(y)))) *.  
0005de0: 2020 2d28 696e 7628 636f 7328 7820 2d20    -(inv(cos(x - 
0005df0: 6578 7028 7929 2920 5e20 3229 2929 2920  exp(y)) ^ 2)))) 
0005e00: 2d20 2830 202b 2030 2920 2a20 696e 7628  - (0 + 0) * inv(
0005e10: 3120 2b20 7829 600a 5c65 6e64 7b76 6572  1 + x)`.\end{ver
0005e20: 6261 7469 6d7d 5c65 6e64 7b62 6f78 6564  batim}\end{boxed
0005e30: 7d0a 0a48 6f77 6576 6572 2c20 6974 2066  }..However, it f
0005e40: 6169 6c73 2074 6f20 6d61 6b65 2076 6172  ails to make var
0005e50: 696f 7573 206f 6276 696f 7573 2073 696d  ious obvious sim
0005e60: 706c 6966 6963 6174 696f 6e73 2073 7563  plifications suc
0005e70: 6820 6173 2024 3020 2a20 7820 3d20 3024  h as $0 * x = 0$
0005e80: 0a61 6e64 2024 7820 2b20 3020 3d20 7824  .and $x + 0 = x$
0005e90: 2e20 536f 6d65 206f 6620 7468 6573 6520  . Some of these 
0005ea0: 7265 6475 6e64 616e 7420 6578 7072 6573  redundant expres
0005eb0: 7369 6f6e 7320 6172 6520 6372 6561 7465  sions are create
0005ec0: 6420 6279 2074 6865 2072 6174 6865 720a  d by the rather.
0005ed0: 756e 7375 6274 6c65 2064 6966 6665 7265  unsubtle differe
0005ee0: 6e74 6961 7469 6f6e 2073 7472 6174 6567  ntiation strateg
0005ef0: 7920 7768 6963 682c 2066 6f72 2069 6e73  y which, for ins
0005f00: 7461 6e63 652c 2061 7070 6c69 6573 2074  tance, applies t
0005f10: 6865 2063 6861 696e 2072 756c 650a 746f  he chain rule.to
0005f20: 2024 6628 7429 2420 6576 656e 2077 6865   $f(t)$ even whe
0005f30: 7265 2024 7424 2069 7320 6a75 7374 2074  re $t$ is just t
0005f40: 6865 2076 6172 6961 626c 6520 6f66 2064  he variable of d
0005f50: 6966 6665 7265 6e74 6961 7469 6f6e 2e20  ifferentiation. 
0005f60: 486f 7765 7665 722c 2073 6f6d 650a 776f  However, some.wo
0005f70: 756c 6420 6265 2068 6172 6420 746f 2061  uld be hard to a
0005f80: 766f 6964 2077 6974 686f 7574 206d 616b  void without mak
0005f90: 696e 6720 7468 6520 6469 6666 6572 656e  ing the differen
0005fa0: 7469 6174 6f72 206d 7563 6820 6d6f 7265  tiator much more
0005fb0: 2063 6f6d 706c 6963 6174 6564 2e0a 4163   complicated..Ac
0005fc0: 636f 7264 696e 676c 792c 206c 6574 2075  cordingly, let u
0005fd0: 7320 6465 6669 6e65 2061 2073 6570 6172  s define a separ
0005fe0: 6174 6520 7369 6d70 6c69 6669 6361 7469  ate simplificati
0005ff0: 6f6e 2066 756e 6374 696f 6e20 7468 6174  on function that
0006000: 2067 6574 7320 7269 6420 6f66 0a73 6f6d   gets rid of.som
0006010: 6520 6f66 2074 6865 7365 2075 6e6e 6563  e of these unnec
0006020: 6573 7361 7279 2065 7870 7265 7373 696f  essary expressio
0006030: 6e73 2e0a 0a5c 6265 6769 6e7b 626f 7865  ns...\begin{boxe
0006040: 647d 5c62 6567 696e 7b76 6572 6261 7469  d}\begin{verbati
0006050: 6d7d 0a20 2023 6c65 7420 7369 6d70 203d  m}.  #let simp =
0006060: 0a20 2020 2020 6675 6e20 2846 6e28 222b  .     fun (Fn("+
0006070: 222c 5b43 6f6e 7374 2022 3022 3b20 745d  ",[Const "0"; t]
0006080: 2929 202d 3e20 740a 2020 2020 2020 207c  )) -> t.       |
0006090: 2028 466e 2822 2b22 2c5b 743b 2043 6f6e   (Fn("+",[t; Con
00060a0: 7374 2022 3022 5d29 2920 2d3e 2074 0a20  st "0"])) -> t. 
00060b0: 2020 2020 2020 7c20 2846 6e28 222d 222c        | (Fn("-",
00060c0: 5b74 3b20 436f 6e73 7420 2230 225d 2929  [t; Const "0"]))
00060d0: 202d 3e20 740a 2020 2020 2020 207c 2028   -> t.       | (
00060e0: 466e 2822 2d22 2c5b 436f 6e73 7420 2230  Fn("-",[Const "0
00060f0: 223b 2074 5d29 2920 2d3e 2046 6e28 222d  "; t])) -> Fn("-
0006100: 222c 5b74 5d29 0a20 2020 2020 2020 7c20  ",[t]).       | 
0006110: 2846 6e28 222b 222c 5b74 313b 2046 6e28  (Fn("+",[t1; Fn(
0006120: 222d 222c 5b74 325d 295d 2929 202d 3e20  "-",[t2])])) -> 
0006130: 466e 2822 2d22 2c5b 7431 3b20 7432 5d29  Fn("-",[t1; t2])
0006140: 0a20 2020 2020 2020 7c20 2846 6e28 222a  .       | (Fn("*
0006150: 222c 5b43 6f6e 7374 2022 3022 3b20 745d  ",[Const "0"; t]
0006160: 2929 202d 3e20 436f 6e73 7420 2230 220a  )) -> Const "0".
0006170: 2020 2020 2020 207c 2028 466e 2822 2a22         | (Fn("*"
0006180: 2c5b 743b 2043 6f6e 7374 2022 3022 5d29  ,[t; Const "0"])
0006190: 2920 2d3e 2043 6f6e 7374 2022 3022 0a20  ) -> Const "0". 
00061a0: 2020 2020 2020 7c20 2846 6e28 222a 222c        | (Fn("*",
00061b0: 5b43 6f6e 7374 2022 3122 3b20 745d 2929  [Const "1"; t]))
00061c0: 202d 3e20 740a 2020 2020 2020 207c 2028   -> t.       | (
00061d0: 466e 2822 2a22 2c5b 743b 2043 6f6e 7374  Fn("*",[t; Const
00061e0: 2022 3122 5d29 2920 2d3e 2074 0a20 2020   "1"])) -> t.   
00061f0: 2020 2020 7c20 2846 6e28 222a 222c 5b46      | (Fn("*",[F
0006200: 6e28 222d 222c 5b74 315d 293b 2046 6e28  n("-",[t1]); Fn(
0006210: 222d 222c 5b74 325d 295d 2929 202d 3e20  "-",[t2])])) -> 
0006220: 466e 2822 2a22 2c5b 7431 3b20 7432 5d29  Fn("*",[t1; t2])
0006230: 0a20 2020 2020 2020 7c20 2846 6e28 222a  .       | (Fn("*
0006240: 222c 5b46 6e28 222d 222c 5b74 315d 293b  ",[Fn("-",[t1]);
0006250: 2074 325d 2929 202d 3e20 466e 2822 2d22   t2])) -> Fn("-"
0006260: 2c5b 466e 2822 2a22 2c5b 7431 3b20 7432  ,[Fn("*",[t1; t2
0006270: 5d29 5d29 0a20 2020 2020 2020 7c20 2846  ])]).       | (F
0006280: 6e28 222a 222c 5b74 313b 2046 6e28 222d  n("*",[t1; Fn("-
0006290: 222c 5b74 325d 295d 2929 202d 3e20 466e  ",[t2])])) -> Fn
00062a0: 2822 2d22 2c5b 466e 2822 2a22 2c5b 7431  ("-",[Fn("*",[t1
00062b0: 3b20 7432 5d29 5d29 0a20 2020 2020 2020  ; t2])]).       
00062c0: 7c20 2846 6e28 222d 222c 5b46 6e28 222d  | (Fn("-",[Fn("-
00062d0: 222c 5b74 5d29 5d29 2920 2d3e 2074 0a20  ",[t])])) -> t. 
00062e0: 2020 2020 2020 7c20 7420 2d3e 2074 3b3b        | t -> t;;
00062f0: 0a5c 656e 647b 7665 7262 6174 696d 7d5c  .\end{verbatim}\
0006300: 656e 647b 626f 7865 647d 0a0a 5468 6973  end{boxed}..This
0006310: 206a 7573 7420 6170 706c 6965 7320 7468   just applies th
0006320: 6520 7369 6d70 6c69 6669 6361 7469 6f6e  e simplification
0006330: 2061 7420 7468 6520 746f 7020 6c65 7665   at the top leve
0006340: 6c20 6f66 2074 6865 2074 6572 6d2e 2057  l of the term. W
0006350: 6520 6e65 6564 2074 6f0a 6578 6563 7574  e need to.execut
0006360: 6520 6974 2069 6e20 6120 626f 7474 6f6d  e it in a bottom
0006370: 2d75 7020 7377 6565 702e 2054 6869 7320  -up sweep. This 
0006380: 7769 6c6c 2061 6c73 6f20 6272 696e 6720  will also bring 
0006390: 6e65 6761 7469 6f6e 7320 7570 7761 7264  negations upward
00063a0: 7320 7468 726f 7567 680a 7072 6f64 7563  s through.produc
00063b0: 7473 2e20 496e 2073 6f6d 6520 6361 7365  ts. In some case
00063c0: 7320 6974 2077 6f75 6c64 2062 6520 6d6f  s it would be mo
00063d0: 7265 2065 6666 6963 6965 6e74 2074 6f20  re efficient to 
00063e0: 7369 6d70 6c69 6679 2069 6e20 6120 746f  simplify in a to
00063f0: 702d 646f 776e 0a73 7765 6570 2c20 652e  p-down.sweep, e.
0006400: 672e 2024 3020 2a20 7424 2066 6f72 2061  g. $0 * t$ for a
0006410: 2063 6f6d 706c 6963 6174 6564 2065 7870   complicated exp
0006420: 7265 7373 696f 6e20 2474 242c 2062 7574  ression $t$, but
0006430: 2074 6869 7320 776f 756c 6420 6e65 6564   this would need
0006440: 0a72 6570 6561 7469 6e67 2066 6f72 2074  .repeating for t
0006450: 6572 6d73 206c 696b 6520 2428 3020 2b20  erms like $(0 + 
0006460: 3029 202a 2032 242e 2054 6865 2063 686f  0) * 2$. The cho
0006470: 6963 6520 6973 2072 6174 6865 7220 6c69  ice is rather li
0006480: 6b65 2074 6861 7420 6265 7477 6565 6e0a  ke that between.
0006490: 6e6f 726d 616c 2061 6e64 2061 7070 6c69  normal and appli
00064a0: 6361 7469 7665 206f 7264 6572 2072 6564  cative order red
00064b0: 7563 7469 6f6e 2069 6e20 6c61 6d62 6461  uction in lambda
00064c0: 2063 616c 6375 6c75 732e 0a0a 5c62 6567   calculus...\beg
00064d0: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
00064e0: 7665 7262 6174 696d 7d0a 2020 236c 6574  verbatim}.  #let
00064f0: 2072 6563 2064 7369 6d70 203d 0a20 2020   rec dsimp =.   
0006500: 2020 6675 6e20 2846 6e28 666e 2c61 7267    fun (Fn(fn,arg
0006510: 7329 2920 2d3e 2073 696d 7028 466e 2866  s)) -> simp(Fn(f
0006520: 6e2c 6d61 7020 6473 696d 7020 6172 6773  n,map dsimp args
0006530: 2929 0a20 2020 2020 2020 7c20 7420 2d3e  )).       | t ->
0006540: 2073 696d 7020 743b 3b0a 5c65 6e64 7b76   simp t;;.\end{v
0006550: 6572 6261 7469 6d7d 5c65 6e64 7b62 6f78  erbatim}\end{box
0006560: 6564 7d0a 0a5c 6e6f 696e 6465 6e74 204e  ed}..\noindent N
0006570: 6f77 2077 6520 6765 7420 6265 7474 6572  ow we get better
0006580: 2072 6573 756c 7473 3a0a 0a5c 6265 6769   results:..\begi
0006590: 6e7b 626f 7865 647d 5c62 6567 696e 7b76  n{boxed}\begin{v
00065a0: 6572 6261 7469 6d7d 0a20 2023 6473 696d  erbatim}.  #dsim
00065b0: 7028 6469 6666 6572 656e 7469 6174 6520  p(differentiate 
00065c0: 2278 2220 7429 3b3b 0a20 202d 203a 2074  "x" t);;.  - : t
00065d0: 6572 6d20 3d0a 2020 2060 2863 6f73 2878  erm =.   `(cos(x
00065e0: 202b 2079 2920 2a20 696e 7628 636f 7328   + y) * inv(cos(
00065f0: 7820 2d20 6578 7028 7929 2929 202b 0a20  x - exp(y))) +. 
0006600: 2020 2073 696e 2878 202b 2079 2920 2a20     sin(x + y) * 
0006610: 2873 696e 2878 202d 2065 7870 2879 2929  (sin(x - exp(y))
0006620: 202a 0a20 2020 2069 6e76 2863 6f73 2878   *.    inv(cos(x
0006630: 202d 2065 7870 2879 2929 205e 2032 2929   - exp(y)) ^ 2))
0006640: 2920 2d20 696e 7628 3120 2b20 7829 600a  ) - inv(1 + x)`.
0006650: 2020 2364 7369 6d70 2864 6966 6665 7265    #dsimp(differe
0006660: 6e74 6961 7465 2022 7922 2074 293b 3b0a  ntiate "y" t);;.
0006670: 2020 2d20 3a20 7465 726d 203d 0a20 2020    - : term =.   
0006680: 6063 6f73 2878 202b 2079 2920 2a20 696e  `cos(x + y) * in
0006690: 7628 636f 7328 7820 2d20 6578 7028 7929  v(cos(x - exp(y)
00066a0: 2929 202d 0a20 2020 2073 696e 2878 202b  )) -.    sin(x +
00066b0: 2079 2920 2a20 2828 6578 7028 7929 202a   y) * ((exp(y) *
00066c0: 2073 696e 2878 202d 2065 7870 2879 2929   sin(x - exp(y))
00066d0: 2920 2a0a 2020 2020 696e 7628 636f 7328  ) *.    inv(cos(
00066e0: 7820 2d20 6578 7028 7929 2920 5e20 3229  x - exp(y)) ^ 2)
00066f0: 2960 0a20 2023 6473 696d 7028 6469 6666  )`.  #dsimp(diff
0006700: 6572 656e 7469 6174 6520 227a 2220 7429  erentiate "z" t)
0006710: 3b3b 0a20 202d 203a 2074 6572 6d20 3d20  ;;.  - : term = 
0006720: 6030 600a 5c65 6e64 7b76 6572 6261 7469  `0`.\end{verbati
0006730: 6d7d 5c65 6e64 7b62 6f78 6564 7d0a 0a49  m}\end{boxed}..I
0006740: 6e20 6765 6e65 7261 6c2c 206f 6e65 2063  n general, one c
0006750: 616e 2061 6c77 6179 7320 6164 6420 6d6f  an always add mo
0006760: 7265 2061 6e64 206d 6f72 6520 736f 7068  re and more soph
0006770: 6973 7469 6361 7465 6420 7369 6d70 6c69  isticated simpli
0006780: 6669 6361 7469 6f6e 2e20 466f 720a 6578  fication. For.ex
0006790: 616d 706c 652c 2063 6f6e 7369 6465 723a  ample, consider:
00067a0: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
00067b0: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
00067c0: 2020 236c 6574 2074 3220 3d20 466e 2822    #let t2 = Fn("
00067d0: 7461 6e22 2c5b 5661 7220 2278 225d 293b  tan",[Var "x"]);
00067e0: 3b0a 2020 7432 203a 2074 6572 6d20 3d20  ;.  t2 : term = 
00067f0: 6074 616e 2878 2960 0a20 2023 6469 6666  `tan(x)`.  #diff
0006800: 6572 656e 7469 6174 6520 2278 2220 7432  erentiate "x" t2
0006810: 3b3b 0a20 202d 203a 2074 6572 6d20 3d0a  ;;.  - : term =.
0006820: 2020 2060 2831 202a 2063 6f73 2878 2929     `(1 * cos(x))
0006830: 202a 2069 6e76 2863 6f73 2878 2929 202b   * inv(cos(x)) +
0006840: 0a20 2020 2073 696e 2878 2920 2a20 2828  .    sin(x) * ((
0006850: 3120 2a20 2d28 7369 6e28 7829 2929 202a  1 * -(sin(x))) *
0006860: 202d 2869 6e76 2863 6f73 2878 2920 5e20   -(inv(cos(x) ^ 
0006870: 3229 2929 600a 2020 2364 7369 6d70 2864  2)))`.  #dsimp(d
0006880: 6966 6665 7265 6e74 6961 7465 2022 7822  ifferentiate "x"
0006890: 2074 3229 3b3b 0a20 202d 203a 2074 6572   t2);;.  - : ter
00068a0: 6d20 3d20 6063 6f73 2878 2920 2a20 696e  m = `cos(x) * in
00068b0: 7628 636f 7328 7829 2920 2b0a 2020 2020  v(cos(x)) +.    
00068c0: 2020 2020 2020 2020 2020 7369 6e28 7829            sin(x)
00068d0: 202a 2028 7369 6e28 7829 202a 2069 6e76   * (sin(x) * inv
00068e0: 2863 6f73 2878 2920 5e20 3229 2960 0a5c  (cos(x) ^ 2))`.\
00068f0: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
0006900: 647b 626f 7865 647d 0a0a 5765 2077 6f75  d{boxed}..We wou
0006910: 6c64 206c 696b 6520 746f 2073 696d 706c  ld like to simpl
0006920: 6966 7920 7b5c 7474 2063 6f73 2878 2920  ify {\tt cos(x) 
0006930: 2a20 696e 7628 636f 7328 7829 297d 2073  * inv(cos(x))} s
0006940: 696d 706c 7920 746f 207b 5c74 7420 317d  imply to {\tt 1}
0006950: 2c0a 6967 6e6f 7269 6e67 2c20 6173 206d  ,.ignoring, as m
0006960: 6f73 7420 636f 6d6d 6572 6369 616c 2063  ost commercial c
0006970: 6f6d 7075 7465 7220 616c 6765 6272 6120  omputer algebra 
0006980: 7379 7374 656d 7320 646f 2c20 7468 6520  systems do, the 
0006990: 706f 7373 6962 696c 6974 7920 7468 6174  possibility that
00069a0: 0a7b 5c74 7420 636f 7328 7829 7d20 6d69  .{\tt cos(x)} mi
00069b0: 6768 7420 6265 207a 6572 6f2e 2057 6520  ght be zero. We 
00069c0: 6361 6e20 6365 7274 6169 6e6c 7920 6164  can certainly ad
00069d0: 6420 6e65 7720 636c 6175 7365 7320 746f  d new clauses to
00069e0: 2074 6865 2073 696d 706c 6966 6965 720a   the simplifier.
00069f0: 666f 7220 7468 6174 2e20 5369 6d69 6c61  for that. Simila
0006a00: 726c 792c 2077 6520 6d69 6768 7420 6c69  rly, we might li
0006a10: 6b65 2074 6f20 636f 6c6c 6563 7420 7570  ke to collect up
0006a20: 2074 6572 6d73 2069 6e20 7468 6520 7365   terms in the se
0006a30: 636f 6e64 2073 756d 6d61 6e64 2e0a 486f  cond summand..Ho
0006a40: 7765 7665 7220 6865 7265 2077 6520 7374  wever here we st
0006a50: 6172 7420 746f 2073 6565 2074 6861 7420  art to see that 
0006a60: 6875 6d61 6e20 7073 7963 686f 6c6f 6779  human psychology
0006a70: 2070 6c61 7973 2061 2072 6f6c 652e 2057   plays a role. W
0006a80: 6869 6368 206f 6620 7468 650a 666f 6c6c  hich of the.foll
0006a90: 6f77 696e 6720 6973 2070 7265 6665 7261  owing is prefera
0006aa0: 626c 653f 2049 7420 6973 2068 6172 6420  ble? It is hard 
0006ab0: 666f 7220 7468 6520 6d61 6368 696e 6520  for the machine 
0006ac0: 746f 2064 6563 6964 6520 756e 6169 6465  to decide unaide
0006ad0: 642e 0a0a 5c62 6567 696e 7b62 6f78 6564  d...\begin{boxed
0006ae0: 7d5c 6265 6769 6e7b 7665 7262 6174 696d  }\begin{verbatim
0006af0: 7d0a 2020 7369 6e28 7829 202a 2028 7369  }.  sin(x) * (si
0006b00: 6e28 7829 202a 2069 6e76 2863 6f73 2878  n(x) * inv(cos(x
0006b10: 2920 5e20 3229 290a 0a20 2073 696e 2878  ) ^ 2))..  sin(x
0006b20: 2920 5e20 3220 2a20 696e 7628 636f 7328  ) ^ 2 * inv(cos(
0006b30: 7829 205e 2032 290a 0a20 2073 696e 2878  x) ^ 2)..  sin(x
0006b40: 2920 5e20 3220 2f20 636f 7328 7829 205e  ) ^ 2 / cos(x) ^
0006b50: 2032 0a0a 2020 2873 696e 2878 2920 2f20   2..  (sin(x) / 
0006b60: 636f 7328 7829 2920 5e20 320a 0a20 2074  cos(x)) ^ 2..  t
0006b70: 616e 2878 2920 5e20 320a 5c65 6e64 7b76  an(x) ^ 2.\end{v
0006b80: 6572 6261 7469 6d7d 5c65 6e64 7b62 6f78  erbatim}\end{box
0006b90: 6564 7d0a 0a41 6e64 2068 6176 696e 6720  ed}..And having 
0006ba0: 6368 6f73 656e 2074 6865 206c 6173 7420  chosen the last 
0006bb0: 6f6e 652c 2073 686f 756c 6420 6974 2074  one, should it t
0006bc0: 6865 6e20 636f 6e76 6572 740a 0a5c 6265  hen convert..\be
0006bd0: 6769 6e7b 626f 7865 647d 5c62 6567 696e  gin{boxed}\begin
0006be0: 7b76 6572 6261 7469 6d7d 0a20 2031 202b  {verbatim}.  1 +
0006bf0: 2074 616e 2878 2920 5e20 320a 5c65 6e64   tan(x) ^ 2.\end
0006c00: 7b76 6572 6261 7469 6d7d 5c65 6e64 7b62  {verbatim}\end{b
0006c10: 6f78 6564 7d0a 0a5c 6e6f 696e 6465 6e74  oxed}..\noindent
0006c20: 2069 6e74 6f0a 0a5c 6265 6769 6e7b 626f   into..\begin{bo
0006c30: 7865 647d 5c62 6567 696e 7b76 6572 6261  xed}\begin{verba
0006c40: 7469 6d7d 0a20 2073 6563 2878 2920 5e20  tim}.  sec(x) ^ 
0006c50: 320a 5c65 6e64 7b76 6572 6261 7469 6d7d  2.\end{verbatim}
0006c60: 5c65 6e64 7b62 6f78 6564 7d0a 0a43 6572  \end{boxed}..Cer
0006c70: 7461 696e 6c79 2c20 6974 2069 7320 7368  tainly, it is sh
0006c80: 6f72 7465 7220 616e 6420 6d6f 7265 2063  orter and more c
0006c90: 6f6e 7665 6e74 696f 6e61 6c2e 2048 6f77  onventional. How
0006ca0: 6576 6572 2069 7420 7265 6c69 6573 206f  ever it relies o
0006cb0: 6e20 7468 6520 6661 6374 0a74 6861 7420  n the fact.that 
0006cc0: 7765 206b 6e6f 7720 7468 6520 6465 6669  we know the defi
0006cd0: 6e69 7469 6f6e 7320 6f66 2074 6865 7365  nitions of these
0006ce0: 2066 6169 726c 7920 6f62 7363 7572 6520   fairly obscure 
0006cf0: 7472 6967 2066 756e 6374 696f 6e73 206c  trig functions l
0006d00: 696b 6520 7b5c 7474 0a73 6563 7d2e 2057  ike {\tt.sec}. W
0006d10: 6861 7465 7665 7220 7468 6520 6d61 6368  hatever the mach
0006d20: 696e 6520 6465 6369 6465 7320 746f 2064  ine decides to d
0006d30: 6f2c 2069 7420 6973 206c 696b 656c 7920  o, it is likely 
0006d40: 7468 6174 2073 6f6d 6520 7573 6572 2077  that some user w
0006d50: 696c 6c20 6669 6e64 0a69 7420 7570 7365  ill find.it upse
0006d60: 7474 696e 672e 0a0a 5c73 6563 7469 6f6e  tting...\section
0006d70: 7bf3 c9ce d4c1 cbd3 c9de c5d3 cbc9 ca20  {.............. 
0006d80: c1ce c1cc c9da 7d0a 255c 7365 6374 696f  ......}.%\sectio
0006d90: 6e7b 5061 7273 696e 677d 0aee c5c4 cfd3  n{Parsing}......
0006da0: d4c1 d4cb cfcd 20d0 d2c5 c4d9 c4d5 ddc5  ...... .........
0006db0: c7cf 20d0 d2c9 cdc5 d2c1 20d1 d7cc d1c5  .. ....... .....
0006dc0: d4d3 d120 cec5 cfc2 c8cf c4c9 cdcf d3d4  ... ............
0006dd0: d820 dac1 c4c1 d7c1 d4d8 20d7 c8cf c4ce  . ........ .....
0006de0: d9c5 20c4 c1ce ced9 c50a d720 d7c9 c4c5  .. ........ ....
0006df0: 20cb cfcd d0cf dac9 c3c9 c920 cbcf ced3   .......... ....
0006e00: d4d2 d5cb d4cf d2cf d720 d4c9 d0cf d72e  ......... ......
0006e10: 20f7 20dc d4cf cd20 d2c1 dac4 c5cc c520   . .... ....... 
0006e20: cdd9 20d2 c1d3 d3cd cfd4 d2c9 cd20 dac1  .. .......... ..
0006e30: c4c1 ded5 0ad0 cfd3 d4d2 cfc5 cec9 d120  ............... 
0006e40: c6cf d2cd c1cc d8ce cfc7 cf20 d1da d9cb  ........... ....
0006e50: c120 cfd0 c9d3 c1ce c9d1 20d7 d9d2 c1d6  . ........ .....
0006e60: c5ce c9ca 20c9 20d2 c1da d2c1 c2cf d4cb  .... . .........
0006e70: c920 c5c7 cf20 d3c9 ced4 c1cb d3c9 dec5  . ... ..........
0006e80: d3cb cfc7 cf20 0ac1 cec1 ccc9 dac1 d4cf  ..... ..........
0006e90: d2c1 2e20 e9da cccf d6c5 cece d9ca 20d0  ... .......... .
0006ea0: cfc4 c8cf c420 c2d5 c4c5 d420 d0d2 c920  ..... ..... ... 
0006eb0: dcd4 cfcd 20c4 cfd3 d4c1 d4cf dece cf20  .... .......... 
0006ec0: cfc2 ddc9 cd2c 20de d4cf c2d9 200a d7d0  ....., ..... ...
0006ed0: cfd3 ccc5 c4d3 d4d7 c9c5 20cc c5c7 cbcf  .......... .....
0006ee0: 20d0 d2c9 cdc5 ced1 d4d8 d3d1 20cb 20c1   ........... . .
0006ef0: cec1 cccf c7c9 dece d9cd 20d1 dad9 cbc1  .......... .....
0006f00: cd2e 0a0a f3c6 cfd2 cdd5 ccc9 d2d5 c5cd  ................
0006f10: 20da c1c4 c1de d520 d3c9 ced4 c1cb d3c9   ...... ........
0006f20: dec5 d3cb cfc7 cf20 c1ce c1cc c9da c120  ....... ....... 
0006f30: d720 cfc2 ddc5 cd20 d7c9 c4c5 2e20 0ae6  . ..... ..... ..
0006f40: cfd2 cdc1 ccd8 ced9 ca20 d1da d9cb 20cf  ......... .... .
0006f50: d0d2 c5c4 c5cc d1c5 d4d3 d120 d3d7 cfc5  ........... ....
0006f60: ca20 7b5c 656d 20c7 d2c1 cdcd c1d4 c9cb  . {\em .........
0006f70: cfca 7d2c 20cb cfd4 cfd2 c1d1 20da c1c4  ..}, ....... ...
0006f80: c1c5 d420 cdce cfd6 c5d3 d4d7 cf20 0a7b  ... ......... .{
0006f90: 5c65 6d20 d0d2 cfc4 d5cb c3c9 ca20 28d0  \em ......... (.
0006fa0: d2c1 d7c9 cc20 d7d9 d7cf c4c1 297d 20c4  ..... ......)} .
0006fb0: ccd1 20cb c1d6 c4cf ca20 d3c9 ced4 c1cb  .. ...... ......
0006fc0: d3c9 dec5 d3cb cfca 20cb c1d4 c5c7 cfd2  ........ .......
0006fd0: c9c9 2e20 e4cc d120 d1da d9cb c10a d4c5  ... ... ........
0006fe0: d2cd cfd7 2c20 d7cb ccc0 dec1 c0dd c9c8  ...., ..........
0006ff0: 20cc c9db d820 c4d7 c520 c9ce c6c9 cbd3   .... ... ......
0007000: ced9 c520 cfd0 c5d2 c1c3 c9c9 2c20 7b5c  ... ........, {\
0007010: 7474 202b 7d20 c97e 7b5c 7474 202a 7d2c  tt +} .~{\tt *},
0007020: 20c1 20d4 c1cb d6c5 0ade c9d3 cccf d7d9   . .............
0007030: c520 cbcf ced3 d4c1 ced4 d920 2824 3024  . ......... ($0$
0007040: 2c20 2431 242c 205c 646f 7473 2920 c920  , $1$, \dots) . 
0007050: d0c5 d2c5 cdc5 cece d9c5 20d3 20c1 ccc6  .......... . ...
0007060: c1d7 c9d4 cecf 2dc3 c9c6 d2cf d7d9 cdc9  ......-.........
0007070: 20c9 cdc5 cec1 cdc9 2c0a c7d2 c1cd cdc1   .......,.......
0007080: d4c9 cbc1 20cd cfd6 c5d4 20d7 d9c7 ccd1  .... ..... .....
0007090: c4c5 d4d8 20d4 c1cb 3a0a 2541 2064 6566  .... ...:.%A def
00070a0: 6563 7420 6f66 206f 7572 2070 7265 7669  ect of our previ
00070b0: 6f75 7320 6578 616d 706c 6520 7761 7320  ous example was 
00070c0: 7468 6174 2074 6865 2069 6e70 7574 2068  that the input h
00070d0: 6164 2074 6f20 6265 2077 7269 7474 656e  ad to be written
00070e0: 0a25 6578 706c 6963 6974 6c79 2069 6e20  .%explicitly in 
00070f0: 7465 726d 7320 6f66 2074 7970 6520 636f  terms of type co
0007100: 6e73 7472 7563 746f 7273 2e20 4865 7265  nstructors. Here
0007110: 2077 6520 7769 6c6c 2073 686f 7720 686f   we will show ho
0007120: 7720 746f 2077 7269 7465 2061 0a25 7061  w to write a.%pa
0007130: 7273 6572 2066 6f72 2074 6869 7320 7369  rser for this si
0007140: 7475 6174 696f 6e2c 2061 6e64 206d 616b  tuation, and mak
0007150: 6520 6f75 7220 636f 6465 2073 7566 6669  e our code suffi
0007160: 6369 656e 746c 7920 6765 6e65 7261 6c20  ciently general 
0007170: 7468 6174 2069 7420 6361 6e0a 2565 6173  that it can.%eas
0007180: 696c 7920 6265 2061 7070 6c69 6564 2074  ily be applied t
0007190: 6f20 7369 6d69 6c61 7220 666f 726d 616c  o similar formal
00071a0: 206c 616e 6775 6167 6573 2e20 4765 6e65   languages. Gene
00071b0: 7261 6c6c 7920 7370 6561 6b69 6e67 2c20  rally speaking, 
00071c0: 7468 6520 7072 6f62 6c65 6d0a 256f 6620  the problem.%of 
00071d0: 7061 7273 696e 6720 6973 2061 7320 666f  parsing is as fo
00071e0: 6c6c 6f77 732e 2041 2066 6f72 6d61 6c20  llows. A formal 
00071f0: 6c61 6e67 7561 6765 2069 7320 6465 6669  language is defi
0007200: 6e65 6420 6279 2061 207b 5c65 6d20 6772  ned by a {\em gr
0007210: 616d 6d61 727d 2c0a 2577 6869 6368 2069  ammar},.%which i
0007220: 7320 6120 7365 7420 6f66 207b 5c65 6d20  s a set of {\em 
0007230: 7072 6f64 7563 7469 6f6e 2072 756c 6573  production rules
0007240: 7d20 666f 7220 6561 6368 2073 796e 7461  } for each synta
0007250: 6374 6963 2063 6174 6567 6f72 792e 2046  ctic category. F
0007260: 6f72 2061 0a25 6c61 6e67 7561 6765 206f  or a.%language o
0007270: 6620 7465 726d 7320 7769 7468 2074 776f  f terms with two
0007280: 2069 6e66 6978 206f 7065 7261 746f 7273   infix operators
0007290: 207b 5c74 7420 2b7d 2061 6e64 207b 5c74   {\tt +} and {\t
00072a0: 7420 2a7d 2061 6e64 206f 6e6c 790a 2561  t *} and only.%a
00072b0: 6c70 6861 6e75 6d65 7269 6320 7661 7269  lphanumeric vari
00072c0: 6162 6c65 7320 616e 6420 6e75 6d65 7261  ables and numera
00072d0: 6c20 2824 3024 2c20 2431 2420 6574 632e  l ($0$, $1$ etc.
00072e0: 2920 636f 6e73 7461 6e74 732c 2069 7420  ) constants, it 
00072f0: 6d69 6768 7420 6c6f 6f6b 0a25 6c69 6b65  might look.%like
0007300: 2074 6869 733a 0a25 0a5c 6265 6769 6e7b   this:.%.\begin{
0007310: 6571 6e61 7272 6179 2a7d 0a74 6572 6d20  eqnarray*}.term 
0007320: 2020 2020 2620 5c67 6f65 7374 6f20 2620      & \goesto & 
0007330: 6e61 6d65 7b5c 7665 7262 2128 217d 2074  name{\verb!(!} t
0007340: 6572 6d6c 6973 7420 7b5c 7665 7262 2129  ermlist {\verb!)
0007350: 217d 2020 2020 2020 2020 205c 5c0a 2020  !}         \\.  
0007360: 2020 2020 2020 2026 207c 2020 2020 2020         & |      
0007370: 2026 206e 616d 6520 2020 2020 2020 2020   & name         
0007380: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007390: 2020 2020 2020 2020 2020 2020 2020 5c5c                \\
00073a0: 0a20 2020 2020 2020 2020 2620 7c20 2020  .         & |   
00073b0: 2020 2020 2620 7b5c 7665 7262 2128 217d      & {\verb!(!}
00073c0: 2074 6572 6d20 7b5c 7665 7262 2129 217d   term {\verb!)!}
00073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00073e0: 205c 5c0a 2020 2020 2020 2020 2026 207c   \\.         & |
00073f0: 2020 2020 2020 2026 206e 756d 6572 616c         & numeral
0007400: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007410: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007420: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
0007430: 2620 7c20 2020 2020 2020 2620 7b5c 7665  & |       & {\ve
0007440: 7262 212d 217d 2074 6572 6d20 2020 2020  rb!-!} term     
0007450: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007460: 2020 2020 2020 205c 5c0a 2020 2020 2020         \\.      
0007470: 2020 2026 207c 2020 2020 2020 2026 2074     & |       & t
0007480: 6572 6d20 7b5c 7665 7262 2120 2b20 217d  erm {\verb! + !}
0007490: 2074 6572 6d20 2020 2020 2020 2020 2020   term           
00074a0: 2020 2020 2020 2020 2020 5c5c 0a20 2020            \\.   
00074b0: 2020 2020 2020 2620 7c20 2020 2020 2020        & |       
00074c0: 2620 7465 726d 207b 5c76 6572 6221 202a  & term {\verb! *
00074d0: 2021 7d20 7465 726d 2020 2020 2020 2020   !} term        
00074e0: 2020 2020 2020 2020 2020 2020 205c 5c0a               \\.
00074f0: 7465 726d 6c69 7374 2026 205c 676f 6573  termlist & \goes
0007500: 746f 2026 2074 6572 6d20 7b5c 7665 7262  to & term {\verb
0007510: 212c 217d 2074 6572 6d6c 6973 7420 2020  !,!} termlist   
0007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007530: 5c5c 0a20 2020 2020 2020 2020 2620 7c20  \\.         & | 
0007540: 2020 2020 2020 2620 7465 726d 0a5c 656e        & term.\en
0007550: 647b 6571 6e61 7272 6179 2a7d 0a25 0aee  d{eqnarray*}.%..
0007560: c120 c4c1 cece d9ca 20cd cfcd c5ce d420  . ...... ...... 
0007570: c2d5 c4c5 cd20 d0d2 c5c4 d0cf ccc1 c7c1  ..... ..........
0007580: d4d8 2c20 ded4 cf20 cec1 cd20 dac1 d2c1  .., ... ... ....
0007590: cec5 c520 c9da d7c5 d3d4 ced9 20cd cecf  ... ........ ...
00075a0: d6c5 d3d4 d7c1 200a c4cf d0d5 d3d4 c9cd  ...... .........
00075b0: d9c8 20c9 cdc5 ce20 c920 dec9 d3cc cfd7  .. .... . ......
00075c0: d9c8 20cb cfce d3d4 c1ce d42c 20ce cf20  .. ........, .. 
00075d0: cdd9 20cd cfc7 ccc9 20c2 d920 d4c1 cbd6  .. ..... .. ....
00075e0: c520 cfd0 d2c5 c4c5 ccc9 d4d8 20c9 c80a  . .......... ...
00075f0: d0d2 c920 d0cf cdcf ddc9 20c1 cec1 cccf  ... ...... .....
0007600: c7c9 dece d9c8 20d0 d2c1 d7c9 cc20 cec1  ...... ...... ..
0007610: 20cf d3ce cfd7 c520 d3c9 cdd7 cfcc cfd7   ...... ........
0007620: 20d7 c8cf c4ce cfc7 cf20 c1cc c6c1 d7c9   ........ ......
0007630: d4c1 2e20 fac1 c4c1 cece cfc5 0acd cecf  ... ............
0007640: d6c5 d3d4 d7cf 20d0 d2cf c4d5 cbc3 c9ca  ...... .........
0007650: 20d0 d2c5 c4cf d3d4 c1d7 ccd1 c5d4 20ce   ............. .
0007660: c1cd 20d3 d0cf d3cf c220 d0cf d2cf d6c4  .. ...... ......
0007670: c5ce c9d1 20cb cfce cbd2 c5d4 cecf c7cf  .... ...........
0007680: 20cc c9ce c5ca cecf c7cf 0ad0 d2c5 c4d3   ...............
0007690: d4c1 d7cc c5ce c9d1 20d7 d3c5 d7cf dacd  ........ .......
00076a0: cfd6 ced9 c820 d4c5 d2cd cfd7 2e20 efd4  ..... ....... ..
00076b0: cdc5 d4c9 cd2c 20de d4cf 20c9 cdc5 cec1  ....., ... .....
00076c0: 20d7 c9c4 c120 246e 616d 6524 2c20 246e   .... $name$, $n
00076d0: 756d 6572 616c 242c 200a 2474 6572 6d24  umeral$, .$term$
00076e0: 20c9 7e24 7465 726d 6c69 7374 2420 cfc2   .~$termlist$ ..
00076f0: cfda cec1 dec1 c0d4 20d3 c9ce d4c1 cbd3  ........ .......
0007700: c9de c5d3 cbc9 c520 7b5c 656d 20cd c5d4  ....... {\em ...
0007710: c1d0 c5d2 c5cd c5ce ced9 c57d 2c0a c120  ...........},.. 
0007720: cec1 c2d2 c1ce ced9 c520 d0cf ccd5 d6c9  ......... ......
0007730: d2ce d9cd 20db d2c9 c6d4 cfcd 20d3 c9cd  .... ....... ...
0007740: d7cf ccd9 203c 3c7b 5c76 6572 6221 2b21  .... <<{\verb!+!
0007750: 7d3e 3e2c 203c 3c7b 5c76 6572 6221 2821  }>>, <<{\verb!(!
0007760: 7d3e 3e20 c920 d4c1 cb20 0ac4 c1cc c5c5  }>> . ... ......
0007770: 7e2d 2d2d 20d0 d2c9 cec1 c4cc c5d6 c1d4  ~--- ...........
0007780: 20d7 c8cf c4ce cfcd d520 d1da d9cb d52e   ........ ......
0007790: 20f2 c1d3 d3cd cfd4 d2c9 cd20 d0d2 c9cd   .......... ....
00077a0: c5d2 20d0 d2c9 cdc5 cec5 cec9 d120 d0d2  .. .......... ..
00077b0: c1d7 c9cc 200a d7d9 d7cf c4c1 3a0a 250a  .... .......:.%.
00077c0: 2557 6520 7769 6c6c 2061 7373 756d 6520  %We will assume 
00077d0: 666f 7220 7468 6520 6d6f 6d65 6e74 2074  for the moment t
00077e0: 6861 7420 7765 206b 6e6f 7720 7768 6174  hat we know what
00077f0: 206e 616d 6573 2061 6e64 206e 756d 6572   names and numer
0007800: 616c 7320 6172 652c 2062 7574 2077 650a  als are, but we.
0007810: 2563 6f75 6c64 2068 6176 6520 7369 6d69  %could have simi
0007820: 6c61 7220 7275 6c65 7320 6465 6669 6e69  lar rules defini
0007830: 6e67 2074 6865 6d20 696e 2074 6572 6d73  ng them in terms
0007840: 206f 6620 7369 6e67 6c65 2063 6861 7261   of single chara
0007850: 6374 6572 732e 204e 6f77 2074 6869 730a  cters. Now this.
0007860: 2573 6574 206f 6620 7072 6f64 7563 7469  %set of producti
0007870: 6f6e 2072 756c 6573 2067 6976 6573 2075  on rules gives u
0007880: 7320 6120 7761 7920 6f66 2067 656e 6572  s a way of gener
0007890: 6174 696e 6720 7468 6520 636f 6e63 7265  ating the concre
00078a0: 7465 2c20 6c69 6e65 6172 0a25 7265 7072  te, linear.%repr
00078b0: 6573 656e 7461 7469 6f6e 2066 6f72 2061  esentation for a
00078c0: 6c6c 2074 6572 6d73 2e20 4e6f 7465 2074  ll terms. Note t
00078d0: 6861 7420 246e 616d 6524 2c20 246e 756d  hat $name$, $num
00078e0: 6572 616c 242c 2024 7465 726d 2420 616e  eral$, $term$ an
00078f0: 640a 2524 7465 726d 6c69 7374 2420 6172  d.%$termlist$ ar
0007900: 6520 6d65 616e 7420 746f 2062 6520 7661  e meant to be va
0007910: 7269 6162 6c65 7320 696e 2074 6865 2061  riables in the a
0007920: 626f 7665 2c20 7768 6572 6561 7320 656c  bove, whereas el
0007930: 656d 656e 7473 206c 696b 650a 2560 7b5c  ements like.%`{\
0007940: 7665 7262 212b 217d 2720 616e 6420 607b  verb!+!}' and `{
0007950: 5c76 6572 6221 2821 7d27 2077 7269 7474  \verb!(!}' writt
0007960: 656e 2069 6e20 626f 6c64 2074 7970 6520  en in bold type 
0007970: 6172 6520 6163 7475 616c 2063 6861 7261  are actual chara
0007980: 6374 6572 732e 2046 6f72 0a25 6578 616d  cters. For.%exam
0007990: 706c 6520 7765 2068 6176 653a 0a25 0a5c  ple we have:.%.\
00079a0: 6265 6769 6e7b 6571 6e61 7272 6179 2a7d  begin{eqnarray*}
00079b0: 0a74 6572 6d20 2020 2020 2620 5c67 6f65  .term     & \goe
00079c0: 7374 6f20 2620 7465 726d 207b 5c76 6572  sto & term {\ver
00079d0: 6221 202a 2021 7d20 7465 726d 2020 2020  b! * !} term    
00079e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00079f0: 2020 2020 2020 2020 205c 5c0a 2020 2020           \\.    
0007a00: 2020 2020 2026 205c 676f 6573 746f 2026       & \goesto &
0007a10: 2074 6572 6d20 7b5c 7665 7262 2120 2a20   term {\verb! * 
0007a20: 217d 207b 5c76 6572 6221 2821 7d20 7465  !} {\verb!(!} te
0007a30: 726d 207b 5c76 6572 6221 2921 7d20 2020  rm {\verb!)!}   
0007a40: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
0007a50: 2620 5c67 6f65 7374 6f20 2620 7465 726d  & \goesto & term
0007a60: 207b 5c76 6572 6221 202a 2021 7d20 7b5c   {\verb! * !} {\
0007a70: 7665 7262 2128 217d 0a20 2020 2020 2020  verb!(!}.       
0007a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
0007a90: 2020 2020 2020 2020 2074 6572 6d20 7b5c           term {\
0007aa0: 7665 7262 2120 2b20 217d 2074 6572 6d20  verb! + !} term 
0007ab0: 7b5c 7665 7262 2129 217d 2020 2020 2020  {\verb!)!}      
0007ac0: 205c 5c0a 2020 2020 2020 2020 2026 205c   \\.         & \
0007ad0: 676f 6573 746f 2026 2074 6572 6d20 7b5c  goesto & term {\
0007ae0: 7665 7262 2120 2a20 217d 207b 5c76 6572  verb! * !} {\ver
0007af0: 6221 2821 7d0a 2020 2020 2020 2020 2020  b!(!}.          
0007b00: 2020 2020 2020 2020 2020 2074 6572 6d20             term 
0007b10: 7b5c 7665 7262 2120 2b20 217d 2074 6572  {\verb! + !} ter
0007b20: 6d20 7b5c 7665 7262 2120 2a20 217d 2074  m {\verb! * !} t
0007b30: 6572 6d20 7b5c 7665 7262 2129 217d 5c5c  erm {\verb!)!}\\
0007b40: 0a20 2020 2020 2020 2020 2620 5c67 6f65  .         & \goe
0007b50: 7374 6f20 2620 6e75 6d65 7261 6c20 7b5c  sto & numeral {\
0007b60: 7665 7262 2120 2a20 217d 207b 5c76 6572  verb! * !} {\ver
0007b70: 6221 2821 7d0a 2020 2020 2020 2020 2020  b!(!}.          
0007b80: 2020 2020 2020 2020 2020 206e 616d 6520             name 
0007b90: 7b5c 7665 7262 2120 2b20 217d 206e 616d  {\verb! + !} nam
0007ba0: 6520 7b5c 7665 7262 2120 2a20 217d 206e  e {\verb! * !} n
0007bb0: 616d 6520 7b5c 7665 7262 2129 217d 0a5c  ame {\verb!)!}.\
0007bc0: 656e 647b 6571 6e61 7272 6179 2a7d 0a25  end{eqnarray*}.%
0007bd0: 0acf d4cb d5c4 c12c 20d0 cfc4 d3d4 c1d7  ......., .......
0007be0: c9d7 20d7 cdc5 d3d4 cf20 246e 616d 6524  .. ...... $name$
0007bf0: 20c9 7e24 6e75 6d65 7261 6c24 20ce c5cb   .~$numeral$ ...
0007c00: cfd4 cfd2 d9c5 20da cec1 dec5 cec9 d120  ...... ........ 
0007c10: c9da 200a d3cf cfd4 d7c5 d4d3 d4d7 d5c0  .. .............
0007c20: ddc9 c820 cdce cfd6 c5d3 d4d7 2c20 cdd9  ... ........, ..
0007c30: 20cd cfd6 c5cd 20d0 cfd2 cfc4 c9d4 d820   ..... ........ 
0007c40: d4c1 cbd5 c020 d3d4 d2cf cbd5 3a0a 255c  ..... ......:.%\
0007c50: 6e6f 696e 6465 6e74 2073 6f2c 2066 6f6c  noindent so, fol
0007c60: 6c6f 7769 6e67 2073 696d 696c 6172 2072  lowing similar r
0007c70: 756c 6573 2066 6f72 2024 6e61 6d65 2420  ules for $name$ 
0007c80: 616e 6420 246e 756d 6572 616c 242c 2077  and $numeral$, w
0007c90: 6520 6361 6e0a 2567 656e 6572 6174 6520  e can.%generate 
0007ca0: 666f 7220 6578 616d 706c 653a 0a25 0a24  for example:.%.$
0007cb0: 2420 0a20 7b5c 7665 7262 2131 3020 2a20  $ . {\verb!10 * 
0007cc0: 2878 202b 2079 202a 207a 2921 7d20 0a24  (x + y * z)!} .$
0007cd0: 240a 0afa c1c4 c1de c120 7b5c 656d 20d3  $........ {\em .
0007ce0: c9ce d4c1 cbd3 c9de c5d3 cbcf c7cf 20c1  .............. .
0007cf0: cec1 ccc9 dac1 2028 d2c1 dac2 cfd2 c129  ...... (.......)
0007d00: 7d20 d0d2 c5d3 ccc5 c4d5 c5d4 20d0 d2d1  } .......... ...
0007d10: cdcf 20d0 d2cf d4c9 d7cf d0cf cccf d6ce  .. .............
0007d20: d5c0 0ac3 c5cc d87e 2d2d 2d20 d7cf d3d3  .......~--- ....
0007d30: d4c1 cecf d7c9 d4d8 20d0 cfd3 ccc5 c4cf  ........ .......
0007d40: d7c1 d4c5 ccd8 cecf d3d4 d820 d0d2 c9cd  ........... ....
0007d50: c5ce c5ce c9d1 20d0 d2c1 d7c9 cc20 d7d9  ...... ...... ..
0007d60: d7cf c4c1 2c20 d4cf 20c5 d3d4 d820 d0cf  ...., .. .... ..
0007d70: 200a dac1 c4c1 cece cfca 20d3 d4d2 cfcb   ......... .....
0007d80: c520 cfd0 d2c5 c4c5 ccc9 d4d8 2c20 cbc1  . .........., ..
0007d90: cbc9 cd20 cfc2 d2c1 dacf cd20 cfce c120  ... ....... ... 
0007da0: cdcf c7cc c120 c2d9 d4d8 20d0 cfd2 cfd6  ..... .... .....
0007db0: c4c5 cec1 2e20 0aeb c1cb 20d0 d2c1 d7c9  ..... .... .....
0007dc0: cccf 2c20 d2c5 dad5 ccd8 d4c1 d4cf cd20  .., ........... 
0007dd0: c1ce c1cc c9da c120 d1d7 ccd1 c5d4 d3d1  ....... ........
0007de0: 207b 5c65 6d20 c4c5 d2c5 d7cf 20d2 c1da   {\em ...... ...
0007df0: c2cf d2c1 2c7d 20ce c1c7 ccd1 c4ce cf0a  ....,} .........
0007e00: c4c5 cdcf ced3 d4d2 c9d2 d5c0 ddc5 c520  ............... 
0007e10: d0cf d2d1 c4cf cb20 d7d9 c2cf d2c1 20d0  ....... ...... .
0007e20: d2cf c4d5 cbc3 c9ca 2e20 0a25 5468 6520  ......... .%The 
0007e30: 7461 736b 206f 6620 7b5c 656d 2070 6172  task of {\em par
0007e40: 7369 6e67 7d20 6973 2074 6f20 7265 7665  sing} is to reve
0007e50: 7273 6520 7468 6973 2070 726f 6365 7373  rse this process
0007e60: 206f 6620 6170 706c 7969 6e67 2070 726f   of applying pro
0007e70: 6475 6374 696f 6e0a 2572 756c 6573 2c20  duction.%rules, 
0007e80: 692e 652e 2074 6f20 7461 6b65 2061 2073  i.e. to take a s
0007e90: 7472 696e 6720 616e 6420 6469 7363 6f76  tring and discov
0007ea0: 6572 2068 6f77 2069 7420 636f 756c 6420  er how it could 
0007eb0: 6861 7665 2062 6565 6e20 6765 6e65 7261  have been genera
0007ec0: 7465 6420 6279 0a25 7468 6520 7072 6f64  ted by.%the prod
0007ed0: 7563 7469 6f6e 2072 756c 6573 2066 6f72  uction rules for
0007ee0: 2061 2073 796e 7461 6374 6963 2063 6174   a syntactic cat
0007ef0: 6567 6f72 792e 2054 7970 6963 616c 6c79  egory. Typically
0007f00: 2c20 7468 6520 6f75 7470 7574 2069 7320  , the output is 
0007f10: 6120 7b5c 656d 0a25 7061 7273 6520 7472  a {\em.%parse tr
0007f20: 6565 7d2c 2069 2e65 2e20 6120 7472 6565  ee}, i.e. a tree
0007f30: 2073 7472 7563 7475 7265 2074 6861 7420   structure that 
0007f40: 7368 6f77 7320 636c 6561 726c 7920 7468  shows clearly th
0007f50: 6520 7365 7175 656e 6365 206f 660a 2561  e sequence of.%a
0007f60: 7070 6c69 6361 7469 6f6e 7320 6f66 2074  pplications of t
0007f70: 6865 2072 756c 6573 2e0a 0aef c4ce cfca  he rules........
0007f80: 20c9 da20 d0d2 cfc2 ccc5 cd2c 20d7 cfda   .. ......., ...
0007f90: cec9 cbc1 c0dd c5ca 20d7 20c8 cfc4 c520  ........ . .... 
0007fa0: d3c9 ced4 c1cb d3c9 dec5 d3cb cfc7 cf20  ............... 
0007fb0: c1ce c1cc c9da c12c 20d1 d7cc d1c5 d4d3  ......., .......
0007fc0: d10a 7b5c 656d 20ce c5cf c4ce cfda cec1  ..{\em .........
0007fd0: dece cfd3 d4d8 7d20 c7d2 c1cd cdc1 d4c9  ......} ........
0007fe0: cbc9 2c20 d42e 7ec5 2e5c 20d7 cfda cdcf  .., ..~..\ .....
0007ff0: d6ce cfd3 d4d8 20d0 cfd2 cfd6 c4c5 cec9  ...... .........
0008000: d120 dac1 c4c1 cece cfca 20d3 d4d2 cfcb  . ........ .....
0008010: c90a cec5 d3cb cfcc d8cb c9cd c920 d2c1  ............. ..
0008020: dacc c9de ced9 cdc9 20d3 d0cf d3cf c2c1  ........ .......
0008030: cdc9 2e20 f720 d2c1 d3d3 cdcf d4d2 c5ce  ... . ..........
0008040: cecf cd20 d7d9 dbc5 20d0 d2c9 cdc5 d2c5  ... .... .......
0008050: 20d4 c120 d6c5 20d3 c1cd c1d1 200a d3d4   .. .. ..... ...
0008060: d2cf cbc1 20cd cfc7 ccc1 20c2 d9d4 d820  .... ..... .... 
0008070: d0cf d2cf d6c4 c5ce c120 c9ce d9cd 20d0  ......... .... .
0008080: d5d4 a3cd 3a0a 254f 6e65 2070 726f 626c  ....:.%One probl
0008090: 656d 2077 6974 6820 7061 7273 696e 6720  em with parsing 
00080a0: 6973 2074 6861 7420 7468 6520 6772 616d  is that the gram
00080b0: 6d61 7220 6d61 7920 6265 207b 5c65 6d20  mar may be {\em 
00080c0: 616d 6269 6775 6f75 737d 2c20 692e 652e  ambiguous}, i.e.
00080d0: 2061 0a25 6769 7665 6e20 7374 7269 6e67   a.%given string
00080e0: 2063 616e 206f 6674 656e 2062 6520 6765   can often be ge
00080f0: 6e65 7261 7465 6420 696e 2073 6576 6572  nerated in sever
0008100: 616c 2064 6966 6665 7265 6e74 2077 6179  al different way
0008110: 732e 2054 6869 7320 6973 2074 6865 2063  s. This is the c
0008120: 6173 650a 2569 6e20 6f75 7220 6578 616d  ase.%in our exam
0008130: 706c 6520 6162 6f76 652c 2066 6f72 2074  ple above, for t
0008140: 6865 2073 7472 696e 6720 636f 756c 6420  he string could 
0008150: 616c 736f 2068 6176 6520 6265 656e 2067  also have been g
0008160: 656e 6572 6174 6564 2062 793a 0a25 0a5c  enerated by:.%.\
0008170: 6265 6769 6e7b 6571 6e61 7272 6179 2a7d  begin{eqnarray*}
0008180: 0a74 6572 6d20 2020 2020 2620 5c67 6f65  .term     & \goe
0008190: 7374 6f20 2620 7465 726d 207b 5c76 6572  sto & term {\ver
00081a0: 6221 202a 2021 7d20 7465 726d 2020 2020  b! * !} term    
00081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00081c0: 2020 2020 2020 2020 205c 5c0a 2020 2020           \\.    
00081d0: 2020 2020 2026 205c 676f 6573 746f 2026       & \goesto &
00081e0: 2074 6572 6d20 7b5c 7665 7262 2120 2a20   term {\verb! * 
00081f0: 217d 207b 5c76 6572 6221 2821 7d20 7465  !} {\verb!(!} te
0008200: 726d 207b 5c76 6572 6221 2921 7d20 2020  rm {\verb!)!}   
0008210: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
0008220: 2620 5c67 6f65 7374 6f20 2620 7465 726d  & \goesto & term
0008230: 207b 5c76 6572 6221 202a 2021 7d20 7b5c   {\verb! * !} {\
0008240: 7665 7262 2128 217d 2074 6572 6d20 7b5c  verb!(!} term {\
0008250: 7665 7262 2120 2a20 217d 0a20 2020 2020  verb! * !}.     
0008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008270: 7465 726d 207b 5c76 6572 6221 2921 7d20  term {\verb!)!} 
0008280: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
00082a0: 2020 205c 5c0a 2020 2020 2020 2020 2026     \\.         &
00082b0: 205c 676f 6573 746f 2026 2074 6572 6d20   \goesto & term 
00082c0: 7b5c 7665 7262 2120 2a20 217d 207b 5c76  {\verb! * !} {\v
00082d0: 6572 6221 2821 7d0a 2020 2020 2020 2020  erb!(!}.        
00082e0: 2020 2020 2020 2020 2020 2020 2074 6572               ter
00082f0: 6d20 7b5c 7665 7262 2120 2b20 217d 2074  m {\verb! + !} t
0008300: 6572 6d20 7b5c 7665 7262 2120 2a20 217d  erm {\verb! * !}
0008310: 2074 6572 6d20 7b5c 7665 7262 2129 217d   term {\verb!)!}
0008320: 5c5c 0a20 2020 2020 2020 2020 2620 5c67  \\.         & \g
0008330: 6f65 7374 6f20 2620 6e75 6d65 7261 6c20  oesto & numeral 
0008340: 7b5c 7665 7262 2120 2a20 217d 207b 5c76  {\verb! * !} {\v
0008350: 6572 6221 2821 7d0a 2020 2020 2020 2020  erb!(!}.        
0008360: 2020 2020 2020 2020 2020 2020 206e 616d               nam
0008370: 6520 7b5c 7665 7262 2120 2b20 217d 206e  e {\verb! + !} n
0008380: 616d 6520 7b5c 7665 7262 2120 2a20 217d  ame {\verb! * !}
0008390: 206e 616d 6520 7b5c 7665 7262 2129 217d   name {\verb!)!}
00083a0: 0a5c 656e 647b 6571 6e61 7272 6179 2a7d  .\end{eqnarray*}
00083b0: 0a0a efde c5d7 c9c4 cec1 d120 d7cf dacd  ........... ....
00083c0: cfd6 cecf d3d4 d820 d5d3 d4d2 c1ce c5ce  ....... ........
00083d0: c9d1 20ce c5cf c4ce cfda cec1 dece cfd3  .. .............
00083e0: d4c9 7e2d 2d2d 20ce c1da cec1 dec5 cec9  ..~--- .........
00083f0: c520 c9ce c6c9 cbd3 ced9 cd0a cfd0 c5d2  . ..............
0008400: c1d4 cfd2 c1cd 20d0 d2c9 cfd2 c9d4 c5d4  ...... .........
0008410: cfd7 20c9 20c1 d3d3 cfc3 c9c1 d4c9 d7ce  .. . ...........
0008420: cfd3 d4c9 2e20 ebd2 cfcd c520 d4cf c7cf  ..... ..... ....
0008430: 2c20 cdd9 20cd cfd6 c5cd 20c4 cfc2 c9d4  , .. ..... .....
0008440: d8d3 d120 d4c1 cbcf c7cf 0ad6 c520 dcc6  ... ......... ..
0008450: c6c5 cbd4 c120 c2c5 da20 d0d2 c9d7 ccc5  ..... ... ......
0008460: dec5 cec9 d120 c4cf d0cf ccce c9d4 c5cc  ..... ..........
0008470: d8ce d9c8 20cd c5c8 c1ce c9da cdcf d720  .... .......... 
0008480: dac1 20d3 dea3 d420 c4cf c2c1 d7cc c5ce  .. .... ........
0008490: c9d1 200a cecf d7d9 c820 d3c9 ced4 c1cb  .. ...... ......
00084a0: d3c9 dec5 d3cb c9c8 20cb c1d4 c5c7 cfd2  ........ .......
00084b0: c9ca 3a0a 2554 6865 206f 6276 696f 7573  ..:.%The obvious
00084c0: 2077 6179 2074 6f20 6669 7820 7468 6973   way to fix this
00084d0: 2069 7320 746f 2073 7065 6369 6679 2072   is to specify r
00084e0: 756c 6573 206f 6620 7072 6563 6564 656e  ules of preceden
00084f0: 6365 2061 6e64 2061 7373 6f63 6961 7469  ce and associati
0008500: 7669 7479 0a25 666f 7220 696e 6669 7820  vity.%for infix 
0008510: 6f70 6572 6174 6f72 732e 2048 6f77 6576  operators. Howev
0008520: 6572 2c20 7765 2063 616e 206d 616b 6520  er, we can make 
0008530: 7468 6520 6772 616d 6d61 7220 756e 616d  the grammar unam
0008540: 6269 6775 6f75 7320 7769 7468 6f75 740a  biguous without.
0008550: 2569 6e74 726f 6475 6369 6e67 2061 6464  %introducing add
0008560: 6974 696f 6e61 6c20 6d65 6368 616e 6973  itional mechanis
0008570: 6d73 2061 7420 7468 6520 636f 7374 206f  ms at the cost o
0008580: 6620 6164 6469 6e67 206e 6577 2073 796e  f adding new syn
0008590: 7461 6374 6963 0a25 6361 7465 676f 7269  tactic.%categori
00085a0: 6573 3a0a 250a 5c62 6567 696e 7b65 716e  es:.%.\begin{eqn
00085b0: 6172 7261 792a 7d0a 6174 6f6d 2020 2020  array*}.atom    
00085c0: 2026 205c 676f 6573 746f 2026 206e 616d   & \goesto & nam
00085d0: 657b 5c76 6572 6221 2821 7d20 7465 726d  e{\verb!(!} term
00085e0: 6c69 7374 207b 5c76 6572 6221 2921 7d20  list {\verb!)!} 
00085f0: 2020 2020 2020 2020 5c5c 0a20 2020 2020          \\.     
0008600: 2020 2020 2620 7c20 2020 2020 2020 2620      & |       & 
0008610: 6e61 6d65 2020 2020 2020 2020 2020 2020  name            
0008620: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008630: 2020 2020 2020 2020 2020 205c 5c0a 2020             \\.  
0008640: 2020 2020 2020 2026 207c 2020 2020 2020         & |      
0008650: 2026 206e 756d 6572 616c 2020 2020 2020   & numeral      
0008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008670: 2020 2020 2020 2020 2020 2020 2020 5c5c                \\
0008680: 0a20 2020 2020 2020 2020 2620 7c20 2020  .         & |   
0008690: 2020 2020 2620 7b5c 7665 7262 2128 217d      & {\verb!(!}
00086a0: 2074 6572 6d20 7b5c 7665 7262 2129 217d   term {\verb!)!}
00086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00086c0: 205c 5c0a 2020 2020 2020 2020 2026 207c   \\.         & |
00086d0: 2020 2020 2020 2026 207b 5c76 6572 6221         & {\verb!
00086e0: 2d21 7d20 6174 6f6d 2020 2020 2020 2020  -!} atom        
00086f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008700: 2020 2020 5c5c 0a6d 756c 6578 7020 2020      \\.mulexp   
0008710: 2620 5c67 6f65 7374 6f20 2620 6174 6f6d  & \goesto & atom
0008720: 207b 5c76 6572 6221 202a 2021 7d20 6d75   {\verb! * !} mu
0008730: 6c65 7870 2020 2020 2020 2020 2020 2020  lexp            
0008740: 2020 2020 2020 205c 5c0a 2020 2020 2020         \\.      
0008750: 2020 2026 207c 2020 2020 2020 2026 2061     & |       & a
0008760: 746f 6d20 2020 2020 2020 2020 2020 2020  tom             
0008770: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008780: 2020 2020 2020 2020 2020 5c5c 0a74 6572            \\.ter
0008790: 6d20 2020 2020 2620 5c67 6f65 7374 6f20  m     & \goesto 
00087a0: 2620 6d75 6c65 7870 207b 5c76 6572 6221  & mulexp {\verb!
00087b0: 202b 2021 7d20 7465 726d 2020 2020 2020   + !} term      
00087c0: 2020 2020 2020 2020 2020 2020 205c 5c0a               \\.
00087d0: 2020 2020 2020 2020 2026 207c 2020 2020           & |    
00087e0: 2020 2026 206d 756c 6578 7020 2020 2020     & mulexp     
00087f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
0008810: 5c5c 0a74 6572 6d6c 6973 7420 2620 5c67  \\.termlist & \g
0008820: 6f65 7374 6f20 2620 7465 726d 207b 5c76  oesto & term {\v
0008830: 6572 6221 2c20 217d 2074 6572 6d6c 6973  erb!, !} termlis
0008840: 7420 2020 2020 2020 2020 2020 2020 2020  t               
0008850: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
0008860: 2620 7c20 2020 2020 2020 2620 7465 726d  & |       & term
0008870: 0a5c 656e 647b 6571 6e61 7272 6179 2a7d  .\end{eqnarray*}
0008880: 0a0a efd4 cdc5 d4c9 cd2c 20de d4cf 20d4  ........., ... .
0008890: c1cb c1d1 20cd cfc4 c9c6 c9cb c1c3 c9d1  .... ...........
00088a0: 20c7 d2c1 cdcd c1d4 c9cb c920 c4c5 ccc1   .......... ....
00088b0: c5d4 20cf c2c5 20c9 cec6 c9cb d3ce d9c5  .. ... .........
00088c0: 20cf d0c5 d2c1 c3c9 c920 0ad0 d2c1 d7cf   ........ ......
00088d0: c1d3 d3cf c3c9 c1d4 c9d7 ced9 cdc9 2e20  ............... 
00088e0: e2cf ccc5 c520 d3cc cfd6 ced9 cd20 d0d2  ..... ....... ..
00088f0: c9cd c5d2 cfcd 20c9 d3d0 cfcc d8da cfd7  ...... .........
0008900: c1ce c9d1 20dc d4cf c7cf 20d0 d2c9 a3cd  .... ..... .....
0008910: c120 d3cc d5d6 c9d4 0ac6 cfd2 cdc1 ccd8  . ..............
0008920: cecf c520 cfd0 d2c5 c4c5 ccc5 cec9 c520  ... ........... 
0008930: d0cf ced1 d4c9 d120 3c3c d7d9 d2c1 d6c5  ....... <<......
0008940: cec9 c53e 3e20 d720 d3d4 c1ce c4c1 d2d4  ...>> . ........
0008950: c57e 414e 5349 7e43 2e0a 254e 6f74 6520  .~ANSI~C..%Note 
0008960: 7468 6174 2074 6869 7320 6d61 6b65 7320  that this makes 
0008970: 626f 7468 2069 6e66 6978 206f 7065 7261  both infix opera
0008980: 746f 7273 2072 6967 6874 2061 7373 6f63  tors right assoc
0008990: 6961 7469 7665 2e20 466f 7220 6120 6d6f  iative. For a mo
00089a0: 7265 0a25 636f 6d70 6c69 6361 7465 6420  re.%complicated 
00089b0: 6578 616d 706c 6520 6f66 2074 6869 7320  example of this 
00089c0: 7465 6368 6e69 7175 6520 696e 2061 6374  technique in act
00089d0: 696f 6e2c 206c 6f6f 6b20 6174 2074 6865  ion, look at the
00089e0: 2066 6f72 6d61 6c20 6465 6669 6e69 7469   formal definiti
00089f0: 6f6e 0a25 6f66 2065 7870 7265 7373 696f  on.%of expressio
0008a00: 6e73 2069 6e20 7468 6520 414e 5349 2043  ns in the ANSI C
0008a10: 2053 7461 6e64 6172 642e 0a0a 5c73 7562   Standard...\sub
0008a20: 7365 6374 696f 6e7b edc5 d4cf c420 d2c5  section{..... ..
0008a30: cbd5 d2d3 c9d7 cecf c7cf 20d3 d0d5 d3cb  .......... .....
0008a40: c17d 0a25 5c73 7562 7365 6374 696f 6e7b  .}.%\subsection{
0008a50: 5265 6375 7273 6976 6520 6465 7363 656e  Recursive descen
0008a60: 7420 7061 7273 696e 677d 0af3 d4d2 cfc5  t parsing}......
0008a70: cec9 c520 d0d2 c1d7 c9cc 20d7 d9d7 cfc4  ... ...... .....
0008a80: c120 d0cf c4d3 cbc1 dad9 d7c1 c5d4 20cf  . ............ .
0008a90: dec5 ced8 20d0 d2cf d3d4 cfca 20c1 ccc7  .... ....... ...
0008aa0: cfd2 c9d4 cd20 d3c9 ced4 c1cb d3c9 dec5  ..... ..........
0008ab0: d3cb cfc7 cf0a c1ce c1cc c9da c120 d0d2  ............. ..
0008ac0: c920 d0cf cdcf ddc9 20cd cecf d6c5 d3d4  . ...... .......
0008ad0: d7c1 20d7 dac1 c9cd cecf 20d2 c5cb d5d2  .. ....... .....
0008ae0: d3c9 d7ce d9c8 20c6 d5ce cbc3 c9ca 2e20  ...... ........ 
0008af0: e5c7 cf20 d3d5 d4d8 20d7 20d4 cfcd 2c20  ... .... . ..., 
0008b00: ded4 cf0a c4cc d120 cbc1 d6c4 cfca 20d3  ....... ...... .
0008b10: c9ce d4c1 cbd3 c9de c5d3 cbcf ca20 cbc1  ............. ..
0008b20: d4c5 c7cf d2c9 c920 d7d7 cfc4 c9d4 d3d1  ....... ........
0008b30: 20d3 d7cf d120 c6d5 cecb c3c9 d12c 20d0   .... ......., .
0008b40: d2c9 dec5 cd20 d3d4 d2d5 cbd4 d5d2 c120  ..... ......... 
0008b50: 0ad2 c5cb d5d2 d3c9 d7ce d9c8 20d7 d9da  ............ ...
0008b60: cfd7 cfd7 20d3 cfcf d4d7 c5d4 d3d4 d7d5  .... ...........
0008b70: c5d4 20da c1d7 c9d3 c9cd cfd3 d4c9 20cf  .. ........... .
0008b80: c4ce c9c8 20d0 d2cf c4d5 cbc3 c9ca 20cf  .... ......... .
0008b90: d420 c4d2 d5c7 c9c8 2e20 0aee c1d0 d2c9  . ....... ......
0008ba0: cdc5 d22c 20d0 d2cf c3c5 c4d5 d2c1 20c1  ..., ......... .
0008bb0: cec1 ccc9 dac1 20d4 c5d2 cdcf d77e 7b5c  ...... ......~{\
0008bc0: 7665 7262 2174 6572 6d21 7d20 d0d2 c920  verb!term!} ... 
0008bd0: d0cf ccd5 dec5 cec9 c920 c9da 20d7 c8cf  ......... .. ...
0008be0: c4ce cfc7 cf0a d0cf d4cf cbc1 20d3 c9cd  ............ ...
0008bf0: d7cf ccc1 7e7b 5c76 6572 6221 2d21 7d20  ....~{\verb!-!} 
0008c00: c2d5 c4c5 d420 d2c5 cbd5 d2d3 c9d7 cecf  ..... ..........
0008c10: 20d7 d9da d9d7 c1d4 d820 d3c1 cdd5 20d3   ........ .... .
0008c20: c5c2 d120 c4cc d120 c1ce c1cc c9da c10a  ... ... ........
0008c30: c1d2 c7d5 cdc5 ced4 c120 cfd0 c5d2 c1c3  ......... ......
0008c40: c9c9 2c20 c120 d0d2 c920 d7d3 d4d2 c5de  .., . ... ......
0008c50: c520 c9cd c5ce c92c 20da c120 cbcf d4cf  . ....., .. ....
0008c60: d2d9 cd20 d3cc c5c4 d5c5 d420 cfd4 cbd2  ... ....... ....
0008c70: d9d7 c1c0 ddc1 d120 d3cb cfc2 cbc1 2c0a  ....... ......,.
0008c80: cfc2 d2c1 d4c9 d4d3 d120 cb20 d0d2 cfc3  ......... . ....
0008c90: c5c4 d5d2 c57e 7b5c 7665 7262 2174 6572  .....~{\verb!ter
0008ca0: 6d6c 6973 7421 7d2e 20f0 cfd3 ccc5 c4ce  mlist!}. .......
0008cb0: d1d1 2c20 d720 d3d7 cfc0 20cf dec5 d2c5  .., . .... .....
0008cc0: c4d8 2c20 0ad7 d9da cfd7 c5d4 7e7b 5c76  .., ........~{\v
0008cd0: 6572 6221 7465 726d 217d 20ce c520 cdc5  erb!term!} .. ..
0008ce0: cec5 c520 cfc4 cecf c7cf 20d2 c1da c12c  ... ...... ....,
0008cf0: 20c9 20d4 c1cb 20c4 c1cc c5c5 2e20 f4c1   . ... ...... ..
0008d00: cbcf ca20 d0cf c4c8 cfc4 200a c5d3 d4c5  ... ...... .....
0008d10: d3d4 d7c5 cece cf20 d7d9 d2c1 d6c1 c5d4  ....... ........
0008d20: d3d1 20ce c120 d1da d9cb c52c 20d0 cfc4  .. .. ....., ...
0008d30: cfc2 cecf cd7e 4d4c 2c20 c4cc d120 cbcf  .....~ML, ... ..
0008d40: d4cf d2cf c7cf 20d2 c5cb d5d2 d3c9 d120  ...... ........ 
0008d50: d3cc d5d6 c9d4 0acf c4ce cfca 20c9 da20  ............ .. 
0008d60: cfd3 cecf d7ce d9c8 20d5 d0d2 c1d7 ccd1  ........ .......
0008d70: c0dd c9c8 20cb cfce d3d4 d2d5 cbc3 c9ca  .... ...........
0008d80: 2e0a 2554 6865 2070 726f 6475 6374 696f  ..%The productio
0008d90: 6e20 7275 6c65 7320 7375 6767 6573 7420  n rules suggest 
0008da0: 6120 7665 7279 2073 696d 706c 6520 7761  a very simple wa
0008db0: 7920 6f66 2067 6f69 6e67 2061 626f 7574  y of going about
0008dc0: 2070 6172 7369 6e67 2075 7369 6e67 2061   parsing using a
0008dd0: 0a25 7365 7269 6573 206f 6620 6d75 7475  .%series of mutu
0008de0: 616c 6c79 2072 6563 7572 7369 7665 2066  ally recursive f
0008df0: 756e 6374 696f 6e73 2e20 5468 6520 6964  unctions. The id
0008e00: 6561 2069 7320 746f 2068 6176 6520 6120  ea is to have a 
0008e10: 6675 6e63 7469 6f6e 2066 6f72 2065 6163  function for eac
0008e20: 680a 2573 796e 7461 6374 6963 2063 6174  h.%syntactic cat
0008e30: 6567 6f72 792c 2061 6e64 2061 2072 6563  egory, and a rec
0008e40: 7572 7369 7665 2073 7472 7563 7475 7265  ursive structure
0008e50: 2074 6861 7420 7265 666c 6563 7473 2065   that reflects e
0008e60: 7861 6374 6c79 2074 6865 206d 7574 7561  xactly the mutua
0008e70: 6c0a 2572 6563 7572 7369 6f6e 2066 6f75  l.%recursion fou
0008e80: 6e64 2069 6e20 7468 6520 6772 616d 6d61  nd in the gramma
0008e90: 7220 6974 7365 6c66 2e20 466f 7220 6578  r itself. For ex
0008ea0: 616d 706c 652c 2074 6865 2070 726f 6365  ample, the proce
0008eb0: 6475 7265 2066 6f72 2070 6172 7369 6e67  dure for parsing
0008ec0: 0a25 7465 726d 732c 2073 6179 207b 5c76  .%terms, say {\v
0008ed0: 6572 6221 7465 726d 217d 2077 696c 6c2c  erb!term!} will,
0008ee0: 206f 6e20 656e 636f 756e 7465 7269 6e67   on encountering
0008ef0: 2061 207b 5c76 6572 6221 2d21 7d20 7379   a {\verb!-!} sy
0008f00: 6d62 6f6c 2c20 6d61 6b65 2061 0a25 7265  mbol, make a.%re
0008f10: 6375 7273 6976 6520 6361 6c6c 2074 6f20  cursive call to 
0008f20: 6974 7365 6c66 2074 6f20 7061 7273 6520  itself to parse 
0008f30: 7468 6520 7375 6274 6572 6d2c 2061 6e64  the subterm, and
0008f40: 206f 6e20 656e 636f 756e 7465 7269 6e67   on encountering
0008f50: 2061 206e 616d 650a 2566 6f6c 6c6f 7765   a name.%followe
0008f60: 6420 6279 2061 6e20 6f70 656e 696e 6720  d by an opening 
0008f70: 7061 7265 6e74 6865 7369 732c 2077 696c  parenthesis, wil
0008f80: 6c20 6d61 6b65 2061 2072 6563 7572 7369  l make a recursi
0008f90: 7665 2063 616c 6c20 746f 0a25 7b5c 7665  ve call to.%{\ve
0008fa0: 7262 2174 6572 6d6c 6973 7421 7d2e 2054  rb!termlist!}. T
0008fb0: 6869 7320 696e 2069 7473 656c 6620 7769  his in itself wi
0008fc0: 6c6c 206d 616b 6520 6174 206c 6561 7374  ll make at least
0008fd0: 206f 6e65 2072 6563 7572 7369 7665 2063   one recursive c
0008fe0: 616c 6c20 746f 0a25 7b5c 7665 7262 2174  all to.%{\verb!t
0008ff0: 6572 6d21 7d2c 2061 6e64 2073 6f20 6f6e  erm!}, and so on
0009000: 2e20 5375 6368 2061 2073 7479 6c65 206f  . Such a style o
0009010: 6620 7072 6f67 7261 6d6d 696e 6720 6973  f programming is
0009020: 2070 6172 7469 6375 6c61 726c 7920 6e61   particularly na
0009030: 7475 7261 6c0a 2569 6e20 6120 6c61 6e67  tural.%in a lang
0009040: 7561 6765 206c 696b 6520 4d4c 2077 6865  uage like ML whe
0009050: 7265 2072 6563 7572 7369 6f6e 2069 7320  re recursion is 
0009060: 7468 6520 7072 696e 6369 7061 6c20 636f  the principal co
0009070: 6e74 726f 6c20 6d65 6368 616e 6973 6d2e  ntrol mechanism.
0009080: 0a0a f0d2 c5c4 d0cf cccf d6c9 cd2c 20de  ............., .
0009090: d4cf 20ce c1db 20d3 c9ce d4c1 cbd3 c9de  .. ... .........
00090a0: c5d3 cbc9 ca20 c1ce c1cc c9da c1d4 cfd2  ..... ..........
00090b0: 2c20 d2c5 c1cc c9da cfd7 c1ce ced9 ca20  , ............. 
00090c0: d3d2 c5c4 d3d4 d7c1 cdc9 7e4d 4c2c 0ad0  ..........~ML,..
00090d0: cfcc d5de c1c5 d420 d720 cbc1 dec5 d3d4  ....... . ......
00090e0: d7c5 20d7 c8cf c4ce cfca 20d0 cfd3 ccc5  .. ....... .....
00090f0: c4cf d7c1 d4c5 ccd8 cecf d3d4 c920 d3d0  ............. ..
0009100: c9d3 cfcb 20cf c2df c5cb d4cf d720 cec5  .... ........ ..
0009110: cbcf d4cf d2cf c7cf 0ad4 c9d0 c17e 245c  .............~$\
0009120: 616c 7068 6124 2e20 f7cf dacd cfd6 cecf  alpha$. ........
0009130: 2c20 ded4 cfc2 d920 d7c8 cfc4 cec1 d120  , ..... ....... 
0009140: d0cf d3cc c5c4 cfd7 c1d4 c5cc d8ce cfd3  ................
0009150: d4d8 20d3 cfd3 d4cf d1cc c120 c9da 0ad0  .. ........ ....
0009160: d2cf d3d4 d9c8 20d3 c9cd d7cf cccf d72c  ...... ........,
0009170: 20ce cf20 cec1 20d0 d2c1 cbd4 c9cb c520   .. .. ........ 
0009180: cfc2 d9de cecf 20d7 d7cf c4c9 d4d3 d120  ...... ........ 
0009190: c4cf d0cf ccce c9d4 c5cc d8ce d9ca 20d5  .............. .
00091a0: d2cf d7c5 ced8 0a7b 5c65 6d20 ccc5 cbd3  .......{\em ....
00091b0: c9de c5d3 cbcf c7cf 20c1 cec1 ccc9 dac1  ........ .......
00091c0: 2c7d 20d7 20c8 cfc4 c520 cbcf d4cf d2cf  ,} . .... ......
00091d0: c7cf 20d3 c9cd d7cf ccd9 20c7 d2d5 d0d0  .. ....... .....
00091e0: c9d2 d5c0 d4d3 d120 0ad7 7e7b 5c65 6d20  ....... ..~{\em 
00091f0: ccc5 cbd3 c5cd d920 28d4 cfcb c5ce d929  ....... (......)
0009200: 2c7d 20ce c1d0 d2c9 cdc5 d22c 203c 3c7b  ,} ........, <<{
0009210: 5c76 6572 6221 7831 3221 7d3e 3e2c 203c  \verb!x12!}>>, <
0009220: 3c7b 5c76 6572 6221 3a3d 217d 3e3e 200a  <{\verb!:=!}>> .
0009230: c97e 3c3c 7b5c 7665 7262 2139 3621 7d3e  .~<<{\verb!96!}>
0009240: 3e2c 20d4 c1cb 20de d4cf 20d7 c8cf c4ce  >, ... ... .....
0009250: cfca 20d0 cfd4 cfcb 20d3 cfd3 d4cf c9d4  .. ..... .......
0009260: 20d5 d6c5 20c9 da20 ccc5 cbd3 c5cd 2c20   ... .. ......, 
0009270: cf20 d4c9 d0c5 20cb cfd4 cfd2 d9c8 0acd  . .... .........
0009280: d920 cec5 20c2 d5c4 c5cd 20c4 c5cc c1d4  . .. ..... .....
0009290: d820 d0d2 c5c4 d0cf cccf d6c5 cec9 ca2e  . ..............
00092a0: 20e1 cec1 cccf c7c9 dece cf2c 20c2 d5c4   .........., ...
00092b0: c5cd 20d3 dec9 d4c1 d4d8 2c20 ded4 cf20  .. ......., ... 
00092c0: c1ce c1cc c9da c1d4 cfd2 0ad0 d2cf c9da  ................
00092d0: d7cf c4c9 d420 d2c5 dad5 ccd8 d4c1 d420  ..... ......... 
00092e0: d4c9 d0c1 7e24 5c62 6574 6124 2e20 fcd4  ....~$\beta$. ..
00092f0: cfd4 20d2 c5da d5cc d8d4 c1d4 20cd cfd6  .. ......... ...
0009300: c5d4 20c2 d9d4 d82c 20ce c1d0 d2c9 cdc5  .. ...., .......
0009310: d22c 20c4 c5d2 c5d7 cfcd 0ad2 c1da c2cf  ., .............
0009320: d2c1 2c20 d0d2 c5c4 d3d4 c1d7 ccc5 cece  .., ............
0009330: d9cd 20d2 c5cb d5d2 d3c9 d7ce d9cd 20d4  .. ........... .
0009340: c9d0 cfcd 20c4 c1ce ced9 c82c 20cc c9c2  .... ......, ...
0009350: cf20 d0d2 cfd3 d4cf 20de c9d3 cccf cd2c  . ...... ......,
0009360: 20c5 d3cc c90a c1ce c1cc c9da c1d4 cfd2   ...............
0009370: 20d0 d2c5 c4ce c1da cec1 dec5 ce20 c4cc   ............ ..
0009380: d120 d2c1 dac2 cfd2 c120 d7d9 d2c1 d6c5  . ....... ......
0009390: cec9 d120 c920 c5c7 cf20 d7d9 dec9 d3cc  ... . ... ......
00093a0: c5ce c9d1 20cf c4ce cfd7 d2c5 cdc5 cece  .... ...........
00093b0: cf2e 0af7 20cf c2dd c5cd 20d3 ccd5 dec1  .... ..... .....
00093c0: c52c 20c1 cec1 ccc9 dac1 d4cf d220 cdcf  ., .......... ..
00093d0: d6c5 d420 cec5 20cf c2d2 c1c2 cfd4 c1d4  ... .. .........
00093e0: d820 d7c8 cfc4 cecf ca20 d0cf d4cf cb20  . ....... ..... 
00093f0: d0cf ccce cfd3 d4d8 c02c 20d4 c1cb 20de  ........., ... .
0009400: d4cf 0ace c1cd 20d0 cfd4 d2c5 c2d5 c5d4  ...... .........
0009410: d3d1 20d7 c5d2 ced5 d4d8 20d7 20c4 cfd0  .. ....... . ...
0009420: cfcc cec5 cec9 c520 cb20 d2c5 dad5 ccd8  ....... . ......
0009430: d4c1 d4d5 20d2 c1da c2cf d2c1 20c5 ddc5  .... ....... ...
0009440: 20c9 20d3 d0c9 d3cf cb20 0ace c5cf c2d2   . ...... ......
0009450: c1c2 cfd4 c1ce ced9 c820 ccc5 cbd3 c5cd  ......... ......
0009460: 2e20 f4c1 cbc9 cd20 cfc2 d2c1 dacf cd2c  . ..... .......,
0009470: 20d4 c9d0 20c1 cec1 ccc9 dac1 d4cf d2c1   ... ...........
0009480: 3a20 0a25 496e 206f 7572 204d 4c20 696d  : .%In our ML im
0009490: 706c 656d 656e 7461 7469 6f6e 2c20 7765  plementation, we
00094a0: 2073 7570 706f 7365 2074 6861 7420 7765   suppose that we
00094b0: 2068 6176 6520 736f 6d65 2069 6e70 7574   have some input
00094c0: 206c 6973 7420 6f66 206f 626a 6563 7473   list of objects
00094d0: 206f 660a 2561 7262 6974 7261 7279 2074   of.%arbitrary t
00094e0: 7970 6520 245c 616c 7068 6124 2066 6f72  ype $\alpha$ for
00094f0: 2074 6865 2070 6172 7365 7220 746f 2063   the parser to c
0009500: 6f6e 7375 6d65 2e20 5468 6573 6520 6d69  onsume. These mi
0009510: 6768 7420 7369 6d70 6c79 2062 650a 2563  ght simply be.%c
0009520: 6861 7261 6374 6572 732c 2062 7574 2069  haracters, but i
0009530: 6e20 6661 6374 2074 6865 7265 2069 7320  n fact there is 
0009540: 7573 7561 6c6c 7920 6120 7365 7061 7261  usually a separa
0009550: 7465 206c 6576 656c 206f 6620 7b5c 656d  te level of {\em
0009560: 206c 6578 6963 616c 0a25 616e 616c 7973   lexical.%analys
0009570: 6973 7d20 7768 6963 6820 636f 6c6c 6563  is} which collec
0009580: 7473 2063 6861 7261 6374 6572 7320 746f  ts characters to
0009590: 6765 7468 6572 2069 6e74 6f20 7b5c 656d  gether into {\em
00095a0: 2074 6f6b 656e 737d 2073 7563 6820 6173   tokens} such as
00095b0: 0a25 607b 5c76 6572 6221 7831 3221 7d27  .%`{\verb!x12!}'
00095c0: 2c20 607b 5c76 6572 6221 3a3d 217d 2720  , `{\verb!:=!}' 
00095d0: 616e 6420 607b 5c76 6572 6221 3936 217d  and `{\verb!96!}
00095e0: 272c 2073 6f20 6279 2074 6865 2074 696d  ', so by the tim
00095f0: 6520 7765 2072 6561 6368 2074 6869 730a  e we reach this.
0009600: 256c 6576 656c 2074 6865 2069 6e70 7574  %level the input
0009610: 2069 7320 6120 6c69 7374 206f 6620 746f   is a list of to
0009620: 6b65 6e73 2e20 5765 2061 766f 6964 2063  kens. We avoid c
0009630: 6f6d 6d69 7474 696e 6720 6f75 7273 656c  ommitting oursel
0009640: 7665 7320 746f 2061 6e79 0a25 7061 7274  ves to any.%part
0009650: 6963 756c 6172 2074 7970 652e 2053 696d  icular type. Sim
0009660: 696c 6172 6c79 2c20 7765 2077 696c 6c20  ilarly, we will 
0009670: 616c 6c6f 7720 7468 6520 7061 7273 6572  allow the parser
0009680: 2074 6f20 636f 6e73 7472 7563 7420 6f62   to construct ob
0009690: 6a65 6374 7320 6f66 0a25 6172 6269 7472  jects of.%arbitr
00096a0: 6172 7920 7479 7065 2024 5c62 6574 6124  ary type $\beta$
00096b0: 2066 726f 6d20 6974 7320 696e 7075 742e   from its input.
00096c0: 2054 6865 7365 206d 6967 6874 2066 6f72   These might for
00096d0: 2065 7861 6d70 6c65 2062 6520 7061 7273   example be pars
00096e0: 6520 7472 6565 730a 2561 7320 6d65 6d62  e trees.%as memb
00096f0: 6572 7320 6f66 2061 2072 6563 7572 7369  ers of a recursi
0009700: 7665 2064 6174 6174 7970 652c 206f 7220  ve datatype, or 
0009710: 6d69 6768 7420 7369 6d70 6c79 2062 6520  might simply be 
0009720: 6e75 6d62 6572 7320 6966 2074 6865 2070  numbers if the p
0009730: 6172 7365 7220 6973 0a25 746f 2074 616b  arser is.%to tak
0009740: 6520 616e 2065 7870 7265 7373 696f 6e20  e an expression 
0009750: 616e 6420 6576 616c 7561 7465 2069 742e  and evaluate it.
0009760: 204e 6f77 2069 6e20 6765 6e65 7261 6c2c   Now in general,
0009770: 2061 2070 6172 7365 7220 6d69 6768 7420   a parser might 
0009780: 6e6f 740a 2563 6f6e 7375 6d65 2061 6c6c  not.%consume all
0009790: 2069 7473 2069 6e70 7574 2c20 736f 2077   its input, so w
00097a0: 6520 616c 736f 206d 616b 6520 6974 206f  e also make it o
00097b0: 7574 7075 7420 7468 6520 7265 6d61 696e  utput the remain
00097c0: 696e 6720 746f 6b65 6e73 2e0a 2554 6865  ing tokens..%The
00097d0: 7265 666f 7265 2c20 6120 7061 7273 6572  refore, a parser
00097e0: 2077 696c 6c20 6861 7665 2074 7970 650a   will have type.
00097f0: 250a 2424 200a 2028 5c61 6c70 6861 296c  %.$$ . (\alpha)l
0009800: 6973 7420 5c74 6f20 5c62 6574 6120 5c74  ist \to \beta \t
0009810: 696d 6573 2028 5c61 6c70 6861 296c 6973  imes (\alpha)lis
0009820: 7420 0a24 240a 0aee c1d0 d2c9 cdc5 d22c  t .$$..........,
0009830: 20c4 ccd1 20d7 c8cf c4ce cfca 20d0 cfd3   ... ....... ...
0009840: ccc5 c4cf d7c1 d4c5 ccd8 cecf d3d4 c97e  ...............~
0009850: 7b5c 7665 7262 2128 7820 2b20 7929 202a  {\verb!(x + y) *
0009860: 207a 217d 200a c6d5 cecb c3c9 d17e 7b5c   z!} ........~{\
0009870: 7665 7262 2161 746f 6d21 7d20 c4cf ccd6  verb!atom!} ....
0009880: cec1 20cf c2d2 c1c2 cfd4 c1d4 d87e 7b5c  .. ..........~{\
0009890: 7665 7262 2128 7820 2b20 7929 217d 20c9  verb!(x + y)!} .
00098a0: 20d7 c5d2 ced5 d4d8 7e7b 5c76 6572 6221   .......~{\verb!
00098b0: 2a20 7a21 7d2e 0af2 c5da d5cc d8d4 c9d2  * z!}...........
00098c0: d5c0 ddc5 c520 c4c5 d2c5 d7cf 20d2 c1da  ..... ...... ...
00098d0: c2cf d2c1 20d0 d2c9 ced1 d4cf ca20 dec1  .... ........ ..
00098e0: d3d4 c920 d7c8 cfc4 c120 cdcf d6c5 d420  ... ..... ..... 
00098f0: c2d9 d4d8 20d0 d2c5 c4d3 d4c1 d7cc c5ce  .... ...........
0009900: cf0a dace c1de c5ce c9c5 cd20 d2c5 cbd5  ........... ....
0009910: d2d3 c9d7 cecf c7cf 20d4 c9d0 c12c 20d7  ........ ...., .
0009920: d7c5 c4c5 cece cfc7 cf20 d2c1 cec5 c52e  ......... ......
0009930: 20ef d4d3 c0c4 c120 cdd9 20c9 cdc5 c5cd   ...... .. .....
0009940: 0a25 466f 7220 6578 616d 706c 652c 2077  .%For example, w
0009950: 6865 6e20 6769 7665 6e20 7468 6520 696e  hen given the in
0009960: 7075 7420 6368 6172 6163 7465 7273 207b  put characters {
0009970: 5c76 6572 6221 2878 202b 2079 2920 2a20  \verb!(x + y) * 
0009980: 7a21 7d20 7468 650a 2566 756e 6374 696f  z!} the.%functio
0009990: 6e20 7b5c 7665 7262 2161 746f 6d21 7d20  n {\verb!atom!} 
00099a0: 7368 6f75 6c64 2070 726f 6365 7373 2074  should process t
00099b0: 6865 2063 6861 7261 6374 6572 7320 7b5c  he characters {\
00099c0: 7665 7262 2128 7820 2b20 7929 217d 2061  verb!(x + y)!} a
00099d0: 6e64 206c 6561 7665 0a25 7468 6520 7265  nd leave.%the re
00099e0: 6d61 696e 696e 6720 6368 6172 6163 7465  maining characte
00099f0: 7273 207b 5c76 6572 6221 2a20 7a21 7d2e  rs {\verb!* z!}.
0009a00: 2049 7420 6d69 6768 7420 7265 7475 726e   It might return
0009a10: 2061 2070 6172 7365 2074 7265 6520 666f   a parse tree fo
0009a20: 7220 7468 650a 2570 726f 6365 7373 6564  r the.%processed
0009a30: 2065 7870 7265 7373 696f 6e20 7573 696e   expression usin
0009a40: 6720 6f75 7220 6561 726c 6965 7220 7265  g our earlier re
0009a50: 6375 7273 6976 6520 7479 7065 2c20 616e  cursive type, an
0009a60: 6420 6865 6e63 6520 7765 2077 6f75 6c64  d hence we would
0009a70: 2068 6176 653a 0a25 0a5c 6265 6769 6e7b   have:.%.\begin{
0009a80: 626f 7865 647d 5c62 6567 696e 7b6c 7374  boxed}\begin{lst
0009a90: 6c69 7374 696e 677d 0a20 2061 746f 6d20  listing}.  atom 
0009aa0: 2228 7820 2b20 7929 202a 207a 2220 3d20  "(x + y) * z" = 
0009ab0: 466e 2822 2b22 2c5b 5661 7220 2278 223b  Fn("+",[Var "x";
0009ac0: 2056 6172 2022 7922 5d29 2c22 2a20 7a22   Var "y"]),"* z"
0009ad0: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
0009ae0: 7d5c 656e 647b 626f 7865 647d 0a0a f0cf  }\end{boxed}....
0009af0: d3cb cfcc d8cb d520 ccc0 c2cf c520 cfc2  ....... ..... ..
0009b00: d2c1 ddc5 cec9 c520 cb20 c6d5 cecb c3c9  ....... . ......
0009b10: c97e 7b5c 7665 7262 2b61 746f 6d2b 7d20  .~{\verb+atom+} 
0009b20: c4cf ccd6 cecf 20d0 d2cf c9d3 c8cf c4c9  ...... .........
0009b30: d4d8 20c9 da20 0ac6 d5ce cbc3 c9c9 7e7b  .. .. ........~{
0009b40: 5c76 6572 6221 6d75 6c65 7870 217d 2c20  \verb!mulexp!}, 
0009b50: d4cf 20d0 cfd3 ccc5 c4ce d1d1 20c2 d5c4  .. ......... ...
0009b60: c5d4 20c9 d3d0 cfcc d8da cfd7 c1d4 d820  .. ............ 
0009b70: d2c5 dad5 ccd8 d4c1 d42c 20d0 cfcc d5de  ........., .....
0009b80: c5ce ced9 ca0a d7d9 dec9 d3cc c5ce c9c5  ................
0009b90: cd7e 7b5c 7665 7262 2161 746f 6d21 7d2c  .~{\verb!atom!},
0009ba0: 20c1 20d4 c1cb d6c5 20cf c2d2 c1c2 c1d4   . ..... .......
0009bb0: d9d7 c1d4 d820 cfd3 d4c1 d7db c9c5 d3d1  ..... ..........
0009bc0: 20cc c5cb d3c5 cdd9 2c20 d7d9 dad9 d7c1   ......., ......
0009bd0: d10a d0cf d7d4 cfd2 cecf 7e7b 5c76 6572  ..........~{\ver
0009be0: 6221 6174 6f6d 217d 20c4 ccd1 20c1 cec1  b!atom!} ... ...
0009bf0: ccc9 dac1 20d0 cfc4 d7d9 d2c1 d6c5 cec9  .... ...........
0009c00: d17e 7b5c 7665 7262 217a 217d 2e0a 2553  .~{\verb!z!}..%S
0009c10: 696e 6365 2061 6e79 2063 616c 6c20 6f66  ince any call of
0009c20: 2074 6865 2066 756e 6374 696f 6e20 7b5c   the function {\
0009c30: 7665 7262 2b61 746f 6d2b 7d20 6d75 7374  verb+atom+} must
0009c40: 2062 6520 6672 6f6d 2077 6974 6869 6e20   be from within 
0009c50: 7468 6520 6675 6e63 7469 6f6e 0a25 7b5c  the function.%{\
0009c60: 7665 7262 216d 756c 6578 7021 7d2c 2074  verb!mulexp!}, t
0009c70: 6869 7320 7365 636f 6e64 2066 756e 6374  his second funct
0009c80: 696f 6e20 7769 6c6c 2075 7365 2074 6865  ion will use the
0009c90: 2072 6573 756c 7420 6f66 207b 5c76 6572   result of {\ver
0009ca0: 6221 6174 6f6d 217d 2061 6e64 0a25 6465  b!atom!} and.%de
0009cb0: 616c 2077 6974 6820 7468 6520 696e 7075  al with the inpu
0009cc0: 7420 7468 6174 2072 656d 6169 6e73 2c20  t that remains, 
0009cd0: 6d61 6b69 6e67 2061 2073 6563 6f6e 6420  making a second 
0009ce0: 6361 6c6c 2074 6f20 7b5c 7665 7262 2161  call to {\verb!a
0009cf0: 746f 6d21 7d20 746f 0a25 7072 6f63 6573  tom!} to.%proces
0009d00: 7320 7468 6520 6578 7072 6573 7369 6f6e  s the expression
0009d10: 2060 7b5c 7665 7262 217a 217d 272e 0a0a   `{\verb!z!}'...
0009d20: 5c73 7562 7365 6374 696f 6e7b ebcf cdc2  \subsection{....
0009d30: c9ce c1d4 cfd2 d920 d3c9 ced4 c1cb d3c9  ....... ........
0009d40: dec5 d3cb cfc7 cf20 c1ce c1cc c9da c17d  ....... .......}
0009d50: 0a25 5c73 7562 7365 6374 696f 6e7b 5061  .%\subsection{Pa
0009d60: 7273 6572 2063 6f6d 6269 6e61 746f 7273  rser combinators
0009d70: 7d0a e5dd c520 cfc4 cec1 20d0 d2c9 dec9  }.... .... .....
0009d80: cec1 2c20 d0cf 20cb cfd4 cfd2 cfca 20d0  .., .. ....... .
0009d90: d2c5 c4cc cfd6 c5ce ced9 ca20 cdc5 d4cf  ........... ....
0009da0: c420 d2c1 dac2 cfd2 c120 cfd3 cfc2 c5ce  . ....... ......
0009db0: cecf 20c8 cfd2 cfdb cf20 0ad0 cfc4 c8cf  .. ...... ......
0009dc0: c4c9 d420 c4cc d120 d2c5 c1cc c9da c1c3  ... ... ........
0009dd0: c9c9 20ce c120 d1da d9cb c57e 4d4c 2c20  .. .. .....~ML, 
0009de0: dcd4 cf20 d7cf dacd cfd6 cecf d3d4 d820  ... ........... 
0009df0: cfd0 d2c5 c4c5 ccc5 cec9 d120 cec5 cbcf  ........... ....
0009e00: d4cf d2d9 c80a d0cf ccc5 dace d9c8 20cb  .............. .
0009e10: cfcd c2c9 cec1 d4cf d2cf d72c 20d0 d2c9  ..........., ...
0009e20: 20d0 cfcd cfdd c920 cbcf d4cf d2d9 c820   ...... ....... 
0009e30: cecf d7d9 c520 c1ce c1cc c9da c1d4 cfd2  ..... ..........
0009e40: d920 ccc5 c7cb cf0a d3cf dac4 c1c0 d4d3  . ..............
0009e50: d120 cec1 20c2 c1da c520 d5d6 c520 d3d5  . .. .... ... ..
0009e60: ddc5 d3d4 d7d5 c0dd c9c8 2e20 efd0 d2c5  ........... ....
0009e70: c4c5 ccc9 d720 dcd4 c920 cbcf cdc2 c9ce  ..... ... ......
0009e80: c1d4 cfd2 d920 cbc1 cb20 c9ce c6c9 cbd3  ..... ... ......
0009e90: ced9 c520 0acf d0c5 d2c1 c3c9 c92c 20cd  ... ........., .
0009ea0: d920 d720 d3cf d3d4 cfd1 cec9 c920 d0d2  . . ......... ..
0009eb0: c9c4 c1d4 d820 d0d2 cfc7 d2c1 cdcd c520  ..... ......... 
0009ec0: d3c9 ced4 c1cb d3c9 dec5 d3cb cfc7 cf20  ............... 
0009ed0: c1ce c1cc c9da c1d4 cfd2 c120 d7c9 c42c  ........... ...,
0009ee0: 200a cfde c5ce d820 d3c8 cfd6 c9ca 20d3   ...... ...... .
0009ef0: cf20 d3d4 d2d5 cbd4 d5d2 cfca 20c9 d3c8  . .......... ...
0009f00: cfc4 cecf ca20 c7d2 c1cd cdc1 d4c9 cbc9  ..... ..........
0009f10: 2e0a 2541 6e6f 7468 6572 2072 6561 736f  ..%Another reaso
0009f20: 6e20 7768 7920 7468 6973 2074 6563 686e  n why this techn
0009f30: 6971 7565 2077 6f72 6b73 2070 6172 7469  ique works parti
0009f40: 6375 6c61 726c 7920 7765 6c6c 2069 6e20  cularly well in 
0009f50: 4d4c 2069 7320 7468 6174 2077 6520 6361  ML is that we ca
0009f60: 6e0a 2564 6566 696e 6520 736f 6d65 2075  n.%define some u
0009f70: 7365 6675 6c20 636f 6d62 696e 6174 6f72  seful combinator
0009f80: 7320 666f 7220 706c 7567 6769 6e67 2070  s for plugging p
0009f90: 6172 7365 7273 2074 6f67 6574 6865 722e  arsers together.
0009fa0: 2049 6e20 6661 6374 2c20 6279 0a25 6769   In fact, by.%gi
0009fb0: 7669 6e67 2074 6865 6d20 696e 6669 7820  ving them infix 
0009fc0: 7374 6174 7573 2c20 7765 2063 616e 206d  status, we can m
0009fd0: 616b 6520 7468 6520 4d4c 2070 6172 7365  ake the ML parse
0009fe0: 7220 7072 6f67 7261 6d20 6c6f 6f6b 2071  r program look q
0009ff0: 7569 7465 2073 696d 696c 6172 0a25 696e  uite similar.%in
000a000: 2073 7472 7563 7475 7265 2074 6f20 7468   structure to th
000a010: 6520 6f72 6967 696e 616c 2067 7261 6d6d  e original gramm
000a020: 6172 2064 6566 696e 696e 6720 7468 6520  ar defining the 
000a030: 6c61 6e67 7561 6765 2e0a 0ae4 ccd1 20ce  language...... .
000a040: c1de c1cc c120 d7d7 c5c4 a3cd 20c9 d3cb  ..... ...... ...
000a050: ccc0 dec5 cec9 c52c 20d3 c9c7 cec1 ccc9  ......., .......
000a060: dac9 d2d5 c0dd c5c5 20cf c220 cfdb c9c2  ........ .. ....
000a070: cbc1 c820 c1ce c1cc c9da c12e 20e4 c1cc  ... ........ ...
000a080: c5c5 0acf d0d2 c5c4 c5cc c9cd 20c9 cec6  ............ ...
000a090: c9cb d3ce d5c0 20cf d0c5 d2c1 c3c9 c07e  ...... ........~
000a0a0: 7b5c 7665 7262 212b 2b21 7d2c 20cb cfd4  {\verb!++!}, ...
000a0b0: cfd2 c1d1 20d0 d2c9 cdc5 ced1 c5d4 20c4  .... ......... .
000a0c0: d7c1 20c1 cec1 ccc9 dac1 d4cf d2c1 0ad0  .. .............
000a0d0: cfd3 ccc5 c4cf d7c1 d4c5 ccd8 cecf 2c20  .............., 
000a0e0: cfc2 dfc5 c4c9 ced1 d120 c9c8 20d2 c5da  ......... .. ...
000a0f0: d5cc d8d4 c1d4 d92c 20c1 20d4 c1cb d6c5  ......., . .....
000a100: 20c9 cec6 c9cb d3ce d5c0 200a cfd0 c5d2   ......... .....
000a110: c1c3 c9c0 7e7b 5c76 6572 6221 7c7c 217d  ....~{\verb!||!}
000a120: 2c20 cbcf d4cf d2c1 d120 d7ce c1de c1cc  , ....... ......
000a130: c520 c4c5 ccc1 c5d4 20d0 cfd0 d9d4 cbd5  . ...... .......
000a140: 20d0 d2c9 cdc5 cec9 d4d8 20cf c4c9 ce20   ......... .... 
000a150: c9da 200a c1ce c1cc c9da c1d4 cfd2 cfd7  .. .............
000a160: 2c20 c120 dac1 d4c5 cd7e 2d2d 2d20 d7d4  , . .....~--- ..
000a170: cfd2 cfca 2e20 efd0 c5d2 c1c3 c9d1 7e7b  ..... ........~{
000a180: 5c76 6572 6221 6d61 6e79 217d 20d0 d2c5  \verb!many!} ...
000a190: c4d3 d4c1 d7cc d1c5 d420 d3cf c2cf ca0a  ......... ......
000a1a0: d3d7 c5d2 d4cb d520 cfd4 cecf d3c9 d4c5  ....... ........
000a1b0: ccd8 cecf 7e7b 5c76 6572 6221 2b2b 217d  ....~{\verb!++!}
000a1c0: 2c20 d42e 7ec5 2e5c 20d0 d2c9 cdc5 ced1  , ..~..\ .......
000a1d0: c5d4 20da c1c4 c1ce ced9 ca20 c1ce c1cc  .. ........ ....
000a1e0: c9da c1d4 cfd2 200a cdc1 cbd3 c9cd c1cc  ...... .........
000a1f0: d8ce cf20 d7cf dacd cfd6 cecf c520 cbcf  ... ......... ..
000a200: ccc9 dec5 d3d4 d7cf 20d2 c1da 2c20 d7d9  ........ ..., ..
000a210: c4c1 d7c1 d120 d3d0 c9d3 cfcb 20d2 c5da  ..... ...... ...
000a220: d5cc d8d4 c1d4 cfd7 2e20 eec1 cbcf cec5  ......... ......
000a230: c32c 0ac9 cec6 c9cb d3ce c1d1 20cf d0c5  .,.......... ...
000a240: d2c1 c3c9 d17e 7b5c 7665 7262 213e 3e21  .....~{\verb!>>!
000a250: 7d20 d0d2 c9cd c5ce d1c5 d4d3 d120 c4cc  } ........... ..
000a260: d120 dac1 d7c5 d2db c1c0 ddc5 ca20 cfc2  . ........... ..
000a270: d2c1 c2cf d4cb c920 0ad2 c5da d5cc d8d4  ....... ........
000a280: c1d4 cfd7 20c1 cec1 ccc9 dac1 20da c1c4  .... ....... ...
000a290: c1ce cecf ca20 c6d5 cecb c3c9 c5ca 2e0a  ..... ..........
000a2a0: 2546 6972 7374 2077 6520 6465 636c 6172  %First we declar
000a2b0: 6520 616e 2065 7863 6570 7469 6f6e 2074  e an exception t
000a2c0: 6f20 6265 2075 7365 6420 7768 6572 6520  o be used where 
000a2d0: 7061 7273 696e 6720 6661 696c 732e 2054  parsing fails. T
000a2e0: 6865 6e20 7765 2064 6566 696e 6520 616e  hen we define an
000a2f0: 0a25 696e 6669 7820 7b5c 7665 7262 212b  .%infix {\verb!+
000a300: 2b21 7d20 7468 6174 2061 7070 6c69 6573  +!} that applies
000a310: 2074 776f 2070 6172 7365 7273 2069 6e20   two parsers in 
000a320: 7365 7175 656e 6365 2c20 7061 6972 696e  sequence, pairin
000a330: 6720 7570 2074 6865 6972 0a25 7265 7375  g up their.%resu
000a340: 6c74 732c 2061 6e64 2061 6e64 2069 6e66  lts, and and inf
000a350: 6978 207b 5c76 6572 6221 7c7c 217d 2077  ix {\verb!||!} w
000a360: 6869 6368 2074 7269 6573 2066 6972 7374  hich tries first
000a370: 206f 6e65 2070 6172 7365 722c 2074 6865   one parser, the
000a380: 6e20 7468 650a 256f 7468 6572 2e20 5765  n the.%other. We
000a390: 2074 6865 6e20 6465 6669 6e65 2061 206d   then define a m
000a3a0: 616e 792d 666f 6c64 2076 6572 7369 6f6e  any-fold version
000a3b0: 206f 6620 7b5c 7665 7262 212b 2b21 7d20   of {\verb!++!} 
000a3c0: 7468 6174 2072 6570 6561 7473 2061 2070  that repeats a p
000a3d0: 6172 7365 720a 2561 7320 6661 7220 6173  arser.%as far as
000a3e0: 2070 6f73 7369 626c 652c 2070 7574 7469   possible, putti
000a3f0: 6e67 2074 6865 2072 6573 756c 7473 2069  ng the results i
000a400: 6e74 6f20 6120 6c69 7374 2e20 4669 6e61  nto a list. Fina
000a410: 6c6c 792c 2074 6865 2069 6e66 6978 0a25  lly, the infix.%
000a420: 7b5c 7665 7262 213e 3e21 7d20 6973 2075  {\verb!>>!} is u
000a430: 7365 6420 746f 206d 6f64 6966 7920 7468  sed to modify th
000a440: 6520 7265 7375 6c74 7320 6f66 2061 2070  e results of a p
000a450: 6172 7365 7220 6163 636f 7264 696e 6720  arser according 
000a460: 746f 2061 2066 756e 6374 696f 6e2e 0a0a  to a function...
000a470: f3cf c7cc c1d3 cecf 20d3 c9ce d4c1 cbd3  ........ .......
000a480: c9d3 d57e 4341 4d4c 2c20 c9c4 c5ce d4c9  ...~CAML, ......
000a490: c6c9 cbc1 d4cf d2d9 20ce c1d0 cfc4 cfc2  ........ .......
000a4a0: c9c5 7e7b 5c76 6572 6221 2b2b 217d 20c1  ..~{\verb!++!} .
000a4b0: d7d4 cfcd c1d4 c9de c5d3 cbc9 0ad3 dec9  ................
000a4c0: d4c1 c0d4 d3d1 20c9 cec6 c9cb d3ce d9cd  ...... .........
000a4d0: c920 cfd0 c5d2 c1c3 c9d1 cdc9 2c20 d4c1  . .........., ..
000a4e0: cb20 ded4 cf20 d7cf 20d7 d2c5 cdd1 20cf  . ... .. ..... .
000a4f0: d0d2 c5c4 c5cc c5ce c9d1 20cf d0c5 d2c1  .......... .....
000a500: c3c9 ca20 cdd9 0ad7 d2c5 cdc5 cece cf20  ... ........... 
000a510: c2cc cfcb c9d2 d5c5 cd20 dcd4 d520 d7cf  ......... ... ..
000a520: dacd cfd6 cecf d3d4 d820 d0d2 c920 d0cf  ......... ... ..
000a530: cdcf ddc9 20cb ccc0 dec5 d7cf c7cf 20d3  .... ......... .
000a540: cccf d7c1 7e7b 5c74 7420 7072 6566 6978  ....~{\tt prefix
000a550: 7d2e 0af0 d2c9 cfd2 c9d4 c5d4 d920 d4c1  }............ ..
000a560: cbd6 c520 dac1 c4c1 c0d4 d3d1 20c1 d7d4  ... ........ ...
000a570: cfcd c1d4 c9de c5d3 cbc9 20d0 cf20 d0c5  .......... .. ..
000a580: d2d7 d9cd 20d3 c9cd d7cf ccc1 cd20 c9c4  .... ........ ..
000a590: c5ce d4c9 c6c9 cbc1 d4cf d2cf d70a c920  ............... 
000a5a0: d0cf ccc1 c7c1 c0d4 d3d1 20d2 c1d7 ced9  .......... .....
000a5b0: cdc9 20d0 d2c9 cfd2 c9d4 c5d4 c1cd 20c1  .. ........... .
000a5c0: d2c9 c6cd c5d4 c9de c5d3 cbc9 c820 cfd0  ............. ..
000a5d0: c5d2 c1c3 c9ca 2c20 cfc2 cfda cec1 dec5  ......, ........
000a5e0: cece d9c8 20dc d4c9 cdc9 200a d3c9 cdd7  .... ..... .....
000a5f0: cfcc c1cd c92e 20f4 c1cb c9cd 20cf c2d2  ...... ..... ...
000a600: c1da cfcd 2c20 d0d2 c9cf d2c9 d4c5 d47e  ...., .........~
000a610: 7b5c 7665 7262 212b 2b21 7d20 cec1 c9d7  {\verb!++!} ....
000a620: d9d3 dbc9 ca2c 200a 7b5c 7665 7262 213e  ....., .{\verb!>
000a630: 3e21 7d7e 2d2d 2d20 d3d2 c5c4 cec9 ca2c  >!}~--- .......,
000a640: 207b 5c76 6572 6221 7c7c 217d 7e2d 2d2d   {\verb!||!}~---
000a650: 20ce c9da dbc9 ca2c 20de d4cf 20ce c1cd   ......, ... ...
000a660: 20c9 20d4 d2c5 c2d5 c5d4 d3d1 2e0a 2525   . ...........%%
000a670: 2520 4953 5355 453a 20d5 d4cf dece c9d4  % ISSUE: .......
000a680: d820 cec1 d3de c5d4 20d0 d2c9 cfd2 c9d4  . ...... .......
000a690: c5d4 cfd7 2c20 ded4 cf20 d4c1 cbcf c520  ...., ... ..... 
000a6a0: 6574 632e 20d7 20cf d2c9 c7c9 cec1 ccc5  etc. . .........
000a6b0: 200a 2554 6865 2043 414d 4c20 7275 6c65   .%The CAML rule
000a6c0: 7320 666f 7220 7379 6d62 6f6c 6963 2069  s for symbolic i
000a6d0: 6465 6e74 6966 6965 7273 2073 7563 6820  dentifiers such 
000a6e0: 6173 207b 5c76 6572 6221 2b2b 217d 206d  as {\verb!++!} m
000a6f0: 616b 6520 7468 656d 2069 6e66 6978 0a25  ake them infix.%
000a700: 6175 746f 6d61 7469 6361 6c6c 792c 2073  automatically, s
000a710: 6f20 7765 2073 7570 7072 6573 7320 7468  o we suppress th
000a720: 6973 2064 7572 696e 6720 7468 6520 6465  is during the de
000a730: 6669 6e69 7469 6f6e 2075 7369 6e67 2074  finition using t
000a740: 6865 207b 5c74 7420 7072 6566 6978 7d0a  he {\tt prefix}.
000a750: 256b 6579 776f 7264 2e20 5468 6569 7220  %keyword. Their 
000a760: 7072 6563 6564 656e 6365 7320 6172 6520  precedences are 
000a770: 616c 736f 2061 7574 6f6d 6174 6963 2c20  also automatic, 
000a780: 666f 6c6c 6f77 696e 6720 6672 6f6d 2074  following from t
000a790: 6865 2075 7375 616c 0a25 7072 6563 6564  he usual.%preced
000a7a0: 656e 6365 206f 6620 7468 6569 7220 6669  ence of their fi
000a7b0: 7273 7420 6368 6172 6163 7465 7273 2061  rst characters a
000a7c0: 7320 6172 6974 686d 6574 6963 206f 7065  s arithmetic ope
000a7d0: 7261 7469 6f6e 7320 6574 632e 2054 6861  rations etc. Tha
000a7e0: 7420 6973 2c0a 257b 5c76 6572 6221 2b2b  t is,.%{\verb!++
000a7f0: 217d 2069 7320 7468 6520 7374 726f 6e67  !} is the strong
000a800: 6573 742c 207b 5c76 6572 6221 3e3e 217d  est, {\verb!>>!}
000a810: 2066 616c 6c73 2069 6e20 7468 6520 6d69   falls in the mi
000a820: 6464 6c65 2c20 616e 6420 7b5c 7665 7262  ddle, and {\verb
000a830: 217c 7c21 7d0a 2569 7320 7468 6520 7765  !||!}.%is the we
000a840: 616b 6573 743b 2074 6869 7320 6973 2065  akest; this is e
000a850: 7861 6374 6c79 2077 6861 7420 7765 2077  xactly what we w
000a860: 616e 742e 0a0a 5c62 6567 696e 7b62 6f78  ant...\begin{box
000a870: 6564 7d5c 6265 6769 6e7b 6c73 746c 6973  ed}\begin{lstlis
000a880: 7469 6e67 7d0a 2020 6578 6365 7074 696f  ting}.  exceptio
000a890: 6e20 4e6f 7061 7273 653b 3b0a 0a20 206c  n Noparse;;..  l
000a8a0: 6574 2070 7265 6669 7820 7c7c 2070 6172  et prefix || par
000a8b0: 7365 7231 2070 6172 7365 7232 2069 6e70  ser1 parser2 inp
000a8c0: 7574 203d 0a20 2020 2074 7279 2070 6172  ut =.    try par
000a8d0: 7365 7231 2069 6e70 7574 0a20 2020 2077  ser1 input.    w
000a8e0: 6974 6820 4e6f 7061 7273 6520 2d3e 2070  ith Noparse -> p
000a8f0: 6172 7365 7232 2069 6e70 7574 3b3b 0a0a  arser2 input;;..
000a900: 2020 6c65 7420 7072 6566 6978 202b 2b20    let prefix ++ 
000a910: 7061 7273 6572 3120 7061 7273 6572 3220  parser1 parser2 
000a920: 696e 7075 7420 3d0a 2020 2020 6c65 7420  input =.    let 
000a930: 7265 7375 6c74 312c 7265 7374 3120 3d20  result1,rest1 = 
000a940: 7061 7273 6572 3120 696e 7075 7420 696e  parser1 input in
000a950: 0a20 2020 206c 6574 2072 6573 756c 7432  .    let result2
000a960: 2c72 6573 7432 203d 2070 6172 7365 7232  ,rest2 = parser2
000a970: 2072 6573 7431 2069 6e0a 2020 2020 2872   rest1 in.    (r
000a980: 6573 756c 7431 2c72 6573 756c 7432 292c  esult1,result2),
000a990: 7265 7374 323b 3b0a 0a20 206c 6574 2072  rest2;;..  let r
000a9a0: 6563 206d 616e 7920 7061 7273 6572 2069  ec many parser i
000a9b0: 6e70 7574 203d 0a20 2020 2074 7279 206c  nput =.    try l
000a9c0: 6574 2072 6573 756c 742c 6e65 7874 203d  et result,next =
000a9d0: 2070 6172 7365 7220 696e 7075 7420 696e   parser input in
000a9e0: 0a20 2020 2020 2020 206c 6574 2072 6573  .        let res
000a9f0: 756c 7473 2c72 6573 7420 3d20 6d61 6e79  ults,rest = many
000aa00: 2070 6172 7365 7220 6e65 7874 2069 6e0a   parser next in.
000aa10: 2020 2020 2020 2020 2872 6573 756c 743a          (result:
000aa20: 3a72 6573 756c 7473 292c 7265 7374 0a20  :results),rest. 
000aa30: 2020 2077 6974 6820 4e6f 7061 7273 6520     with Noparse 
000aa40: 2d3e 205b 5d2c 696e 7075 743b 3b0a 0a20  -> [],input;;.. 
000aa50: 206c 6574 2070 7265 6669 7820 3e3e 2070   let prefix >> p
000aa60: 6172 7365 7220 7472 6561 746d 656e 7420  arser treatment 
000aa70: 696e 7075 7420 3d0a 2020 2020 6c65 7420  input =.    let 
000aa80: 7265 7375 6c74 2c72 6573 7420 3d20 7061  result,rest = pa
000aa90: 7273 6572 2069 6e70 7574 2069 6e0a 2020  rser input in.  
000aaa0: 2020 7472 6561 746d 656e 7428 7265 7375    treatment(resu
000aab0: 6c74 292c 7265 7374 3b3b 0a5c 656e 647b  lt),rest;;.\end{
000aac0: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
000aad0: 626f 7865 647d 0a0a f7d7 c5c4 a3cd 20d3  boxed}........ .
000aae0: ccc5 c4d5 c0dd c9c5 20d5 cec9 d7c5 d2d3  ........ .......
000aaf0: c1cc d8ce d9c5 20c6 d5ce cbc3 c9c9 2c20  ...... ......., 
000ab00: cbcf d4cf d2d9 c520 cec1 cd20 d0cf cec1  ....... ... ....
000ab10: c4cf c2d1 d4d3 d120 d720 c4c1 ccd8 cec5  ....... . ......
000ab20: cadb c5cd 2e0a e2cf ccd8 dbc1 d120 dec1  ............. ..
000ab30: d3d4 d820 c9da 20ce c9c8 20d5 d6c5 20cf  ... .. ... ... .
000ab40: c2d3 d5d6 c4c1 ccc1 d3d8 20d2 c1ce c5c5  .......... .....
000ab50: 2c20 dac1 20c9 d3cb ccc0 dec5 cec9 c5cd  , .. ...........
000ab60: 200a c6d5 cecb c3c9 c97e 7b5c 7474 2065   ........~{\tt e
000ab70: 7870 6c6f 6465 7d2c 20d0 d2c5 cfc2 d2c1  xplode}, .......
000ab80: dad5 c0dd c5ca 20d3 d4d2 cfcb d520 d720  ...... ...... . 
000ab90: d3d0 c9d3 cfcb 20cf c4ce cfd3 c9cd d7cf  ...... .........
000aba0: ccd8 ced9 c820 d3d4 d2cf cb2e 20e5 a30a  ..... ...... ...
000abb0: d2c5 c1cc c9da c1c3 c9d1 20c9 d3d0 cfcc  .......... .....
000abc0: d8da d5c5 d420 d7d3 d4d2 cfc5 cece d9c5  ..... ..........
000abd0: 20c6 d5ce cbc3 c9c9 207b 5c76 6572 6221   ....... {\verb!
000abe0: 7375 625f 7374 7269 6e67 217d 200a c97e  sub_string!} ..~
000abf0: 7b5c 7665 7262 2173 7472 696e 675f 6c65  {\verb!string_le
000ac00: 6e67 7468 217d 2c20 cbcf d4cf d2d9 c520  ngth!}, ....... 
000ac10: cec5 20d2 c1d3 d3cd c1d4 d2c9 d7c1 ccc9  .. .............
000ac20: d3d8 2c20 cecf 20c9 c820 cec1 dace c1de  .., .. .. ......
000ac30: c5ce c9c5 20cc c5c7 cbcf 0ad0 cfce d1d4  .... ...........
000ac40: d820 c9da 20d0 d2c9 cdc5 d2c1 2e0a 2557  . .. .........%W
000ac50: 6520 7769 6c6c 2c20 696e 2077 6861 7420  e will, in what 
000ac60: 666f 6c6c 6f77 732c 2075 7365 2074 6865  follows, use the
000ac70: 2066 6f6c 6c6f 7769 6e67 206f 7468 6572   following other
000ac80: 2066 756e 6374 696f 6e73 2e20 4d6f 7374   functions. Most
000ac90: 206f 6620 7468 6573 650a 2568 6176 6520   of these.%have 
000aca0: 6265 656e 2064 6566 696e 6564 2061 626f  been defined abo
000acb0: 7665 2c20 7468 6520 6d61 696e 2065 7863  ve, the main exc
000acc0: 6570 7469 6f6e 2062 6569 6e67 207b 5c74  eption being {\t
000acd0: 7420 6578 706c 6f64 657d 2077 6869 6368  t explode} which
000ace0: 2063 6f6e 7665 7274 730a 2561 2073 7472   converts.%a str
000acf0: 696e 6720 696e 746f 2061 206c 6973 7420  ing into a list 
000ad00: 6f66 2031 2d65 6c65 6d65 6e74 7320 7374  of 1-elements st
000ad10: 7269 6e67 732e 2049 7420 7573 6573 2074  rings. It uses t
000ad20: 6865 2069 6e62 7569 6c74 2066 756e 6374  he inbuilt funct
000ad30: 696f 6e73 0a25 7b5c 7665 7262 2173 7562  ions.%{\verb!sub
000ad40: 5f73 7472 696e 6721 7d20 616e 6420 7b5c  _string!} and {\
000ad50: 7665 7262 2173 7472 696e 675f 6c65 6e67  verb!string_leng
000ad60: 7468 217d 3b20 7765 2064 6f20 6e6f 7420  th!}; we do not 
000ad70: 6465 7363 7269 6265 2074 6865 6d20 696e  describe them in
000ad80: 0a25 6465 7461 696c 2062 7574 2074 6865  .%detail but the
000ad90: 6972 2066 756e 6374 696f 6e20 7368 6f75  ir function shou
000ada0: 6c64 2062 6520 6561 7379 2074 6f20 6772  ld be easy to gr
000adb0: 6173 7020 6672 6f6d 2074 6865 2065 7861  asp from the exa
000adc0: 6d70 6c65 2e0a 250a 5c62 6567 696e 7b62  mple..%.\begin{b
000add0: 6f78 6564 7d5c 6265 6769 6e7b 7665 7262  oxed}\begin{verb
000ade0: 6174 696d 7d0a 2020 6c65 7420 7265 6320  atim}.  let rec 
000adf0: 6974 6c69 7374 2066 203d 0a20 2020 2020  itlist f =.     
000ae00: 2020 6675 6e20 5b5d 2062 202d 3e20 620a    fun [] b -> b.
000ae10: 2020 2020 2020 2020 207c 2028 683a 3a74           | (h::t
000ae20: 2920 6220 2d3e 2066 2068 2028 6974 6c69  ) b -> f h (itli
000ae30: 7374 2066 2074 2062 293b 3b0a 0a20 206c  st f t b);;..  l
000ae40: 6574 2075 6e63 7572 7279 2066 2878 2c79  et uncurry f(x,y
000ae50: 2920 3d20 6620 7820 793b 3b0a 0a20 206c  ) = f x y;;..  l
000ae60: 6574 204b 2078 2079 203d 2078 3b3b 0a0a  et K x y = x;;..
000ae70: 2020 6c65 7420 4320 6620 7820 7920 3d20    let C f x y = 
000ae80: 6620 7920 783b 3b0a 0a20 206c 6574 206f  f y x;;..  let o
000ae90: 2066 2067 2078 203d 2066 2867 2078 293b   f g x = f(g x);
000aea0: 3b0a 2020 2369 6e66 6978 2022 6f22 3b3b  ;.  #infix "o";;
000aeb0: 0a0a 2020 6c65 7420 6578 706c 6f64 6520  ..  let explode 
000aec0: 7320 3d0a 2020 2020 6c65 7420 7265 6320  s =.    let rec 
000aed0: 6578 6170 206e 206c 203d 0a20 2020 2020  exap n l =.     
000aee0: 2020 2069 6620 6e20 3c20 3020 7468 656e     if n < 0 then
000aef0: 206c 2065 6c73 650a 2020 2020 2020 2020   l else.        
000af00: 6578 6170 2028 6e20 2d20 3129 2028 2873  exap (n - 1) ((s
000af10: 7562 5f73 7472 696e 6720 7320 6e20 3129  ub_string s n 1)
000af20: 3a3a 6c29 2069 6e0a 2020 2020 6578 6170  ::l) in.    exap
000af30: 2028 7374 7269 6e67 5f6c 656e 6774 6820   (string_length 
000af40: 7320 2d20 3129 205b 5d3b 3b0a 5c65 6e64  s - 1) [];;.\end
000af50: 7b76 6572 6261 7469 6d7d 5c65 6e64 7b62  {verbatim}\end{b
000af60: 6f78 6564 7d0a 0ae4 ccd1 20ce c1de c1cc  oxed}..... .....
000af70: c12c 20cf d0d2 c5c4 c5cc c9cd 20ce c5cb  ., ......... ...
000af80: cfd4 cfd2 d9c5 203c 3cc1 d4cf cdc1 d2ce  ...... <<.......
000af90: d9c5 3e3e 20c1 cec1 ccc9 dac1 d4cf d2d9  ..>> ...........
000afa0: 2e20 e6d5 cecb c3c9 d17e 7b5c 7474 2073  . .......~{\tt s
000afb0: 6f6d 657d 0ad0 d2c9 cec9 cdc1 c5d4 20cc  ome}.......... .
000afc0: c0c2 cfca 20d7 c8cf c4ce cfca 20d3 c9cd  .... ....... ...
000afd0: d7cf cc2c 20d5 c4cf d7cc c5d4 d7cf d2d1  ..., ...........
000afe0: c0dd c9ca 20da c1c4 c1ce cecf cdd5 20d0  .... ......... .
000aff0: d2c5 c4c9 cbc1 d4d5 2c20 c90a d7cf dad7  ........, ......
000b000: d2c1 ddc1 c5d4 20c5 c7cf 2e20 e6d5 cecb  ...... .... ....
000b010: c3c9 d17e 7b5c 7474 2061 7d20 d7d9 d0cf  ...~{\tt a} ....
000b020: ccce d1c5 d420 d3c8 cfd6 c5c5 20c4 c5ca  ..... ...... ...
000b030: d3d4 d7c9 c52c 20d3 20d4 cfca 20d2 c1da  ....., . ... ...
000b040: cec9 c3c5 ca2c 0ade d4cf 20cf cec1 20d0  .....,.... ... .
000b050: d2cf d7c5 d2d1 c5d4 20d7 c8cf c4ce cfca  ........ .......
000b060: 20d3 c9cd d7cf cc20 cec1 20d2 c1d7 c5ce   ...... .. .....
000b070: d3d4 d7cf 20da c1c4 c1ce cecf cdd5 2e20  .... .......... 
000b080: eec1 cbcf cec5 c32c 200a 7b5c 7474 2066  ......., .{\tt f
000b090: 696e 6973 6865 647d 20d0 d2c5 c4ce c1da  inished} .......
000b0a0: cec1 dec5 cec1 20c4 ccd1 20d0 d2cf d7c5  ...... ... .....
000b0b0: d2cb c920 d4cf c7cf 2c20 ded4 cf20 d7c5  ... ...., ... ..
000b0c0: d3d8 20d7 c8cf c4ce cfca 20d0 cfd4 cfcb  .. ....... .....
000b0d0: 20c2 d9cc 0acf c2d2 c1c2 cfd4 c1ce 2e0a   ...............
000b0e0: 2549 6e20 6f72 6465 7220 746f 2067 6574  %In order to get
000b0f0: 2073 7461 7274 6564 2c20 7765 2064 6566   started, we def
000b100: 696e 6520 6120 6665 7720 6061 746f 6d69  ine a few `atomi
000b110: 6327 2070 6172 7365 7273 2e20 5468 6520  c' parsers. The 
000b120: 6675 6e63 7469 6f6e 207b 5c74 740a 2573  function {\tt.%s
000b130: 6f6d 657d 2061 6363 6570 7473 2061 6e79  ome} accepts any
000b140: 2069 7465 6d20 7361 7469 7366 7969 6e67   item satisfying
000b150: 2061 2070 7265 6469 6361 7465 2061 6e64   a predicate and
000b160: 2072 6574 7572 6e73 2069 742e 2054 6865   returns it. The
000b170: 2066 756e 6374 696f 6e20 7b5c 7474 0a25   function {\tt.%
000b180: 617d 2069 7320 7369 6d69 6c61 722c 2062  a} is similar, b
000b190: 7574 2064 656d 616e 6473 2061 2070 6172  ut demands a par
000b1a0: 7469 6375 6c61 7220 6974 656d 2c20 616e  ticular item, an
000b1b0: 6420 6669 6e61 6c6c 7920 7b5c 7474 2066  d finally {\tt f
000b1c0: 696e 6973 6865 647d 206a 7573 740a 256d  inished} just.%m
000b1d0: 616b 6573 2073 7572 6520 7468 6572 6520  akes sure there 
000b1e0: 6172 6520 6e6f 2069 7465 6d73 206c 6566  are no items lef
000b1f0: 7420 746f 2062 6520 7061 7273 6564 2e0a  t to be parsed..
000b200: 250a 5c62 6567 696e 7b62 6f78 6564 7d5c  %.\begin{boxed}\
000b210: 6265 6769 6e7b 6c73 746c 6973 7469 6e67  begin{lstlisting
000b220: 7d0a 2020 6c65 7420 736f 6d65 2070 203d  }.  let some p =
000b230: 0a20 2020 2066 756e 205b 5d20 2d3e 2072  .    fun [] -> r
000b240: 6169 7365 204e 6f70 6172 7365 0a20 2020  aise Noparse.   
000b250: 2020 207c 2028 683a 3a74 2920 2d3e 2069     | (h::t) -> i
000b260: 6620 7020 6820 7468 656e 2028 682c 7429  f p h then (h,t)
000b270: 2065 6c73 6520 7261 6973 6520 4e6f 7061   else raise Nopa
000b280: 7273 653b 3b0a 0a20 206c 6574 2061 2074  rse;;..  let a t
000b290: 6f6b 203d 2073 6f6d 6520 2866 756e 2069  ok = some (fun i
000b2a0: 7465 6d20 2d3e 2069 7465 6d20 3d20 746f  tem -> item = to
000b2b0: 6b29 3b3b 0a0a 2020 6c65 7420 6669 6e69  k);;..  let fini
000b2c0: 7368 6564 2069 6e70 7574 203d 0a20 2020  shed input =.   
000b2d0: 2069 6620 696e 7075 7420 3d20 5b5d 2074   if input = [] t
000b2e0: 6865 6e20 302c 696e 7075 7420 656c 7365  hen 0,input else
000b2f0: 2072 6169 7365 204e 6f70 6172 7365 3b3b   raise Noparse;;
000b300: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
000b310: 7d5c 656e 647b 626f 7865 647d 0a0a 5c73  }\end{boxed}..\s
000b320: 7562 7365 6374 696f 6e7b 4c65 7869 6361  ubsection{Lexica
000b330: 6c20 616e 616c 7973 6973 7d0a 0a4f 7572  l analysis}..Our
000b340: 2070 6172 7369 6e67 2063 6f6d 6269 6e61   parsing combina
000b350: 746f 7273 2063 616e 2065 6173 696c 7920  tors can easily 
000b360: 6265 2075 7365 642c 2069 6e20 636f 6e6a  be used, in conj
000b370: 756e 6374 696f 6e20 7769 7468 2061 2066  unction with a f
000b380: 6577 2073 696d 706c 650a 6368 6172 6163  ew simple.charac
000b390: 7465 7220 6469 7363 7269 6d69 6e61 7469  ter discriminati
000b3a0: 6f6e 2066 756e 6374 696f 6e73 2c20 746f  on functions, to
000b3b0: 2063 6f6e 7374 7275 6374 2061 206c 6578   construct a lex
000b3c0: 6963 616c 2061 6e61 6c79 7a65 7220 666f  ical analyzer fo
000b3d0: 7220 6f75 720a 6c61 6e67 7561 6765 206f  r our.language o
000b3e0: 6620 7465 726d 732e 2057 6520 6465 6669  f terms. We defi
000b3f0: 6e65 2061 2074 7970 6520 6f66 207b 5c65  ne a type of {\e
000b400: 6d20 746f 6b65 6e73 7d20 286f 7220 6c65  m tokens} (or le
000b410: 7865 6d65 7329 2c20 616e 6420 7468 6520  xemes), and the 
000b420: 6c65 7865 720a 7472 616e 736c 6174 6573  lexer.translates
000b430: 2074 6865 2069 6e70 7574 2073 7472 696e   the input strin
000b440: 6720 696e 746f 2061 206c 6973 7420 6f66  g into a list of
000b450: 2074 6f6b 656e 732e 2054 6865 2060 6f74   tokens. The `ot
000b460: 6865 7227 2063 6173 6573 2063 6f76 6572  her' cases cover
000b470: 0a73 796d 626f 6c69 6320 6964 656e 7469  .symbolic identi
000b480: 6669 6572 733b 2074 6865 7920 6172 6520  fiers; they are 
000b490: 616c 6c20 7374 7261 6967 6874 666f 7277  all straightforw
000b4a0: 6172 6420 6173 2074 6865 7920 636f 6e73  ard as they cons
000b4b0: 6973 7420 6f66 206a 7573 7420 610a 7369  ist of just a.si
000b4c0: 6e67 6c65 2063 6861 7261 6374 6572 2c20  ngle character, 
000b4d0: 7261 7468 6572 2074 6861 6e20 636f 6d70  rather than comp
000b4e0: 6f73 6974 6520 6f6e 6573 206c 696b 6520  osite ones like 
000b4f0: 607b 5c76 6572 6221 3a3d 217d 272e 0a0a  `{\verb!:=!}'...
000b500: 5c62 6567 696e 7b62 6f78 6564 7d5c 6265  \begin{boxed}\be
000b510: 6769 6e7b 6c73 746c 6973 7469 6e67 7d0a  gin{lstlisting}.
000b520: 2020 7479 7065 2074 6f6b 656e 203d 204e    type token = N
000b530: 616d 6520 6f66 2073 7472 696e 6720 7c20  ame of string | 
000b540: 4e75 6d20 6f66 2073 7472 696e 6720 7c20  Num of string | 
000b550: 4f74 6865 7220 6f66 2073 7472 696e 673b  Other of string;
000b560: 3b0a 0a20 206c 6574 206c 6578 203d 0a20  ;..  let lex =. 
000b570: 2020 206c 6574 2073 6576 6572 616c 2070     let several p
000b580: 203d 206d 616e 7920 2873 6f6d 6520 7029   = many (some p)
000b590: 2069 6e0a 2020 2020 6c65 7420 6c6f 7765   in.    let lowe
000b5a0: 7263 6173 655f 6c65 7474 6572 2073 203d  rcase_letter s =
000b5b0: 2022 6122 203c 3d20 7320 2620 7320 3c3d   "a" <= s & s <=
000b5c0: 2022 7a22 2069 6e0a 2020 2020 6c65 7420   "z" in.    let 
000b5d0: 7570 7065 7263 6173 655f 6c65 7474 6572  uppercase_letter
000b5e0: 2073 203d 2022 4122 203c 3d20 7320 2620   s = "A" <= s & 
000b5f0: 7320 3c3d 2022 5a22 2069 6e0a 2020 2020  s <= "Z" in.    
000b600: 6c65 7420 6c65 7474 6572 2073 203d 206c  let letter s = l
000b610: 6f77 6572 6361 7365 5f6c 6574 7465 7220  owercase_letter 
000b620: 7320 6f72 2075 7070 6572 6361 7365 5f6c  s or uppercase_l
000b630: 6574 7465 7220 7320 696e 0a20 2020 206c  etter s in.    l
000b640: 6574 2061 6c70 6861 2073 203d 206c 6574  et alpha s = let
000b650: 7465 7220 7320 6f72 2073 203d 2022 5f22  ter s or s = "_"
000b660: 206f 7220 7320 3d20 2227 2220 696e 0a20   or s = "'" in. 
000b670: 2020 206c 6574 2064 6967 6974 2073 203d     let digit s =
000b680: 2022 3022 203c 3d20 7320 2620 7320 3c3d   "0" <= s & s <=
000b690: 2022 3922 2069 6e0a 2020 2020 6c65 7420   "9" in.    let 
000b6a0: 616c 7068 616e 756d 2073 203d 2061 6c70  alphanum s = alp
000b6b0: 6861 2073 206f 7220 6469 6769 7420 7320  ha s or digit s 
000b6c0: 696e 0a20 2020 206c 6574 2073 7061 6365  in.    let space
000b6d0: 2073 203d 2073 203d 2022 2022 206f 7220   s = s = " " or 
000b6e0: 7320 3d20 225c 6e22 206f 7220 7320 3d20  s = "\n" or s = 
000b6f0: 225c 7422 2069 6e0a 2020 2020 6c65 7420  "\t" in.    let 
000b700: 636f 6c6c 6563 7428 682c 7429 203d 2068  collect(h,t) = h
000b710: 5e28 6974 6c69 7374 2028 7072 6566 6978  ^(itlist (prefix
000b720: 205e 2920 7420 2222 2920 696e 0a20 2020   ^) t "") in.   
000b730: 206c 6574 2072 6177 6e61 6d65 203d 0a20   let rawname =. 
000b740: 2020 2020 2020 736f 6d65 2061 6c70 6861        some alpha
000b750: 202b 2b20 7365 7665 7261 6c20 616c 7068   ++ several alph
000b760: 616e 756d 203e 3e20 284e 616d 6520 6f20  anum >> (Name o 
000b770: 636f 6c6c 6563 7429 2069 6e0a 2020 2020  collect) in.    
000b780: 6c65 7420 7261 776e 756d 6572 616c 203d  let rawnumeral =
000b790: 0a20 2020 2020 2020 736f 6d65 2064 6967  .       some dig
000b7a0: 6974 202b 2b20 7365 7665 7261 6c20 6469  it ++ several di
000b7b0: 6769 7420 3e3e 2028 4e75 6d20 6f20 636f  git >> (Num o co
000b7c0: 6c6c 6563 7429 2069 6e0a 2020 2020 6c65  llect) in.    le
000b7d0: 7420 7261 776f 7468 6572 203d 2073 6f6d  t rawother = som
000b7e0: 6520 284b 2074 7275 6529 203e 3e20 4f74  e (K true) >> Ot
000b7f0: 6865 7220 696e 0a20 2020 206c 6574 2074  her in.    let t
000b800: 6f6b 656e 203d 0a20 2020 2020 2028 7261  oken =.      (ra
000b810: 776e 616d 6520 7c7c 2072 6177 6e75 6d65  wname || rawnume
000b820: 7261 6c20 7c7c 2072 6177 6f74 6865 7229  ral || rawother)
000b830: 202b 2b20 7365 7665 7261 6c20 7370 6163   ++ several spac
000b840: 6520 3e3e 2066 7374 2069 6e0a 2020 2020  e >> fst in.    
000b850: 6c65 7420 746f 6b65 6e73 203d 2028 7365  let tokens = (se
000b860: 7665 7261 6c20 7370 6163 6520 2b2b 206d  veral space ++ m
000b870: 616e 7920 746f 6b65 6e29 203e 3e20 736e  any token) >> sn
000b880: 6420 696e 0a20 2020 206c 6574 2061 6c6c  d in.    let all
000b890: 746f 6b65 6e73 203d 2028 746f 6b65 6e73  tokens = (tokens
000b8a0: 202b 2b20 6669 6e69 7368 6564 2920 3e3e   ++ finished) >>
000b8b0: 2066 7374 2069 6e0a 2020 2020 6673 7420   fst in.    fst 
000b8c0: 6f20 616c 6c74 6f6b 656e 7320 6f20 6578  o alltokens o ex
000b8d0: 706c 6f64 653b 3b0a 5c65 6e64 7b6c 7374  plode;;.\end{lst
000b8e0: 6c69 7374 696e 677d 5c65 6e64 7b62 6f78  listing}\end{box
000b8f0: 6564 7d0a 0a5c 6e6f 696e 6465 6e74 2046  ed}..\noindent F
000b900: 6f72 2065 7861 6d70 6c65 3a0a 0a5c 6265  or example:..\be
000b910: 6769 6e7b 626f 7865 647d 5c62 6567 696e  gin{boxed}\begin
000b920: 7b76 6572 6261 7469 6d7d 0a20 2023 6c65  {verbatim}.  #le
000b930: 7820 2273 696e 2878 202b 2079 2920 2a20  x "sin(x + y) * 
000b940: 636f 7328 3220 2a20 7820 2b20 7929 223b  cos(2 * x + y)";
000b950: 3b0a 2020 202d 203a 2074 6f6b 656e 206c  ;.   - : token l
000b960: 6973 7420 3d0a 2020 205b 4e61 6d65 2022  ist =.   [Name "
000b970: 7369 6e22 3b20 4f74 6865 7220 2228 223b  sin"; Other "(";
000b980: 204e 616d 6520 2278 223b 204f 7468 6572   Name "x"; Other
000b990: 2022 2b22 3b20 4e61 6d65 2022 7922 3b20   "+"; Name "y"; 
000b9a0: 4f74 6865 7220 2229 223b 0a20 2020 204f  Other ")";.    O
000b9b0: 7468 6572 2022 2a22 3b20 4e61 6d65 2022  ther "*"; Name "
000b9c0: 636f 7322 3b20 4f74 6865 7220 2228 223b  cos"; Other "(";
000b9d0: 204e 756d 2022 3222 3b20 4f74 6865 7220   Num "2"; Other 
000b9e0: 222a 223b 204e 616d 6520 2278 223b 0a20  "*"; Name "x";. 
000b9f0: 2020 204f 7468 6572 2022 2b22 3b20 4e61     Other "+"; Na
000ba00: 6d65 2022 7922 3b20 4f74 6865 7220 2229  me "y"; Other ")
000ba10: 225d 0a5c 656e 647b 7665 7262 6174 696d  "].\end{verbatim
000ba20: 7d5c 656e 647b 626f 7865 647d 0a0a 5c73  }\end{boxed}..\s
000ba30: 7562 7365 6374 696f 6e7b 5061 7273 696e  ubsection{Parsin
000ba40: 6720 7465 726d 737d 0a0a 5369 6e63 6520  g terms}..Since 
000ba50: 7765 2061 7265 206e 6f77 2077 6f72 6b69  we are now worki
000ba60: 6e67 2061 7420 7468 6520 6c65 7665 6c20  ng at the level 
000ba70: 6f66 2074 6f6b 656e 732c 2077 6520 6465  of tokens, we de
000ba80: 6669 6e65 2074 7269 7669 616c 2070 6172  fine trivial par
000ba90: 7365 7273 2074 6f0a 6163 6365 7074 2074  sers to.accept t
000baa0: 6f6b 656e 7320 6f66 2028 6f6e 6c79 2920  okens of (only) 
000bab0: 6120 6365 7274 6169 6e20 6b69 6e64 3a0a  a certain kind:.
000bac0: 0a5c 6265 6769 6e7b 626f 7865 647d 5c62  .\begin{boxed}\b
000bad0: 6567 696e 7b6c 7374 6c69 7374 696e 677d  egin{lstlisting}
000bae0: 0a20 206c 6574 206e 616d 6520 3d0a 2020  .  let name =.  
000baf0: 2020 6675 6e20 284e 616d 6520 733a 3a72    fun (Name s::r
000bb00: 6573 7429 202d 3e20 732c 7265 7374 0a20  est) -> s,rest. 
000bb10: 2020 2020 207c 205f 202d 3e20 7261 6973       | _ -> rais
000bb20: 6520 4e6f 7061 7273 653b 3b0a 0a20 206c  e Noparse;;..  l
000bb30: 6574 206e 756d 6572 616c 203d 0a20 2020  et numeral =.   
000bb40: 2066 756e 2028 4e75 6d20 733a 3a72 6573   fun (Num s::res
000bb50: 7429 202d 3e20 732c 7265 7374 0a20 2020  t) -> s,rest.   
000bb60: 2020 207c 205f 202d 3e20 7261 6973 6520     | _ -> raise 
000bb70: 4e6f 7061 7273 653b 3b0a 0a20 206c 6574  Noparse;;..  let
000bb80: 206f 7468 6572 203d 0a20 2020 2066 756e   other =.    fun
000bb90: 2028 4f74 6865 7220 733a 3a72 6573 7429   (Other s::rest)
000bba0: 202d 3e20 732c 7265 7374 0a20 2020 2020   -> s,rest.     
000bbb0: 207c 205f 202d 3e20 7261 6973 6520 4e6f   | _ -> raise No
000bbc0: 7061 7273 653b 3b0a 5c65 6e64 7b6c 7374  parse;;.\end{lst
000bbd0: 6c69 7374 696e 677d 5c65 6e64 7b62 6f78  listing}\end{box
000bbe0: 6564 7d0a 0a5c 6e6f 696e 6465 6e74 204e  ed}..\noindent N
000bbf0: 6f77 2077 6520 6361 6e20 6465 6669 6e65  ow we can define
000bc00: 2061 2070 6172 7365 7220 666f 7220 7465   a parser for te
000bc10: 726d 732c 2069 6e20 6120 666f 726d 2076  rms, in a form v
000bc20: 6572 7920 7369 6d69 6c61 7220 746f 2074  ery similar to t
000bc30: 6865 0a6f 7269 6769 6e61 6c20 6772 616d  he.original gram
000bc40: 6d61 722e 2054 6865 206d 6169 6e20 6469  mar. The main di
000bc50: 6666 6572 656e 6365 2069 7320 7468 6174  fference is that
000bc60: 2065 6163 6820 7072 6f64 7563 7469 6f6e   each production
000bc70: 2072 756c 6520 6861 730a 6173 736f 6369   rule has.associ
000bc80: 6174 6564 2077 6974 6820 6974 2073 6f6d  ated with it som
000bc90: 6520 736f 7274 206f 6620 7370 6563 6961  e sort of specia
000bca0: 6c20 6163 7469 6f6e 2074 6f20 7461 6b65  l action to take
000bcb0: 2061 7320 6120 7265 7375 6c74 206f 6620   as a result of 
000bcc0: 7061 7273 696e 672e 0a0a 5c62 6567 696e  parsing...\begin
000bcd0: 7b62 6f78 6564 7d5c 6265 6769 6e7b 6c73  {boxed}\begin{ls
000bce0: 746c 6973 7469 6e67 7d0a 2020 6c65 7420  tlisting}.  let 
000bcf0: 7265 6320 6174 6f6d 2069 6e70 7574 0a20  rec atom input. 
000bd00: 2020 2020 2020 2020 3d20 286e 616d 6520          = (name 
000bd10: 2b2b 2061 2028 4f74 6865 7220 2228 2229  ++ a (Other "(")
000bd20: 202b 2b20 7465 726d 6c69 7374 202b 2b20   ++ termlist ++ 
000bd30: 6120 284f 7468 6572 2022 2922 290a 2020  a (Other ")").  
000bd40: 2020 2020 2020 2020 2020 2020 2020 3e3e                >>
000bd50: 2028 6675 6e20 2828 286e 616d 652c 5f29   (fun (((name,_)
000bd60: 2c61 7267 7329 2c5f 2920 2d3e 2046 6e28  ,args),_) -> Fn(
000bd70: 6e61 6d65 2c61 7267 7329 290a 2020 2020  name,args)).    
000bd80: 2020 2020 207c 7c20 6e61 6d65 0a20 2020       || name.   
000bd90: 2020 2020 2020 2020 2020 2020 203e 3e20               >> 
000bda0: 2866 756e 2073 202d 3e20 5661 7220 7329  (fun s -> Var s)
000bdb0: 0a20 2020 2020 2020 2020 7c7c 206e 756d  .         || num
000bdc0: 6572 616c 0a20 2020 2020 2020 2020 2020  eral.           
000bdd0: 2020 2020 203e 3e20 2866 756e 2073 202d       >> (fun s -
000bde0: 3e20 436f 6e73 7420 7329 0a20 2020 2020  > Const s).     
000bdf0: 2020 2020 7c7c 2061 2028 4f74 6865 7220      || a (Other 
000be00: 2228 2229 202b 2b20 7465 726d 202b 2b20  "(") ++ term ++ 
000be10: 6120 284f 7468 6572 2022 2922 290a 2020  a (Other ")").  
000be20: 2020 2020 2020 2020 2020 2020 2020 3e3e                >>
000be30: 2028 736e 6420 6f20 6673 7429 0a20 2020   (snd o fst).   
000be40: 2020 2020 2020 7c7c 2061 2028 4f74 6865        || a (Othe
000be50: 7220 222d 2229 202b 2b20 6174 6f6d 0a20  r "-") ++ atom. 
000be60: 2020 2020 2020 2020 2020 2020 2020 203e                 >
000be70: 3e20 736e 6429 2069 6e70 7574 0a20 2020  > snd) input.   
000be80: 2061 6e64 206d 756c 6578 7020 696e 7075   and mulexp inpu
000be90: 740a 2020 2020 2020 2020 203d 2028 6174  t.         = (at
000bea0: 6f6d 202b 2b20 6128 4f74 6865 7220 222a  om ++ a(Other "*
000beb0: 2229 202b 2b20 6d75 6c65 7870 0a20 2020  ") ++ mulexp.   
000bec0: 2020 2020 2020 2020 2020 2020 203e 3e20               >> 
000bed0: 2866 756e 2028 2861 2c5f 292c 6d29 202d  (fun ((a,_),m) -
000bee0: 3e20 466e 2822 2a22 2c5b 613b 6d5d 2929  > Fn("*",[a;m]))
000bef0: 0a20 2020 2020 2020 2020 7c7c 2061 746f  .         || ato
000bf00: 6d29 2069 6e70 7574 0a20 2020 2061 6e64  m) input.    and
000bf10: 2074 6572 6d20 696e 7075 740a 2020 2020   term input.    
000bf20: 2020 2020 203d 2028 6d75 6c65 7870 202b       = (mulexp +
000bf30: 2b20 6128 4f74 6865 7220 222b 2229 202b  + a(Other "+") +
000bf40: 2b20 7465 726d 0a20 2020 2020 2020 2020  + term.         
000bf50: 2020 2020 2020 203e 3e20 2866 756e 2028         >> (fun (
000bf60: 2861 2c5f 292c 6d29 202d 3e20 466e 2822  (a,_),m) -> Fn("
000bf70: 2b22 2c5b 613b 6d5d 2929 0a20 2020 2020  +",[a;m])).     
000bf80: 2020 2020 7c7c 206d 756c 6578 7029 2069      || mulexp) i
000bf90: 6e70 7574 0a20 2020 2061 6e64 2074 6572  nput.    and ter
000bfa0: 6d6c 6973 7420 696e 7075 740a 2020 2020  mlist input.    
000bfb0: 2020 2020 203d 2028 7465 726d 202b 2b20       = (term ++ 
000bfc0: 6120 284f 7468 6572 2022 2c22 2920 2b2b  a (Other ",") ++
000bfd0: 2074 6572 6d6c 6973 740a 2020 2020 2020   termlist.      
000bfe0: 2020 2020 2020 2020 2020 3e3e 2028 6675            >> (fu
000bff0: 6e20 2828 682c 5f29 2c74 2920 2d3e 2068  n ((h,_),t) -> h
000c000: 3a3a 7429 0a20 2020 2020 2020 2020 7c7c  ::t).         ||
000c010: 2074 6572 6d0a 2020 2020 2020 2020 2020   term.          
000c020: 2020 2020 2020 3e3e 2028 6675 6e20 6820        >> (fun h 
000c030: 2d3e 205b 685d 2929 2069 6e70 7574 3b3b  -> [h])) input;;
000c040: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
000c050: 7d5c 656e 647b 626f 7865 647d 0a0a 5c6e  }\end{boxed}..\n
000c060: 6f69 6e64 656e 7420 4c65 7420 7573 2070  oindent Let us p
000c070: 6163 6b61 6765 2065 7665 7279 7468 696e  ackage everythin
000c080: 6720 7570 2061 7320 6120 7369 6e67 6c65  g up as a single
000c090: 2070 6172 7369 6e67 2066 756e 6374 696f   parsing functio
000c0a0: 6e3a 0a0a 5c62 6567 696e 7b62 6f78 6564  n:..\begin{boxed
000c0b0: 7d5c 6265 6769 6e7b 6c73 746c 6973 7469  }\begin{lstlisti
000c0c0: 6e67 7d0a 2020 6c65 7420 7061 7273 6572  ng}.  let parser
000c0d0: 203d 2066 7374 206f 2028 7465 726d 202b   = fst o (term +
000c0e0: 2b20 6669 6e69 7368 6564 203e 3e20 6673  + finished >> fs
000c0f0: 7429 206f 206c 6578 3b3b 0a5c 656e 647b  t) o lex;;.\end{
000c100: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
000c110: 626f 7865 647d 0a0a 5c6e 6f69 6e64 656e  boxed}..\noinden
000c120: 7420 546f 2073 6565 2069 7420 696e 2061  t To see it in a
000c130: 6374 696f 6e2c 2077 6520 7472 7920 7769  ction, we try wi
000c140: 7468 2061 6e64 2077 6974 686f 7574 2074  th and without t
000c150: 6865 2070 7269 6e74 6572 2028 7365 6520  he printer (see 
000c160: 6162 6f76 6529 0a69 6e73 7461 6c6c 6564  above).installed
000c170: 3a0a 0a5c 6265 6769 6e7b 626f 7865 647d  :..\begin{boxed}
000c180: 5c62 6567 696e 7b76 6572 6261 7469 6d7d  \begin{verbatim}
000c190: 0a20 2023 7061 7273 6572 2022 7369 6e28  .  #parser "sin(
000c1a0: 7820 2b20 7929 202a 2063 6f73 2832 202a  x + y) * cos(2 *
000c1b0: 2078 202b 2079 2922 3b3b 0a20 202d 203a   x + y)";;.  - :
000c1c0: 2074 6572 6d20 3d0a 2020 2046 6e0a 2020   term =.   Fn.  
000c1d0: 2020 2822 2a22 2c0a 2020 2020 205b 466e    ("*",.     [Fn
000c1e0: 2028 2273 696e 222c 205b 466e 2028 222b   ("sin", [Fn ("+
000c1f0: 222c 205b 5661 7220 2278 223b 2056 6172  ", [Var "x"; Var
000c200: 2022 7922 5d29 5d29 3b0a 2020 2020 2020   "y"])]);.      
000c210: 466e 2028 2263 6f73 222c 205b 466e 2028  Fn ("cos", [Fn (
000c220: 222b 222c 205b 466e 2028 222a 222c 205b  "+", [Fn ("*", [
000c230: 436f 6e73 7420 2232 223b 2056 6172 2022  Const "2"; Var "
000c240: 7822 5d29 3b0a 2020 2020 2020 2020 2020  x"]);.          
000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
000c260: 2020 5661 7220 2279 225d 295d 295d 290a    Var "y"])])]).
000c270: 2020 2369 6e73 7461 6c6c 5f70 7269 6e74    #install_print
000c280: 6572 2022 7072 696e 745f 7465 726d 223b  er "print_term";
000c290: 3b0a 2020 2d20 3a20 756e 6974 203d 2028  ;.  - : unit = (
000c2a0: 290a 2020 2370 6172 7365 7220 2273 696e  ).  #parser "sin
000c2b0: 2878 202b 2079 2920 2a20 636f 7328 3220  (x + y) * cos(2 
000c2c0: 2a20 7820 2b20 7929 223b 3b0a 2020 2d20  * x + y)";;.  - 
000c2d0: 3a20 7465 726d 203d 2060 7369 6e28 7820  : term = `sin(x 
000c2e0: 2b20 7929 202a 2063 6f73 2832 202a 2078  + y) * cos(2 * x
000c2f0: 202b 2079 2960 0a5c 656e 647b 7665 7262   + y)`.\end{verb
000c300: 6174 696d 7d5c 656e 647b 626f 7865 647d  atim}\end{boxed}
000c310: 0a0a 5c73 7562 7365 6374 696f 6e7b 4175  ..\subsection{Au
000c320: 746f 6d61 7469 6320 7072 6563 6564 656e  tomatic preceden
000c330: 6365 2070 6172 7369 6e67 7d0a 0a49 6e20  ce parsing}..In 
000c340: 7468 6520 6162 6f76 6520 7061 7273 6572  the above parser
000c350: 2c20 7765 2060 6861 7264 7769 7265 6427  , we `hardwired'
000c360: 2061 2070 6172 7365 7220 666f 7220 7468   a parser for th
000c370: 6520 7477 6f20 696e 6669 7820 6f70 6572  e two infix oper
000c380: 6174 6f72 732e 0a48 6f77 6576 6572 2069  ators..However i
000c390: 7420 776f 756c 6420 6265 206e 6963 6572  t would be nicer
000c3a0: 2c20 616e 6420 636f 6e73 6973 7465 6e74  , and consistent
000c3b0: 2077 6974 6820 6f75 7220 6170 7072 6f61   with our approa
000c3c0: 6368 2074 6f20 7072 696e 7469 6e67 2c20  ch to printing, 
000c3d0: 6966 0a63 6861 6e67 6573 2074 6f20 7468  if.changes to th
000c3e0: 6520 7365 7420 6f66 2069 6e66 6978 6573  e set of infixes
000c3f0: 2063 6f75 6c64 2070 726f 7061 6761 7465   could propagate
000c400: 2074 6f20 7468 6520 7061 7273 6572 2e20   to the parser. 
000c410: 4d6f 7265 6f76 6572 2c20 6576 656e 0a77  Moreover, even.w
000c420: 6974 6820 6a75 7374 2074 776f 2064 6966  ith just two dif
000c430: 6665 7265 6e74 2062 696e 6172 7920 6f70  ferent binary op
000c440: 6572 6174 6f72 732c 206f 7572 2070 726f  erators, our pro
000c450: 6475 6374 696f 6e20 7275 6c65 7320 616e  duction rules an
000c460: 6420 636f 6e73 6571 7565 6e74 0a70 6172  d consequent.par
000c470: 7365 7220 7765 7265 2061 6c72 6561 6479  ser were already
000c480: 2073 7461 7274 696e 6720 746f 206c 6f6f   starting to loo
000c490: 6b20 6172 7469 6669 6369 616c 3b20 696d  k artificial; im
000c4a0: 6167 696e 6520 6966 2077 6520 6861 6420  agine if we had 
000c4b0: 6120 646f 7a65 6e20 6f72 0a73 6f2e 2057  a dozen or.so. W
000c4c0: 6861 7420 7765 2077 6f75 6c64 206c 696b  hat we would lik
000c4d0: 6520 6973 2074 6f20 6175 746f 6d61 7465  e is to automate
000c4e0: 2074 6865 2070 726f 6475 6374 696f 6e20   the production 
000c4f0: 6f66 2061 206c 6179 6572 206f 6620 7061  of a layer of pa
000c500: 7273 6572 732c 206f 6e65 0a66 6f72 2065  rsers, one.for e
000c510: 6163 6820 6f70 6572 6174 6f72 2c20 696e  ach operator, in
000c520: 206f 7264 6572 206f 6620 7072 6563 6564   order of preced
000c530: 656e 6365 2e20 5468 6973 2063 616e 2065  ence. This can e
000c540: 6173 696c 7920 6265 2064 6f6e 652e 2046  asily be done. F
000c550: 6972 7374 2c20 7765 0a64 6566 696e 6520  irst, we.define 
000c560: 6120 6765 6e65 7261 6c20 6675 6e63 7469  a general functi
000c570: 6f6e 2074 6861 7420 7461 6b65 7320 6120  on that takes a 
000c580: 7061 7273 6572 2066 6f72 2077 6861 742c  parser for what,
000c590: 2061 7420 7468 6973 206c 6576 656c 2c20   at this level, 
000c5a0: 6172 650a 7265 6761 7264 6564 2061 7320  are.regarded as 
000c5b0: 6174 6f6d 6963 2065 7870 7265 7373 696f  atomic expressio
000c5c0: 6e73 2c20 616e 6420 7072 6f64 7563 6573  ns, and produces
000c5d0: 2061 206e 6577 2070 6172 7365 7220 666f   a new parser fo
000c5e0: 7220 7375 6368 2065 7870 7265 7373 696f  r such expressio
000c5f0: 6e73 0a73 6570 6172 6174 6564 2062 7920  ns.separated by 
000c600: 6120 6769 7665 6e20 6f70 6572 6174 6f72  a given operator
000c610: 2e20 4e6f 7465 2074 6861 7420 7468 6973  . Note that this
000c620: 2063 6f75 6c64 2061 6c73 6f20 6265 2064   could also be d
000c630: 6566 696e 6564 2075 7369 6e67 0a70 6172  efined using.par
000c640: 7369 6e67 2063 6f6d 6269 6e61 746f 7273  sing combinators
000c650: 2c20 6275 7420 7468 6520 6675 6e63 7469  , but the functi
000c660: 6f6e 2062 656c 6f77 2069 7320 7369 6d70  on below is simp
000c670: 6c65 2061 6e64 206d 6f72 6520 6566 6669  le and more effi
000c680: 6369 656e 742e 0a0a 5c62 6567 696e 7b62  cient...\begin{b
000c690: 6f78 6564 7d5c 6265 6769 6e7b 6c73 746c  oxed}\begin{lstl
000c6a0: 6973 7469 6e67 7d0a 2020 6c65 7420 7265  isting}.  let re
000c6b0: 6320 6269 6e6f 7020 6f70 2070 6172 7365  c binop op parse
000c6c0: 7220 696e 7075 7420 3d0a 2020 2020 6c65  r input =.    le
000c6d0: 7420 6174 6f6d 312c 7265 7374 3120 6173  t atom1,rest1 as
000c6e0: 2072 6573 756c 7420 3d20 7061 7273 6572   result = parser
000c6f0: 2069 6e70 7574 2069 6e0a 2020 2020 6966   input in.    if
000c700: 206e 6f74 2072 6573 7431 203d 205b 5d20   not rest1 = [] 
000c710: 2620 6864 2072 6573 7431 203d 204f 7468  & hd rest1 = Oth
000c720: 6572 206f 7020 7468 656e 0a20 2020 2020  er op then.     
000c730: 206c 6574 2061 746f 6d32 2c72 6573 7432   let atom2,rest2
000c740: 203d 2062 696e 6f70 206f 7020 7061 7273   = binop op pars
000c750: 6572 2028 746c 2072 6573 7431 2920 696e  er (tl rest1) in
000c760: 0a20 2020 2020 2046 6e28 6f70 2c5b 6174  .      Fn(op,[at
000c770: 6f6d 313b 2061 746f 6d32 5d29 2c72 6573  om1; atom2]),res
000c780: 7432 0a20 2020 2065 6c73 6520 7265 7375  t2.    else resu
000c790: 6c74 3b3b 0a5c 656e 647b 6c73 746c 6973  lt;;.\end{lstlis
000c7a0: 7469 6e67 7d5c 656e 647b 626f 7865 647d  ting}\end{boxed}
000c7b0: 0a0a 4e6f 7720 7765 2064 6566 696e 6520  ..Now we define 
000c7c0: 6675 6e63 7469 6f6e 7320 7468 6174 2070  functions that p
000c7d0: 6963 6b20 6f75 7420 7468 6520 696e 6669  ick out the infi
000c7e0: 7820 6f70 6572 6174 6f72 2069 6e20 6f75  x operator in ou
000c7f0: 7220 6173 736f 6369 6174 696f 6e0a 6c69  r association.li
000c800: 7374 2077 6974 6820 2865 7175 616c 2920  st with (equal) 
000c810: 6c6f 7765 7374 2070 7265 6365 6465 6e63  lowest precedenc
000c820: 652c 2061 6e64 2064 656c 6574 6520 6974  e, and delete it
000c830: 2066 726f 6d20 7468 6520 6c69 7374 2e20   from the list. 
000c840: 4966 2077 650a 6d61 696e 7461 696e 6564  If we.maintained
000c850: 2074 6865 206c 6973 7420 616c 7265 6164   the list alread
000c860: 7920 736f 7274 6564 2069 6e20 7072 6563  y sorted in prec
000c870: 6564 656e 6365 206f 7264 6572 2c20 7765  edence order, we
000c880: 2063 6f75 6c64 2073 696d 706c 7920 7461   could simply ta
000c890: 6b65 0a74 6865 2068 6561 6420 616e 6420  ke.the head and 
000c8a0: 7461 696c 206f 6620 7468 6520 6c69 7374  tail of the list
000c8b0: 2e0a 0a5c 6265 6769 6e7b 626f 7865 647d  ...\begin{boxed}
000c8c0: 5c62 6567 696e 7b6c 7374 6c69 7374 696e  \begin{lstlistin
000c8d0: 677d 0a20 206c 6574 2066 696e 646d 696e  g}.  let findmin
000c8e0: 206c 203d 2069 746c 6973 740a 2020 2020   l = itlist.    
000c8f0: 2866 756e 2028 5f2c 7072 3120 6173 2070  (fun (_,pr1 as p
000c900: 3129 2028 5f2c 7072 3220 6173 2070 3229  1) (_,pr2 as p2)
000c910: 202d 3e20 6966 2070 7231 203c 3d20 7072   -> if pr1 <= pr
000c920: 3220 7468 656e 2070 3120 656c 7365 2070  2 then p1 else p
000c930: 3229 0a20 2020 2028 746c 206c 2920 2868  2).    (tl l) (h
000c940: 6420 6c29 3b3b 0a0a 2020 6c65 7420 7265  d l);;..  let re
000c950: 6320 6465 6c65 7465 2078 2028 683a 3a74  c delete x (h::t
000c960: 2920 3d20 6966 2068 203d 2078 2074 6865  ) = if h = x the
000c970: 6e20 7420 656c 7365 2068 3a3a 2864 656c  n t else h::(del
000c980: 6574 6520 7820 7429 3b3b 0a5c 656e 647b  ete x t);;.\end{
000c990: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
000c9a0: 626f 7865 647d 0a0a 5c6e 6f69 6e64 656e  boxed}..\noinden
000c9b0: 7420 4e6f 7720 7765 2063 616e 2064 6566  t Now we can def
000c9c0: 696e 6520 7468 6520 6765 6e65 7269 6320  ine the generic 
000c9d0: 7072 6563 6564 656e 6365 2070 6172 7365  precedence parse
000c9e0: 723a 0a0a 5c62 6567 696e 7b62 6f78 6564  r:..\begin{boxed
000c9f0: 7d5c 6265 6769 6e7b 6c73 746c 6973 7469  }\begin{lstlisti
000ca00: 6e67 7d0a 2020 6c65 7420 7265 6320 7072  ng}.  let rec pr
000ca10: 6563 6564 656e 6365 2069 6c69 7374 2070  ecedence ilist p
000ca20: 6172 7365 7220 696e 7075 7420 3d0a 2020  arser input =.  
000ca30: 2020 6966 2069 6c69 7374 203d 205b 5d20    if ilist = [] 
000ca40: 7468 656e 2070 6172 7365 7220 696e 7075  then parser inpu
000ca50: 7420 656c 7365 0a20 2020 206c 6574 206f  t else.    let o
000ca60: 7070 203d 2066 696e 646d 696e 2069 6c69  pp = findmin ili
000ca70: 7374 2069 6e0a 2020 2020 6c65 7420 696c  st in.    let il
000ca80: 6973 7427 203d 2064 656c 6574 6520 6f70  ist' = delete op
000ca90: 7020 696c 6973 7420 696e 0a20 2020 2062  p ilist in.    b
000caa0: 696e 6f70 2028 6673 7420 6f70 7029 2028  inop (fst opp) (
000cab0: 7072 6563 6564 656e 6365 2069 6c69 7374  precedence ilist
000cac0: 2720 7061 7273 6572 2920 696e 7075 743b  ' parser) input;
000cad0: 3b0a 5c65 6e64 7b6c 7374 6c69 7374 696e  ;.\end{lstlistin
000cae0: 677d 5c65 6e64 7b62 6f78 6564 7d0a 0a5c  g}\end{boxed}..\
000caf0: 6e6f 696e 6465 6e74 2061 6e64 2068 656e  noindent and hen
000cb00: 6365 2063 616e 206d 6f64 6966 7920 7468  ce can modify th
000cb10: 6520 6d61 696e 2070 6172 7365 7220 746f  e main parser to
000cb20: 2062 6520 626f 7468 2073 696d 706c 6572   be both simpler
000cb30: 2061 6e64 206d 6f72 650a 6765 6e65 7261   and more.genera
000cb40: 6c3a 0a0a 5c62 6567 696e 7b62 6f78 6564  l:..\begin{boxed
000cb50: 7d5c 6265 6769 6e7b 6c73 746c 6973 7469  }\begin{lstlisti
000cb60: 6e67 7d0a 2020 6c65 7420 7265 6320 6174  ng}.  let rec at
000cb70: 6f6d 2069 6e70 7574 0a20 2020 2020 2020  om input.       
000cb80: 2020 3d20 286e 616d 6520 2b2b 2061 2028    = (name ++ a (
000cb90: 4f74 6865 7220 2228 2229 202b 2b20 7465  Other "(") ++ te
000cba0: 726d 6c69 7374 202b 2b20 6120 284f 7468  rmlist ++ a (Oth
000cbb0: 6572 2022 2922 290a 2020 2020 2020 2020  er ")").        
000cbc0: 2020 2020 2020 2020 3e3e 2028 6675 6e20          >> (fun 
000cbd0: 2828 286e 616d 652c 5f29 2c61 7267 7329  (((name,_),args)
000cbe0: 2c5f 2920 2d3e 2046 6e28 6e61 6d65 2c61  ,_) -> Fn(name,a
000cbf0: 7267 7329 290a 2020 2020 2020 2020 207c  rgs)).         |
000cc00: 7c20 6e61 6d65 0a20 2020 2020 2020 2020  | name.         
000cc10: 2020 2020 2020 203e 3e20 2866 756e 2073         >> (fun s
000cc20: 202d 3e20 5661 7220 7329 0a20 2020 2020   -> Var s).     
000cc30: 2020 2020 7c7c 206e 756d 6572 616c 0a20      || numeral. 
000cc40: 2020 2020 2020 2020 2020 2020 2020 203e                 >
000cc50: 3e20 2866 756e 2073 202d 3e20 436f 6e73  > (fun s -> Cons
000cc60: 7420 7329 0a20 2020 2020 2020 2020 7c7c  t s).         ||
000cc70: 2061 2028 4f74 6865 7220 2228 2229 202b   a (Other "(") +
000cc80: 2b20 7465 726d 202b 2b20 6120 284f 7468  + term ++ a (Oth
000cc90: 6572 2022 2922 290a 2020 2020 2020 2020  er ")").        
000cca0: 2020 2020 2020 2020 3e3e 2028 736e 6420          >> (snd 
000ccb0: 6f20 6673 7429 0a20 2020 2020 2020 2020  o fst).         
000ccc0: 7c7c 2061 2028 4f74 6865 7220 222d 2229  || a (Other "-")
000ccd0: 202b 2b20 6174 6f6d 0a20 2020 2020 2020   ++ atom.       
000cce0: 2020 2020 2020 2020 203e 3e20 736e 6429           >> snd)
000ccf0: 2069 6e70 7574 0a20 2020 2061 6e64 2074   input.    and t
000cd00: 6572 6d20 696e 7075 7420 3d20 7072 6563  erm input = prec
000cd10: 6564 656e 6365 2028 2169 6e66 6978 6573  edence (!infixes
000cd20: 2920 6174 6f6d 2069 6e70 7574 0a20 2020  ) atom input.   
000cd30: 2061 6e64 2074 6572 6d6c 6973 7420 696e   and termlist in
000cd40: 7075 740a 2020 2020 2020 2020 203d 2028  put.         = (
000cd50: 7465 726d 202b 2b20 6120 284f 7468 6572  term ++ a (Other
000cd60: 2022 2c22 2920 2b2b 2074 6572 6d6c 6973   ",") ++ termlis
000cd70: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
000cd80: 2020 3e3e 2028 6675 6e20 2828 682c 5f29    >> (fun ((h,_)
000cd90: 2c74 2920 2d3e 2068 3a3a 7429 0a20 2020  ,t) -> h::t).   
000cda0: 2020 2020 2020 7c7c 2074 6572 6d0a 2020        || term.  
000cdb0: 2020 2020 2020 2020 2020 2020 2020 3e3e                >>
000cdc0: 2028 6675 6e20 6820 2d3e 205b 685d 2929   (fun h -> [h]))
000cdd0: 2069 6e70 7574 3b3b 0a0a 2020 6c65 7420   input;;..  let 
000cde0: 7061 7273 6572 203d 2066 7374 206f 2028  parser = fst o (
000cdf0: 7465 726d 202b 2b20 6669 6e69 7368 6564  term ++ finished
000ce00: 203e 3e20 6673 7429 206f 206c 6578 3b3b   >> fst) o lex;;
000ce10: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
000ce20: 7d5c 656e 647b 626f 7865 647d 0a0a 5c6e  }\end{boxed}..\n
000ce30: 6f69 6e64 656e 7420 666f 7220 6578 616d  oindent for exam
000ce40: 706c 653a 0a0a 5c62 6567 696e 7b62 6f78  ple:..\begin{box
000ce50: 6564 7d5c 6265 6769 6e7b 7665 7262 6174  ed}\begin{verbat
000ce60: 696d 7d0a 2020 2370 6172 7365 7220 2232  im}.  #parser "2
000ce70: 202a 2073 696e 2878 295e 3220 2b20 3220   * sin(x)^2 + 2 
000ce80: 2a20 7369 6e28 7929 5e32 202d 2032 223b  * sin(y)^2 - 2";
000ce90: 3b0a 2020 2d20 3a20 7465 726d 203d 0a20  ;.  - : term =. 
000cea0: 2020 466e 0a20 2020 2028 222b 222c 0a20    Fn.    ("+",. 
000ceb0: 2020 2020 5b46 6e20 2822 2a22 2c20 5b43      [Fn ("*", [C
000cec0: 6f6e 7374 2022 3222 3b20 466e 2028 225e  onst "2"; Fn ("^
000ced0: 222c 205b 466e 2028 2273 696e 222c 205b  ", [Fn ("sin", [
000cee0: 5661 7220 2278 225d 293b 0a20 2020 2020  Var "x"]);.     
000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
000cf10: 436f 6e73 7420 2232 225d 295d 293b 0a20  Const "2"])]);. 
000cf20: 2020 2020 2046 6e0a 2020 2020 2020 2028       Fn.       (
000cf30: 222d 222c 0a20 2020 2020 2020 205b 466e  "-",.        [Fn
000cf40: 2028 222a 222c 205b 436f 6e73 7420 2232   ("*", [Const "2
000cf50: 223b 2046 6e20 2822 5e22 2c20 5b46 6e20  "; Fn ("^", [Fn 
000cf60: 2822 7369 6e22 2c20 5b56 6172 2022 7922  ("sin", [Var "y"
000cf70: 5d29 3b0a 2020 2020 2020 2020 2020 2020  ]);.            
000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
000cf90: 2020 2020 2020 2020 2020 2020 436f 6e73              Cons
000cfa0: 7420 2232 225d 295d 293b 0a20 2020 2020  t "2"])]);.     
000cfb0: 2020 2020 436f 6e73 7420 2232 225d 295d      Const "2"])]
000cfc0: 290a 2020 2369 6e73 7461 6c6c 5f70 7269  ).  #install_pri
000cfd0: 6e74 6572 2022 7072 696e 745f 7465 726d  nter "print_term
000cfe0: 223b 3b0a 2020 2d20 3a20 756e 6974 203d  ";;.  - : unit =
000cff0: 2028 290a 2020 2370 6172 7365 7220 2232   ().  #parser "2
000d000: 202a 2073 696e 2878 295e 3220 2b20 3220   * sin(x)^2 + 2 
000d010: 2a20 7369 6e28 7929 5e32 202d 2032 223b  * sin(y)^2 - 2";
000d020: 3b0a 2020 2d20 3a20 7465 726d 203d 2060  ;.  - : term = `
000d030: 3220 2a20 7369 6e28 7829 205e 2032 202b  2 * sin(x) ^ 2 +
000d040: 2028 3220 2a20 7369 6e28 7929 205e 2032   (2 * sin(y) ^ 2
000d050: 202d 2032 2960 0a5c 656e 647b 7665 7262   - 2)`.\end{verb
000d060: 6174 696d 7d5c 656e 647b 626f 7865 647d  atim}\end{boxed}
000d070: 0a0a 5c73 7562 7365 6374 696f 6e7b 4465  ..\subsection{De
000d080: 6665 6374 7320 6f66 206f 7572 2061 7070  fects of our app
000d090: 726f 6163 687d 0a0a 4f75 7220 6170 7072  roach}..Our appr
000d0a0: 6f61 6368 2074 6f20 6c65 7869 6e67 2061  oach to lexing a
000d0b0: 6e64 2070 6172 7369 6e67 2069 7320 6e6f  nd parsing is no
000d0c0: 7420 7061 7274 6963 756c 6172 6c79 2065  t particularly e
000d0d0: 6666 6963 6965 6e74 2e20 496e 2066 6163  fficient. In fac
000d0e0: 742c 0a43 414d 4c20 616e 6420 736f 6d65  t,.CAML and some
000d0f0: 206f 7468 6572 204d 4c20 696d 706c 656d   other ML implem
000d100: 656e 7461 7469 6f6e 7320 696e 636c 7564  entations includ
000d110: 6520 6120 6765 6e65 7261 746f 7220 666f  e a generator fo
000d120: 7220 4c52 2070 6172 7365 7273 0a73 696d  r LR parsers.sim
000d130: 696c 6172 2074 6f20 5941 4343 2028 5965  ilar to YACC (Ye
000d140: 7420 416e 6f74 6865 7220 436f 6d70 696c  t Another Compil
000d150: 6572 2043 6f6d 7069 6c65 7229 2077 6869  er Compiler) whi
000d160: 6368 2069 7320 6f66 7465 6e20 7573 6564  ch is often used
000d170: 2074 6f20 6765 6e65 7261 7465 0a70 6172   to generate.par
000d180: 7365 7273 2069 6e20 4320 756e 6465 7220  sers in C under 
000d190: 556e 6978 2e20 4e6f 7420 6f6e 6c79 2061  Unix. Not only a
000d1a0: 7265 2074 6865 7365 206d 6f72 6520 6765  re these more ge
000d1b0: 6e65 7261 6c20 696e 2074 6865 2067 7261  neral in the gra
000d1c0: 6d6d 6172 7320 7468 6174 0a74 6865 7920  mmars that.they 
000d1d0: 6361 6e20 6861 6e64 6c65 2c20 6275 7420  can handle, but 
000d1e0: 7468 6520 7265 7375 6c74 696e 6720 7061  the resulting pa
000d1f0: 7273 6572 7320 6172 6520 6d6f 7265 2065  rsers are more e
000d200: 6666 6963 6965 6e74 2e20 486f 7765 7665  fficient. Howeve
000d210: 7220 7765 0a62 656c 6965 7665 2074 6865  r we.believe the
000d220: 2070 7265 7365 6e74 2061 7070 726f 6163   present approac
000d230: 6820 6973 2072 6174 6865 7220 636c 6561  h is rather clea
000d240: 722c 2061 6465 7175 6174 6520 666f 7220  r, adequate for 
000d250: 6d6f 7374 2070 7572 706f 7365 732c 2061  most purposes, a
000d260: 6e64 2061 0a67 6f6f 6420 696e 7472 6f64  nd a.good introd
000d270: 7563 7469 6f6e 2074 6f20 7072 6f67 7261  uction to progra
000d280: 6d6d 696e 6720 7769 7468 2068 6967 6865  mming with highe
000d290: 7220 6f72 6465 7220 6675 6e63 7469 6f6e  r order function
000d2a0: 732e 0a0a 5468 6520 696e 6566 6669 6369  s...The ineffici
000d2b0: 656e 6379 206f 6620 6f75 7220 6170 7072  ency of our appr
000d2c0: 6f61 6368 2063 616e 2062 6520 7265 6475  oach can be redu
000d2d0: 6365 6420 6279 2061 766f 6964 696e 6720  ced by avoiding 
000d2e0: 6120 6665 7720 7061 7274 6963 756c 6172  a few particular
000d2f0: 6c79 0a77 6173 7465 6675 6c20 6665 6174  ly.wasteful feat
000d300: 7572 6573 2e20 4e6f 7465 2074 6861 7420  ures. Note that 
000d310: 6966 2074 776f 2064 6966 6665 7265 6e74  if two different
000d320: 2070 726f 6475 6374 696f 6e73 2066 6f72   productions for
000d330: 2074 6865 2073 616d 650a 7379 6e74 6163   the same.syntac
000d340: 7469 6320 6361 7465 676f 7279 2068 6176  tic category hav
000d350: 6520 6120 636f 6d6d 6f6e 2070 7265 6669  e a common prefi
000d360: 782c 2074 6865 6e20 7765 2073 686f 756c  x, then we shoul
000d370: 6420 6176 6f69 6420 7061 7273 696e 6720  d avoid parsing 
000d380: 6974 206d 6f72 650a 7468 616e 206f 6e63  it more.than onc
000d390: 652c 2075 6e6c 6573 7320 6974 2069 7320  e, unless it is 
000d3a0: 6775 6172 616e 7465 6564 2074 6f20 6265  guaranteed to be
000d3b0: 2074 7269 7669 616c 2e20 4f75 7220 7072   trivial. Our pr
000d3c0: 6f64 7563 7469 6f6e 2072 756c 6573 2066  oduction rules f
000d3d0: 6f72 0a24 7465 726d 2420 6861 7665 2074  or.$term$ have t
000d3e0: 6869 7320 7072 6f70 6572 7479 3a0a 0a5c  his property:..\
000d3f0: 6265 6769 6e7b 6571 6e61 7272 6179 2a7d  begin{eqnarray*}
000d400: 0a74 6572 6d20 2020 2020 2620 5c67 6f65  .term     & \goe
000d410: 7374 6f20 2620 6e61 6d65 7b5c 7665 7262  sto & name{\verb
000d420: 2128 217d 2074 6572 6d6c 6973 7420 7b5c  !(!} termlist {\
000d430: 7665 7262 2129 217d 2020 2020 2020 2020  verb!)!}        
000d440: 205c 5c0a 2020 2020 2020 2020 2026 207c   \\.         & |
000d450: 2020 2020 2020 2026 206e 616d 6520 2020         & name   
000d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
000d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
000d480: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
000d490: 2620 7c20 2020 2020 2020 2620 5c63 646f  & |       & \cdo
000d4a0: 7473 0a5c 656e 647b 6571 6e61 7272 6179  ts.\end{eqnarray
000d4b0: 2a7d 0a0a 5765 2063 6172 6566 756c 6c79  *}..We carefully
000d4c0: 2070 7574 2074 6865 206c 6f6e 6765 7220   put the longer 
000d4d0: 7072 6f64 7563 7469 6f6e 2066 6972 7374  production first
000d4e0: 2069 6e20 6f75 7220 6163 7475 616c 2069   in our actual i
000d4f0: 6d70 6c65 6d65 6e74 6174 696f 6e2c 0a6f  mplementation,.o
000d500: 7468 6572 7769 7365 2073 7563 6365 7373  therwise success
000d510: 2069 6e20 7265 6164 696e 6720 6120 6e61   in reading a na
000d520: 6d65 2077 6f75 6c64 2063 6175 7365 2074  me would cause t
000d530: 6865 2061 6261 6e64 6f6e 6d65 6e74 206f  he abandonment o
000d540: 6620 6174 7465 6d70 7473 2074 6f0a 7265  f attempts to.re
000d550: 6164 2061 2070 6172 656e 7468 6573 697a  ad a parenthesiz
000d560: 6564 206c 6973 7420 6f66 2061 7267 756d  ed list of argum
000d570: 656e 7473 2e20 4e65 7665 7274 6865 6c65  ents. Neverthele
000d580: 7373 2c20 6265 6361 7573 6520 6f66 2074  ss, because of t
000d590: 6865 0a72 6564 756e 6461 6e63 7920 7765  he.redundancy we
000d5a0: 2068 6176 6520 6d65 6e74 696f 6e65 642c   have mentioned,
000d5b0: 2074 6869 7320 7761 7920 6f66 2063 6f6e   this way of con
000d5c0: 7374 7275 6374 696e 6720 7468 6520 7061  structing the pa
000d5d0: 7273 6572 2069 7320 7761 7374 6566 756c  rser is wasteful
000d5e0: 2e0a 496e 2074 6869 7320 6361 7365 2069  ..In this case i
000d5f0: 7420 646f 6573 6e27 7420 6d61 7474 6572  t doesn't matter
000d600: 206d 7563 682c 2062 6563 6175 7365 2074   much, because t
000d610: 6865 2064 7570 6c69 6361 7465 6420 6361  he duplicated ca
000d620: 6c6c 206f 6e6c 7920 616e 616c 797a 6573  ll only analyzes
000d630: 0a6f 6e65 2074 6f6b 656e 2e20 486f 7765  .one token. Howe
000d640: 7665 7220 7468 6520 6361 7365 2066 6f72  ver the case for
000d650: 2024 7465 726d 6c69 7374 2420 6973 206d   $termlist$ is m
000d660: 6f72 6520 7369 676e 6966 6963 616e 743a  ore significant:
000d670: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
000d680: 6265 6769 6e7b 6c73 746c 6973 7469 6e67  begin{lstlisting
000d690: 7d0a 2020 2020 6c65 7420 2e2e 2e0a 2020  }.    let ....  
000d6a0: 2020 616e 6420 7465 726d 6c69 7374 2069    and termlist i
000d6b0: 6e70 7574 0a20 2020 2020 2020 2020 3d20  nput.         = 
000d6c0: 2874 6572 6d20 2b2b 2061 2028 4f74 6865  (term ++ a (Othe
000d6d0: 7220 222c 2229 202b 2b20 7465 726d 6c69  r ",") ++ termli
000d6e0: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
000d6f0: 2020 203e 3e20 2866 756e 2028 2868 2c5f     >> (fun ((h,_
000d700: 292c 7429 202d 3e20 683a 3a74 290a 2020  ),t) -> h::t).  
000d710: 2020 2020 2020 207c 7c20 7465 726d 0a20         || term. 
000d720: 2020 2020 2020 2020 2020 2020 2020 203e                 >
000d730: 3e20 2866 756e 2068 202d 3e20 5b68 5d29  > (fun h -> [h])
000d740: 2920 696e 7075 743b 3b0a 5c65 6e64 7b6c  ) input;;.\end{l
000d750: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
000d760: 6f78 6564 7d0a 0a48 6572 6520 7765 2063  oxed}..Here we c
000d770: 6f75 6c64 2072 6570 6172 7365 2061 2077  ould reparse a w
000d780: 686f 6c65 2074 6572 6d2c 2077 6869 6368  hole term, which
000d790: 206d 6967 6874 2062 6520 6172 6269 7472   might be arbitr
000d7a0: 6172 696c 7920 6c61 7267 652e 2057 6520  arily large. We 
000d7b0: 6361 6e0a 6176 6f69 6420 7468 6973 2069  can.avoid this i
000d7c0: 6e20 7365 7665 7261 6c20 7761 7973 2e20  n several ways. 
000d7d0: 4f6e 6520 6973 2074 6f20 6d6f 7665 2074  One is to move t
000d7e0: 6865 207b 5c76 6572 6221 7c7c 217d 2061  he {\verb!||!} a
000d7f0: 6c74 6572 6e61 7469 6f6e 2074 6f20 6166  lternation to af
000d800: 7465 720a 7468 6520 696e 6974 6961 6c20  ter.the initial 
000d810: 7465 726d 2068 6173 2062 6565 6e20 7265  term has been re
000d820: 6164 2e20 4120 636f 6e76 656e 6965 6e74  ad. A convenient
000d830: 2077 6179 2074 6f20 636f 6465 2069 7420   way to code it 
000d840: 6973 2074 6f20 6573 6368 6577 0a65 7870  is to eschew.exp
000d850: 6c69 6369 7420 7265 6375 7273 696f 6e20  licit recursion 
000d860: 696e 2066 6176 6f75 7220 6f66 207b 5c74  in favour of {\t
000d870: 7420 6d61 6e79 7d3a 0a0a 5c62 6567 696e  t many}:..\begin
000d880: 7b62 6f78 6564 7d5c 6265 6769 6e7b 6c73  {boxed}\begin{ls
000d890: 746c 6973 7469 6e67 7d0a 2020 2020 6c65  tlisting}.    le
000d8a0: 7420 2e2e 2e0a 2020 2020 616e 6420 7465  t ....    and te
000d8b0: 726d 6c69 7374 2069 6e70 7574 0a20 2020  rmlist input.   
000d8c0: 2020 2020 203d 2074 6572 6d20 2b2b 206d       = term ++ m
000d8d0: 616e 7920 2861 2028 4f74 6865 7220 222c  any (a (Other ",
000d8e0: 2229 202b 2b20 7465 726d 203e 3e20 736e  ") ++ term >> sn
000d8f0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
000d900: 2020 203e 3e20 2866 756e 2028 682c 7429     >> (fun (h,t)
000d910: 202d 3e20 683a 3a74 2920 696e 7075 743b   -> h::t) input;
000d920: 3b0a 5c65 6e64 7b6c 7374 6c69 7374 696e  ;.\end{lstlistin
000d930: 677d 5c65 6e64 7b62 6f78 6564 7d0a 0a5c  g}\end{boxed}..\
000d940: 6e6f 696e 6465 6e74 2054 6865 7265 666f  noindent Therefo
000d950: 7265 2074 6865 2066 696e 616c 2076 6572  re the final ver
000d960: 7369 6f6e 206f 6620 7468 6520 7061 7273  sion of the pars
000d970: 6572 2069 733a 0a0a 5c62 6567 696e 7b62  er is:..\begin{b
000d980: 6f78 6564 7d5c 6265 6769 6e7b 6c73 746c  oxed}\begin{lstl
000d990: 6973 7469 6e67 7d0a 2020 6c65 7420 7265  isting}.  let re
000d9a0: 6320 6174 6f6d 2069 6e70 7574 0a20 2020  c atom input.   
000d9b0: 2020 2020 2020 3d20 286e 616d 6520 2b2b        = (name ++
000d9c0: 2061 2028 4f74 6865 7220 2228 2229 202b   a (Other "(") +
000d9d0: 2b20 7465 726d 6c69 7374 202b 2b20 6120  + termlist ++ a 
000d9e0: 284f 7468 6572 2022 2922 290a 2020 2020  (Other ")").    
000d9f0: 2020 2020 2020 2020 2020 2020 3e3e 2028              >> (
000da00: 6675 6e20 2828 286e 616d 652c 5f29 2c61  fun (((name,_),a
000da10: 7267 7329 2c5f 2920 2d3e 2046 6e28 6e61  rgs),_) -> Fn(na
000da20: 6d65 2c61 7267 7329 290a 2020 2020 2020  me,args)).      
000da30: 2020 207c 7c20 6e61 6d65 0a20 2020 2020     || name.     
000da40: 2020 2020 2020 2020 2020 203e 3e20 2866             >> (f
000da50: 756e 2073 202d 3e20 5661 7220 7329 0a20  un s -> Var s). 
000da60: 2020 2020 2020 2020 7c7c 206e 756d 6572          || numer
000da70: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
000da80: 2020 203e 3e20 2866 756e 2073 202d 3e20     >> (fun s -> 
000da90: 436f 6e73 7420 7329 0a20 2020 2020 2020  Const s).       
000daa0: 2020 7c7c 2061 2028 4f74 6865 7220 2228    || a (Other "(
000dab0: 2229 202b 2b20 7465 726d 202b 2b20 6120  ") ++ term ++ a 
000dac0: 284f 7468 6572 2022 2922 290a 2020 2020  (Other ")").    
000dad0: 2020 2020 2020 2020 2020 2020 3e3e 2028              >> (
000dae0: 736e 6420 6f20 6673 7429 0a20 2020 2020  snd o fst).     
000daf0: 2020 2020 7c7c 2061 2028 4f74 6865 7220      || a (Other 
000db00: 222d 2229 202b 2b20 6174 6f6d 0a20 2020  "-") ++ atom.   
000db10: 2020 2020 2020 2020 2020 2020 203e 3e20               >> 
000db20: 736e 6429 2069 6e70 7574 0a20 2020 2061  snd) input.    a
000db30: 6e64 2074 6572 6d20 696e 7075 7420 3d20  nd term input = 
000db40: 7072 6563 6564 656e 6365 2028 2169 6e66  precedence (!inf
000db50: 6978 6573 2920 6174 6f6d 2069 6e70 7574  ixes) atom input
000db60: 0a20 2020 2061 6e64 2074 6572 6d6c 6973  .    and termlis
000db70: 7420 696e 7075 740a 2020 2020 2020 2020  t input.        
000db80: 2020 3d20 2874 6572 6d20 2b2b 206d 616e    = (term ++ man
000db90: 7920 2861 2028 4f74 6865 7220 222c 2229  y (a (Other ",")
000dba0: 202b 2b20 7465 726d 203e 3e20 736e 6429   ++ term >> snd)
000dbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
000dbc0: 203e 3e20 2866 756e 2028 682c 7429 202d   >> (fun (h,t) -
000dbd0: 3e20 683a 3a74 2929 2069 6e70 7574 3b3b  > h::t)) input;;
000dbe0: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
000dbf0: 7d5c 656e 647b 626f 7865 647d 0a0a 4120  }\end{boxed}..A 
000dc00: 6765 6e65 7261 6c20 6465 6665 6374 206f  general defect o
000dc10: 6620 6f75 7220 6170 7072 6f61 6368 2c20  f our approach, 
000dc20: 616e 6420 7265 6375 7273 6976 6520 6465  and recursive de
000dc30: 7363 656e 7420 7061 7273 696e 6720 6765  scent parsing ge
000dc40: 6e65 7261 6c6c 792c 2069 730a 7468 6174  nerally, is.that
000dc50: 2073 6f2d 6361 6c6c 6564 207b 5c65 6d20   so-called {\em 
000dc60: 6c65 6674 2072 6563 7572 7369 6f6e 7d20  left recursion} 
000dc70: 696e 2070 726f 6475 6374 696f 6e73 2063  in productions c
000dc80: 6175 7365 7320 7072 6f62 6c65 6d73 2e20  auses problems. 
000dc90: 5468 6973 2069 730a 7768 6572 6520 6120  This is.where a 
000dca0: 6769 7665 6e20 6361 7465 676f 7279 2065  given category e
000dcb0: 7870 616e 6473 2074 6f20 6120 7365 7175  xpands to a sequ
000dcc0: 656e 6365 2069 6e63 6c75 6469 6e67 2074  ence including t
000dcd0: 6865 2063 6174 6567 6f72 7920 6974 7365  he category itse
000dce0: 6c66 2061 730a 7468 6520 6669 7273 7420  lf as.the first 
000dcf0: 6974 656d 2e20 466f 7220 6578 616d 706c  item. For exampl
000dd00: 652c 2069 6620 7765 2068 6164 2077 616e  e, if we had wan
000dd10: 7465 6420 746f 206d 616b 6520 7468 6520  ted to make the 
000dd20: 6164 6469 7469 6f6e 206f 7065 7261 746f  addition operato
000dd30: 720a 6c65 6674 2d61 7373 6f63 6961 7469  r.left-associati
000dd40: 7665 2069 6e20 6f75 7220 6561 726c 6965  ve in our earlie
000dd50: 7220 6772 616d 6d61 722c 2077 6520 636f  r grammar, we co
000dd60: 756c 6420 6861 7665 2075 7365 643a 0a0a  uld have used:..
000dd70: 5c62 6567 696e 7b65 716e 6172 7261 792a  \begin{eqnarray*
000dd80: 7d0a 7465 726d 2020 2020 2026 205c 676f  }.term     & \go
000dd90: 6573 746f 2026 2074 6572 6d20 7b5c 7665  esto & term {\ve
000dda0: 7262 2120 2b20 217d 206d 756c 6578 7020  rb! + !} mulexp 
000ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
000ddc0: 2020 5c5c 0a20 2020 2020 2020 2020 2620    \\.         & 
000ddd0: 7c20 2020 2020 2020 2620 6d75 6c65 7870  |       & mulexp
000dde0: 0a5c 656e 647b 6571 6e61 7272 6179 2a7d  .\end{eqnarray*}
000ddf0: 0a0a 5468 6520 6e61 6976 6520 7472 616e  ..The naive tran
000de00: 7363 7269 7074 696f 6e20 696e 746f 204d  scription into M
000de10: 4c20 776f 756c 6420 6c6f 6f70 2069 6e64  L would loop ind
000de20: 6566 696e 6974 656c 792c 2063 616c 6c69  efinitely, calli
000de30: 6e67 207b 5c74 7420 7465 726d 7d20 6f6e  ng {\tt term} on
000de40: 0a74 6865 2073 616d 6520 7375 6274 6572  .the same subter
000de50: 6d20 6f76 6572 2061 6e64 206f 7665 722e  m over and over.
000de60: 2054 6865 7265 2061 7265 2076 6172 696f   There are vario
000de70: 7573 2073 6c69 6768 746c 7920 6164 2068  us slightly ad h
000de80: 6f63 2077 6179 7320 6f66 0a64 6561 6c69  oc ways of.deali
000de90: 6e67 2077 6974 6820 7468 6973 2070 726f  ng with this pro
000dea0: 626c 656d 2e20 466f 7220 6578 616d 706c  blem. For exampl
000deb0: 652c 206f 6e65 2063 616e 2063 6f6e 7665  e, one can conve
000dec0: 7274 2074 6869 7320 7573 6520 6f66 2072  rt this use of r
000ded0: 6563 7572 7369 6f6e 2c0a 7768 6963 6820  ecursion,.which 
000dee0: 696e 2073 6f6d 6520 7761 7973 2069 7320  in some ways is 
000def0: 7261 7468 6572 2067 7261 7475 6974 6f75  rather gratuitou
000df00: 732c 2069 6e74 6f20 7468 6520 6578 706c  s, into the expl
000df10: 6963 6974 2075 7365 206f 6620 7265 7065  icit use of repe
000df20: 7469 7469 6f6e 2e0a 5765 2063 616e 2064  tition..We can d
000df30: 6f20 7468 6973 2075 7369 6e67 2073 7461  o this using sta
000df40: 6e64 6172 6420 636f 6d62 696e 6174 6f72  ndard combinator
000df50: 7320 6c69 6b65 207b 5c74 7420 6d61 6e79  s like {\tt many
000df60: 7d20 746f 2072 6574 7572 6e20 6120 6c69  } to return a li
000df70: 7374 206f 660a 6024 6d75 6c65 7870 2427  st of.`$mulexp$'
000df80: 7320 616e 6420 7468 656e 2072 756e 206f  s and then run o
000df90: 7665 7220 7468 6520 6c69 7374 2062 7569  ver the list bui
000dfa0: 6c64 696e 6720 7468 6520 7472 6565 206c  lding the tree l
000dfb0: 6566 742d 6173 736f 6369 6174 6564 2e0a  eft-associated..
000dfc0: 0a41 2066 696e 616c 2070 726f 626c 656d  .A final problem
000dfd0: 2069 7320 7468 6174 2077 6520 646f 206e   is that we do n
000dfe0: 6f74 2068 616e 646c 6520 6572 726f 7273  ot handle errors
000dff0: 2076 6572 7920 6772 6163 6566 756c 6c79   very gracefully
000e000: 2e20 5765 2061 6c77 6179 730a 7261 6973  . We always.rais
000e010: 6520 7468 6520 6578 6365 7074 696f 6e20  e the exception 
000e020: 7b5c 7474 204e 6f70 6172 7365 7d2c 2061  {\tt Noparse}, a
000e030: 6e64 2074 6869 732c 2077 6865 6e20 6361  nd this, when ca
000e040: 7567 6874 2c20 696e 6974 6961 7465 730a  ught, initiates.
000e050: 6261 636b 7472 6163 6b69 6e67 2e20 486f  backtracking. Ho
000e060: 7765 7665 7220 7468 6973 2069 7320 6e6f  wever this is no
000e070: 7420 616c 7761 7973 2061 7070 726f 7072  t always appropr
000e080: 6961 7465 2066 6f72 2074 7970 6963 616c  iate for typical
000e090: 2067 7261 6d6d 6172 732e 2041 740a 6265   grammars. At.be
000e0a0: 7374 2c20 6974 2063 616e 2063 6175 7365  st, it can cause
000e0b0: 2065 7870 656e 7369 7665 2072 6570 6172   expensive repar
000e0c0: 7369 6e67 2c20 616e 6420 6361 6e20 6c65  sing, and can le
000e0d0: 6164 2074 6f20 6261 6666 6c69 6e67 2065  ad to baffling e
000e0e0: 7272 6f72 0a69 6e64 6963 6174 696f 6e73  rror.indications
000e0f0: 2061 7420 7468 6520 746f 7020 6c65 7665   at the top leve
000e100: 6c2e 2046 6f72 2065 7861 6d70 6c65 2c20  l. For example, 
000e110: 6f6e 2065 6e63 6f75 6e74 6572 696e 6720  on encountering 
000e120: 7b5c 7474 2035 202b 7d2c 2077 6520 6578  {\tt 5 +}, we ex
000e130: 7065 6374 0a61 2074 6572 6d20 666f 6c6c  pect.a term foll
000e140: 6f77 696e 6720 7468 6520 7b5c 7474 202b  owing the {\tt +
000e150: 7d2c 2061 6e64 2069 6620 7765 2064 6f6e  }, and if we don
000e160: 2774 2066 696e 6420 6f6e 652c 2077 6520  't find one, we 
000e170: 7368 6f75 6c64 2067 656e 6572 6174 6520  should generate 
000e180: 610a 636f 6d70 7265 6865 6e73 6962 6c65  a.comprehensible
000e190: 2065 7863 6570 7469 6f6e 2066 6f72 2074   exception for t
000e1a0: 6865 2075 7365 722c 2072 6174 6865 7220  he user, rather 
000e1b0: 7468 616e 2072 6169 7365 207b 5c74 7420  than raise {\tt 
000e1c0: 4e6f 7061 7273 657d 2061 6e64 0a70 6572  Noparse} and.per
000e1d0: 6861 7073 2069 6e69 7469 6174 6520 7365  haps initiate se
000e1e0: 7665 7261 6c20 6f74 6865 7220 706f 696e  veral other poin
000e1f0: 746c 6573 7320 6174 7465 6d70 7473 2074  tless attempts t
000e200: 6f20 7061 7273 6520 7468 6520 6578 7072  o parse the expr
000e210: 6573 7369 6f6e 2069 6e20 610a 6469 6666  ession in a.diff
000e220: 6572 656e 7420 7761 792e 0a0a 5c73 6563  erent way...\sec
000e230: 7469 6f6e 7bf4 cfde cec1 d120 c1d2 c9c6  tion{...... ....
000e240: cdc5 d4c9 cbc1 20d7 c5dd c5d3 d4d7 c5ce  ...... .........
000e250: ced9 c820 dec9 d3c5 cc7d 0a25 5c73 6563  ... .....}.%\sec
000e260: 7469 6f6e 7b45 7861 6374 2072 6561 6c20  tion{Exact real 
000e270: 6172 6974 686d 6574 6963 7d0a 0aed c1db  arithmetic}.....
000e280: c9ce cec1 d120 d2c5 c1cc c9da c1c3 c9d1  ..... ..........
000e290: 20d7 c5dd c5d3 d4d7 c5ce cecf ca20 c1d2   ............ ..
000e2a0: c9c6 cdc5 d4c9 cbc9 20cf c2d9 dece cf20  ........ ...... 
000e2b0: c9d3 d0cf ccd8 dad5 c5d4 20d0 d2c9 c2cc  .......... .....
000e2c0: c9d6 a3ce cecf c50a d0d2 c5c4 d3d4 c1d7  ................
000e2d0: ccc5 cec9 c520 dec9 d3c5 cc20 d720 c6cf  ..... ..... . ..
000e2e0: d2cd c1d4 c520 d320 d0cc c1d7 c1c0 ddc5  ..... . ........
000e2f0: ca20 d4cf decb cfca 2e20 f720 cfc2 ddc5  . ....... . ....
000e300: cd20 d3cc d5de c1c5 2c20 cdd9 20cd cfd6  . ......, .. ...
000e310: c5cd 200a cfd0 c5d2 c9d2 cfd7 c1d4 d820  .. ............ 
000e320: d7c5 ddc5 d3d4 d7c5 cece d9cd c920 dec9  ............. ..
000e330: d3cc c1cd c920 28cc c9c2 cf20 d7d2 d5de  ..... (.... ....
000e340: ced5 c02c 20cc c9c2 cf20 d0d2 c920 d0cf  ..., .... ... ..
000e350: cdcf ddc9 20cb cfcd d0d8 c0d4 c5d2 c129  .... ..........)
000e360: 200a ccc9 dbd8 20d7 20d4 cfcd 20d3 ccd5   ..... . ... ...
000e370: dec1 c52c 20cb cfc7 c4c1 20cf cec9 20c9  ..., ..... ... .
000e380: cdc5 c0d4 20d4 cf20 c9cc c920 c9ce cfc5  .... .. ... ....
000e390: 20cb cfce c5de cecf c520 d0d2 c5c4 d3d4   ........ ......
000e3a0: c1d7 ccc5 cec9 c52e 0af7 cfda cec9 cbc1  ................
000e3b0: c5d4 20d7 cfd0 d2cf d32c 20d5 cdc5 d3d4  .. ......, .....
000e3c0: cecf 20cc c920 c7cf d7cf d2c9 d4d8 20cf  .. .. ........ .
000e3d0: 2060 d3d5 ddc5 d3d4 d7cf d7c1 cec9 c927   `.............'
000e3e0: 20de c9d3 c5cc 2c20 cbcf d4cf d2d9 c50a   ....., ........
000e3f0: 2520 4953 5355 4520 2334 202d 2d20 7175  % ISSUE #4 -- qu
000e400: 6f74 6174 696f 6e20 6d61 726b 7320 2020  otation marks   
000e410: 2020 2020 2020 2020 5e5e 5e5e 5e5e 5e5e          ^^^^^^^^
000e420: 5e5e 5e5e 5e5e 5e0a cec5 20d0 d2c5 c4d3  ^^^^^^^... .....
000e430: d4c1 d7c9 cdd9 20d7 20cb cfce c5de cecf  ...... . .......
000e440: ca20 c6cf d2cd c52e 20ee c1d0 d2c9 cdc5  . ...... .......
000e450: d22c 20eb d2cf cec5 cbc5 d220 d0d2 c9da  ., ........ ....
000e460: cec1 d7c1 cc20 c3c5 ccd9 c520 c920 0ad2  ..... ..... . ..
000e470: c1c3 c9cf cec1 ccd8 ced9 c520 dec9 d3cc  ........... ....
000e480: c12c 20d0 cfd3 cbcf ccd8 cbd5 20c9 c820  ., ......... .. 
000e490: cdcf d6ce cf20 dac1 c4c1 d4d8 20d4 cfde  ..... ...... ...
000e4a0: cecf 2c20 c120 d4c1 cbd6 c520 0a7b 5c65  .., . ..... .{\e
000e4b0: 6d20 c1cc c7c5 c2d2 c1c9 dec5 d3cb c9c5  m ..............
000e4c0: 7d20 dec9 d3cc c125 0a5c 666f 6f74 6e6f  } .....%.\footno
000e4d0: 7465 7bf7 c5dd c5d3 d4d7 c5ce cecf c520  te{............ 
000e4e0: dec9 d3cc cf20 cec1 dad9 d7c1 c5d4 d3d1  ..... ..........
000e4f0: 20c1 ccc7 c5c2 d2c1 c9de c5d3 cbc9 cd2c   ..............,
000e500: 20c5 d3cc c920 cfce cf20 d1d7 ccd1 c5d4   .... ... ......
000e510: d3d1 200a cbcf d2ce c5cd 20d0 cfcc c9ce  .. ....... .....
000e520: cfcd c120 d320 c3c5 ccd9 cdc9 20cb cfdc  ... . ...... ...
000e530: c6c6 c9c3 c9c5 ced4 c1cd c920 28ce c1d0  ........... (...
000e540: d2c9 cdc5 d22c 2024 5c73 7172 747b 327d  ....., $\sqrt{2}
000e550: 2429 2c20 0ad7 20d0 d2cf d4c9 d7ce cfcd  $), .. .........
000e560: 20d3 ccd5 dec1 c520 dcd4 cf20 dec9 d3cc   ...... ... ....
000e570: cf7e 2d2d 2d20 d4d2 c1ce d3c3 c5ce c4c5  .~--- ..........
000e580: ced4 cecf c52e 7d2c 200a d0d2 c5c4 d3d4  ......}, .......
000e590: c1d7 c9cd d9c5 20cd cecf c7cf decc c5ce  ...... .........
000e5a0: c1cd c92c 20cb cfd2 ced1 cdc9 20cb cfd4  ..., ....... ...
000e5b0: cfd2 d9c8 20cf cec9 20d1 d7cc d1c0 d4d3  .... ... .......
000e5c0: d12e 20ef c4ce c1cb cf2c 20cf ce20 cfd4  .. ......, .. ..
000e5d0: d7c5 d2c7 c1cc 200a d4d2 c1ce d3c3 c5ce  ...... .........
000e5e0: c4c5 ced4 ced9 c520 dec9 d3cc c12c 20cb  ....... ....., .
000e5f0: c1cb 20ce c520 c9cd c5c0 ddc9 c520 cbcf  .. .. ....... ..
000e600: cec5 dece cfc7 cf20 d0d2 c5c4 d3d4 c1d7  ....... ........
000e610: ccc5 cec9 d12e 20e7 cfd7 cfd2 d1d4 2c20  ...... ......., 
000e620: ded4 cf20 0acb cfc7 c4c1 20eb d2cf cec5  ... ...... .....
000e630: cbc5 d2d5 20d0 cfd0 c1cc cfd3 d820 cec1  .... ........ ..
000e640: 20c7 ccc1 dac1 20c9 dad7 c5d3 d4ce cfc5   ..... .........
000e650: 20c4 cfcb c1da c1d4 c5cc d8d3 d4d7 cf20   .............. 
000e660: d4d2 c1ce d3c3 c5ce c4c5 ced4 cecf d3d4  ................
000e670: c920 0ade c9d3 ccc1 7e24 5c70 6924 7e5c  . ......~$\pi$~\
000e680: 6369 7465 4e7b 6c69 6e64 656d 616e 6e2d  citeN{lindemann-
000e690: 7069 7d2c 20cf ce20 d1cb cfc2 d920 cfd4  pi}, .. ..... ..
000e6a0: cfda d7c1 ccd3 d120 cf20 cec5 cd20 d4c1  ....... . ... ..
000e6b0: cb3a 203c 3cc9 ced4 c5d2 c5d3 cecf 2c0a  .: <<.........,.
000e6c0: c5d3 ccc9 20ce c520 d0d2 c9ce c9cd c1d4  .... .. ........
000e6d0: d820 d7cf 20d7 cec9 cdc1 cec9 c520 d4cf  . .. ........ ..
000e6e0: c7cf 2c20 ded4 cf20 dec9 d3cc c17e 245c  .., ... .....~$\
000e6f0: 7069 2420 cec5 20d3 d5dd c5d3 d4d7 d5c5  pi$ .. .........
000e700: d43e 3e2e 0a0a 2552 6561 6c20 6172 6974  .>>...%Real arit
000e710: 686d 6574 6963 206f 6e20 636f 6d70 7574  hmetic on comput
000e720: 6572 7320 6973 206e 6f72 6d61 6c6c 7920  ers is normally 
000e730: 646f 6e65 2076 6961 2066 6c6f 6174 696e  done via floatin
000e740: 6720 706f 696e 740a 2561 7070 726f 7869  g point.%approxi
000e750: 6d61 7469 6f6e 732e 2049 6e20 6765 6e65  mations. In gene
000e760: 7261 6c2c 2077 6520 6361 6e20 6f6e 6c79  ral, we can only
000e770: 206d 616e 6970 756c 6174 6520 6120 7265   manipulate a re
000e780: 616c 206e 756d 6265 722c 2065 6974 6865  al number, eithe
000e790: 720a 256f 7572 7365 6c76 6573 206f 7220  r.%ourselves or 
000e7a0: 696e 7369 6465 2061 2063 6f6d 7075 7465  inside a compute
000e7b0: 722c 2076 6961 2073 6f6d 6520 736f 7274  r, via some sort
000e7c0: 206f 6620 6669 6e69 7465 2072 6570 7265   of finite repre
000e7d0: 7365 6e74 6174 696f 6e2e 2053 6f6d 650a  sentation. Some.
000e7e0: 2571 7565 7374 696f 6e20 686f 7720 6e75  %question how nu
000e7f0: 6d62 6572 7320 6361 6e20 6265 2073 6169  mbers can be sai
000e800: 6420 746f 2060 6578 6973 7427 2069 6620  d to `exist' if 
000e810: 7468 6579 2068 6176 6520 6e6f 2066 696e  they have no fin
000e820: 6974 650a 2572 6570 7265 7365 6e74 6174  ite.%representat
000e830: 696f 6e2e 2046 6f72 2065 7861 6d70 6c65  ion. For example
000e840: 2c20 4b72 6f6e 6563 6b65 7220 6163 6365  , Kronecker acce
000e850: 7074 6564 2069 6e74 6567 6572 7320 616e  pted integers an
000e860: 6420 7261 7469 6f6e 616c 7320 6265 6361  d rationals beca
000e870: 7573 650a 2574 6865 7920 6361 6e20 6265  use.%they can be
000e880: 2077 7269 7474 656e 2064 6f77 6e20 6578   written down ex
000e890: 706c 6963 6974 6c79 2c20 616e 6420 6576  plicitly, and ev
000e8a0: 656e 207b 5c65 6d20 616c 6765 6272 6169  en {\em algebrai
000e8b0: 637d 0a25 6e75 6d62 6572 735c 666f 6f74  c}.%numbers\foot
000e8c0: 6e6f 7465 7b41 6c67 6562 7261 6963 206e  note{Algebraic n
000e8d0: 756d 6265 7273 2061 7265 2074 686f 7365  umbers are those
000e8e0: 2074 6861 7420 6172 6520 726f 6f74 7320   that are roots 
000e8f0: 6f66 2070 6f6c 796e 6f6d 6961 6c73 2077  of polynomials w
000e900: 6974 680a 2569 6e74 6567 6572 2063 6f65  ith.%integer coe
000e910: 6666 6963 6965 6e74 732c 2065 2e67 2e20  fficients, e.g. 
000e920: 245c 7371 7274 7b32 7d24 2c20 616e 6420  $\sqrt{2}$, and 
000e930: 7472 616e 7363 656e 6465 6e74 616c 206e  transcendental n
000e940: 756d 6265 7273 2061 7265 206f 6e65 7320  umbers are ones 
000e950: 7468 6174 0a25 6172 656e 2774 2e7d 2062  that.%aren't.} b
000e960: 6563 6175 7365 2074 6865 7920 6361 6e20  ecause they can 
000e970: 6265 2072 6570 7265 7365 6e74 6564 2075  be represented u
000e980: 7369 6e67 2074 6865 2070 6f6c 796e 6f6d  sing the polynom
000e990: 6961 6c73 206f 6620 7768 6963 6820 7468  ials of which th
000e9a0: 6579 0a25 6172 6520 736f 6c75 7469 6f6e  ey.%are solution
000e9b0: 732e 2048 6f77 6576 6572 2068 6520 7265  s. However he re
000e9c0: 6a65 6374 6564 2074 7261 6e73 6365 6e64  jected transcend
000e9d0: 656e 7461 6c20 6e75 6d62 6572 7320 6265  ental numbers be
000e9e0: 6361 7573 6520 6170 7061 7265 6e74 6c79  cause apparently
000e9f0: 0a25 7468 6579 2063 6f75 6c64 206e 6f74  .%they could not
000ea00: 2062 6520 7265 7072 6573 656e 7465 6420   be represented 
000ea10: 6669 6e69 7465 6c79 2e20 416c 6c65 6765  finitely. Allege
000ea20: 646c 7920 6865 2068 6520 6772 6565 7465  dly he he greete
000ea30: 6420 7468 6520 6661 6d6f 7573 0a25 7072  d the famous.%pr
000ea40: 6f6f 6620 6279 205c 6369 7465 4e7b 6c69  oof by \citeN{li
000ea50: 6e64 656d 616e 6e2d 7069 7d20 7468 6174  ndemann-pi} that
000ea60: 2024 5c70 6924 2069 7320 7472 616e 7363   $\pi$ is transc
000ea70: 656e 6465 6e74 616c 2077 6974 6820 7468  endental with th
000ea80: 6520 7265 6d61 726b 2074 6861 740a 2574  e remark that.%t
000ea90: 6869 7320 7761 7320 6069 6e74 6572 6573  his was `interes
000eaa0: 7469 6e67 2c20 6578 6365 7074 2074 6861  ting, except tha
000eab0: 7420 245c 7069 2420 646f 6573 206e 6f74  t $\pi$ does not
000eac0: 2065 7869 7374 272e 0a0a f5de c9d4 d9d7   exist'.........
000ead0: c1d1 20d3 cfd7 d2c5 cdc5 cece d9c5 20c4  .. ........... .
000eae0: cfd3 d4c9 d6c5 cec9 d12c 20cd d920 cdcf  ........., .. ..
000eaf0: d6c5 cd20 d3cb c1da c1d4 d82c 20de d4cf  ... ......., ...
000eb00: 20cb cfce c5de cecf c520 d0d2 c5c4 d3d4   ........ ......
000eb10: c1d7 ccc5 cec9 c50a d720 d0d2 c9ce c3c9  ......... ......
000eb20: d0c5 20d7 cfda cdcf d6ce cf20 c4cc d120  .. ........ ... 
000eb30: c7cf d2c1 dac4 cf20 c2cf ccd8 dbc5 c7cf  ....... ........
000eb40: 20cb cfcc c9de c5d3 d4d7 c120 dec9 d3c5   .......... ....
000eb50: cc2c 20de c5cd 20d4 c52c 200a d3d5 ddc5  ., ... .., .....
000eb60: d3d4 d7cf d7c1 cec9 c520 cbcf d4cf d2d9  ......... ......
000eb70: c820 d0d2 c9da cec1 d7c1 cccf d3d8 20eb  . ............ .
000eb80: d2cf cec5 cbc5 d2cf cd2e 20fc d4c9 cd20  .......... .... 
000eb90: d0d2 c5c4 d3d4 c1d7 ccc5 cec9 c5cd 20d1  .............. .
000eba0: d7cc d1c0 d4d3 d120 0ad0 d2cf c7d2 c1cd  ....... ........
000ebb0: cdd9 2028 c9cc c92c 20d7 cfcf c2dd c520  .. (..., ...... 
000ebc0: c7cf d7cf d2d1 2c20 7b5c 656d 20d0 d2c1  ......, {\em ...
000ebd0: d7c9 ccc1 7d29 20d7 d9de c9d3 ccc5 cec9  ....}) .........
000ebe0: d120 d4d2 c5c2 d5c5 cdd9 c820 dec9 d3c5  . ......... ....
000ebf0: cc20 d30a d0d2 cfc9 dad7 cfcc d8ce cfca  . ..............
000ec00: 20da c1c4 c1ce cecf ca20 d2c1 dad2 d1c4   ........ ......
000ec10: cecf d3d4 d8c0 2e20 eec1 d0d2 c9cd c5d2  ....... ........
000ec20: 2c20 cdd9 20cd cfd6 c5cd 20ce c1d0 c9d3  , .. ..... .....
000ec30: c1d4 d820 d0d2 cfc7 d2c1 cdcd d52c 200a  ... ........., .
000ec40: d7d9 dec9 d3cc d1c0 ddd5 c020 c4cc d120  ........... ... 
000ec50: dac1 c4c1 cece cfc7 cf7e 246e 2420 d0c5  .........~$n$ ..
000ec60: d2d7 d9c5 2024 6e24 7eda cec1 cbcf d720  .... $n$~...... 
000ec70: dec9 d3cc c17e 245c 7069 2420 c9cc c920  .....~$\pi$ ... 
000ec80: d6c5 200a d2c1 c3c9 cfce c1cc d8ce cfc5  .. .............
000ec90: 20de c9d3 cccf 7e24 7224 20d4 c1cb cfc5   .....~$r$ .....
000eca0: 2c20 ded4 cf7e 247c 5c70 6920 2d20 727c  , ...~$|\pi - r|
000ecb0: 203c 2032 5e7b 2d6e 7d24 2e20 eec5 dac1   < 2^{-n}$. ....
000ecc0: d7c9 d3c9 cdcf 20cf d420 d4cf c7cf 2c20  ...... .. ...., 
000ecd0: 0acb c1cb cfca 20c9 da20 d0cf c4c8 cfc4  ...... .. ......
000ece0: cfd7 20c2 d9cc 20d7 d9c2 d2c1 ce20 c4cc  .. ... ...... ..
000ecf0: d120 d0cf d3cc c5c4 cfd7 c1d4 c5cc d8ce  . ..............
000ed00: cfc7 cf20 d5d4 cfde cec5 cec9 d120 d7c5  ... ......... ..
000ed10: ddc5 d3d4 d7c5 cece cfc7 cf20 0ade c9d3  ........... ....
000ed20: ccc1 2c20 d7c1 d6ce c5ca dbc9 cd20 c5c7  .., ......... ..
000ed30: cf20 d3d7 cfca d3d4 d7cf cd20 d1d7 ccd1  . ......... ....
000ed40: c5d4 d3d1 20cb cfce c5de cecf d3d4 d820  .... .......... 
000ed50: d0d2 cfc7 d2c1 cdcd d92d d0d2 c5c4 d3d4  .........-......
000ed60: c1d7 ccc5 cec9 d12e 0a0a 2548 6f77 6576  ..........%Howev
000ed70: 6572 2c20 6769 7665 6e20 6f75 7220 6d6f  er, given our mo
000ed80: 6465 726e 2070 6572 7370 6563 7469 7665  dern perspective
000ed90: 2c20 7765 2063 616e 2073 6179 2074 6861  , we can say tha
000eda0: 7420 6166 7465 7220 616c 6c20 6d61 6e79  t after all many
000edb0: 206d 6f72 650a 256e 756d 6265 7273 2074   more.%numbers t
000edc0: 6861 6e20 4b72 6f6e 6563 6b65 7220 776f  han Kronecker wo
000edd0: 756c 6420 6861 7665 2061 6363 6570 7465  uld have accepte
000ede0: 6420 7b5c 656d 2064 6f7d 2068 6176 6520  d {\em do} have 
000edf0: 6120 6669 6e69 7465 0a25 7265 7072 6573  a finite.%repres
000ee00: 656e 7461 7469 6f6e 2c20 6e61 6d65 6c79  entation, namely
000ee10: 2074 6865 2070 726f 6772 616d 2c20 6f72   the program, or
000ee20: 2069 6e20 736f 6d65 206d 6f72 6520 6162   in some more ab
000ee30: 7374 7261 6374 2073 656e 7365 2074 6865  stract sense the
000ee40: 207b 5c65 6d0a 2572 756c 657d 2c20 7573   {\em.%rule}, us
000ee50: 6564 2074 6f20 6361 6c63 756c 6174 6520  ed to calculate 
000ee60: 7468 656d 2074 6f20 6772 6561 7465 7220  them to greater 
000ee70: 616e 6420 6772 6561 7465 7220 7072 6563  and greater prec
000ee80: 6973 696f 6e2e 2046 6f72 2065 7861 6d70  ision. For examp
000ee90: 6c65 2c20 7765 0a25 6361 6e20 7772 6974  le, we.%can writ
000eea0: 6520 6120 7072 6f67 7261 6d20 7468 6174  e a program that
000eeb0: 2077 696c 6c20 7072 6f64 7563 6520 666f   will produce fo
000eec0: 7220 616e 7920 6172 6775 6d65 6e74 2024  r any argument $
000eed0: 6e24 2074 6865 2066 6972 7374 2024 6e24  n$ the first $n$
000eee0: 2064 6967 6974 730a 256f 6620 245c 7069   digits.%of $\pi
000eef0: 242e 2041 6c74 6572 6e61 7469 7665 6c79  $. Alternatively
000ef00: 2069 7420 6361 6e20 7072 6f64 7563 6520   it can produce 
000ef10: 6120 7261 7469 6f6e 616c 206e 756d 6265  a rational numbe
000ef20: 7220 2472 2420 7375 6368 2074 6861 7420  r $r$ such that 
000ef30: 247c 5c70 6920 2d0a 2572 7c20 3c20 325e  $|\pi -.%r| < 2^
000ef40: 7b2d 6e7d 242e 2057 6861 7465 7665 7220  {-n}$. Whatever 
000ef50: 6170 7072 6f61 6368 2069 7320 7461 6b65  approach is take
000ef60: 6e20 746f 2074 6865 2073 7563 6365 7373  n to the success
000ef70: 6976 6520 6170 7072 6f78 696d 6174 696f  ive approximatio
000ef80: 6e20 6f66 2061 0a25 7265 616c 206e 756d  n of a.%real num
000ef90: 6265 722c 2074 6865 206b 6579 2070 6f69  ber, the key poi
000efa0: 6e74 2069 7320 7468 6174 2069 7473 2072  nt is that its r
000efb0: 6570 7265 7365 6e74 6174 696f 6e2c 2074  epresentation, t
000efc0: 6865 2070 726f 6772 616d 2069 7473 656c  he program itsel
000efd0: 662c 2069 730a 2566 696e 6974 652e 0a0a  f, is.%finite...
000efe0: f4c1 cbcf ca20 d0cf c4c8 cfc4 20cf d3cf  ..... ...... ...
000eff0: c2c5 cece cf20 c8cf d2cf dbcf 20d2 c5c1  ..... ...... ...
000f000: ccc9 dad5 c5d4 d3d1 20ce c120 d1da d9cb  ........ .. ....
000f010: c1c8 2c20 d0cf c4cf c2ce d9c8 7e4d 4c2c  .., ........~ML,
000f020: 20d0 d2c9 20d0 cfcd cfdd c90a c6d5 cecb   ... ...........
000f030: c3c9 ca20 d7d9 d3db c9c8 20d0 cfd2 d1c4  ... ...... .....
000f040: cbcf d72e 20f4 cf2c 20de d4cf 20cd d920  .... .., ... .. 
000f050: cec1 dad9 d7c1 ccc9 20d7 d9db c520 3c3c  ........ .... <<
000f060: d0d2 cfc7 d2c1 cdcd cfca 3e3e 2c20 d720  ..........>>, . 
000f070: 0a4d 4c2d d2c5 c1cc c9da c1c3 c9c9 20d3  .ML-.......... .
000f080: d4c1 cecf d7c9 d4d3 d120 d0d2 cfd3 d4cf  ......... ......
000f090: 20c6 d5ce cbc3 c9c5 ca2e 20e1 d2c9 c6cd   ......... .....
000f0a0: c5d4 c9de c5d3 cbc9 c520 cfd0 c5d2 c1c3  ......... ......
000f0b0: c9c9 20d0 d2c9 20dc d4cf cd0a d0d2 c5c4  .. ... .........
000f0c0: d3d4 c1d7 c9cd d920 c6d5 cecb c3c9 d1cd  ....... ........
000f0d0: c920 d7d9 d3db c9c8 20d0 cfd2 d1c4 cbcf  . ...... .......
000f0e0: d72c 20cb cfd4 cfd2 d9c5 20d0 cf20 dac1  ., ....... .. ..
000f0f0: c4c1 cece d9cd 200a c1d0 d0d2 cfcb d3c9  ...... .........
000f100: cdc1 c3c9 d1cd 7e24 7824 20c9 7e24 7924  ......~$x$ .~$y$
000f110: 20cb cfce d3d4 d2d5 c9d2 d5c0 d420 c1d0   ............ ..
000f120: d0d2 cfcb d3c9 cdc1 c3c9 c920 c4cc d17e  ........... ...~
000f130: 2478 202b 2079 242c 2024 7820 7924 2c20  $x + y$, $x y$, 
000f140: 0a24 5c73 696e 2878 2924 20c9 7ed4 2ec4  .$\sin(x)$ .~...
000f150: 2e20 f720 c2cf ccc5 c520 d4d2 c1c4 c9c3  . . ..... ......
000f160: c9cf cece d9c8 20d1 dad9 cbc1 c820 d0d2  ...... ...... ..
000f170: cfc7 d2c1 cdcd c9d2 cfd7 c1ce c9d1 20ce  .............. .
000f180: c1cd 20d0 d2c9 dbcc cfd3 d80a c2d9 20da  .. ........... .
000f190: c1c4 c1d4 d820 cbcf cecb d2c5 d4ce cfc5  ..... ..........
000f1a0: 20d0 d2c5 c4d3 d4c1 d7cc c5ce c9c5 20d0   ............. .
000f1b0: d2cf c7d2 c1cd cd2c 20ce c1d0 d2c9 cdc5  ......., .......
000f1c0: d22c 20c7 a3c4 c5cc c5d7 d520 ced5 cdc5  ., ........ ....
000f1d0: d2c1 c3c9 c02c 0ac9 20d2 c5c1 ccc9 dacf  .....,.. .......
000f1e0: d7c1 d4d8 20c4 ccd1 20ce c5c7 cf20 c9ce  .... ... .... ..
000f1f0: d4c5 d2d0 d2c5 d4c1 d4cf d22e 250a 5c66  ............%.\f
000f200: 6f6f 746e 6f74 657b 4566 6665 6374 6976  ootnote{Effectiv
000f210: 656c 792c 2077 6520 6172 650a 6d61 6e69  ely, we are.mani
000f220: 7075 6c61 7469 6e67 2066 756e 6374 696f  pulating functio
000f230: 6e73 2060 696e 2065 7874 656e 7369 6f6e  ns `in extension
000f240: 2720 7261 7468 6572 2074 6861 6e20 6069  ' rather than `i
000f250: 6e20 696e 7465 6e73 696f 6e27 2c20 692e  n intension', i.
000f260: 652e 206e 6f74 0a63 6f6e 6365 726e 696e  e. not.concernin
000f270: 6720 6f75 7273 656c 7665 7320 7769 7468  g ourselves with
000f280: 2074 6865 6972 2072 6570 7265 7365 6e74   their represent
000f290: 6174 696f 6e2e 7d0a 0a25 5468 6973 2077  ation.}..%This w
000f2a0: 6f72 6b73 2070 6172 7469 6375 6c61 726c  orks particularl
000f2b0: 7920 6e69 6365 6c79 2069 6e20 6120 6c61  y nicely in a la
000f2c0: 6e67 7561 6765 206c 696b 6520 4d4c 2077  nguage like ML w
000f2d0: 6865 7265 2068 6967 6865 7220 6f72 6465  here higher orde
000f2e0: 720a 2566 756e 6374 696f 6e73 2061 7265  r.%functions are
000f2f0: 2061 7661 696c 6162 6c65 2e20 5768 6174   available. What
000f300: 2077 6520 6861 7665 2063 616c 6c65 6420   we have called 
000f310: 6120 6070 726f 6772 616d 2720 6162 6f76  a `program' abov
000f320: 6520 7769 6c6c 206a 7573 7420 6265 2061  e will just be a
000f330: 6e0a 254d 4c20 6675 6e63 7469 6f6e 2e20  n.%ML function. 
000f340: 5765 2063 616e 2061 6374 7561 6c6c 7920  We can actually 
000f350: 7265 7072 6573 656e 7420 7468 6520 6172  represent the ar
000f360: 6974 686d 6574 6963 206f 7065 7261 7469  ithmetic operati
000f370: 6f6e 7320 6f6e 206e 756d 6265 7273 2061  ons on numbers a
000f380: 730a 2568 6967 6865 7220 6f72 6465 7220  s.%higher order 
000f390: 6675 6e63 7469 6f6e 7320 7468 6174 2c20  functions that, 
000f3a0: 6769 7665 6e20 6675 6e63 7469 6f6e 7320  given functions 
000f3b0: 666f 7220 6170 7072 6f78 696d 6174 696e  for approximatin
000f3c0: 6720 2478 2420 616e 6420 2479 242c 0a25  g $x$ and $y$,.%
000f3d0: 7769 6c6c 2070 726f 6475 6365 206e 6577  will produce new
000f3e0: 206f 6e65 7320 666f 7220 6170 7072 6f78   ones for approx
000f3f0: 696d 6174 696e 6720 2478 202b 2079 242c  imating $x + y$,
000f400: 2024 7820 7924 2c20 2473 696e 2878 2924   $x y$, $sin(x)$
000f410: 2061 6e64 2073 6f20 6f6e 2c20 666f 720a   and so on, for.
000f420: 2561 2077 6964 6520 7261 6e67 6520 6f66  %a wide range of
000f430: 2066 756e 6374 696f 6e73 2e20 496e 2061   functions. In a
000f440: 6e20 6f72 6469 6e61 7279 2070 726f 6772  n ordinary progr
000f450: 616d 6d69 6e67 206c 616e 6775 6167 652c  amming language,
000f460: 2077 6520 776f 756c 6420 6e65 6564 0a25   we would need.%
000f470: 746f 2064 6566 696e 6520 6120 636f 6e63  to define a conc
000f480: 7265 7465 2072 6570 7265 7365 6e74 6174  rete representat
000f490: 696f 6e20 666f 7220 7072 6f67 7261 6d73  ion for programs
000f4a0: 2c20 652e 672e 2060 475c 226f 6465 6c20  , e.g. `G\"odel 
000f4b0: 6e75 6d62 6572 696e 6727 2c20 616e 640a  numbering', and.
000f4c0: 2577 7269 7465 2061 6e20 696e 7465 7270  %write an interp
000f4d0: 7265 7465 7220 666f 7220 7468 6973 2072  reter for this r
000f4e0: 6570 7265 7365 6e74 6174 696f 6e2e 5c66  epresentation.\f
000f4f0: 6f6f 746e 6f74 657b 4566 6665 6374 6976  ootnote{Effectiv
000f500: 656c 792c 2077 6520 6172 650a 256d 616e  ely, we are.%man
000f510: 6970 756c 6174 696e 6720 6675 6e63 7469  ipulating functi
000f520: 6f6e 7320 6069 6e20 6578 7465 6e73 696f  ons `in extensio
000f530: 6e27 2072 6174 6865 7220 7468 616e 2060  n' rather than `
000f540: 696e 2069 6e74 656e 7369 6f6e 272c 2069  in intension', i
000f550: 2e65 2e20 6e6f 740a 2563 6f6e 6365 726e  .e. not.%concern
000f560: 696e 6720 6f75 7273 656c 7665 7320 7769  ing ourselves wi
000f570: 7468 2074 6865 6972 2072 6570 7265 7365  th their represe
000f580: 6e74 6174 696f 6e2e 7d0a 0a5c 7375 6273  ntation.}..\subs
000f590: 6563 7469 6f6e 7bf7 d9c2 cfd2 20d0 d2c5  ection{..... ...
000f5a0: c4d3 d4c1 d7cc c5ce c9d1 20d7 c5dd c5d3  .......... .....
000f5b0: d4d7 c5ce ced9 c820 dec9 d3c5 cc7d 0a25  ....... .....}.%
000f5c0: 5c73 7562 7365 6374 696f 6e7b 5265 7072  \subsection{Repr
000f5d0: 6573 656e 7461 7469 6f6e 206f 6620 7265  esentation of re
000f5e0: 616c 206e 756d 6265 7273 7d0a 0aeb c1d6  al numbers}.....
000f5f0: c4cf cdd5 20d7 c5dd c5d3 d4d7 c5ce cecf  .... ...........
000f600: cdd5 20de c9d3 ccd5 7e24 7824 20d0 cfd3  .. .....~$x$ ...
000f610: d4c1 d7c9 cd20 d720 d3cf cfd4 d7c5 d4d3  ..... . ........
000f620: d4d7 c9c5 200a c6d5 cecb c3c9 c07e 2466  .... ........~$f
000f630: 5f78 3a5c 6e61 7420 5c74 6f20 5c6e 756d  _x:\nat \to \num
000f640: 242c 20cb cfd4 cfd2 c1d1 20c4 ccd1 20d0  $, ....... ... .
000f650: d2cf c9da d7cf ccd8 cecf c7cf 7e24 6e20  ............~$n 
000f660: 5c69 6e20 5c6e 6174 240a d7cf dad7 d2c1  \in \nat$.......
000f670: ddc1 c5d4 20cd c1d3 dbd4 c1c2 c9d2 cfd7  .... ...........
000f680: c1ce cecf c520 d0d2 c9c2 ccc9 d6c5 cece  ..... ..........
000f690: cfc5 20da cec1 dec5 cec9 c57e 2478 2420  .. ........~$x$ 
000f6a0: d320 d4cf dece cfd3 d4d8 c07e 2432 5e7b  . .........~$2^{
000f6b0: 2d6e 7d24 3a0a 2424 200a 207c 665f 7828  -n}$:.$$ . |f_x(
000f6c0: 6e29 202d 2032 5e6e 2078 7c20 3c20 312e  n) - 2^n x| < 1.
000f6d0: 0a24 240a f720 d3d7 cfc0 20cf dec5 d2c5  .$$.. .... .....
000f6e0: c4d8 2c20 c4c1 cece cfc5 20d7 d9d2 c1d6  .., ...... .....
000f6f0: c5ce c9c5 200a dccb d7c9 d7c1 ccc5 ced4  .... ...........
000f700: cecf 7e24 7c7b 665f 7828 6e29 205c 6f76  ..~$|{f_x(n) \ov
000f710: 6572 2032 5e6e 7d20 2d20 787c 203c 207b  er 2^n} - x| < {
000f720: 3120 5c6f 7665 7220 325e 6e7d 242e 20f4  1 \over 2^n}$. .
000f730: c1cb d6c5 20d7 cfda cdcf d6ce cf0a cec5  .... ...........
000f740: d0cf d3d2 c5c4 d3d4 d7c5 cece cfc5 20d7  .............. .
000f750: d9de c9d3 ccc5 cec9 c520 d2c1 c3c9 cfce  ......... ......
000f760: c1cc d8ce cfc7 cf20 d0d2 c9c2 ccc9 d6c5  ....... ........
000f770: cece cfc7 cf20 dace c1de c5ce c9d1 2c20  ..... ........, 
000f780: cecf 20c4 ccd1 0ad5 c4cf c2d3 d4d7 c120  .. ............ 
000f790: d7d9 dec9 d3cc c5ce c9ca 20d7 c1d6 cecf  .......... .....
000f7a0: 2c20 ded4 cfc2 d920 dace c1cd c5ce c1d4  , ..... ........
000f7b0: c5cc c920 d7d3 c5c8 20d7 d9de c9d3 ccd1  ... .... .......
000f7c0: c5cd d9c8 20d7 c5cc c9de c9ce 0ac2 d9cc  .... ...........
000f7d0: c920 d0d2 c5c4 d3d4 c1d7 c9cd d920 d720  . ........... . 
000f7e0: d7c9 c4c5 20d3 d4c5 d0c5 cec5 ca20 cec5  .... ........ ..
000f7f0: cbcf d4cf d2cf c7cf 20de c9d3 ccc1 2e20  ........ ...... 
000f800: f0cf c4cf c2ce cfc5 20cf c7d2 c1ce c9de  ........ .......
000f810: c5ce c9c5 200a d0cf dad7 cfcc c9d4 20c9  .... ......... .
000f820: dac2 c5d6 c1d4 d820 ccc1 d7c9 cecf cfc2  ....... ........
000f830: d2c1 dace cfc7 cf20 d2cf d3d4 c120 cfc2  ....... ..... ..
000f840: ddc5 c7cf 20da cec1 cdc5 cec1 d4c5 ccd1  .... ...........
000f850: 20d0 d2c9 20d3 d5cd cdc9 d2cf d7c1 cec9   ... ...........
000f860: c92e 0af1 d7ce cfc5 20cd c1d3 dbd4 c1c2  ........ .......
000f870: c9d2 cfd7 c1ce c9c5 20d5 d0d2 cfdd c1c5  ........ .......
000f880: d420 d2c5 c1cc c9da c1c3 c9c0 20cf d0c5  . .......... ...
000f890: d2c1 c3c9 ca2c 20d0 cfda d7cf ccd1 d120  ....., ........ 
000f8a0: cfc7 d2c1 cec9 dec9 d4d8 d3d1 0acc c9db  ................
000f8b0: d820 c3c5 cccf dec9 d3cc c5ce cecf ca20  . ............. 
000f8c0: c1d2 c9c6 cdc5 d4c9 cbcf ca2e 20f7 d9c2  ............ ...
000f8d0: cfd2 7e24 3224 20d7 20cb c1de c5d3 d4d7  ..~$2$ . .......
000f8e0: c520 cfd3 cecf d7c1 cec9 d120 d0d2 cfc9  . ......... ....
000f8f0: dad7 cfcc c5ce 2e0a edc1 ccd9 c520 cfd3  ............. ..
000f900: cecf d7c1 cec9 d120 d0d2 c5c4 d0cf ded4  ....... ........
000f910: c9d4 c5cc d8ce c5c5 20d4 c5cd 2c20 ded4  ........ ..., ..
000f920: cf20 d0cf dad7 cfcc d1c0 d420 d0cf c4c2  . ......... ....
000f930: c9d2 c1d4 d820 d0cf c4c8 cfc4 d1dd d5c0  ..... ..........
000f940: 0ad4 cfde cecf d3d4 d820 c2cf ccc5 c520  ......... ..... 
000f950: c7c9 c2cb cf2e 20ee c1d0 d2c9 cdc5 d22c  ...... ........,
000f960: 20d7 d9c2 cfd2 20cf d3ce cfd7 c1ce c9d1   ..... .........
000f970: 7e24 3130 2420 d7c5 c4a3 d420 cb20 d4cf  ~$10$ ..... . ..
000f980: cdd5 2c20 ded4 cf20 c4c1 d6c5 0ad0 d2c9  .., ... ........
000f990: 20ce c5cf c2c8 cfc4 c9cd cfd3 d4c9 20ce   ............. .
000f9a0: c5c2 cfcc d8db cfc7 cf20 d5d7 c5cc c9de  ......... ......
000f9b0: c5ce c9d1 20d4 cfde cecf d3d4 c920 d0d2  .... ........ ..
000f9c0: c5c4 d3d4 c1d7 ccc5 cec9 d120 cdd9 20d7  ........... .. .
000f9d0: d9ce d5d6 c4c5 ced9 0ad5 d7c5 ccc9 dec9  ................
000f9e0: d7c1 d4d8 20c5 a320 d720 3130 7ed2 c1da  .... .. . 10~...
000f9f0: 2e0a 254f 7572 2061 7070 726f 6163 6820  ..%Our approach 
000fa00: 6973 2074 6f20 7265 7072 6573 656e 7420  is to represent 
000fa10: 6120 7265 616c 2024 7824 2062 7920 6120  a real $x$ by a 
000fa20: 6675 6e63 7469 6f6e 2024 665f 783a 5c6e  function $f_x:\n
000fa30: 6174 205c 746f 205c 6e75 6d24 2074 6861  at \to \num$ tha
000fa40: 740a 2566 6f72 2065 6163 6820 246e 205c  t.%for each $n \
000fa50: 696e 205c 6e61 7424 2072 6574 7572 6e73  in \nat$ returns
000fa60: 2061 6e20 6170 7072 6f78 696d 6174 696f   an approximatio
000fa70: 6e20 6f66 2024 7824 2074 6f20 7769 7468  n of $x$ to with
000fa80: 696e 2024 325e 7b2d 6e7d 242c 0a25 6170  in $2^{-n}$,.%ap
000fa90: 7072 6f70 7269 6174 656c 7920 7363 616c  propriately scal
000faa0: 6564 2e20 496e 2066 6163 742c 2077 6520  ed. In fact, we 
000fab0: 6861 7665 3a0a 250a 2524 2420 7c66 5f78  have:.%.%$$ |f_x
000fac0: 286e 2920 2d20 325e 6e20 787c 203c 2031  (n) - 2^n x| < 1
000fad0: 2024 240a 250a 2554 6869 7320 6973 206f   $$.%.%This is o
000fae0: 6620 636f 7572 7365 2065 7175 6976 616c  f course equival
000faf0: 656e 7420 746f 2024 7c7b 665f 7828 6e29  ent to $|{f_x(n)
000fb00: 205c 6f76 6572 2032 5e6e 7d20 2d20 787c   \over 2^n} - x|
000fb10: 203c 207b 3120 5c6f 7665 7220 325e 6e7d   < {1 \over 2^n}
000fb20: 242e 2057 650a 2563 6f75 6c64 2072 6574  $. We.%could ret
000fb30: 7572 6e20 6120 7261 7469 6f6e 616c 2061  urn a rational a
000fb40: 7070 726f 7869 6d61 7469 6f6e 2064 6972  pproximation dir
000fb50: 6563 746c 792c 2062 7574 2069 7420 776f  ectly, but it wo
000fb60: 756c 6420 7374 696c 6c20 6265 0a25 636f  uld still be.%co
000fb70: 6e76 656e 6965 6e74 2066 6f72 2074 6865  nvenient for the
000fb80: 2072 6174 696f 6e61 6c73 2074 6f20 6861   rationals to ha
000fb90: 7665 2064 656e 6f6d 696e 6174 6f72 7320  ve denominators 
000fba0: 7468 6174 2061 7265 2061 6c6c 2070 6f77  that are all pow
000fbb0: 6572 7320 6f66 2073 6f6d 650a 256e 756d  ers of some.%num
000fbc0: 6265 722c 2073 6f20 7468 6174 2063 6f6d  ber, so that com
000fbd0: 6d6f 6e20 6465 6e6f 6d69 6e61 746f 7273  mon denominators
000fbe0: 2061 7269 7369 6e67 2064 7572 696e 6720   arising during 
000fbf0: 6164 6469 7469 6f6e 2064 6f6e 2774 2067  addition don't g
000fc00: 6574 2074 6f6f 2062 6967 2e0a 2550 6572  et too big..%Per
000fc10: 666f 726d 696e 6720 7468 6520 7363 616c  forming the scal
000fc20: 696e 6720 6469 7265 6374 6c79 2073 6565  ing directly see
000fc30: 6d73 2073 696d 706c 6572 2c20 7265 7175  ms simpler, requ
000fc40: 6972 696e 6720 6f6e 6c79 2069 6e74 6567  iring only integ
000fc50: 6572 0a25 6172 6974 686d 6574 6963 2e20  er.%arithmetic. 
000fc60: 4f75 7220 6368 6f69 6365 206f 6620 7468  Our choice of th
000fc70: 6520 6261 7365 2024 3224 2069 7320 6c61  e base $2$ is la
000fc80: 7267 656c 7920 6172 6269 7472 6172 792e  rgely arbitrary.
000fc90: 2041 206c 6f77 6572 2062 6173 6520 6973   A lower base is
000fca0: 0a25 6e6f 726d 616c 6c79 2061 6476 616e  .%normally advan
000fcb0: 7461 6765 6f75 7320 6265 6361 7573 6520  tageous because 
000fcc0: 6974 206d 696e 696d 697a 6573 2074 6865  it minimizes the
000fcd0: 207b 5c65 6d20 6772 616e 756c 6172 6974   {\em granularit
000fce0: 797d 206f 6620 7468 650a 2561 6368 6965  y} of the.%achie
000fcf0: 7661 626c 6520 6163 6375 7261 6369 6573  vable accuracies
000fd00: 2e20 466f 7220 6578 616d 706c 652c 2069  . For example, i
000fd10: 6620 7765 2075 7365 6420 6261 7365 2031  f we used base 1
000fd20: 302c 2074 6865 6e20 6576 656e 2069 6620  0, then even if 
000fd30: 7765 206f 6e6c 790a 256e 6565 6420 746f  we only.%need to
000fd40: 2069 6e63 7265 6173 6520 7468 6520 6163   increase the ac
000fd50: 6375 7261 6379 206f 6620 616e 2061 7070  curacy of an app
000fd60: 726f 7869 6d61 7469 6f6e 2073 6c69 6768  roximation sligh
000fd70: 746c 792c 2077 6520 6861 7665 2074 6f20  tly, we have to 
000fd80: 7374 6570 2075 700a 2574 6865 2072 6571  step up.%the req
000fd90: 7565 7374 6564 2061 6363 7572 6163 7920  uested accuracy 
000fda0: 6279 2061 2066 6163 746f 7220 6f66 2031  by a factor of 1
000fdb0: 302e 0a0a 5c73 7562 7365 6374 696f 6e7b  0...\subsection{
000fdc0: e3c5 ccd9 c520 dec9 d3cc c120 d0d2 cfc9  ..... ..... ....
000fdd0: dad7 cfcc d8ce cfca 20d2 c1da d2d1 c4ce  ........ .......
000fde0: cfd3 d4c9 7d0a 255c 7375 6273 6563 7469  ....}.%\subsecti
000fdf0: 6f6e 7b41 7262 6974 7261 7279 2d70 7265  on{Arbitrary-pre
000fe00: 6369 7369 6f6e 2069 6e74 6567 6572 737d  cision integers}
000fe10: 0a0a f3d4 c1ce c4c1 d2d4 ced9 ca20 c3c5  ............. ..
000fe20: cccf dec9 d3cc c5ce ced9 ca20 d4c9 d020  ........... ... 
000fe30: 287b 5c74 7420 696e 747d 2920 d720 4341  ({\tt int}) . CA
000fe40: 4d4c 20c9 cdc5 d420 c4cf d7cf ccd8 cecf  ML .... ........
000fe50: 20cf c7d2 c1ce c9de c5ce ced9 ca20 0ac4   ............ ..
000fe60: c9c1 d0c1 dacf ce20 d0d2 c5c4 d3d4 c1d7  ....... ........
000fe70: c9cd d9c8 20da cec1 dec5 cec9 ca2c 20d0  .... ........, .
000fe80: cfdc d4cf cdd5 20ce c1cd 20d0 d2c5 d6c4  ...... ... .....
000fe90: c520 d7d3 c5c7 cf20 d0cf d4d2 c5c2 d5c5  . ..... ........
000fea0: d4d3 d120 0ad7 cfda cdcf d6ce cfd3 d4d8  ... ............
000feb0: 20cf d0c5 d2c9 d2cf d7c1 d4d8 20c3 c5cc   ........... ...
000fec0: d9cd c920 dec9 d3cc c1cd c920 cec5 cfc7  ... ....... ....
000fed0: d2c1 cec9 dec5 cece cfca 20d2 c1da d2d1  .......... .....
000fee0: c4ce cfd3 d4c9 2e0a f0d2 cfc7 d2c1 cdcd  ................
000fef0: cec1 d120 d2c5 c1cc c9da c1c3 c9d1 20d0  ... .......... .
000ff00: cfc4 cfc2 cecf ca20 c1d2 c9c6 cdc5 d4c9  ....... ........
000ff10: cbc9 20ce c520 d3cc c9db cbcf cd20 d3cc  .. .. ....... ..
000ff20: cfd6 cec1 2c20 cecf 20ce c5d3 cbcf ccd8  ...., .. .......
000ff30: cbcf 0ad5 d4cf cdc9 d4c5 ccd8 cec1 2e20  ............... 
000ff40: eb20 d3de c1d3 d4d8 c02c 20d7 c5d2 d3c9  . ......., .....
000ff50: d120 4341 4d4c 204c 6967 6874 2c20 d5d3  . CAML Light, ..
000ff60: d4c1 cecf d7cc c5ce cec1 d120 cec1 2054  ........... .. T
000ff70: 686f 722c 20d5 d6c5 20d7 cbcc c0de c1c5  hor, ... .......
000ff80: d420 0ad7 20d3 c5c2 d120 c2c9 c2cc c9cf  . .. .... ......
000ff90: d4c5 cbd5 20c2 d9d3 d4d2 d9c8 20c1 ccc7  .... ....... ...
000ffa0: cfd2 c9d4 cdcf d720 c3c5 cccf dec9 d3cc  ....... ........
000ffb0: c5ce cecf ca20 28ce c120 d3c1 cdcf cd20  ..... (.. ..... 
000ffc0: c4c5 ccc5 2c20 d2c1 c3c9 cfce c1cc d8ce  ...., ..........
000ffd0: cfca 2920 0ac1 d2c9 c6cd c5d4 c9cb c92e  ..) ............
000ffe0: 20f0 d2c5 c4d0 cfcc cfd6 c9cd 2c20 ded4   ..........., ..
000fff0: cf20 cbcf cec6 c9c7 d5d2 c1c3 c9d1 20d3  . ............ .
0010000: c9d3 d4c5 cdd9 20da c1c4 c1c5 d420 d3cc  ...... ...... ..
0010010: c5c4 d5c0 ddc9 c520 d0d5 d4c9 20d0 cfc9  ....... .... ...
0010020: d3cb c10a c9d3 d0cf ccce c9cd d9c8 20c6  .............. .
0010030: c1ca cccf d73a 0a25 0a5c 6265 6769 6e7b  .....:.%.\begin{
0010040: 626f 7865 647d 5c62 6567 696e 7b6c 7374  boxed}\begin{lst
0010050: 6c69 7374 696e 677d 5b6c 616e 6775 6167  listing}[languag
0010060: 653d 7368 5d0a 2020 5041 5448 3d22 2450  e=sh].  PATH="$P
0010070: 4154 483a 2f68 6f6d 652f 6a72 6831 332f  ATH:/home/jrh13/
0010080: 6361 6d6c 2f62 696e 220a 2020 6578 706f  caml/bin".  expo
0010090: 7274 2050 4154 480a 5c65 6e64 7b6c 7374  rt PATH.\end{lst
00100a0: 6c69 7374 696e 677d 5c65 6e64 7b62 6f78  listing}\end{box
00100b0: 6564 7d0a 250a f720 dcd4 cfcd 20d3 ccd5  ed}.%.. .... ...
00100c0: dec1 c520 4341 4d4c 2dd3 c9d3 d4c5 cdc1  ... CAML-.......
00100d0: 20d3 20d0 cfc4 c4c5 d2d6 cbcf ca20 3c3c   . .......... <<
00100e0: c4cc c9ce cecf ca3e 3e20 c1d2 c9c6 cdc5  .......>> ......
00100f0: d4c9 cbc9 20da c1d0 d5d3 cbc1 c5d4 d3d1  .... ...........
0010100: 200a cbcf cdc1 cec4 cfca 3a0a 5c62 6567   .........:.\beg
0010110: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
0010120: 7665 7262 6174 696d 7d0a 2020 2420 6361  verbatim}.  $ ca
0010130: 6d6c 6c69 6768 7420 6d79 5f6c 6974 746c  mllight my_littl
0010140: 655f 6361 6d6c 0a5c 656e 647b 7665 7262  e_caml.\end{verb
0010150: 6174 696d 7d5c 656e 647b 626f 7865 647d  atim}\end{boxed}
0010160: 0a0a 2543 414d 4c27 7320 7374 616e 6461  ..%CAML's standa
0010170: 7264 2069 6e74 6567 6572 7320 2874 7970  rd integers (typ
0010180: 6520 7b5c 7474 2069 6e74 7d29 2068 6176  e {\tt int}) hav
0010190: 6520 6120 7365 7665 7265 6c79 206c 696d  e a severely lim
00101a0: 6974 6564 2072 616e 6765 2c20 736f 0a25  ited range, so.%
00101b0: 6669 7273 7420 6f66 2061 6c6c 2077 6520  first of all we 
00101c0: 6e65 6564 2074 6f20 7365 7420 7570 2061  need to set up a
00101d0: 2074 7970 6520 6f66 2075 6e6c 696d 6974   type of unlimit
00101e0: 6564 2d70 7265 6369 7369 6f6e 2069 6e74  ed-precision int
00101f0: 6567 6572 732e 2054 6869 7320 6973 0a25  egers. This is.%
0010200: 6e6f 7420 736f 2064 6966 6669 6375 6c74  not so difficult
0010210: 2074 6f20 7072 6f67 7261 6d2c 2062 7574   to program, but
0010220: 2069 7320 736c 6967 6874 6c79 2074 6564   is slightly ted
0010230: 696f 7573 2e20 466f 7274 756e 6174 656c  ious. Fortunatel
0010240: 792c 2074 6865 2043 414d 4c0a 2572 656c  y, the CAML.%rel
0010250: 6561 7365 2069 6e63 6c75 6465 7320 6120  ease includes a 
0010260: 6c69 6272 6172 7920 7468 6174 2067 6976  library that giv
0010270: 6573 2061 2066 6173 7420 696d 706c 656d  es a fast implem
0010280: 656e 7461 7469 6f6e 206f 6620 6172 6269  entation of arbi
0010290: 7472 6172 790a 2570 7265 6369 7369 6f6e  trary.%precision
00102a0: 2069 6e74 6567 6572 2028 616e 6420 696e   integer (and in
00102b0: 2066 6163 7420 7261 7469 6f6e 616c 2920   fact rational) 
00102c0: 6172 6974 686d 6574 6963 2e20 4120 7665  arithmetic. A ve
00102d0: 7273 696f 6e20 6f66 2043 414d 4c20 4c69  rsion of CAML Li
00102e0: 6768 740a 2577 6974 6820 7468 6973 206c  ght.%with this l
00102f0: 6962 7261 7279 2070 7265 2d6c 6f61 6465  ibrary pre-loade
0010300: 6420 6973 2069 6e73 7461 6c6c 6564 206f  d is installed o
0010310: 6e20 5468 6f72 2e20 4173 7375 6d69 6e67  n Thor. Assuming
0010320: 2079 6f75 2068 6176 6520 7573 6564 2074   you have used t
0010330: 6865 0a25 666f 6c6c 6f77 696e 6720 7061  he.%following pa
0010340: 7468 2073 6574 7469 6e67 3a0a 250a 255c  th setting:.%.%\
0010350: 6265 6769 6e7b 626f 7865 647d 5c62 6567  begin{boxed}\beg
0010360: 696e 7b6c 7374 6c69 7374 696e 677d 5b6c  in{lstlisting}[l
0010370: 616e 6775 6167 653d 7368 5d0a 2520 2050  anguage=sh].%  P
0010380: 4154 483d 2224 5041 5448 3a2f 686f 6d65  ATH="$PATH:/home
0010390: 2f6a 7268 3133 2f63 616d 6c2f 6269 6e22  /jrh13/caml/bin"
00103a0: 0a25 2020 6578 706f 7274 2050 4154 480a  .%  export PATH.
00103b0: 255c 656e 647b 6c73 746c 6973 7469 6e67  %\end{lstlisting
00103c0: 7d5c 656e 647b 626f 7865 647d 0a25 0a25  }\end{boxed}.%.%
00103d0: 5c6e 6f69 6e64 656e 7420 7468 656e 2074  \noindent then t
00103e0: 6865 2061 7567 6d65 6e74 6564 2076 6572  he augmented ver
00103f0: 7369 6f6e 206f 6620 4341 4d4c 204c 6967  sion of CAML Lig
0010400: 6874 2063 616e 2062 6520 6669 7265 6420  ht can be fired 
0010410: 7570 2075 7369 6e67 3a0a 250a 255c 6265  up using:.%.%\be
0010420: 6769 6e7b 626f 7865 647d 5c62 6567 696e  gin{boxed}\begin
0010430: 7b76 6572 6261 7469 6d7d 0a25 2020 2420  {verbatim}.%  $ 
0010440: 6361 6d6c 6c69 6768 7420 6d79 5f6c 6974  camllight my_lit
0010450: 746c 655f 6361 6d6c 0a25 5c65 6e64 7b76  tle_caml.%\end{v
0010460: 6572 6261 7469 6d7d 5c65 6e64 7b62 6f78  erbatim}\end{box
0010470: 6564 7d0a 0af0 cfd3 ccc5 20da c1d0 d5d3  ed}....... .....
0010480: cbc1 20d3 c9d3 d4c5 cdd9 20c9 d3d0 cfcc  .. ....... .....
0010490: d8da d5ca d4c5 20c4 c9d2 c5cb d4c9 d7d5  ...... .........
00104a0: 7e7b 5c76 6572 622b 236f 7065 6e2b 7d20  ~{\verb+#open+} 
00104b0: c4cc d120 d0cf ccd5 dec5 cec9 d120 0ac4  ... ......... ..
00104c0: cfd3 d4d5 d0c1 20cb cf20 d7d3 c5cd 20c6  ...... .. .... .
00104d0: d5ce cbc3 c9d1 cd20 c2c9 c2cc c9cf d4c5  ....... ........
00104e0: cbc9 3a0a 250a 5c62 6567 696e 7b62 6f78  ..:.%.\begin{box
00104f0: 6564 7d5c 6265 6769 6e7b 7665 7262 6174  ed}\begin{verbat
0010500: 696d 7d0a 2020 2323 6f70 656e 2022 6e75  im}.  ##open "nu
0010510: 6d22 3b3b 0a5c 656e 647b 7665 7262 6174  m";;.\end{verbat
0010520: 696d 7d5c 656e 647b 626f 7865 647d 0a0a  im}\end{boxed}..
0010530: 2557 6865 6e20 7468 6520 7379 7374 656d  %When the system
0010540: 2072 6574 7572 6e73 2069 7473 2070 726f   returns its pro
0010550: 6d70 742c 2075 7365 2074 6865 207b 5c76  mpt, use the {\v
0010560: 6572 622b 236f 7065 6e2b 7d20 6469 7265  erb+#open+} dire
0010570: 6374 6976 6520 746f 206d 616b 650a 2574  ctive to make.%t
0010580: 6865 206c 6962 7261 7279 2066 756e 6374  he library funct
0010590: 696f 6e73 2061 7661 696c 6162 6c65 3a0a  ions available:.
00105a0: 250a 255c 6265 6769 6e7b 626f 7865 647d  %.%\begin{boxed}
00105b0: 5c62 6567 696e 7b76 6572 6261 7469 6d7d  \begin{verbatim}
00105c0: 0a25 2020 2323 6f70 656e 2022 6e75 6d22  .%  ##open "num"
00105d0: 3b3b 0a25 5c65 6e64 7b76 6572 6261 7469  ;;.%\end{verbati
00105e0: 6d7d 5c65 6e64 7b62 6f78 6564 7d0a 0af7  m}\end{boxed}...
00105f0: 20c2 c9c2 ccc9 cfd4 c5cb c520 cfd0 d2c5   .......... ....
0010600: c4c5 ccd1 c5d4 d3d1 20ce cfd7 d9ca 20d4  ........ ..... .
0010610: c9d0 20c4 c1ce ced9 c820 7b5c 7474 206e  .. ...... {\tt n
0010620: 756d 7d2c 20d0 d2c5 c4d3 d4c1 d7cc d1c0  um}, ...........
0010630: ddc9 ca0a d2c1 c3c9 cfce c1cc d8ce d9c5  ................
0010640: 20de c9d3 ccc1 20d0 d2cf c9da d7cf ccd8   ..... .........
0010650: cecf ca20 d2c1 dad2 d1c4 cecf d3d4 c92c  ... ...........,
0010660: 20d3 d2c5 c4c9 20cb cfd4 cfd2 d9c8 20ce   ..... ....... .
0010670: c1cd 20d0 cfce c1c4 cfc2 c9d4 d3d1 200a  .. ........... .
0010680: ccc9 dbd8 20d0 cfc4 cdce cfd6 c5d3 d4d7  .... ...........
0010690: cf20 c3c5 ccd9 c820 dec9 d3c5 cc2e 20f1  . ..... ...... .
00106a0: dad9 cb20 4341 4d4c 20ce c520 d0d2 c5c4  ... CAML .. ....
00106b0: cfd3 d4c1 d7cc d1c5 d420 d7cf dacd cfd6  ......... ......
00106c0: cecf d3d4 c920 0ad0 c5d2 c5c7 d2d5 dacb  ..... ..........
00106d0: c920 cfd0 c5d2 c1c3 c9ca 2c20 d0cf dcd4  . ........, ....
00106e0: cfcd d520 c4cc d120 cfc2 cfda cec1 dec5  ... ... ........
00106f0: cec9 d120 c1d2 c9c6 cdc5 d4c9 dec5 d3cb  ... ............
0010700: c9c8 20c4 c5ca d3d4 d7c9 ca20 0ace c1c4  .. ........ ....
0010710: 7e7b 5c74 7420 6e75 6d7d 20d0 d2c9 c8cf  ~{\tt num} .....
0010720: c4c9 d4d3 d120 c9d3 d0cf ccd8 dacf d7c1  ..... ..........
0010730: d4d8 20c4 d2d5 c7c9 c520 d3c9 cdd7 cfcc  .. ...... ......
0010740: d92e 0a0a 2554 6869 7320 6c69 6272 6172  ....%This librar
0010750: 7920 7365 7473 2075 7020 6120 6e65 7720  y sets up a new 
0010760: 7479 7065 207b 5c74 7420 6e75 6d7d 206f  type {\tt num} o
0010770: 6620 6172 6269 7472 6172 7920 7072 6563  f arbitrary prec
0010780: 6973 696f 6e20 7261 7469 6f6e 616c 0a25  ision rational.%
0010790: 6e75 6d62 6572 733b 2077 6520 7769 6c6c  numbers; we will
00107a0: 206a 7573 7420 7573 6520 7468 6520 696e   just use the in
00107b0: 7465 6765 7220 7375 6273 6574 2e20 4341  teger subset. CA
00107c0: 4d4c 2064 6f65 7320 6e6f 7420 7072 6f76  ML does not prov
00107d0: 6964 650a 256f 7665 726c 6f61 6469 6e67  ide.%overloading
00107e0: 2c20 736f 2069 7420 6973 206e 6563 6573  , so it is neces
00107f0: 7361 7279 2074 6f20 7573 6520 6469 6666  sary to use diff
0010800: 6572 656e 7420 7379 6d62 6f6c 7320 666f  erent symbols fo
0010810: 7220 7468 6520 7573 7561 6c0a 2561 7269  r the usual.%ari
0010820: 7468 6d65 7469 6320 6f70 6572 6174 696f  thmetic operatio
0010830: 6e73 206f 7665 7220 7b5c 7474 206e 756d  ns over {\tt num
0010840: 7d2e 0a0a efd4 cdc5 d4c9 cd2c 20de d4cf  }.........., ...
0010850: 20de c9d3 ccc1 2dcb cfce d3d4 c1ce d4d9   .....-.........
0010860: 20d4 c9d0 c17e 7b5c 7474 206e 756d 7d20   ....~{\tt num} 
0010870: c4cf ccd6 ced9 20da c1c4 c1d7 c1d4 d8d3  ...... .........
0010880: d120 cbc1 cb7e 7b5c 7474 2049 6e74 206b  . ...~{\tt Int k
0010890: 7d2c 200a c120 cec5 20d0 d2cf d3d4 cf7e  }, .. .. ......~
00108a0: 7b5c 7474 206b 7d2e 20e6 c1cb d4c9 dec5  {\tt k}. .......
00108b0: d3cb c92c 207b 5c74 7420 496e 747d 7ed1  ..., {\tt Int}~.
00108c0: d7cc d1c5 d4d3 d120 cbcf ced3 d4d2 d5cb  ....... ........
00108d0: d4cf d2cf cd20 0ad4 c9d0 c17e 7b5c 7474  ..... .....~{\tt
00108e0: 206e 756d 7d20 c920 d0d2 c9cd c5ce d1c5   num} . ........
00108f0: d4d3 d120 d720 d3cc d5de c1c5 2c20 cbcf  ... . ......, ..
0010900: c7c4 c120 dec9 d3cc cf20 c9cd c5c5 d420  ... ..... ..... 
0010910: d0d2 d1cd cfc5 20cd c1db c9ce cecf c520  ...... ........ 
0010920: 0ad0 d2c5 c4d3 d4c1 d7cc c5ce c9c5 2e20  ............... 
0010930: e2cf ccd8 dbc9 c520 dec9 d3cc c120 cbcf  ....... ..... ..
0010940: ced3 d4d2 d5c9 d2d5 c0d4 d3d1 7e7b 5c74  ............~{\t
0010950: 7420 4269 675c 5f69 6e74 7d2e 0a0a 254e  t Big\_int}...%N
0010960: 6f74 6520 7468 6174 2073 6d61 6c6c 2063  ote that small c
0010970: 6f6e 7374 616e 7473 206f 6620 7479 7065  onstants of type
0010980: 207b 5c74 7420 6e75 6d7d 206d 7573 7420   {\tt num} must 
0010990: 6265 2077 7269 7474 656e 2061 7320 7b5c  be written as {\
00109a0: 7474 2049 6e74 206b 7d0a 2572 6174 6865  tt Int k}.%rathe
00109b0: 7220 7468 616e 2073 696d 706c 7920 7b5c  r than simply {\
00109c0: 7474 206b 7d2e 2049 6e20 6661 6374 207b  tt k}. In fact {
00109d0: 5c74 7420 496e 747d 2069 7320 6120 7479  \tt Int} is a ty
00109e0: 7065 2063 6f6e 7374 7275 6374 6f72 2066  pe constructor f
00109f0: 6f72 207b 5c74 740a 256e 756d 7d20 7573  or {\tt.%num} us
0010a00: 6564 2069 6e20 7468 6520 6361 7365 2077  ed in the case w
0010a10: 6865 6e20 7468 6520 6e75 6d62 6572 2069  hen the number i
0010a20: 7320 6120 6d61 6368 696e 652d 7265 7072  s a machine-repr
0010a30: 6573 656e 7461 626c 6520 696e 7465 6765  esentable intege
0010a40: 722e 0a25 4c61 7267 6572 206f 6e65 7320  r..%Larger ones 
0010a50: 7573 6520 7b5c 7474 2042 6967 5c5f 696e  use {\tt Big\_in
0010a60: 747d 2e0a 0af5 cec1 d2ce c1d1 20cf d0c5  t}.......... ...
0010a70: d2c1 c3c9 d120 d3cd c5ce d920 dace c1cb  ..... ..... ....
0010a80: c120 d7c5 ccc9 dec9 ced9 20d4 c9d0 c17e  . ........ ....~
0010a90: 7b5c 7474 206e 756d 7d20 0acf c2cf dace  {\tt num} ......
0010aa0: c1de c1c5 d4d3 d17e 7b5c 7474 206d 696e  .......~{\tt min
0010ab0: 7573 5c5f 6e75 6d7d 2e20 e5dd a320 cfc4  us\_num}. ... ..
0010ac0: cec1 20d0 cfcc c5da cec1 d120 d5ce c1d2  .. ........ ....
0010ad0: cec1 d120 cfd0 c5d2 c1c3 c9d1 7e2d 2d2d  ... ........~---
0010ae0: 200a 7b5c 7474 2061 6273 5c5f 6e75 6d7d   .{\tt abs\_num}
0010af0: 2c20 cbcf d4cf d2c1 d120 d7d9 dec9 d3cc  , ....... ......
0010b00: d1c5 d420 c1c2 d3cf ccc0 d4ce d5c0 20d7  ... .......... .
0010b10: c5cc c9de c9ce d520 c1d2 c7d5 cdc5 ced4  ....... ........
0010b20: c12c 20d4 2e7e c52e 5c20 250a d0cf 20da  ., ..~..\ %... .
0010b30: c1c4 c1ce cecf cdd5 7e24 7824 20d7 cfda  ........~$x$ ...
0010b40: d7d2 c1dd c1c5 d47e 247c 787c 242e 0a0a  .......~$|x|$...
0010b50: 2554 6865 2075 6e61 7279 206e 6567 6174  %The unary negat
0010b60: 696f 6e20 6f6e 2074 7970 6520 7b5c 7474  ion on type {\tt
0010b70: 206e 756d 7d20 6973 2077 7269 7474 656e   num} is written
0010b80: 207b 5c74 7420 6d69 6e75 735c 5f6e 756d   {\tt minus\_num
0010b90: 7d2e 2041 6e6f 7468 6572 2068 616e 6479  }. Another handy
0010ba0: 0a25 756e 6172 7920 6f70 6572 6174 6f72  .%unary operator
0010bb0: 2069 7320 7b5c 7474 2061 6273 5c5f 6e75   is {\tt abs\_nu
0010bc0: 6d7d 2c20 7768 6963 6820 6669 6e64 7320  m}, which finds 
0010bd0: 6162 736f 6c75 7465 2076 616c 7565 732c  absolute values,
0010be0: 2069 2e65 2e20 6769 7665 6e20 2478 240a   i.e. given $x$.
0010bf0: 2572 6574 7572 6e73 2024 7c78 7c24 2e0a  %returns $|x|$..
0010c00: 0af0 cfcd c9cd cf20 d5ce c1d2 ced9 c82c  ....... .......,
0010c10: 20d7 20ce c1db c520 d2c1 d3d0 cfd2 d1d6   . .... ........
0010c20: c5ce c9c5 20d0 d2c5 c4cf d3d4 c1d7 ccc5  .... ...........
0010c30: ce20 d3d4 c1ce c4c1 d2d4 ced9 ca20 cec1  . ........... ..
0010c40: c2cf d220 c2c9 cec1 d2ce d9c8 0acf d0c5  ... ............
0010c50: d2c1 c3c9 ca2e 20ef d0c5 d2c1 c3c9 c920  ...... ........ 
0010c60: c3c5 cccf dec9 d3cc c5ce cecf c7cf 20c4  .............. .
0010c70: c5cc c5ce c9d1 20c9 20d7 d9de c9d3 ccc5  ...... . .......
0010c80: cec9 d120 cfd3 d4c1 d4cb c12c 200a cfc2  ... ......., ...
0010c90: cfda cec1 dec5 cece d9c5 7e7b 5c74 7420  ..........~{\tt 
0010ca0: 7175 6f5c 5f6e 756d 7d20 c97e 7b5c 7474  quo\_num} .~{\tt
0010cb0: 206d 6f64 5c5f 6e75 6d7d 2c20 cec5 20d1   mod\_num}, .. .
0010cc0: d7cc d1c0 d4d3 d120 c9ce c6c9 cbd3 ced9  ....... ........
0010cd0: cdc9 2e20 0af7 20d4 cf20 d6c5 20d7 d2c5  ... .. .. .. ...
0010ce0: cdd1 2c20 c2cf ccd8 dbc9 ced3 d4d7 cf20  .., ........... 
0010cf0: d0d2 cfde c9c8 20c2 c9ce c1d2 ced9 c820  ...... ........ 
0010d00: cfd0 c5d2 c1c3 c9ca 20cf d0d2 c5c4 c5cc  ........ .......
0010d10: c5ce d920 cbc1 cb20 c9ce c6c9 cbd3 ced9  ... ... ........
0010d20: c520 0ad3 20c9 cdc5 cec1 cdc9 2c20 d0cf  . .. ......., ..
0010d30: ccd5 dec5 cece d9cd c920 c4cf c2c1 d7cc  ......... ......
0010d40: c5ce c9c5 cd20 d3c9 cdd7 cfcc c17e 6060  ..... .......~``
0010d50: 7b5c 7665 7262 212f 217d 2727 20cb 20c9  {\verb!/!}'' . .
0010d60: cdc5 cec1 cd20 c1ce c1cc cfc7 c9de ced9  ..... ..........
0010d70: c820 0acf d0c5 d2c1 c3c9 ca20 cec1 c420  . ......... ... 
0010d80: d4c9 d0cf cd7e 7b5c 7474 2069 6e74 7d2e  .....~{\tt int}.
0010d90: 20f7 c1d6 cecf 20d0 cfcd cec9 d4d8 2c20   ..... ......., 
0010da0: ded4 cf20 d720 cfc2 ddc5 cd20 d3cc d5de  ... . ..... ....
0010db0: c1c5 20d4 d2c5 c2d5 c5d4 d3d1 0ac9 d3d0  .. .............
0010dc0: cfcc d8da cfd7 c1d4 d87e 7b5c 7474 203d  .........~{\tt =
0010dd0: 2f7d 20c4 ccd1 20d3 d2c1 d7ce c5ce c9d1  /} ... .........
0010de0: 20de c9d3 c5cc 2e20 f0d2 c9de c9ce c120   ...... ....... 
0010df0: dcd4 cfc7 cf20 d720 d4cf cd2c 20de d4cf  ..... . ..., ...
0010e00: 200a cbcf ced3 d4d2 d5cb d4cf d2d9 20d4   ............. .
0010e10: c9d0 c17e 7b5c 7474 206e 756d 7d2c 20cb  ...~{\tt num}, .
0010e20: c1cb 20d7 d3c5 c7c4 c12c 20d2 c1da ccc9  .. ......, .....
0010e30: dece d920 d0cf 20cf d0d2 c5c4 c5cc c5ce  ... .. .........
0010e40: c9c0 2c20 cecf 20cd cfc7 d5d4 0ad0 c5d2  .., .. .........
0010e50: c5d3 c5cb c1d4 d8d3 d120 d0cf 20c9 ced4  ......... .. ...
0010e60: c5d2 d0d2 c5d4 c1c3 c9c9 20d0 d2c5 c4d3  .......... .....
0010e70: d4c1 d7cc d1c5 cdd9 c820 dace c1de c5ce  ......... ......
0010e80: c9ca 2e20 eec1 d0d2 c9cd c5d2 2c20 d720  ... ........, . 
0010e90: c8cf c4c5 200a d7d9 dec9 d3cc c5ce c9d1  .... ...........
0010ea0: 20de c1d3 d4ce cfc7 cf7e 2432 5e7b 3330   ........~$2^{30
0010eb0: 7d24 20c9 7e24 3224 20d0 d2c9 20d0 cfcd  }$ .~$2$ ... ...
0010ec0: cfdd c920 c4d7 d5c8 20c4 cfd3 d4d5 d0ce  ... .... .......
0010ed0: d9c8 20cf d0c5 d2c1 c3c9 ca20 c4c5 ccc5  .. ........ ....
0010ee0: cec9 d10a cdd9 20cd cfd6 c5cd 20d0 cfcc  ...... ..... ...
0010ef0: d5de c9d4 d820 d2c5 dad5 ccd8 d4c1 d4d9  ..... ..........
0010f00: 2c20 dec9 d3cc c5ce cecf 20d2 c1d7 ced9  , ........ .....
0010f10: c52c 20ce cf20 d2c1 dacc c9de ced9 c520  ., .. ......... 
0010f20: d320 d4cf decb c920 dad2 c5ce c9d1 0ad1  . ..... ........
0010f30: dad9 cbc1 2c20 d0cf d3cb cfcc d8cb d520  ...., ......... 
0010f40: d720 cfc4 cecf cd20 d3cc d5de c1c5 20c2  . ..... ...... .
0010f50: d5c4 c5d4 20c9 d3d0 cfcc d8da cfd7 c1ce  .... ...........
0010f60: 20cb cfce d3d4 d2d5 cbd4 cfd2 7e7b 5c74   ...........~{\t
0010f70: 7420 496e 747d 2c20 c10a d720 c4d2 d5c7  t Int}, ... ....
0010f80: cfcd 7e2d 2d2d 207b 5c74 7420 5261 7469  ..~--- {\tt Rati
0010f90: 6f7d 2e0a 0a25 5468 6520 7573 7561 6c20  o}...%The usual 
0010fa0: 6269 6e61 7279 206f 7065 7261 7469 6f6e  binary operation
0010fb0: 7320 6172 6520 616c 736f 2061 7661 696c  s are also avail
0010fc0: 6162 6c65 2e20 5468 6520 2874 7275 6e63  able. The (trunc
0010fd0: 6174 696e 6729 2064 6976 6973 696f 6e20  ating) division 
0010fe0: 616e 640a 256d 6f64 756c 7573 2066 756e  and.%modulus fun
0010ff0: 6374 696f 6e2c 2063 616c 6c65 6420 7b5c  ction, called {\
0011000: 7474 2071 756f 5c5f 6e75 6d7d 2061 6e64  tt quo\_num} and
0011010: 207b 5c74 7420 6d6f 645c 5f6e 756d 7d2c   {\tt mod\_num},
0011020: 2064 6f20 6e6f 7420 6861 7665 2069 6e66   do not have inf
0011030: 6978 0a25 7374 6174 7573 2e20 486f 7765  ix.%status. Howe
0011040: 7665 7220 6d6f 7374 206f 6620 7468 6520  ver most of the 
0011050: 6f74 6865 7220 6269 6e61 7279 206f 7065  other binary ope
0011060: 7261 746f 7273 2061 7265 2069 6e66 6978  rators are infix
0011070: 6573 2c20 616e 6420 7468 6520 6e61 6d65  es, and the name
0011080: 730a 2561 7265 2064 6572 6976 6564 2066  s.%are derived f
0011090: 726f 6d20 7468 6520 7573 7561 6c20 6f6e  rom the usual on
00110a0: 6573 2062 7920 6164 6469 6e67 2061 2073  es by adding a s
00110b0: 6c61 7368 2060 7b5c 7665 7262 212f 217d  lash `{\verb!/!}
00110c0: 272e 2049 7420 6973 2069 6d70 6f72 7461  '. It is importa
00110d0: 6e74 0a25 746f 2072 6561 6c69 7a65 2074  nt.%to realize t
00110e0: 6861 7420 696e 2067 656e 6572 616c 2c20  hat in general, 
00110f0: 6f6e 6520 6d75 7374 2075 7365 207b 5c74  one must use {\t
0011100: 7420 3d2f 7d20 746f 2063 6f6d 7061 7265  t =/} to compare
0011110: 206e 756d 6265 7273 2066 6f72 0a25 6571   numbers for.%eq
0011120: 7561 6c69 7479 2e20 5468 6973 2069 7320  uality. This is 
0011130: 6265 6361 7573 6520 7468 6520 636f 6e73  because the cons
0011140: 7472 7563 746f 7273 206f 6620 7468 6520  tructors of the 
0011150: 7479 7065 207b 5c74 7420 6e75 6d7d 2061  type {\tt num} a
0011160: 7265 2c20 6173 0a25 616c 7761 7973 2c20  re, as.%always, 
0011170: 6469 7374 696e 6374 2062 7920 6465 6669  distinct by defi
0011180: 6e69 7469 6f6e 2c20 7965 7420 696e 2074  nition, yet in t
0011190: 6572 6d73 206f 6620 7468 6520 756e 6465  erms of the unde
00111a0: 726c 7969 6e67 206d 6561 6e69 6e67 2074  rlying meaning t
00111b0: 6865 7920 6d61 790a 256f 7665 726c 6170  hey may.%overlap
00111c0: 2e20 466f 7220 6578 616d 706c 6520 7765  . For example we
00111d0: 2067 6574 2064 6966 6665 7265 6e74 2072   get different r
00111e0: 6573 756c 7420 6672 6f6d 2075 7369 6e67  esult from using
00111f0: 2074 7275 6e63 6174 696e 6720 6469 7669   truncating divi
0011200: 7369 6f6e 2061 6e64 0a25 7472 7565 2064  sion and.%true d
0011210: 6976 6973 696f 6e20 6f6e 2024 325e 7b33  ivision on $2^{3
0011220: 307d 2420 616e 6420 2432 242c 2065 7665  0}$ and $2$, eve
0011230: 6e20 7468 6f75 6768 2074 6865 7920 6172  n though they ar
0011240: 6520 6e75 6d65 7269 6361 6c6c 7920 7468  e numerically th
0011250: 6520 7361 6d65 2e0a 254f 6e65 2075 7365  e same..%One use
0011260: 7320 7479 7065 2063 6f6e 7374 7275 6374  s type construct
0011270: 6f72 207b 5c74 7420 496e 747d 2061 6e64  or {\tt Int} and
0011280: 2074 6865 206f 7468 6572 207b 5c74 7420   the other {\tt 
0011290: 5261 7469 6f7d 2e0a 0a5c 6265 6769 6e7b  Ratio}...\begin{
00112a0: 626f 7865 647d 5c62 6567 696e 7b76 6572  boxed}\begin{ver
00112b0: 6261 7469 6d7d 0a20 2023 2849 6e74 2032  batim}.  #(Int 2
00112c0: 202a 2a2f 2049 6e74 2033 3029 202f 2f20   **/ Int 30) // 
00112d0: 496e 7420 3220 3d20 7175 6f5f 6e75 6d20  Int 2 = quo_num 
00112e0: 2849 6e74 2032 202a 2a2f 2049 6e74 2033  (Int 2 **/ Int 3
00112f0: 3029 2028 496e 7420 3229 3b3b 0a20 2069  0) (Int 2);;.  i
0011300: 7420 3a20 626f 6f6c 203d 2066 616c 7365  t : bool = false
0011310: 0a20 2023 2849 6e74 2032 202a 2a2f 2049  .  #(Int 2 **/ I
0011320: 6e74 2033 3029 202f 2f20 496e 7420 3220  nt 30) // Int 2 
0011330: 3d2f 2071 756f 5f6e 756d 2028 496e 7420  =/ quo_num (Int 
0011340: 3220 2a2a 2f20 496e 7420 3330 2920 2849  2 **/ Int 30) (I
0011350: 6e74 2032 293b 3b0a 2020 6974 203a 2062  nt 2);;.  it : b
0011360: 6f6f 6c20 3d20 7472 7565 0a5c 656e 647b  ool = true.\end{
0011370: 7665 7262 6174 696d 7d5c 656e 647b 626f  verbatim}\end{bo
0011380: 7865 647d 0a0a f0cf ccce d9ca 20d3 d0c9  xed}........ ...
0011390: d3cf cb20 c9ce c6c9 cbd3 ced9 c820 cfd0  ... ......... ..
00113a0: c5d2 c1c3 c9ca 3a0a 255c 6e6f 696e 6465  ......:.%\noinde
00113b0: 6e74 2048 6572 6520 6973 2061 2066 756c  nt Here is a ful
00113c0: 6c20 6c69 7374 206f 6620 7468 6520 6d61  l list of the ma
00113d0: 696e 2069 6e66 6978 2062 696e 6172 7920  in infix binary 
00113e0: 6f70 6572 6174 6f72 733a 0a0a 5c62 6967  operators:..\big
00113f0: 736b 6970 0a5c 6265 6769 6e7b 7461 6275  skip.\begin{tabu
0011400: 6c61 727d 7b7c 6c7c 6c7c 6c7c 7d0a 5c68  lar}{|l|l|l|}.\h
0011410: 6c69 6e65 0a25 4f70 6572 6174 6f72 2020  line.%Operator  
0011420: 2026 2054 7970 6520 2020 2020 2020 2020   & Type         
0011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
0011440: 2020 2020 2620 4d65 616e 696e 6720 2020      & Meaning   
0011450: 2020 2020 2020 2020 2020 2020 5c5c 0aef              \\..
0011460: d0c5 d2c1 d4cf d220 2020 2620 f4c9 d020  .......   & ... 
0011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
0011480: 2020 2020 2020 2020 2020 2020 2026 20fa               & .
0011490: cec1 dec5 cec9 c520 2020 2020 2020 2020  .......         
00114a0: 2020 205c 5c0a 5c68 6c69 6e65 0a7b 5c74     \\.\hline.{\t
00114b0: 7420 2a2a 2f7d 2020 2620 7b5c 7474 206e  t **/}  & {\tt n
00114c0: 756d 202d 3e20 6e75 6d20 2d3e 206e 756d  um -> num -> num
00114d0: 7d20 2020 2020 2020 2020 2026 20f7 d9de  }          & ...
00114e0: c9d3 ccc5 cec9 c520 d3d4 c5d0 c5ce c920  ....... ....... 
00114f0: 205c 5c0a 7b5c 7474 202a 2f7d 2020 2026   \\.{\tt */}   &
0011500: 207b 5c74 7420 6e75 6d20 2d3e 206e 756d   {\tt num -> num
0011510: 202d 3e20 6e75 6d7d 2020 2020 2020 2020   -> num}        
0011520: 2020 2620 f5cd cecf d6c5 cec9 c520 2020    & .........   
0011530: 2020 2020 2020 2020 5c5c 0a7b 5c74 7420          \\.{\tt 
0011540: 2b2f 7d20 2020 2620 7b5c 7474 206e 756d  +/}   & {\tt num
0011550: 202d 3e20 6e75 6d20 2d3e 206e 756d 7d20   -> num -> num} 
0011560: 2020 2020 2020 2020 2026 20f3 cccf d6c5           & .....
0011570: cec9 c520 2020 2020 2020 2020 2020 205c  ...            \
0011580: 5c0a 7b5c 7474 202d 2f7d 2020 2026 207b  \.{\tt -/}   & {
0011590: 5c74 7420 6e75 6d20 2d3e 206e 756d 202d  \tt num -> num -
00115a0: 3e20 6e75 6d7d 2020 2020 2020 2020 2020  > num}          
00115b0: 2620 f7d9 dec9 d4c1 cec9 c520 2020 2020  & .........     
00115c0: 2020 2020 2020 5c5c 0a7b 5c74 7420 3d2f        \\.{\tt =/
00115d0: 7d20 2020 2620 7b5c 7474 206e 756d 202d  }   & {\tt num -
00115e0: 3e20 6e75 6d20 2d3e 2062 6f6f 6c7d 2020  > num -> bool}  
00115f0: 2020 2020 2020 2026 20f2 c1d7 c5ce d3d4         & .......
0011600: d7cf 2020 2020 2020 2020 2020 205c 5c0a  ..           \\.
0011610: 7b5c 7474 203c 3e2f 7d20 2026 207b 5c74  {\tt <>/}  & {\t
0011620: 7420 6e75 6d20 2d3e 206e 756d 202d 3e20  t num -> num -> 
0011630: 626f 6f6c 7d20 2020 2020 2020 2020 2620  bool}         & 
0011640: eec5 d2c1 d7c5 ced3 d4d7 cf20 2020 2020  ...........     
0011650: 2020 2020 5c5c 0a7b 5c74 7420 3c2f 7d20      \\.{\tt </} 
0011660: 2020 2620 7b5c 7474 206e 756d 202d 3e20    & {\tt num -> 
0011670: 6e75 6d20 2d3e 2062 6f6f 6c7d 2020 2020  num -> bool}    
0011680: 2020 2020 2026 20ed c5ce d8db c52c 20de       & ......, .
0011690: c5cd 2020 2020 2020 2020 205c 5c0a 7b5c  ..         \\.{\
00116a0: 7474 203c 3d2f 7d20 2026 207b 5c74 7420  tt <=/}  & {\tt 
00116b0: 6e75 6d20 2d3e 206e 756d 202d 3e20 626f  num -> num -> bo
00116c0: 6f6c 7d20 2020 2020 2020 2020 2620 edc5  ol}         & ..
00116d0: ced8 dbc5 20cc c9c2 cf20 d2c1 d7ce cf20  .... .... ..... 
00116e0: 2020 5c5c 0a7b 5c74 7420 3e2f 7d20 2020    \\.{\tt >/}   
00116f0: 2620 7b5c 7474 206e 756d 202d 3e20 6e75  & {\tt num -> nu
0011700: 6d20 2d3e 2062 6f6f 6c7d 2020 2020 2020  m -> bool}      
0011710: 2020 2026 20e2 cfcc d8db c52c 20de c5cd     & ......, ...
0011720: 2020 2020 2020 2020 205c 5c0a 7b5c 7474           \\.{\tt
0011730: 203e 3d2f 7d20 2026 207b 5c74 7420 6e75   >=/}  & {\tt nu
0011740: 6d20 2d3e 206e 756d 202d 3e20 626f 6f6c  m -> num -> bool
0011750: 7d20 2020 2020 2020 2020 2620 e2cf ccd8  }         & ....
0011760: dbc5 20cc c9c2 cf20 d2c1 d7ce cf20 2020  .. .... .....   
0011770: 5c5c 0a25 7b5c 7474 202a 2a2f 7d20 2026  \\.%{\tt **/}  &
0011780: 207b 5c74 7420 6e75 6d20 2d3e 206e 756d   {\tt num -> num
0011790: 202d 3e20 6e75 6d7d 2020 2020 2020 2020   -> num}        
00117a0: 2020 2620 4578 706f 6e65 6e74 6961 7469    & Exponentiati
00117b0: 6f6e 2020 2020 2020 2020 5c5c 0a25 7b5c  on        \\.%{\
00117c0: 7474 202a 2f7d 2020 2026 207b 5c74 7420  tt */}   & {\tt 
00117d0: 6e75 6d20 2d3e 206e 756d 202d 3e20 6e75  num -> num -> nu
00117e0: 6d7d 2020 2020 2020 2020 2020 2620 4d75  m}          & Mu
00117f0: 6c74 6970 6c69 6361 7469 6f6e 2020 2020  ltiplication    
0011800: 2020 2020 5c5c 0a25 7b5c 7474 202b 2f7d      \\.%{\tt +/}
0011810: 2020 2026 207b 5c74 7420 6e75 6d20 2d3e     & {\tt num ->
0011820: 206e 756d 202d 3e20 6e75 6d7d 2020 2020   num -> num}    
0011830: 2020 2020 2020 2620 4164 6469 7469 6f6e        & Addition
0011840: 2020 2020 2020 2020 2020 2020 2020 5c5c                \\
0011850: 0a25 7b5c 7474 202d 2f7d 2020 2026 207b  .%{\tt -/}   & {
0011860: 5c74 7420 6e75 6d20 2d3e 206e 756d 202d  \tt num -> num -
0011870: 3e20 6e75 6d7d 2020 2020 2020 2020 2020  > num}          
0011880: 2620 5375 6274 7261 6374 696f 6e20 2020  & Subtraction   
0011890: 2020 2020 2020 2020 5c5c 0a25 7b5c 7474          \\.%{\tt
00118a0: 203d 2f7d 2020 2026 207b 5c74 7420 6e75   =/}   & {\tt nu
00118b0: 6d20 2d3e 206e 756d 202d 3e20 626f 6f6c  m -> num -> bool
00118c0: 7d20 2020 2020 2020 2020 2620 4571 7561  }         & Equa
00118d0: 6c69 7479 2020 2020 2020 2020 2020 2020  lity            
00118e0: 2020 5c5c 0a25 7b5c 7474 203c 3e2f 7d20    \\.%{\tt <>/} 
00118f0: 2026 207b 5c74 7420 6e75 6d20 2d3e 206e   & {\tt num -> n
0011900: 756d 202d 3e20 626f 6f6c 7d20 2020 2020  um -> bool}     
0011910: 2020 2020 2620 496e 6571 7561 6c69 7479      & Inequality
0011920: 2020 2020 2020 2020 2020 2020 5c5c 0a25              \\.%
0011930: 7b5c 7474 203c 2f7d 2020 2026 207b 5c74  {\tt </}   & {\t
0011940: 7420 6e75 6d20 2d3e 206e 756d 202d 3e20  t num -> num -> 
0011950: 626f 6f6c 7d20 2020 2020 2020 2020 2620  bool}         & 
0011960: 4c65 7373 2074 6861 6e20 2020 2020 2020  Less than       
0011970: 2020 2020 2020 5c5c 0a25 7b5c 7474 203c        \\.%{\tt <
0011980: 3d2f 7d20 2026 207b 5c74 7420 6e75 6d20  =/}  & {\tt num 
0011990: 2d3e 206e 756d 202d 3e20 626f 6f6c 7d20  -> num -> bool} 
00119a0: 2020 2020 2020 2020 2620 4c65 7373 2074          & Less t
00119b0: 6861 6e20 6f72 2065 7175 616c 2020 2020  han or equal    
00119c0: 5c5c 0a25 7b5c 7474 203e 2f7d 2020 2026  \\.%{\tt >/}   &
00119d0: 207b 5c74 7420 6e75 6d20 2d3e 206e 756d   {\tt num -> num
00119e0: 202d 3e20 626f 6f6c 7d20 2020 2020 2020   -> bool}       
00119f0: 2020 2620 4772 6561 7465 7220 7468 616e    & Greater than
0011a00: 2020 2020 2020 2020 2020 5c5c 0a25 7b5c            \\.%{\
0011a10: 7474 203e 3d2f 7d20 2026 207b 5c74 7420  tt >=/}  & {\tt 
0011a20: 6e75 6d20 2d3e 206e 756d 202d 3e20 626f  num -> num -> bo
0011a30: 6f6c 7d20 2020 2020 2020 2020 2620 4772  ol}         & Gr
0011a40: 6561 7465 7220 7468 616e 206f 7220 6571  eater than or eq
0011a50: 7561 6c20 5c5c 0a5c 686c 696e 650a 5c65  ual \\.\hline.\e
0011a60: 6e64 7b74 6162 756c 6172 7d0a 5c62 6967  nd{tabular}.\big
0011a70: 736b 6970 0a0a f0d2 c9cd c5d2 20c9 d3d0  skip........ ...
0011a80: cfcc d8da cfd7 c1ce c9d1 20cf d0c5 d2c1  .......... .....
0011a90: c3c9 ca3a 0a25 5c6e 6f69 6e64 656e 7420  ...:.%\noindent 
0011aa0: 4c65 7420 7573 2073 6565 2073 6f6d 6520  Let us see some 
0011ab0: 6675 7274 6865 7220 6578 616d 706c 6573  further examples
0011ac0: 3a0a 250a 5c62 6567 696e 7b62 6f78 6564  :.%.\begin{boxed
0011ad0: 7d5c 6265 6769 6e7b 7665 7262 6174 696d  }\begin{verbatim
0011ae0: 7d0a 2020 2349 6e74 2035 202a 2f20 496e  }.  #Int 5 */ In
0011af0: 7420 3134 3b3b 0a20 2069 7420 3a20 6e75  t 14;;.  it : nu
0011b00: 6d20 3d20 496e 7420 3730 0a20 2023 496e  m = Int 70.  #In
0011b10: 7420 3220 2a2a 2f20 496e 7420 3330 3b3b  t 2 **/ Int 30;;
0011b20: 0a20 2069 7420 3a20 6e75 6d20 3d20 4269  .  it : num = Bi
0011b30: 675f 696e 7420 3c61 6273 7472 3e0a 2020  g_int <abstr>.  
0011b40: 2328 496e 7420 3220 2a2a 2f20 496e 7420  #(Int 2 **/ Int 
0011b50: 3330 2920 2f2f 2049 6e74 2032 3b3b 0a20  30) // Int 2;;. 
0011b60: 2069 7420 3a20 6e75 6d20 3d20 5261 7469   it : num = Rati
0011b70: 6f20 3c61 6273 7472 3e0a 2020 2371 756f  o <abstr>.  #quo
0011b80: 5f6e 756d 2028 496e 7420 3220 2a2a 2f20  _num (Int 2 **/ 
0011b90: 496e 7420 3330 2920 2849 6e74 2032 293b  Int 30) (Int 2);
0011ba0: 3b0a 2020 6974 203a 206e 756d 203d 2049  ;.  it : num = I
0011bb0: 6e74 2035 3336 3837 3039 3132 0a5c 656e  nt 536870912.\en
0011bc0: 647b 7665 7262 6174 696d 7d5c 656e 647b  d{verbatim}\end{
0011bd0: 626f 7865 647d 0a0a efd4 cdc5 d4c9 cd2c  boxed}.........,
0011be0: 20de d4cf 20de c9d3 ccc1 20d4 c9d0 c17e   ... ..... ....~
0011bf0: 7b5c 7474 206e 756d 7d20 d0cf 20d5 cdcf  {\tt num} .. ...
0011c00: ccde c1ce c9c0 20ce c520 d7d9 d7cf c4d1  ...... .. ......
0011c10: d4d3 d12e 20ef c4ce c1cb cf2c 20cd d90a  .... ......, ...
0011c20: d7d3 c5c7 c4c1 20cd cfd6 c5cd 20d0 d2c5  ...... ..... ...
0011c30: cfc2 d2c1 dacf d7c1 d4d8 20c9 c820 d720  .......... .. . 
0011c40: d3d4 d2cf cbc9 20d0 d2c9 20d0 cfcd cfdd  ...... ... .....
0011c50: c920 c6d5 cecb c3c9 c97e 7b5c 7474 2073  . .......~{\tt s
0011c60: 7472 696e 675c 5f6f 665c 5f6e 756d 7d2e  tring\_of\_num}.
0011c70: 0a25 4e6f 7465 2074 6861 7420 6c61 7267  .%Note that larg
0011c80: 6520 6e75 6d62 6572 7320 6172 6520 6e6f  e numbers are no
0011c90: 7420 7072 696e 7465 642e 2048 6f77 6576  t printed. Howev
0011ca0: 6572 2077 6520 6361 6e20 616c 7761 7973  er we can always
0011cb0: 2063 6f6e 7665 7274 206f 6e65 2074 6f20   convert one to 
0011cc0: 610a 2573 7472 696e 6720 7573 696e 6720  a.%string using 
0011cd0: 7b5c 7474 2073 7472 696e 675c 5f6f 665c  {\tt string\_of\
0011ce0: 5f6e 756d 7d3a 0a25 0a5c 6265 6769 6e7b  _num}:.%.\begin{
0011cf0: 626f 7865 647d 5c62 6567 696e 7b76 6572  boxed}\begin{ver
0011d00: 6261 7469 6d7d 0a20 2023 7374 7269 6e67  batim}.  #string
0011d10: 5f6f 665f 6e75 6d28 496e 7420 3220 2a2a  _of_num(Int 2 **
0011d20: 2049 6e74 2031 3530 293b 3b0a 2020 2d20   Int 150);;.  - 
0011d30: 3a20 7374 7269 6e67 203d 2022 3134 3237  : string = "1427
0011d40: 3234 3736 3932 3730 3539 3539 3838 3130  2476927059598810
0011d50: 3538 3238 3539 3639 3434 3934 3935 3133  5828596944949513
0011d60: 3633 3832 3734 3636 3234 220a 5c65 6e64  6382746624".\end
0011d70: 7b76 6572 6261 7469 6d7d 5c65 6e64 7b62  {verbatim}\end{b
0011d80: 6f78 6564 7d0a 250a e1ce c1cc cfc7 c9de  oxed}.%.........
0011d90: cecf 20c4 c5cc c1c5 d4d3 d120 c920 cfc2  .. ........ . ..
0011da0: d2c1 d4ce cfc5 20d0 d2c5 cfc2 d2c1 dacf  ...... .........
0011db0: d7c1 cec9 c52c 20d2 c5c1 ccc9 dad5 c5cd  ....., .........
0011dc0: cfc5 20c6 d5ce cbc3 c9c5 ca20 d320 d7d0  .. ........ . ..
0011dd0: cfcc cec5 0ac5 d3d4 c5d3 d4d7 c5ce ced9  ................
0011de0: cd20 c9cd c5ce c5cd 7e7b 5c74 7420 6e75  . ......~{\tt nu
0011df0: 6d5c 5f6f 665c 5f73 7472 696e 677d 2e0a  m\_of\_string}..
0011e00: 255c 6e6f 696e 6465 6e74 2054 6869 7320  %\noindent This 
0011e10: 616c 736f 2068 6173 2061 6e20 696e 7665  also has an inve
0011e20: 7273 652c 2063 616c 6c65 6420 6e61 7475  rse, called natu
0011e30: 7261 6c6c 7920 656e 6f75 6768 207b 5c74  rally enough {\t
0011e40: 740a 256e 756d 5c5f 6f66 5c5f 7374 7269  t.%num\_of\_stri
0011e50: 6e67 7d2e 0a0a 5c73 7562 7365 6374 696f  ng}...\subsectio
0011e60: 6e7b efd3 cecf d7ce d9c5 20cf d0c5 d2c1  n{........ .....
0011e70: c3c9 c97d 0a25 5c73 7562 7365 6374 696f  ...}.%\subsectio
0011e80: 6e7b 4261 7369 6320 6f70 6572 6174 696f  n{Basic operatio
0011e90: 6e73 7d0a 0aee c1d0 cfcd cec9 cd2c 20de  ns}.........., .
0011ea0: d4cf 20c4 ccd1 20d7 c5dd c5d3 d4d7 c5ce  .. ... .........
0011eb0: ced9 c820 dec9 d3c5 cc20 cec1 cdc9 20c2  ... ..... .... .
0011ec0: d9cc cf20 d7d9 c2d2 c1ce cf20 d0d2 c5c4  ... ....... ....
0011ed0: d3d4 c1d7 ccc5 cec9 c520 d720 d7c9 c4c5  ......... . ....
0011ee0: 0ac6 d5ce cbc3 c9ca 7e24 5c6e 756d 205c  ........~$\num \
0011ef0: 746f 205c 6e75 6d24 2e20 f2c5 c1cc c9da  to \num$. ......
0011f00: c1c3 c9d1 20ce c120 d1da d9cb c57e 4d4c  .... .. .....~ML
0011f10: 20d7 20c4 c5ca d3d4 d7c9 d4c5 ccd8 cecf   . .............
0011f20: d3d4 c920 c2d5 c4c5 d420 0a25 2049 5353  ... ..... .% ISS
0011f30: 5545 3a20 5a20 2d3e 205a 2073 686f 756c  UE: Z -> Z shoul
0011f40: 6420 6265 2070 726f 6261 626c 7920 4e20  d be probably N 
0011f50: 2d3e 205a 203f 3f3f 0ac9 d3d0 cfcc d8da  -> Z ???........
0011f60: cfd7 c1d4 d87e 7b5c 7474 2069 6e74 202d  .....~{\tt int -
0011f70: 3e20 6e75 6d7d 2c20 d0cf d3cb cfcc d8cb  > num}, ........
0011f80: d520 c4c9 c1d0 c1da cfce c120 dace c1de  . ......... ....
0011f90: c5ce c9ca 20d7 d3d4 d2cf c5ce cecf c7cf  .... ...........
0011fa0: 200a c3c5 cccf dec9 d3cc c5ce cecf c7cf   ...............
0011fb0: 20d4 c9d0 c120 d7d0 cfcc cec5 20c4 cfd3   .... ...... ...
0011fc0: d4c1 d4cf dece cf20 c4cc d120 dac1 c4c1  ....... ... ....
0011fd0: cec9 d120 d4d2 c5c2 d5c5 cdcf ca20 d2c1  ... ......... ..
0011fe0: dad2 d1c4 cecf d3d4 c92e 0aef d0d2 c5c4  ................
0011ff0: c5cc c9cd 20ce c5cb cfd4 cfd2 d9c5 20c2  .... ......... .
0012000: c1da cfd7 d9c5 20cf d0c5 d2c1 c3c9 c920  ...... ........ 
0012010: cec1 c420 d7c5 ddc5 d3d4 d7c5 cece d9cd  ... ............
0012020: c920 dec9 d3cc c1cd c92e 20ee c1c9 c2cf  . ........ .....
0012030: ccc5 c50a c6d5 cec4 c1cd c5ce d4c1 ccd8  ................
0012040: cec1 d120 cfd0 c5d2 c1c3 c9d1 2c20 d320  ... ........, . 
0012050: cbcf d4cf d2cf ca20 cdd9 20ce c1de cea3  ....... .. .....
0012060: cd2c 20d3 d4c1 d7c9 d420 d720 d3cf cfd4  ., ...... . ....
0012070: d7c5 d4d3 d4d7 c9c5 20da c1c4 c1ce cecf  ........ .......
0012080: cdd5 0ac3 c5cc cfcd d520 d7c5 ddc5 d3d4  ......... ......
0012090: d7c5 cece cfc5 20de c9d3 cccf 2e20 e5a3  ...... ...... ..
00120a0: 20d2 c5c1 ccc9 dac1 c3c9 d120 d0d2 cfd3   .......... ....
00120b0: d4c1 3a0a 250a 2552 6563 616c 6c20 7468  ..:.%.%Recall th
00120c0: 6174 206f 7572 2072 6561 6c20 6e75 6d62  at our real numb
00120d0: 6572 7320 6172 6520 7375 7070 6f73 6564  ers are supposed
00120e0: 2074 6f20 6265 2028 7265 7072 6573 656e   to be (represen
00120f0: 7465 6420 6279 2920 6675 6e63 7469 6f6e  ted by) function
0012100: 730a 2524 5c6e 756d 205c 746f 205c 6e75  s.%$\num \to \nu
0012110: 6d24 2e20 496e 204d 4c20 7765 2077 696c  m$. In ML we wil
0012120: 6c20 6163 7475 616c 6c79 2075 7365 207b  l actually use {
0012130: 5c74 7420 696e 7420 2d3e 206e 756d 7d2c  \tt int -> num},
0012140: 2073 696e 6365 2074 6865 2069 6e62 7569   since the inbui
0012150: 6c74 0a25 7479 7065 206f 6620 696e 7465  lt.%type of inte
0012160: 6765 7273 2069 7320 6d6f 7265 2074 6861  gers is more tha
0012170: 6e20 6164 6571 7561 7465 2066 6f72 2069  n adequate for i
0012180: 6e64 6578 696e 6720 7468 6520 6c65 7665  ndexing the leve
0012190: 6c20 6f66 2061 6363 7572 6163 792e 204e  l of accuracy. N
00121a0: 6f77 0a25 7765 2063 616e 2064 6566 696e  ow.%we can defin
00121b0: 6520 736f 6d65 206f 7065 7261 7469 6f6e  e some operation
00121c0: 7320 6f6e 2072 6561 6c73 2e20 5468 6520  s on reals. The 
00121d0: 6d6f 7374 2062 6173 6963 206f 7065 7261  most basic opera
00121e0: 7469 6f6e 2c20 7768 6963 6820 6765 7473  tion, which gets
00121f0: 2075 730a 2573 7461 7274 6564 2c20 6973   us.%started, is
0012200: 2074 6f20 7072 6f64 7563 6520 7468 6520   to produce the 
0012210: 7265 616c 206e 756d 6265 7220 636f 7272  real number corr
0012220: 6573 706f 6e64 696e 6720 746f 2061 6e20  esponding to an 
0012230: 696e 7465 6765 722e 2054 6869 7320 6973  integer. This is
0012240: 0a25 6561 7379 3a0a 250a 5c62 6567 696e  .%easy:.%.\begin
0012250: 7b62 6f78 6564 7d5c 6265 6769 6e7b 7665  {boxed}\begin{ve
0012260: 7262 6174 696d 7d0a 2020 236c 6574 2072  rbatim}.  #let r
0012270: 6561 6c5f 6f66 5f69 6e74 206b 206e 203d  eal_of_int k n =
0012280: 2028 496e 7420 3220 2a2a 2f20 496e 7420   (Int 2 **/ Int 
0012290: 6e29 202a 2f20 496e 7420 6b3b 3b0a 2020  n) */ Int k;;.  
00122a0: 7265 616c 5f6f 665f 696e 7420 3a20 696e  real_of_int : in
00122b0: 7420 2d3e 2069 6e74 202d 3e20 6e75 6d20  t -> int -> num 
00122c0: 3d20 3c66 756e 3e0a 2020 2372 6561 6c5f  = <fun>.  #real_
00122d0: 6f66 5f69 6e74 2032 333b 3b0a 2020 2d20  of_int 23;;.  - 
00122e0: 3a20 696e 7420 2d3e 206e 756d 203d 203c  : int -> num = <
00122f0: 6675 6e3e 0a5c 656e 647b 7665 7262 6174  fun>.\end{verbat
0012300: 696d 7d5c 656e 647b 626f 7865 647d 0a25  im}\end{boxed}.%
0012310: 0aef dec5 d7c9 c4ce cf2c 20de d4cf 20c4  ........., ... .
0012320: ccd1 20d0 d2cf c9da d7cf ccd8 cecf c7cf  .. .............
0012330: 7e24 6b24 20d3 d0d2 c1d7 c5c4 ccc9 d720  ~$k$ .......... 
0012340: cbd2 c9d4 c5d2 c9ca 20c1 d0d0 d2cf cbd3  ........ .......
0012350: c9cd c1c3 c9c9 3a0a 255c 6e6f 696e 6465  ......:.%\noinde
0012360: 6e74 2049 7420 6973 206f 6276 696f 7573  nt It is obvious
0012370: 2074 6861 7420 666f 7220 616e 7920 246b   that for any $k
0012380: 2420 7468 6973 206f 6265 7973 2074 6865  $ this obeys the
0012390: 2064 6573 6972 6564 2061 7070 726f 7869   desired approxi
00123a0: 6d61 7469 6f6e 0a25 6372 6974 6572 696f  mation.%criterio
00123b0: 6e3a 0a25 0a24 2420 0a20 7c66 5f6b 286e  n:.%.$$ . |f_k(n
00123c0: 2920 2d20 325e 6e20 6b7c 203d 207c 325e  ) - 2^n k| = |2^
00123d0: 6e20 6b20 2d20 325e 6e20 6b7c 203d 2030  n k - 2^n k| = 0
00123e0: 203c 2031 200a 2424 0a25 0aef d0d2 c5c4   < 1 .$$.%......
00123f0: c5cc c9cd 20d0 c5d2 d7d5 c020 cec5 d4d2  .... ...... ....
0012400: c9d7 c9c1 ccd8 ced5 c020 cfd0 c5d2 c1c3  ......... ......
0012410: c9c0 7e2d 2d2d 20d3 cdc5 ced5 20da cec1  ..~--- ..... ...
0012420: cbc1 2e0a 255c 6e6f 696e 6465 6e74 204e  ....%\noindent N
0012430: 6f77 2077 6520 6361 6e20 6465 6669 6e65  ow we can define
0012440: 2074 6865 2066 6972 7374 206e 6f6e 7472   the first nontr
0012450: 6976 6961 6c20 6f70 6572 6174 696f 6e2c  ivial operation,
0012460: 2074 6861 7420 6f66 2075 6e61 7279 0a25   that of unary.%
0012470: 6e65 6761 7469 6f6e 3a0a 250a 5c62 6567  negation:.%.\beg
0012480: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
0012490: 6c73 746c 6973 7469 6e67 7d0a 2020 6c65  lstlisting}.  le
00124a0: 7420 7265 616c 5f6e 6567 2066 206e 203d  t real_neg f n =
00124b0: 206d 696e 7573 5f6e 756d 2866 206e 293b   minus_num(f n);
00124c0: 3b0a 5c65 6e64 7b6c 7374 6c69 7374 696e  ;.\end{lstlistin
00124d0: 677d 5c65 6e64 7b62 6f78 6564 7d0a 0aeb  g}\end{boxed}...
00124e0: cfcd d0c9 ccd1 d4cf d220 c4cc d120 dcd4  ......... ... ..
00124f0: cfca 20c6 d5ce cbc3 c9c9 20d7 d9d7 cfc4  .. ....... .....
0012500: c9d4 20c2 cfcc c5c5 20cf c2dd c9ca 20d4  .. ..... ..... .
0012510: c9d0 2c20 dec5 cd20 d4d2 c5c2 d5c5 d4d3  .., ... ........
0012520: d12c 20ce cf20 dcd4 cf0a cec5 20d3 cfda  ., .. ...... ...
0012530: c4c1 d3d4 20d4 d2d5 c4ce cfd3 d4c5 ca2e  .... ...........
0012540: 20e4 cfd3 d4c1 d4cf dece cf20 ccc5 c7cb   .......... ....
0012550: cf20 d5c2 c5c4 c9d4 d8d3 d12c 20de d4cf  . ........., ...
0012560: 20cb d2c9 d4c5 d2c9 ca20 c1d0 d0d2 cfcb   ........ ......
0012570: d3c9 cdc1 c3c9 c90a cec5 20ce c1d2 d5db  .......... .....
0012580: c1c5 d4d3 d12e 20e5 d3cc c920 cec1 cd20  ...... .... ... 
0012590: c9da d7c5 d3d4 cecf 2c20 ded4 cf20 c4cc  ........, ... ..
00125a0: d120 ccc0 c2cf c7cf 7e24 6e24 20d7 d9d0  . ......~$n$ ...
00125b0: cfcc ced1 c5d4 d3d1 0a24 2420 0a20 7c66  .........$$ . |f
00125c0: 5f78 286e 2920 2d20 325e 6e20 787c 203c  _x(n) - 2^n x| <
00125d0: 2031 2c0a 2424 0ad4 cf20 c9da 20dc d4cf   1,.$$... .. ...
00125e0: c7cf 20d3 ccc5 c4d5 c5d4 0a25 0a25 5468  .. ........%.%Th
00125f0: 6520 636f 6d70 696c 6572 2067 656e 6572  e compiler gener
0012600: 616c 697a 6573 2074 6865 2074 7970 6520  alizes the type 
0012610: 6d6f 7265 2074 6861 6e20 696e 7465 6e64  more than intend
0012620: 6564 2c20 6275 7420 7468 6973 2077 696c  ed, but this wil
0012630: 6c20 6e6f 7420 7472 6f75 626c 650a 2575  l not trouble.%u
0012640: 732e 2049 7420 6973 2061 6c6d 6f73 7420  s. It is almost 
0012650: 6173 2065 6173 7920 746f 2073 6565 2074  as easy to see t
0012660: 6861 7420 7468 6520 6170 7072 6f78 696d  hat the approxim
0012670: 6174 696f 6e20 6372 6974 6572 696f 6e20  ation criterion 
0012680: 6973 2070 7265 7365 7276 6564 2e0a 2549  is preserved..%I
0012690: 6620 7765 206b 6e6f 7720 7468 6174 2066  f we know that f
00126a0: 6f72 2065 6163 6820 246e 243a 0a25 0a25  or each $n$:.%.%
00126b0: 2424 207c 665f 7828 6e29 202d 2032 5e6e  $$ |f_x(n) - 2^n
00126c0: 2078 7c20 3c20 3120 2424 0a25 0a25 5c6e   x| < 1 $$.%.%\n
00126d0: 6f69 6e64 656e 7420 7468 656e 2077 6520  oindent then we 
00126e0: 6861 7665 2066 6f72 2061 6e79 2024 6e24  have for any $n$
00126f0: 3a0a 250a 5c62 6567 696e 7b65 716e 6172  :.%.\begin{eqnar
0012700: 7261 792a 7d0a 7c66 5f7b 2d78 7d28 6e29  ray*}.|f_{-x}(n)
0012710: 202d 2032 5e6e 2028 2d78 297c 2026 203d   - 2^n (-x)| & =
0012720: 2026 207c 2d66 5f78 286e 2920 2d20 325e   & |-f_x(n) - 2^
0012730: 6e20 282d 7829 7c20 2020 2020 2020 5c5c  n (-x)|       \\
0012740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
0012750: 2020 2020 2020 2020 2620 3d20 2620 7c2d          & = & |-
0012760: 2866 5f78 286e 2920 2d20 325e 6e20 7829  (f_x(n) - 2^n x)
0012770: 7c20 2020 2020 2020 205c 5c0a 2020 2020  |        \\.    
0012780: 2020 2020 2020 2020 2020 2020 2020 2020                  
0012790: 2020 2026 203d 2026 207c 665f 7828 6e29     & = & |f_x(n)
00127a0: 202d 2032 5e6e 2078 7c20 2020 2020 2020   - 2^n x|       
00127b0: 2020 2020 5c5c 0a20 2020 2020 2020 2020      \\.         
00127c0: 2020 2020 2020 2020 2020 2020 2020 2620                & 
00127d0: 3c20 2620 310a 5c65 6e64 7b65 716e 6172  < & 1.\end{eqnar
00127e0: 7261 792a 7d0a 0ae1 cec1 cccf c7c9 dece  ray*}...........
00127f0: cf2c 20cd d920 cdcf d6c5 cd20 cfd0 d2c5  ., .. ..... ....
0012800: c4c5 ccc9 d4d8 20d7 d9de c9d3 ccc5 cec9  ...... .........
0012810: c520 c1c2 d3cf ccc0 d4ce cfca 20d7 c5cc  . .......... ...
0012820: c9de c9ce d920 d7c5 ddc5 d3d4 d7c5 cece  ..... ..........
0012830: d9c8 200a dec9 d3c5 cc2c 20c9 d3d0 cfcc  .. ......, .....
0012840: d8da d5d1 20c6 d5ce cbc3 c9c0 7e7b 5c74  .... .......~{\t
0012850: 7420 6162 735c 5f6e 756d 7d3a 0a25 0a25  t abs\_num}:.%.%
0012860: 5369 6d69 6c61 726c 792c 2077 6520 6361  Similarly, we ca
0012870: 6e20 6465 6669 6e65 2061 6e20 6061 6273  n define an `abs
0012880: 6f6c 7574 6520 7661 6c75 6527 2066 756e  olute value' fun
0012890: 6374 696f 6e20 6f6e 2072 6561 6c20 6e75  ction on real nu
00128a0: 6d62 6572 732c 2075 7369 6e67 0a25 7468  mbers, using.%th
00128b0: 6520 636f 7272 6573 706f 6e64 696e 6720  e corresponding 
00128c0: 6675 6e63 7469 6f6e 207b 5c74 7420 6162  function {\tt ab
00128d0: 735c 5f6e 756d 7d20 6f6e 206e 756d 6265  s\_num} on numbe
00128e0: 7273 3a0a 250a 5c62 6567 696e 7b62 6f78  rs:.%.\begin{box
00128f0: 6564 7d5c 6265 6769 6e7b 6c73 746c 6973  ed}\begin{lstlis
0012900: 7469 6e67 7d0a 2020 6c65 7420 7265 616c  ting}.  let real
0012910: 5f61 6273 2066 206e 203d 2061 6273 5f6e  _abs f n = abs_n
0012920: 756d 2028 6620 6e29 3b3b 0a5c 656e 647b  um (f n);;.\end{
0012930: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
0012940: 626f 7865 647d 0a25 0ae4 cfcb c1da c1d4  boxed}.%........
0012950: c5cc d8d3 d4d7 cf20 cbcf d2d2 c5cb d4ce  ....... ........
0012960: cfd3 d4c9 20dc d4cf c7cf 20cf d0d2 c5c4  .... ..... .....
0012970: c5cc c5ce c9d1 20d4 c1cb d6c5 20ce c520  ...... ..... .. 
0012980: d0d2 c5c4 d3d4 c1d7 ccd1 c5d4 20d4 d2d5  ............ ...
0012990: c4ce cfd3 d4c9 2c0a d0d2 c9ce c9cd c1d1  ......,.........
00129a0: 20d7 cf20 d7ce c9cd c1ce c9c5 2c20 ded4   .. ........, ..
00129b0: cf7e 247c 7c78 7c20 2d20 7c79 7c7c 205c  .~$||x| - |y|| \
00129c0: 6c65 7120 7c78 202d 2079 7c24 2e20 0a0a  leq |x - y|$. ..
00129d0: f0c5 d2c5 cac4 c5cd 20cb 20d3 ccc5 c4d5  ........ . .....
00129e0: c0dd c5ca 20da c1c4 c1de c57e 2d2d 2d20  .... ......~--- 
00129f0: d3cc cfd6 c5ce c9c0 20c4 d7d5 c820 d7c5  ........ .... ..
0012a00: ddc5 d3d4 d7c5 cece d9c8 20de c9d3 c5cc  .......... .....
0012a10: 2e20 f0d2 c5c4 d0cf cccf d6c9 cd2c 0ade  . ...........,..
0012a20: d4cf 7e24 7824 20c9 7e24 7924 20d0 d2c5  ..~$x$ .~$y$ ...
0012a30: c4d3 d4c1 d7cc c5ce d920 cbc1 cb7e 2466  ......... ...~$f
0012a40: 5f78 2420 c97e 2466 5f79 2420 d3cf cfd4  _x$ .~$f_y$ ....
0012a50: d7c5 d4d3 d4d7 c5ce cecf 2e20 efd0 d2c5  ........... ....
0012a60: c4c5 ccc9 cd20 d3cc cfd6 c5ce c9c5 0ad4  ..... ..........
0012a70: c1cb 3a0a 2554 6865 2063 6f72 7265 6374  ..:.%The correct
0012a80: 6e65 7373 206f 6620 7468 6973 2069 7320  ness of this is 
0012a90: 6167 6169 6e20 7374 7261 6967 6874 666f  again straightfo
0012aa0: 7277 6172 642c 2075 7369 6e67 2074 6865  rward, using the
0012ab0: 2066 6163 7420 7468 6174 2024 7c7c 787c   fact that $||x|
0012ac0: 202d 0a25 7c79 7c7c 205c 6c65 7120 7c78   -.%|y|| \leq |x
0012ad0: 202d 2079 7c24 2e20 4e6f 7720 636f 6e73   - y|$. Now cons
0012ae0: 6964 6572 2074 6865 2070 726f 626c 656d  ider the problem
0012af0: 206f 6620 6164 6469 6e67 2074 776f 2072   of adding two r
0012b00: 6561 6c20 6e75 6d62 6572 732e 0a25 5375  eal numbers..%Su
0012b10: 7070 6f73 6520 2478 2420 616e 6420 2479  ppose $x$ and $y
0012b20: 2420 6172 6520 7265 7072 6573 656e 7465  $ are represente
0012b30: 6420 6279 2024 665f 7824 2061 6e64 2024  d by $f_x$ and $
0012b40: 665f 7924 2072 6573 7065 6374 6976 656c  f_y$ respectivel
0012b50: 792e 2057 6520 636f 756c 640a 2564 6566  y. We could.%def
0012b60: 696e 653a 0a25 0a24 2420 0a20 665f 7b78  ine:.%.$$ . f_{x
0012b70: 202b 2079 7d28 6e29 203d 2066 5f78 286e   + y}(n) = f_x(n
0012b80: 2920 2b20 665f 7928 6e29 2e0a 2424 0a25  ) + f_y(n)..$$.%
0012b90: 0aef c4ce c1cb cf2c 20d4 c1cb cfc5 20cf  ......., ..... .
0012ba0: d0d2 c5c4 c5cc c5ce c9c5 20ce c520 c7c1  .......... .. ..
0012bb0: d2c1 ced4 c9d2 d5c5 d420 d3cf c2cc c0c4  ......... ......
0012bc0: c5ce cec9 d120 cbd2 c9d4 c5d2 c9d1 20c1  ..... ........ .
0012bd0: d0d0 d2cf cbd3 c9cd c1c3 c9c9 3a0a 2548  ............:.%H
0012be0: 6f77 6576 6572 2074 6869 7320 6769 7665  owever this give
0012bf0: 7320 6e6f 2067 7561 7261 6e74 6565 2074  s no guarantee t
0012c00: 6861 7420 7468 6520 6170 7072 6f78 696d  hat the approxim
0012c10: 6174 696f 6e20 6372 6974 6572 696f 6e20  ation criterion 
0012c20: 6973 206d 6169 6e74 6169 6e65 643b 0a25  is maintained;.%
0012c30: 7765 2077 6f75 6c64 2068 6176 653a 0a25  we would have:.%
0012c40: 0a5c 6265 6769 6e7b 6571 6e61 7272 6179  .\begin{eqnarray
0012c50: 2a7d 0a7c 665f 7b78 202b 2079 7d28 6e29  *}.|f_{x + y}(n)
0012c60: 202d 2032 5e6e 2028 7820 2b20 7929 7c20   - 2^n (x + y)| 
0012c70: 2620 3d20 2620 7c66 5f78 286e 2920 2b20  & = & |f_x(n) + 
0012c80: 665f 7928 6e29 202d 2032 5e6e 2028 7820  f_y(n) - 2^n (x 
0012c90: 2b20 7929 7c20 2020 2020 205c 5c0a 2020  + y)|      \\.  
0012ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0012cb0: 2020 2020 2020 2020 2020 2026 205c 6c65             & \le
0012cc0: 7120 2620 7c66 5f78 286e 2920 2d20 325e  q & |f_x(n) - 2^
0012cd0: 6e20 787c 202b 207c 665f 7928 6e29 202d  n x| + |f_y(n) -
0012ce0: 2032 5e6e 2079 7c0a 5c65 6e64 7b65 716e   2^n y|.\end{eqn
0012cf0: 6172 7261 792a 7d0a 250a edcf d6ce cf20  array*}.%...... 
0012d00: d5d4 d7c5 d2d6 c4c1 d4d8 2c20 ded4 cf20  .........., ... 
0012d10: d3d5 cdcd c120 d720 d0d2 c1d7 cfca 20de  ..... . ...... .
0012d20: c1d3 d4c9 20ce c5d2 c1d7 c5ce d3d4 d7c1  .... ...........
0012d30: 20ce c520 d0d2 c5d7 d9db c1c5 d47e 2432   .. .........~$2
0012d40: 242c 200a d720 d4cf 20d7 d2c5 cdd1 2c20  $, .. .. ....., 
0012d50: cbc1 cb20 cbd2 c9d4 c5d2 c9ca 20cf c7d2  ... ........ ...
0012d60: c1ce c9de c9d7 c1c5 d420 cec1 d37e 2431  ......... ...~$1
0012d70: 242e 20f3 ccc5 c4cf d7c1 d4c5 ccd8 cecf  $. .............
0012d80: 2c20 d720 c4c1 cece cfcd 200a d3cc d5de  , . ...... .....
0012d90: c1c5 20ce c1cd 20d4 d2c5 c2d5 c5d4 d3d1  .. ... .........
0012da0: 20d7 d9de c9d3 ccc9 d4d8 7e24 7824 20c9   .........~$x$ .
0012db0: 7e24 7924 20d3 207b 5c65 6d20 c2cf ccd8  ~$y$ . {\em ....
0012dc0: dbc5 ca7d 200a d2c1 dad2 d1c4 cecf d3d4  ...} ...........
0012dd0: d8c0 2c20 dec5 cd20 d4d2 c5c2 d5c5 d4d3  .., ... ........
0012de0: d120 cfd4 20d2 c5da d5cc d8d4 c1d4 c120  . .. .......... 
0012df0: cfd0 c5d2 c1c3 c9c9 2e20 f0d2 c5c4 d0cf  ......... ......
0012e00: cccf d6c9 cd2c 20de d4cf 0a25 0a25 5765  ....., ....%.%We
0012e10: 2063 616e 2067 7561 7261 6e74 6565 2074   can guarantee t
0012e20: 6861 7420 7468 6520 7375 6d20 6f6e 2074  hat the sum on t
0012e30: 6865 2072 6967 6874 2069 7320 6c65 7373  he right is less
0012e40: 2074 6861 6e20 2432 242c 2062 7574 206e   than $2$, but n
0012e50: 6f74 2074 6861 7420 6974 2069 730a 256c  ot that it is.%l
0012e60: 6573 7320 7468 616e 2024 3124 2061 7320  ess than $1$ as 
0012e70: 7265 7175 6972 6564 2e20 5468 6572 6566  required. Theref
0012e80: 6f72 652c 2077 6520 6e65 6564 2069 6e20  ore, we need in 
0012e90: 7468 6973 2063 6173 6520 746f 2065 7661  this case to eva
0012ea0: 6c75 6174 6520 2478 2420 616e 640a 2524  luate $x$ and.%$
0012eb0: 7924 2074 6f20 7b5c 656d 2067 7265 6174  y$ to {\em great
0012ec0: 6572 7d20 6163 6375 7261 6379 2074 6861  er} accuracy tha
0012ed0: 6e20 7265 7175 6972 6564 2069 6e20 7468  n required in th
0012ee0: 6520 616e 7377 6572 2e20 5375 7070 6f73  e answer. Suppos
0012ef0: 6520 7765 2064 6566 696e 653a 0a25 0a24  e we define:.%.$
0012f00: 2420 0a20 2066 5f7b 7820 2b20 797d 286e  $ .  f_{x + y}(n
0012f10: 2920 3d20 2866 5f78 286e 202b 2031 2920  ) = (f_x(n + 1) 
0012f20: 2b20 665f 7928 6e20 2b20 3129 2920 2f20  + f_y(n + 1)) / 
0012f30: 322e 0a24 240a 250a fcd4 cf2c 20d7 20d3  2..$$.%...., . .
0012f40: d7cf c020 cfde c5d2 c5c4 d82c 20c4 c1c5  ... ......., ...
0012f50: d40a 255c 6e6f 696e 6465 6e74 204e 6f77  ..%\noindent Now
0012f60: 2077 6520 6861 7665 3a0a 250a 5c62 6567   we have:.%.\beg
0012f70: 696e 7b65 716e 6172 7261 792a 7d0a 7c66  in{eqnarray*}.|f
0012f80: 5f7b 7820 2b20 797d 286e 2920 2d20 325e  _{x + y}(n) - 2^
0012f90: 6e20 2878 202b 2079 297c 0a26 203d 2026  n (x + y)|.& = &
0012fa0: 207c 2866 5f78 286e 202b 2031 2920 2b20   |(f_x(n + 1) + 
0012fb0: 665f 7928 6e20 2b20 3129 2920 2f20 3220  f_y(n + 1)) / 2 
0012fc0: 2d20 325e 6e20 2878 202b 2079 297c 2020  - 2^n (x + y)|  
0012fd0: 2020 2020 2020 2020 2020 205c 5c0a 2620             \\.& 
0012fe0: 5c6c 6571 2026 207c 665f 7828 6e20 2b20  \leq & |f_x(n + 
0012ff0: 3129 202f 2032 202d 2032 5e6e 2078 7c20  1) / 2 - 2^n x| 
0013000: 2b20 7c66 5f79 286e 202b 2031 2920 2f20  + |f_y(n + 1) / 
0013010: 3220 2d20 325e 6e20 797c 2020 2020 5c5c  2 - 2^n y|    \\
0013020: 0a26 203d 2026 207b 3120 5c6f 7665 7220  .& = & {1 \over 
0013030: 327d 207c 665f 7828 6e20 2b20 3129 202d  2} |f_x(n + 1) -
0013040: 2032 5e7b 6e20 2b20 317d 2078 7c20 2b0a   2^{n + 1} x| +.
0013050: 2020 2020 2020 7b31 205c 6f76 6572 2032        {1 \over 2
0013060: 7d20 7c66 5f79 286e 202b 2031 2920 2d20  } |f_y(n + 1) - 
0013070: 325e 7b6e 202b 2031 7d20 797c 2020 2020  2^{n + 1} y|    
0013080: 2020 2020 2020 2020 2020 2020 2020 2020                  
0013090: 5c5c 0a26 203c 2026 207b 3120 5c6f 7665  \\.& < & {1 \ove
00130a0: 7220 327d 2031 202b 207b 3120 5c6f 7665  r 2} 1 + {1 \ove
00130b0: 7220 327d 2031 203d 2031 0a5c 656e 647b  r 2} 1 = 1.\end{
00130c0: 6571 6e61 7272 6179 2a7d 0a0a efde c5d7  eqnarray*}......
00130d0: c9c4 cecf 2c20 ded4 cf20 d4c1 cbcf c520  ...., ... ..... 
00130e0: cfd0 d2c5 c4c5 ccc5 cec9 c520 c4cf d3d4  ........... ....
00130f0: c9c7 c1c5 d420 d6c5 ccc1 c5cd cfca 20d4  ..... ........ .
0013100: cfde cecf d3d4 c92e 20ef c4ce c1cb cf2c  ........ ......,
0013110: 20d7 20ce a3cd 0ace c5d1 d7ce cf20 c9d3   . .......... ..
0013120: d0cf ccd8 dad5 c5d4 d3d1 20cf d0c5 d2c1  .......... .....
0013130: c3c9 d120 c4c5 ccc5 cec9 d120 d7c5 ddc5  ... ....... ....
0013140: d3d4 d7c5 cece d9c8 20de c9d3 c5cc 2e20  ........ ...... 
0013150: f0cf d3cb cfcc d8cb d520 c6d5 cecb c3c9  ......... ......
0013160: d10a c4cf ccd6 cec1 20d7 cfda d7d2 c1dd  ........ .......
0013170: c1d4 d820 c3c5 cccf dec9 d3cc c5ce ced9  ... ............
0013180: ca20 d2c5 dad5 ccd8 d4c1 d42c 20de c1d3  . ........., ...
0013190: d4ce cfc5 20d4 d2c5 c2d5 c5d4 d3d1 20cf  .... ......... .
00131a0: cbd2 d5c7 ccc9 d4d8 2e0a e5d3 ccc9 20cd  .............. .
00131b0: d920 d7d9 dec9 d3cc c9cd 20de c1d3 d4ce  . ........ .....
00131c0: cfc5 20d0 d2c9 20d0 cfcd cfdd c97e 7b5c  .. ... ......~{\
00131d0: 7474 2071 756f 5c5f 6e75 6d7d 2c20 cfdb  tt quo\_num}, ..
00131e0: c9c2 cbc1 20cf cbd2 d5c7 ccc5 cec9 d10a  .... ...........
00131f0: d3cf d3d4 c1d7 c9d4 20d0 cfde d4c9 7e24  ........ .....~$
0013200: 3124 20c9 20ce c520 d0cf dad7 cfcc c9d4  1$ . .. ........
0013210: 20c4 cfd3 d4c9 ded8 20d4 d2c5 c2d5 c5cd   ....... .......
0013220: cfca 20d4 cfde cecf d3d4 c920 cec5 dac1  .. ........ ....
0013230: d7c9 d3c9 cdcf 20cf d420 0ad4 cfde cecf  ...... .. ......
0013240: d3d4 c920 d7d9 dec9 d3cc c5ce c9d1 20c1  ... .......... .
0013250: d2c7 d5cd c5ce d4cf d72e 20f7 20d4 cf20  .......... . .. 
0013260: d6c5 20d7 d2c5 cdd1 2c20 dac1 d4d2 c1d4  .. ....., ......
0013270: c9d7 20de d5d4 d820 c2cf ccd8 dbc5 20d5  .. .... ...... .
0013280: d3c9 ccc9 ca2c 0acd d920 cdcf d6c5 cd20  .....,... ..... 
0013290: cfd0 d2c5 c4c5 ccc9 d4d8 20c6 d5ce cbc3  .......... .....
00132a0: c9c0 20c4 c5cc c5ce c9d1 2c20 cbcf d4cf  .. ......., ....
00132b0: d2c1 d120 d7d3 c5c7 c4c1 20c2 d5c4 c5d4  ... ...... .....
00132c0: 20d7 cfda d7d2 c1dd c1d4 d820 c3c5 cccf   .......... ....
00132d0: c520 0ade c9d3 cccf 2c20 c2cc c9d6 c1ca  . ......, ......
00132e0: dbc5 c520 cb7e d4cf dece cfcd d520 d2c5  ... .~....... ..
00132f0: dad5 ccd8 d4c1 d4d5 2028 c9cc c920 cfc4  ........ (... ..
0013300: cecf 20c9 da20 c4d7 d5c8 20c2 ccc9 d6c1  .. .. .... .....
0013310: cadb c9c8 2c20 c5d3 ccc9 200a d2c1 d3d3  ...., .... .....
0013320: d4cf d1ce c9c5 20c4 cf20 cec9 c820 cfcb  ...... .. ... ..
0013330: c1da d9d7 c1c5 d4d3 d120 cfc4 c9ce c1cb  ......... ......
0013340: cfd7 d9cd 292c 20d4 c1cb 20de d4cf 20cf  ....), ... ... .
0013350: dbc9 c2cb c120 cfcb d2d5 c7cc c5ce c9d1  ..... ..........
0013360: 20ce c9cb cfc7 c4c1 200a cec5 20d0 d2c5   ....... ... ...
0013370: d7d9 d3c9 d47e 2431 205c 6f76 6572 2032  .....~$1 \over 2
0013380: 242e 20f4 c1cb c1d1 20c6 d5ce cbc3 c9d1  $. ..... .......
0013390: 20cd cfd6 c5d4 20c2 d9d4 d820 d2c5 c1cc   ..... .... ....
00133a0: c9da cfd7 c1ce c120 d720 c3c5 cccf dec9  ....... . ......
00133b0: d3cc c5ce cecf ca0a c1d2 c9c6 cdc5 d4c9  ................
00133c0: cbc5 2c20 cecf 20c2 d5c4 c5d4 20d0 d2cf  .., .. ..... ...
00133d0: ddc5 20d7 d3c5 c7cf 20d7 cfd3 d0cf ccd8  .. ..... .......
00133e0: dacf d7c1 d4d8 d3d1 20cf d0c5 d2c1 c3c9  ........ .......
00133f0: c5ca 20c4 c5cc c5ce c9d1 20d2 c1c3 c9cf  .. ....... .....
0013400: cec1 ccd8 ced9 c80a dec9 d3c5 cc20 d320  ............. . 
0013410: d0cf d3cc c5c4 d5c0 ddc9 cd20 cfcb d2d5  ........... ....
0013420: c7cc c5ce c9c5 cd20 dec1 d3d4 cecf c7cf  ....... ........
0013430: 20cb 20c2 ccc9 d6c1 cadb c5cd d520 c3c5   . .......... ..
0013440: cccf cdd5 2c20 d0cf d3cb cfcc d8cb d520  ...., ......... 
0013450: c4cc d10a dcd4 c9c8 20c4 c5ca d3d4 d7c9  ........ .......
0013460: ca20 d5d6 c520 cfd0 d2c5 c4c5 ccc5 ced9  . ... ..........
0013470: 20d7 d3d4 d2cf c5ce ced9 c520 c6d5 cecb   .......... ....
0013480: c3c9 c93a 0a25 0a25 4170 7061 7265 6e74  ...:.%.%Apparent
0013490: 6c79 2074 6869 7320 6a75 7374 2067 6976  ly this just giv
00134a0: 6573 2074 6865 2061 6363 7572 6163 7920  es the accuracy 
00134b0: 7265 7175 6972 6564 2e20 486f 7765 7665  required. Howeve
00134c0: 7220 7765 2068 6176 6520 696d 706c 6963  r we have implic
00134d0: 6974 6c79 0a25 7573 6564 2072 6561 6c20  itly.%used real 
00134e0: 6d61 7468 656d 6174 6963 616c 2064 6976  mathematical div
00134f0: 6973 696f 6e20 6162 6f76 652e 2053 696e  ision above. Sin
0013500: 6365 2074 6865 2066 756e 6374 696f 6e20  ce the function 
0013510: 6973 2073 7570 706f 7365 6420 746f 2079  is supposed to y
0013520: 6965 6c64 0a25 616e 2069 6e74 6567 6572  ield.%an integer
0013530: 2c20 7765 2061 7265 206f 626c 6967 6564  , we are obliged
0013540: 2074 6f20 726f 756e 6420 7468 6520 7175   to round the qu
0013550: 6f74 6965 6e74 2074 6f20 616e 2069 6e74  otient to an int
0013560: 6567 6572 2e20 4966 2077 6520 6a75 7374  eger. If we just
0013570: 2075 7365 0a25 7b5c 7474 2071 756f 5c5f   use.%{\tt quo\_
0013580: 6e75 6d7d 2c20 7468 6520 6572 726f 7220  num}, the error 
0013590: 6672 6f6d 2072 6f75 6e64 696e 6720 7468  from rounding th
00135a0: 6973 206d 6967 6874 2062 6520 616c 6d6f  is might be almo
00135b0: 7374 2024 3124 2c20 6166 7465 7220 7768  st $1$, after wh
00135c0: 6963 680a 2577 6520 636f 756c 6420 6e65  ich.%we could ne
00135d0: 7665 7220 6775 6172 616e 7465 6520 7468  ver guarantee th
00135e0: 6520 626f 756e 6420 7765 2077 616e 742c  e bound we want,
00135f0: 2068 6f77 6576 6572 2061 6363 7572 6174   however accurat
0013600: 656c 7920 7765 2065 7661 6c75 6174 6520  ely we evaluate 
0013610: 7468 650a 2561 7267 756d 656e 7473 2e20  the.%arguments. 
0013620: 486f 7765 7665 7220 7769 7468 2061 2062  However with a b
0013630: 6974 206d 6f72 6520 6361 7265 2077 6520  it more care we 
0013640: 6361 6e20 6465 6669 6e65 2061 2064 6976  can define a div
0013650: 6973 696f 6e20 6675 6e63 7469 6f6e 2074  ision function t
0013660: 6861 740a 2561 6c77 6179 7320 7265 7475  hat.%always retu
0013670: 726e 7320 7468 6520 696e 7465 6765 7220  rns the integer 
0013680: 636c 6f73 6573 7420 746f 2074 6865 2074  closest to the t
0013690: 7275 6520 7265 7375 6c74 2028 6f72 206f  rue result (or o
00136a0: 6e65 206f 6620 7468 656d 2069 6e20 7468  ne of them in th
00136b0: 650a 2563 6173 6520 6f66 2074 776f 2065  e.%case of two e
00136c0: 7175 616c 6c79 2063 6c6f 7365 206f 6e65  qually close one
00136d0: 7329 2c20 736f 2074 6861 7420 7468 6520  s), so that the 
00136e0: 726f 756e 6469 6e67 2065 7272 6f72 206e  rounding error n
00136f0: 6576 6572 2065 7863 6565 6473 2024 310a  ever exceeds $1.
0013700: 255c 6f76 6572 2032 242e 2054 6869 7320  %\over 2$. This 
0013710: 636f 756c 6420 6265 2064 6f6e 6520 6469  could be done di
0013720: 7265 6374 6c79 2069 6e20 696e 7465 6765  rectly in intege
0013730: 7220 6172 6974 686d 6574 6963 2c20 6275  r arithmetic, bu
0013740: 7420 7468 6520 6d6f 7374 0a25 7374 7261  t the most.%stra
0013750: 6967 6874 666f 7277 6172 6420 636f 6469  ightforward codi
0013760: 6e67 2069 7320 746f 2075 7365 2072 6174  ng is to use rat
0013770: 696f 6e61 6c20 6469 7669 7369 6f6e 2066  ional division f
0013780: 6f6c 6c6f 7765 6420 6279 2072 6f75 6e64  ollowed by round
0013790: 696e 6720 746f 2074 6865 0a25 6e65 6172  ing to the.%near
00137a0: 6573 7420 696e 7465 6765 722c 2061 7320  est integer, as 
00137b0: 7468 6572 6520 6172 6520 6275 696c 742d  there are built-
00137c0: 696e 2066 756e 6374 696f 6e73 2066 6f72  in functions for
00137d0: 2062 6f74 6820 7468 6573 6520 6f70 6572   both these oper
00137e0: 6174 696f 6e73 3a0a 250a 5c62 6567 696e  ations:.%.\begin
00137f0: 7b62 6f78 6564 7d5c 6265 6769 6e7b 7665  {boxed}\begin{ve
0013800: 7262 6174 696d 7d0a 2020 236c 6574 206e  rbatim}.  #let n
0013810: 6469 7620 7820 7920 3d20 726f 756e 645f  div x y = round_
0013820: 6e75 6d28 7820 2f2f 2079 293b 3b0a 2020  num(x // y);;.  
0013830: 6e64 6976 203a 206e 756d 202d 3e20 6e75  ndiv : num -> nu
0013840: 6d20 2d3e 206e 756d 203d 203c 6675 6e3e  m -> num = <fun>
0013850: 0a20 2023 2369 6e66 6978 2022 6e64 6976  .  ##infix "ndiv
0013860: 223b 3b0a 2020 2328 496e 7420 3233 2920  ";;.  #(Int 23) 
0013870: 6e64 6976 2028 496e 7420 3529 3b3b 0a20  ndiv (Int 5);;. 
0013880: 202d 203a 206e 756d 203d 2049 6e74 2035   - : num = Int 5
0013890: 0a20 2023 2849 6e74 2032 3229 206e 6469  .  #(Int 22) ndi
00138a0: 7620 2849 6e74 2035 293b 3b0a 2020 2d20  v (Int 5);;.  - 
00138b0: 3a20 6e75 6d20 3d20 496e 7420 340a 2020  : num = Int 4.  
00138c0: 2328 496e 7428 2d31 3129 2920 6e64 6976  #(Int(-11)) ndiv
00138d0: 2028 496e 7420 3429 3b3b 0a20 202d 203a   (Int 4);;.  - :
00138e0: 206e 756d 203d 2049 6e74 202d 330a 2020   num = Int -3.  
00138f0: 2328 496e 7428 2d39 2929 206e 6469 7620  #(Int(-9)) ndiv 
0013900: 2849 6e74 2034 293b 3b0a 2020 2d20 3a20  (Int 4);;.  - : 
0013910: 6e75 6d20 3d20 496e 7420 2d32 0a5c 656e  num = Int -2.\en
0013920: 647b 7665 7262 6174 696d 7d5c 656e 647b  d{verbatim}\end{
0013930: 626f 7865 647d 0a0a e5d3 ccc9 20cd d920  boxed}...... .. 
0013940: cfd0 d2c5 c4c5 ccc9 cd20 cfd0 c5d2 c1c3  ......... ......
0013950: c9c0 20d3 cccf d6c5 cec9 d120 d320 d5de  .. ........ . ..
0013960: a3d4 cfcd 20d3 cbc1 dac1 cece cfc7 cf20  .... .......... 
0013970: d7d9 dbc5 2c0a 255c 6e6f 696e 6465 6e74  ....,.%\noindent
0013980: 204e 6f77 2069 6620 7765 2064 6566 696e   Now if we defin
0013990: 653a 0a25 0a24 2420 0a20 665f 7b78 202b  e:.%.$$ . f_{x +
00139a0: 2079 7d28 6e29 203d 2028 665f 7828 6e20   y}(n) = (f_x(n 
00139b0: 2b20 3229 202b 2066 5f79 286e 202b 2032  + 2) + f_y(n + 2
00139c0: 2929 205c 6d62 6f78 7b20 6e64 6976 207d  )) \mbox{ ndiv }
00139d0: 2034 2c20 0a24 240a 250a d7d3 a320 c2d5   4, .$$.%.... ..
00139e0: c4c5 d420 d2c1 c2cf d4c1 d4d8 2c20 cbc1  ... ........, ..
00139f0: cb20 d4d2 c5c2 d5c5 d4d3 d13a 0a25 5c6e  . .........:.%\n
0013a00: 6f69 6e64 656e 7420 6576 6572 7974 6869  oindent everythi
0013a10: 6e67 2077 6f72 6b73 3a0a 250a 5c62 6567  ng works:.%.\beg
0013a20: 696e 7b65 716e 6172 7261 792a 7d0a 7c66  in{eqnarray*}.|f
0013a30: 5f7b 7820 2b20 797d 286e 2920 2d20 325e  _{x + y}(n) - 2^
0013a40: 6e20 2878 202b 2079 297c 0a26 203d 2020  n (x + y)|.& =  
0013a50: 2020 2620 7c28 2866 5f78 286e 202b 2032    & |((f_x(n + 2
0013a60: 2920 2b20 665f 7928 6e20 2b20 3229 2920  ) + f_y(n + 2)) 
0013a70: 5c6d 626f 787b 206e 6469 7620 7d20 3429  \mbox{ ndiv } 4)
0013a80: 202d 2032 5e6e 2028 7820 2b20 7929 7c20   - 2^n (x + y)| 
0013a90: 2020 205c 5c0a 2620 5c6c 6571 2026 207b     \\.& \leq & {
0013aa0: 3120 5c6f 7665 7220 327d 202b 207c 2866  1 \over 2} + |(f
0013ab0: 5f78 286e 202b 2032 2920 2b20 665f 7928  _x(n + 2) + f_y(
0013ac0: 6e20 2b20 3229 2920 2f20 3420 2d20 325e  n + 2)) / 4 - 2^
0013ad0: 6e20 2878 202b 2079 297c 2020 2020 205c  n (x + y)|     \
0013ae0: 5c0a 2620 3d20 2020 2026 207b 3120 5c6f  \.& =    & {1 \o
0013af0: 7665 7220 327d 202b 207b 3120 5c6f 7665  ver 2} + {1 \ove
0013b00: 7220 347d 207c 2866 5f78 286e 202b 2032  r 4} |(f_x(n + 2
0013b10: 2920 2b20 665f 7928 6e20 2b20 3229 2920  ) + f_y(n + 2)) 
0013b20: 2d0a 2020 2020 2020 2020 2020 2020 2020  -.              
0013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
0013b40: 2020 2020 2020 2032 5e7b 6e20 2b20 327d         2^{n + 2}
0013b50: 2878 202b 2079 297c 2020 2020 2020 2020  (x + y)|        
0013b60: 2020 2020 2020 2020 2020 5c5c 0a26 205c            \\.& \
0013b70: 6c65 7120 2620 7b31 205c 6f76 6572 2032  leq & {1 \over 2
0013b80: 7d20 2b20 7b31 205c 6f76 6572 2034 7d20  } + {1 \over 4} 
0013b90: 7c66 5f78 286e 202b 2032 2920 2d20 325e  |f_x(n + 2) - 2^
0013ba0: 7b6e 202b 2032 7d20 787c 202b 0a20 2020  {n + 2} x| +.   
0013bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0013bc0: 2020 2020 7b31 205c 6f76 6572 2034 7d20      {1 \over 4} 
0013bd0: 7c66 5f79 286e 202b 2032 2920 2d20 325e  |f_y(n + 2) - 2^
0013be0: 7b6e 202b 2032 7d20 797c 2020 2020 2020  {n + 2} y|      
0013bf0: 2020 2020 205c 5c0a 2620 3c20 2020 2026       \\.& <    &
0013c00: 207b 3120 5c6f 7665 7220 327d 202b 207b   {1 \over 2} + {
0013c10: 3120 5c6f 7665 7220 347d 2031 202b 207b  1 \over 4} 1 + {
0013c20: 3120 5c6f 7665 7220 347d 2031 2020 2020  1 \over 4} 1    
0013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
0013c40: 5c5c 0a26 3d20 2020 2020 2620 310a 5c65  \\.&=     & 1.\e
0013c50: 6e64 7b65 716e 6172 7261 792a 7d0a 250a  nd{eqnarray*}.%.
0013c60: f0d2 cfc7 d2c1 cdcd cec1 d120 d2c5 c1cc  ........... ....
0013c70: c9da c1c3 c9d1 20d7 d9c7 ccd1 c4c9 d420  ...... ........ 
0013c80: d4c1 cb3a 0a25 5c6e 6f69 6e64 656e 7420  ...:.%\noindent 
0013c90: 4163 636f 7264 696e 676c 7920 7765 206d  Accordingly we m
0013ca0: 616b 6520 6f75 7220 6465 6669 6e69 7469  ake our definiti
0013cb0: 6f6e 3a0a 250a 5c62 6567 696e 7b62 6f78  on:.%.\begin{box
0013cc0: 6564 7d5c 6265 6769 6e7b 6c73 746c 6973  ed}\begin{lstlis
0013cd0: 7469 6e67 7d0a 2020 6c65 7420 7265 616c  ting}.  let real
0013ce0: 5f61 6464 2066 2067 206e 203d 0a20 2020  _add f g n =.   
0013cf0: 2028 6628 6e20 2b20 3229 202b 2f20 6728   (f(n + 2) +/ g(
0013d00: 6e20 2b20 3229 2920 6e64 6976 2028 496e  n + 2)) ndiv (In
0013d10: 7420 3429 3b3b 0a5c 656e 647b 6c73 746c  t 4);;.\end{lstl
0013d20: 6973 7469 6e67 7d5c 656e 647b 626f 7865  isting}\end{boxe
0013d30: 647d 0a0a e1ce c1cc cfc7 c9de ced9 c520  d}............. 
0013d40: d2c1 d3d3 d5d6 c4c5 cec9 d120 cdcf c7d5  ........... ....
0013d50: d420 c2d9 d4d8 20c9 d3d0 cfcc d8da cfd7  . .... .........
0013d60: c1ce d920 c4cc d120 cfd0 d2c5 c4c5 ccc5  ... ... ........
0013d70: cec9 d120 cfd0 c5d2 c1c3 c9c9 0ad7 d9de  ... ............
0013d80: c9d4 c1ce c9d1 2c20 cecf 20d0 d2cf ddc5  ......, .. .....
0013d90: 20d7 d3c5 c7cf 20d0 cfd3 d4d2 cfc9 d4d8   ..... .........
0013da0: 20c5 a320 cec1 20cf d3ce cfd7 c520 d5d6   .. .. ...... ..
0013db0: c520 d7d7 c5c4 c5ce ced9 c820 c6d5 cecb  . ......... ....
0013dc0: c3c9 ca3a 0a25 5765 2063 616e 2064 6566  ...:.%We can def
0013dd0: 696e 6520 7375 6274 7261 6374 696f 6e20  ine subtraction 
0013de0: 7369 6d69 6c61 726c 792c 2062 7574 2074  similarly, but t
0013df0: 6865 2073 696d 706c 6573 7420 6170 7072  he simplest appr
0013e00: 6f61 6368 2069 7320 746f 2062 7569 6c64  oach is to build
0013e10: 2069 740a 256f 7574 206f 6620 7468 6520   it.%out of the 
0013e20: 6675 6e63 7469 6f6e 7320 7468 6174 2077  functions that w
0013e30: 6520 616c 7265 6164 7920 6861 7665 3a0a  e already have:.
0013e40: 250a 5c62 6567 696e 7b62 6f78 6564 7d5c  %.\begin{boxed}\
0013e50: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
0013e60: 2020 236c 6574 2072 6561 6c5f 7375 6220    #let real_sub 
0013e70: 6620 6720 3d20 7265 616c 5f61 6464 2066  f g = real_add f
0013e80: 2028 7265 616c 5f6e 6567 2067 293b 3b0a   (real_neg g);;.
0013e90: 2020 7265 616c 5f73 7562 203a 2028 6e75    real_sub : (nu
0013ea0: 6d20 2d3e 206e 756d 2920 2d3e 2028 6e75  m -> num) -> (nu
0013eb0: 6d20 2d3e 206e 756d 2920 2d3e 206e 756d  m -> num) -> num
0013ec0: 202d 3e20 6e75 6d20 3d20 3c66 756e 3e0a   -> num = <fun>.
0013ed0: 5c65 6e64 7b76 6572 6261 7469 6d7d 5c65  \end{verbatim}\e
0013ee0: 6e64 7b62 6f78 6564 7d0a 0af2 c5c1 ccc9  nd{boxed}.......
0013ef0: dac1 c3c9 d120 d5cd cecf d6c5 cec9 d12c  ..... .........,
0013f00: 20d7 d9de c9d3 ccc5 cec9 d120 cfc2 d2c1   .......... ....
0013f10: d4ce d9c8 20de c9d3 c5cc 20c9 20c4 c5cc  .... ..... . ...
0013f20: c5ce c9d1 20d0 cfd4 d2c5 c2d5 c5d4 200a  .... ......... .
0013f30: d720 cfc2 ddc5 cd20 d3cc d5de c1c5 20ce  . ..... ...... .
0013f40: c5d3 cbcf ccd8 cbcf 20c2 cfcc d8db c9c8  ........ .......
0013f50: 20d5 d3c9 ccc9 ca2e 20ef c4ce c1cb cf2c   ....... ......,
0013f60: 20de c1d3 d4ce d9c5 20d3 ccd5 dec1 c920   ....... ...... 
0013f70: d5cd cecf d6c5 cec9 d120 c90a c4c5 ccc5  ......... ......
0013f80: cec9 d120 cec1 20c3 c5cc cfc5 20de c9d3  ... .. ..... ...
0013f90: cccf 20d3 d5dd c5d3 d4d7 c5ce cecf 20cc  .. ........... .
0013fa0: c5c7 dec5 20c9 20d0 d2c9 20dc d4cf cd20  .... . ... .... 
0013fb0: c4cf d3d4 c1d4 cfde cecf 20de c1d3 d4d9  .......... .....
0013fc0: 2e20 f0cf 200a d3cf cfc2 d2c1 d6c5 cec9  . .. ...........
0013fd0: d1cd 20dc c6c6 c5cb d4c9 d7ce cfd3 d4c9  .. .............
0013fe0: 20cf cec9 20da c1d3 ccd5 d6c9 d7c1 c0d4   ... ...........
0013ff0: 20cf d4c4 c5cc d8ce cfc7 cf20 d2c1 d3d3   .......... ....
0014000: cdcf d4d2 c5ce c9d1 2e20 f0d5 d3d4 d80a  ......... ......
0014010: 2549 7420 6973 2061 2062 6974 2074 7269  %It is a bit tri
0014020: 636b 6965 7220 746f 2064 6566 696e 6520  ckier to define 
0014030: 6d75 6c74 6970 6c69 6361 7469 6f6e 2c20  multiplication, 
0014040: 696e 7665 7273 6573 2061 6e64 2064 6976  inverses and div
0014050: 6973 696f 6e2e 2048 6f77 6576 6572 0a25  ision. However.%
0014060: 7468 6520 6361 7365 7320 7768 6572 6520  the cases where 
0014070: 7765 206d 756c 7469 706c 7920 6f72 2064  we multiply or d
0014080: 6976 6964 6520 6279 2061 6e20 696e 7465  ivide by an inte
0014090: 6765 7220 6172 6520 6d75 6368 2065 6173  ger are much eas
00140a0: 6965 7220 616e 6420 7175 6974 650a 2563  ier and quite.%c
00140b0: 6f6d 6d6f 6e2e 2049 7420 6973 2077 6f72  ommon. It is wor
00140c0: 7468 7768 696c 6520 696d 706c 656d 656e  thwhile implemen
00140d0: 7469 6e67 2074 6865 7365 2073 6570 6172  ting these separ
00140e0: 6174 656c 7920 6173 2074 6865 7920 6361  ately as they ca
00140f0: 6e20 6265 206d 6164 6520 6d6f 7265 0a25  n be made more.%
0014100: 6566 6669 6369 656e 742e 2057 6520 6465  efficient. We de
0014110: 6669 6e65 3a0a 250a 2424 200a 2020 665f  fine:.%.$$ .  f_
0014120: 7b6d 2078 7d28 6e29 203d 2028 6d20 665f  {m x}(n) = (m f_
0014130: 7828 6e2b 702b 3129 2920 5c6d 626f 787b  x(n+p+1)) \mbox{
0014140: 206e 6469 7620 7d20 325e 7b70 2b31 7d2c   ndiv } 2^{p+1},
0014150: 0a24 240a 250a c7c4 c520 2470 247e d7d9  .$$.%.... $p$~..
0014160: c2c9 d2c1 c5d4 d3d1 20d4 c1cb 2c20 ded4  ........ ..., ..
0014170: cfc2 d97e 2432 5e70 205c 6765 7120 7c6d  ...~$2^p \geq |m
0014180: 7c24 2e20 e4cf cbc1 dac1 d4d8 20cb cfd2  |$. ........ ...
0014190: d2c5 cbd4 cecf d3d4 d820 dcd4 cfc7 cf20  ......... ..... 
00141a0: 0acf d0d2 c5c4 c5cc c5ce c9d1 20cc c5c7  ............ ...
00141b0: cbcf 3a0a 255c 6e6f 696e 6465 6e74 2077  ..:.%\noindent w
00141c0: 6865 7265 2024 7024 2069 7320 6368 6f73  here $p$ is chos
00141d0: 656e 2073 6f20 7468 6174 2024 325e 7020  en so that $2^p 
00141e0: 5c67 6571 207c 6d7c 242e 2046 6f72 2063  \geq |m|$. For c
00141f0: 6f72 7265 6374 6e65 7373 2c20 7765 2068  orrectness, we h
0014200: 6176 653a 0a25 0a5c 6265 6769 6e7b 6571  ave:.%.\begin{eq
0014210: 6e61 7272 6179 2a7d 0a7c 665f 7b6d 2078  narray*}.|f_{m x
0014220: 7d28 6e29 202d 2032 5e6e 2028 6d20 7829  }(n) - 2^n (m x)
0014230: 7c0a 2620 5c6c 6571 2026 207b 3120 5c6f  |.& \leq & {1 \o
0014240: 7665 7220 327d 202b 207c 7b6d 2066 5f78  ver 2} + |{m f_x
0014250: 286e 2b70 2b31 2920 5c6f 7665 7220 325e  (n+p+1) \over 2^
0014260: 7b70 2b31 7d7d 202d 2032 5e6e 2028 6d20  {p+1}} - 2^n (m 
0014270: 7829 7c20 2020 2020 2020 5c5c 0a26 203d  x)|       \\.& =
0014280: 2020 2020 2620 7b31 205c 6f76 6572 2032      & {1 \over 2
0014290: 7d20 2b20 7b7c 6d7c 205c 6f76 6572 2032  } + {|m| \over 2
00142a0: 5e7b 702b 317d 7d20 7c66 5f78 286e 2b70  ^{p+1}} |f_x(n+p
00142b0: 2b31 2920 2d20 325e 7b6e 2b70 2b31 7d20  +1) - 2^{n+p+1} 
00142c0: 787c 2020 205c 5c0a 2620 3c20 2020 2026  x|   \\.& <    &
00142d0: 207b 3120 5c6f 7665 7220 327d 202b 207b   {1 \over 2} + {
00142e0: 7c6d 7c20 5c6f 7665 7220 325e 7b70 2b31  |m| \over 2^{p+1
00142f0: 7d7d 2020 2020 2020 2020 2020 2020 2020  }}              
0014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
0014310: 5c5c 0a26 205c 6c65 7120 2620 7b31 205c  \\.& \leq & {1 \
0014320: 6f76 6572 2032 7d20 2b20 7b31 205c 6f76  over 2} + {1 \ov
0014330: 6572 2032 7d20 7b7c 6d7c 205c 6f76 6572  er 2} {|m| \over
0014340: 2032 5e70 7d20 2020 2020 2020 2020 2020   2^p}           
0014350: 2020 2020 2020 2020 2020 205c 5c0a 2620             \\.& 
0014360: 5c6c 6571 2026 207b 3120 5c6f 7665 7220  \leq & {1 \over 
0014370: 327d 202b 207b 3120 5c6f 7665 7220 327d  2} + {1 \over 2}
0014380: 203d 2031 2e0a 5c65 6e64 7b65 716e 6172   = 1..\end{eqnar
0014390: 7261 792a 7d0a 0ae4 ccd1 20d2 c5c1 ccc9  ray*}..... .....
00143a0: dac1 c3c9 c920 d4c1 cbcf c7cf 20d0 cfc4  ..... ...... ...
00143b0: c8cf c4c1 20ce c1cd 20d0 cfd4 d2c5 c2d5  .... ... .......
00143c0: c5d4 d3d1 20c6 d5ce cbc3 c9d1 20d7 d9de  .... ....... ...
00143d0: c9d3 ccc5 cec9 d120 0ad3 cfcf d4d7 c5d4  ....... ........
00143e0: d3d4 d7d5 c0dd c5c7 cf7e 2470 242e 20ee  .........~$p$. .
00143f0: c520 d3cc c9db cbcf cd20 c9da cfdd d2a3  . ....... ......
0014400: cece cfc5 2c20 cecf 20d7 d0cf ccce c520  ...., .. ...... 
0014410: d0cf c4c8 cfc4 d1dd c5c5 200a cfd0 d2c5  .......... .....
0014420: c4c5 ccc5 cec9 c520 cdcf d6c5 d420 d7d9  ....... ..... ..
0014430: c7cc d1c4 c5d4 d820 d4c1 cb3a 200a 2549  ....... ...: .%I
0014440: 6e20 6f72 6465 7220 746f 2069 6d70 6c65  n order to imple
0014450: 6d65 6e74 2074 6869 732c 2077 6520 6e65  ment this, we ne
0014460: 6564 2061 2066 756e 6374 696f 6e20 746f  ed a function to
0014470: 2066 696e 6420 7468 6520 6170 7072 6f70   find the approp
0014480: 7269 6174 6520 2470 242e 2054 6865 0a25  riate $p$. The.%
0014490: 666f 6c6c 6f77 696e 6720 6973 2063 7275  following is cru
00144a0: 6465 2062 7574 2061 6465 7175 6174 653a  de but adequate:
00144b0: 0a25 0a5c 6265 6769 6e7b 626f 7865 647d  .%.\begin{boxed}
00144c0: 5c62 6567 696e 7b6c 7374 6c69 7374 696e  \begin{lstlistin
00144d0: 677d 0a20 206c 6574 206c 6f67 3220 3d0a  g}.  let log2 =.
00144e0: 2020 2020 6c65 7420 7265 6320 6c6f 6732      let rec log2
00144f0: 2078 2079 203d 0a20 2020 2020 2069 6620   x y =.      if 
0014500: 7820 3c2f 2049 6e74 2031 2074 6865 6e20  x </ Int 1 then 
0014510: 790a 2020 2020 2020 656c 7365 206c 6f67  y.      else log
0014520: 3220 2871 756f 5f6e 756d 2078 2028 496e  2 (quo_num x (In
0014530: 7420 3229 2920 2879 202b 2031 2920 696e  t 2)) (y + 1) in
0014540: 0a20 2020 2066 756e 2078 202d 3e20 6c6f  .    fun x -> lo
0014550: 6732 2028 7820 2d2f 2049 6e74 2031 2920  g2 (x -/ Int 1) 
0014560: 303b 3b0a 5c65 6e64 7b6c 7374 6c69 7374  0;;.\end{lstlist
0014570: 696e 677d 5c65 6e64 7b62 6f78 6564 7d0a  ing}\end{boxed}.
0014580: 250a 255c 6e6f 696e 6465 6e74 2054 6865  %.%\noindent The
0014590: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
00145a0: 6973 2073 696d 706c 793a 0af3 20d5 dea3  is simply:.. ...
00145b0: d4cf cd20 d3cb c1da c1ce cecf c7cf 20d7  ... .......... .
00145c0: d9db c52c 20cf d0c5 d2c1 c3c9 d120 d5cd  ..., ........ ..
00145d0: cecf d6c5 cec9 d120 cec1 20c3 c5cc cfc5  ....... .. .....
00145e0: 20de c9d3 cccf 20d0 d2c9 cec9 cdc1 c5d4   ..... .........
00145f0: 20d7 c9c4 3a0a 250a 5c62 6567 696e 7b62   ...:.%.\begin{b
0014600: 6f78 6564 7d5c 6265 6769 6e7b 6c73 746c  oxed}\begin{lstl
0014610: 6973 7469 6e67 7d0a 2020 6c65 7420 7265  isting}.  let re
0014620: 616c 5f69 6e74 6d75 6c20 6d20 7820 6e20  al_intmul m x n 
0014630: 3d0a 2020 2020 206c 6574 2070 203d 206c  =.     let p = l
0014640: 6f67 3220 2861 6273 5f6e 756d 206d 2920  og2 (abs_num m) 
0014650: 696e 0a20 2020 2020 6c65 7420 7031 203d  in.     let p1 =
0014660: 2070 202b 2031 2069 6e0a 2020 2020 2028   p + 1 in.     (
0014670: 6d20 2a2f 2078 286e 202b 2070 3129 2920  m */ x(n + p1)) 
0014680: 6e64 6976 2028 496e 7420 3220 2a2a 2f20  ndiv (Int 2 **/ 
0014690: 496e 7420 7031 293b 3b0a 5c65 6e64 7b6c  Int p1);;.\end{l
00146a0: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
00146b0: 6f78 6564 7d0a 250a e4c5 ccc5 cec9 c520  oxed}.%........ 
00146c0: cec1 20c3 c5cc cfc5 20de c9d3 cccf 20d7  .. ..... ..... .
00146d0: d7cf c4c9 d4d3 d120 d3cc c5c4 d5c0 ddc9  ....... ........
00146e0: cd20 cfc2 d2c1 dacf cd3a 0a25 5c6e 6f69  . .......:.%\noi
00146f0: 6e64 656e 7420 466f 7220 6469 7669 7369  ndent For divisi
0014700: 6f6e 2062 7920 616e 2069 6e74 6567 6572  on by an integer
0014710: 2c20 7765 2064 6566 696e 653a 0a25 0a24  , we define:.%.$
0014720: 2420 665f 7b78 202f 206d 7d28 6e29 203d  $ f_{x / m}(n) =
0014730: 2066 5f78 286e 2920 5c6d 626f 787b 206e   f_x(n) \mbox{ n
0014740: 6469 7620 7d20 6d20 2424 0a0a e4cc d120  div } m $$..... 
0014750: d5d0 d2cf ddc5 cec9 d120 c4cf cbc1 dac1  ......... ......
0014760: d4c5 ccd8 d3d4 d7c1 20cb cfd2 d2c5 cbd4  ........ .......
0014770: cecf d3d4 c920 dcd4 cfc7 cf20 cfd0 d2c5  ..... ..... ....
0014780: c4c5 ccc5 cec9 d120 c2d5 c4c5 cd20 d3de  ....... ..... ..
0014790: c9d4 c1d4 d82c 0ade d4cf 20d3 ccd5 dec1  .....,.... .....
00147a0: ca7e 246d 203d 2030 2420 cec9 cbcf c7c4  .~$m = 0$ ......
00147b0: c120 cec5 20cd cfd6 c5d4 20d7 cfda cec9  . .. ..... .....
00147c0: cbce d5d4 d82c 20c1 20d0 d2c9 2024 6d20  ....., . ... $m 
00147d0: 3d20 5c70 6d20 3124 20d2 c5da d5cc d8d4  = \pm 1$ .......
00147e0: c1d4 0acf d0c5 d2c1 c3c9 c920 cec5 20c9  ........... .. .
00147f0: dacd c5ce d1c5 d420 d0cf c7d2 c5db cecf  ....... ........
0014800: d3d4 c92e 20f7 20cf d3d4 c1cc d8ce d9c8  .... . .........
0014810: 20d3 ccd5 dec1 d1c8 20c9 da7e 247c 665f   ....... ..~$|f_
0014820: 7828 6e29 202d 2032 5e6e 2078 7c20 3c20  x(n) - 2^n x| < 
0014830: 3124 200a d3cc c5c4 d5c5 d42c 20de d4cf  1$ ........, ...
0014840: 7e24 7c66 5f78 286e 2920 2f20 6d20 2d20  ~$|f_x(n) / m - 
0014850: 325e 6e20 7820 2f20 6d7c 203c 207b 3120  2^n x / m| < {1 
0014860: 5c6f 7665 7220 7c6d 7c7d 205c 6c65 7120  \over |m|} \leq 
0014870: 7b31 205c 6f76 6572 2032 7d24 2c20 cfd4  {1 \over 2}$, ..
0014880: cbd5 c4c1 2c0a d720 d3d7 cfc0 20cf dec5  ....,.. .... ...
0014890: d2c5 c4d8 2c20 d320 d5de a3d4 cfcd 2024  ...., . ...... $
00148a0: 7c66 5f78 286e 2920 5c6d 626f 787b 206e  |f_x(n) \mbox{ n
00148b0: 6469 7620 7d20 6d20 2d20 665f 7828 6e29  div } m - f_x(n)
00148c0: 202f 206d 7c20 5c6c 6571 207b 3120 5c6f   / m| \leq {1 \o
00148d0: 7665 7220 327d 240a d0cf ccd5 dec1 c5cd  ver 2}$.........
00148e0: 20d4 d2c5 c2d5 c5cd cfc5 2e20 f720 c9d4   .......... . ..
00148f0: cfc7 c52c 20d0 d2cf c7d2 c1cd cdce c1d1  ..., ...........
0014900: 20d2 c5c1 ccc9 dac1 c3c9 d120 c4c5 ccc5   .......... ....
0014910: cec9 d120 d4c1 cbcf d7c1 3a0a 2546 6f72  ... ......:.%For
0014920: 2063 6f72 7265 6374 6e65 7373 2c20 7765   correctness, we
0014930: 2063 616e 2069 676e 6f72 6520 7468 6520   can ignore the 
0014940: 7472 6976 6961 6c20 6361 7365 7320 7768  trivial cases wh
0014950: 656e 2020 246d 203d 2030 242c 2077 6869  en  $m = 0$, whi
0014960: 6368 2073 686f 756c 640a 256e 6576 6572  ch should.%never
0014970: 2062 6520 7573 6564 2c20 616e 6420 7768   be used, and wh
0014980: 656e 2024 6d20 3d20 5c70 6d20 3124 2c20  en $m = \pm 1$, 
0014990: 7369 6e63 6520 7468 656e 2074 6865 2072  since then the r
00149a0: 6573 756c 7420 6973 2065 7861 6374 2e20  esult is exact. 
00149b0: 4f74 6865 7277 6973 652c 0a25 7765 2061  Otherwise,.%we a
00149c0: 7373 756d 6520 247c 665f 7828 6e29 202d  ssume $|f_x(n) -
00149d0: 2032 5e6e 2078 7c20 3c20 3124 2c20 736f   2^n x| < 1$, so
00149e0: 2024 7c66 5f78 286e 2920 2f20 6d20 2d20   $|f_x(n) / m - 
00149f0: 325e 6e20 7820 2f20 6d7c 203c 207b 3120  2^n x / m| < {1 
0014a00: 5c6f 7665 7220 7c6d 7c7d 0a25 5c6c 6571  \over |m|}.%\leq
0014a10: 207b 3120 5c6f 7665 7220 327d 242c 2077   {1 \over 2}$, w
0014a20: 6869 6368 2c20 746f 6765 7468 6572 2077  hich, together w
0014a30: 6974 6820 7468 6520 6661 6374 2074 6861  ith the fact tha
0014a40: 7420 247c 665f 7828 6e29 205c 6d62 6f78  t $|f_x(n) \mbox
0014a50: 7b20 6e64 6976 207d 206d 0a25 2d20 665f  { ndiv } m.%- f_
0014a60: 7828 6e29 202f 206d 7c20 5c6c 6571 207b  x(n) / m| \leq {
0014a70: 3120 5c6f 7665 7220 327d 242c 2079 6965  1 \over 2}$, yie
0014a80: 6c64 7320 7468 6520 7265 7375 6c74 2e20  lds the result. 
0014a90: 536f 2077 6520 6861 7665 3a0a 250a 5c62  So we have:.%.\b
0014aa0: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
0014ab0: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
0014ac0: 6c65 7420 7265 616c 5f69 6e74 6469 7620  let real_intdiv 
0014ad0: 6d20 7820 6e20 3d0a 2020 2020 2078 286e  m x n =.     x(n
0014ae0: 2920 6e64 6976 2028 496e 7420 6d29 3b3b  ) ndiv (Int m);;
0014af0: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
0014b00: 7d5c 656e 647b 626f 7865 647d 0a0a 5c73  }\end{boxed}..\s
0014b10: 7562 7365 6374 696f 6e7b f5cd cecf d6c5  ubsection{......
0014b20: cec9 c53a 20cf c2dd c9ca 20d3 ccd5 dec1  ...: ..... .....
0014b30: ca7d 0a25 5c73 7562 7365 6374 696f 6e7b  .}.%\subsection{
0014b40: 4765 6e65 7261 6c20 6d75 6c74 6970 6c69  General multipli
0014b50: 6361 7469 6f6e 7d0a 0aef d0d2 c5c4 c5cc  cation}.........
0014b60: c9d4 d820 d5cd cecf d6c5 cec9 c520 d720  ... ......... . 
0014b70: cfc2 ddc5 cd20 d3cc d5de c1c5 20d4 d2d5  ..... ...... ...
0014b80: c4ce c5c5 2c20 d0cf d3cb cfcc d8cb d520  ...., ......... 
0014b90: d0cf c7d2 c5db cecf d3d4 d820 0ac1 d0d0  ........... ....
0014ba0: d2cf cbd3 c9cd c1c3 c9c9 20cf c4ce cfc7  .......... .....
0014bb0: cf20 c9da 20d3 cfcd cecf d6c9 d4c5 ccc5  . .. ...........
0014bc0: ca20 d5cd cecf d6c1 c5d4 d3d1 20ce c120  . .......... .. 
0014bd0: d0cf d2d1 c4cf cb20 d7d4 cfd2 cfc7 cf2e  ....... ........
0014be0: 200a f3cc c5c4 cfd7 c1d4 c5cc d8ce cf2c   ..............,
0014bf0: 20ce c1cd 20d0 cfd4 d2c5 c2d5 c5d4 d3d1   ... ...........
0014c00: 20d0 d2c5 c4d7 c1d2 c9d4 c5cc d8ce cf20   .............. 
0014c10: cfc3 c5ce c9d4 d820 d0cf d2d1 c4cb c920  ....... ....... 
0014c20: d3cf cdce cfd6 c9d4 c5cc c5ca 2e0a f0cf  ................
0014c30: d3d4 d5d0 c9cd 20d3 ccc5 c4d5 c0dd c9cd  ...... .........
0014c40: 20cf c2d2 c1da cfcd 2e20 f0d2 c5c4 d0cf   ........ ......
0014c50: cccf d6c9 cd2c 20de d4cf 20ce c1cd 20d4  ....., ... ... .
0014c60: d2c5 c2d5 c5d4 d3d1 20d7 d9de c9d3 ccc9  ........ .......
0014c70: d4d8 200a d7d9 d2c1 d6c5 cec9 c57e 2478  .. ..........~$x
0014c80: 202b 2079 2420 c4cf 2024 6e5c 6862 6f78   + y$ .. $n\hbox
0014c90: 7b2d c7cf 7d24 7ed2 c1da d2d1 c4c1 2e20  {-..}$~........ 
0014ca0: e4cc d120 dcd4 cfc7 cf20 d7d9 c2c5 d2c5  ... ..... ......
0014cb0: cd7e 2472 2420 c97e 2473 2420 d4c1 cbc9  .~$r$ .~$s$ ....
0014cc0: c52c 0ade d4cf 7e24 7c72 202d 2073 7c20  .,....~$|r - s| 
0014cd0: 5c6c 6571 2031 2420 c97e 2472 202b 2073  \leq 1$ .~$r + s
0014ce0: 203d 206e 202b 2032 242e 20f4 c1cb c9cd   = n + 2$. .....
0014cf0: 20cf c2d2 c1da cfcd 2c20 cfc2 c520 dcd4   ......., ... ..
0014d00: c920 d7c5 ccc9 dec9 ced9 0ace c5d3 cbcf  . ..............
0014d10: ccd8 cbcf 20c2 cfcc d8db c52c 20de c5cd  .... ......, ...
0014d20: 20d0 cfcc cfd7 c9ce c120 d4d2 c5c2 d5c5   ........ ......
0014d30: cdcf ca20 d2c1 dad2 d1c4 cecf d3d4 c92e  ... ............
0014d40: 20e4 c1cc c5c5 20d7 d9de c9d3 ccc9 cd7e   ..... ........~
0014d50: 2466 5f78 2872 2924 0ac9 7e24 665f 7928  $f_x(r)$..~$f_y(
0014d60: 7329 242c 20d0 cfd3 ccc5 20de c5c7 cf20  s)$, ..... .... 
0014d70: cfd0 d2c5 c4c5 ccc9 cd7e 2470 2420 c97e  .........~$p$ .~
0014d80: 2471 247e 2d2d 2d20 d3cf cfd4 d7c5 d4d3  $q$~--- ........
0014d90: d4d7 d5c0 ddc9 c520 0a3c 3cc4 d7cf c9de  ....... .<<.....
0014da0: ced9 c520 cccf c7c1 d2c9 c6cd d93e 3e2c  ... .........>>,
0014db0: 20c4 ccd1 20cb cfd4 cfd2 d9c8 20d3 d0d2   ... ....... ...
0014dc0: c1d7 c5c4 ccc9 d7cf 7e24 7c66 5f78 2872  ........~$|f_x(r
0014dd0: 297c 205c 6c65 7120 325e 7024 2061 6e64  )| \leq 2^p$ and
0014de0: 2024 7c66 5f79 2873 297c 205c 6c65 7120   $|f_y(s)| \leq 
0014df0: 325e 7124 2e0a e5d3 ccc9 20cb c1cb 7e24  2^q$...... ...~$
0014e00: 7024 2c20 d4c1 cb20 c97e 2471 2420 d2c1  p$, ... .~$q$ ..
0014e10: d7ce d920 ced5 ccc0 2c20 d4cf 20cc c5c7  ... ...., .. ...
0014e20: cbcf 20d5 c2c5 c4c9 d4d8 d3d1 2c20 ded4  .. ........., ..
0014e30: cf20 d2c5 dad5 ccd8 d4c1 d4cf cd0a d7d9  . ..............
0014e40: dec9 d3cc c5ce c9ca 20d4 c1cb d6c5 20c2  ........ ..... .
0014e50: d5c4 c5d4 7e24 3024 2e20 f720 d0d2 cfd4  ....~$0$. . ....
0014e60: c9d7 cecf cd20 d3cc d5de c1c5 20cf d4cd  ..... ...... ...
0014e70: c5d4 c9cd 2c20 ded4 cf20 ccc9 c2cf 7e24  ...., ... ....~$
0014e80: 7020 3e20 3024 2c0a ccc9 c2cf 7e24 7120  p > 0$,.....~$q 
0014e90: 3e20 3024 7e2d 2d2d 20dc d4cf d420 c6c1  > 0$~--- .... ..
0014ea0: cbd4 20ce c1cd 20d0 cfce c1c4 cfc2 c9d4  .. ... .........
0014eb0: d3d1 20d7 20c4 c1cc d8ce c5ca dbc5 cd2e  .. . ...........
0014ec0: 0a25 4765 6e65 7261 6c20 6d75 6c74 6970  .%General multip
0014ed0: 6c69 6361 7469 6f6e 2069 7320 6861 7264  lication is hard
0014ee0: 6572 2062 6563 6175 7365 2074 6865 2065  er because the e
0014ef0: 7272 6f72 2069 6e20 6170 7072 6f78 696d  rror in approxim
0014f00: 6174 696f 6e20 666f 7220 6f6e 650a 256e  ation for one.%n
0014f10: 756d 6265 7220 6973 206d 756c 7469 706c  umber is multipl
0014f20: 6965 6420 6279 2074 6865 206d 6167 6e69  ied by the magni
0014f30: 7475 6465 206f 6620 7468 6520 7365 636f  tude of the seco
0014f40: 6e64 206e 756d 6265 722e 2054 6865 7265  nd number. There
0014f50: 666f 7265 2c20 6265 666f 7265 0a25 7468  fore, before.%th
0014f60: 6520 6669 6e61 6c20 6163 6375 7261 6369  e final accuraci
0014f70: 6573 2061 7265 2063 616c 6375 6c61 7465  es are calculate
0014f80: 642c 2061 2070 7265 6c69 6d69 6e61 7279  d, a preliminary
0014f90: 2065 7661 6c75 6174 696f 6e20 6f66 2074   evaluation of t
0014fa0: 6865 2061 7267 756d 656e 7473 0a25 6973  he arguments.%is
0014fb0: 2072 6571 7569 7265 6420 746f 2064 6574   required to det
0014fc0: 6572 6d69 6e65 2074 6865 6972 2061 7070  ermine their app
0014fd0: 726f 7869 6d61 7465 206d 6167 6e69 7475  roximate magnitu
0014fe0: 6465 2e20 5765 2070 726f 6365 6564 2061  de. We proceed a
0014ff0: 7320 666f 6c6c 6f77 732e 0a25 5375 7070  s follows..%Supp
0015000: 6f73 6520 7468 6174 2077 6520 7761 6e74  ose that we want
0015010: 2074 6f20 6576 616c 7561 7465 2024 7820   to evaluate $x 
0015020: 2b20 7924 2074 6f20 7072 6563 6973 696f  + y$ to precisio
0015030: 6e20 246e 242e 2046 6972 7374 2077 6520  n $n$. First we 
0015040: 6368 6f6f 7365 2024 7224 0a25 616e 6420  choose $r$.%and 
0015050: 2473 2420 736f 2074 6861 7420 247c 7220  $s$ so that $|r 
0015060: 2d20 737c 205c 6c65 7120 3124 2061 6e64  - s| \leq 1$ and
0015070: 2024 7220 2b20 7320 3d20 6e20 2b20 3224   $r + s = n + 2$
0015080: 2e20 5468 6174 2069 732c 2062 6f74 6820  . That is, both 
0015090: 2472 2420 616e 6420 2473 240a 2561 7265  $r$ and $s$.%are
00150a0: 2073 6c69 6768 746c 7920 6d6f 7265 2074   slightly more t
00150b0: 6861 6e20 6861 6c66 2074 6865 2072 6571  han half the req
00150c0: 7569 7265 6420 7072 6563 6973 696f 6e2e  uired precision.
00150d0: 2057 6520 6e6f 7720 6576 616c 7561 7465   We now evaluate
00150e0: 2024 665f 7828 7229 240a 2561 6e64 2024   $f_x(r)$.%and $
00150f0: 665f 7928 7329 242c 2061 6e64 2073 656c  f_y(s)$, and sel
0015100: 6563 7420 6e61 7475 7261 6c20 6e75 6d62  ect natural numb
0015110: 6572 7320 2470 2420 616e 6420 2471 2420  ers $p$ and $q$ 
0015120: 7468 6174 2061 7265 2074 6865 2063 6f72  that are the cor
0015130: 7265 7370 6f6e 6469 6e67 0a25 6062 696e  responding.%`bin
0015140: 6172 7920 6c6f 6761 7269 7468 6d73 272c  ary logarithms',
0015150: 2069 2e65 2e20 247c 665f 7828 7229 7c20   i.e. $|f_x(r)| 
0015160: 5c6c 6571 2032 5e70 2420 616e 6420 247c  \leq 2^p$ and $|
0015170: 665f 7928 7329 7c20 5c6c 6571 2032 5e71  f_y(s)| \leq 2^q
0015180: 242e 2049 6620 626f 7468 0a25 2470 2420  $. If both.%$p$ 
0015190: 616e 6420 2471 2420 6172 6520 7a65 726f  and $q$ are zero
00151a0: 2c20 7468 656e 2069 7420 6973 2065 6173  , then it is eas
00151b0: 7920 746f 2073 6565 2074 6861 7420 7765  y to see that we
00151c0: 206d 6179 2072 6574 7572 6e20 6a75 7374   may return just
00151d0: 2024 3024 2e0a 254f 7468 6572 7769 7365   $0$..%Otherwise
00151e0: 2c20 7265 6d65 6d62 6572 2074 6861 7420  , remember that 
00151f0: 6569 7468 6572 2024 7020 3e20 3024 206f  either $p > 0$ o
0015200: 7220 2471 203e 2030 2420 6173 2077 6520  r $q > 0$ as we 
0015210: 7769 6c6c 206e 6565 6420 7468 6973 206c  will need this l
0015220: 6174 6572 2e0a 254e 6f77 2073 6574 3a0a  ater..%Now set:.
0015230: 0af0 d5d3 d4d8 0a25 0a5c 6265 6769 6e7b  .......%.\begin{
0015240: 6571 6e61 7272 6179 2a7d 0a6b 2026 3d20  eqnarray*}.k &= 
0015250: 266e 202b 2071 202d 2073 202b 2033 203d  &n + q - s + 3 =
0015260: 2020 7120 2b20 7220 2b20 3120 2020 2020    q + r + 1     
0015270: 2020 2020 2020 5c5c 0a6c 2026 3d20 266e        \\.l &= &n
0015280: 202b 2070 202d 2072 202b 2033 203d 2020   + p - r + 3 =  
0015290: 7020 2b20 7320 2b20 3120 2020 2020 2020  p + s + 1       
00152a0: 2020 2020 5c5c 0a6d 2026 3d20 2628 6b20      \\.m &= &(k 
00152b0: 2b20 6c29 202d 206e 203d 2020 7020 2b20  + l) - n =  p + 
00152c0: 7120 2b20 342e 0a5c 656e 647b 6571 6e61  q + 4..\end{eqna
00152d0: 7272 6179 2a7d 0a25 0af0 cfcb c1d6 c5cd  rray*}.%........
00152e0: 2c20 ded4 cf20 d0cf c7d2 c5db cecf d3d4  , ... ..........
00152f0: d820 d7d9 d2c1 d6c5 cec9 d17e 2466 5f7b  . .........~$f_{
0015300: 7820 797d 286e 2920 3d20 2866 5f78 286b  x y}(n) = (f_x(k
0015310: 2920 665f 7928 6c29 2920 5c6d 626f 787b  ) f_y(l)) \mbox{
0015320: 206e 6469 7620 7d20 325e 6d24 0ad5 c4cf   ndiv } 2^m$....
0015330: d7cc c5d4 d7cf d2d1 c5d4 20cb d2c9 d4c5  .......... .....
0015340: d2c9 c020 c1d0 d0d2 cfcb d3c9 cdc1 c3c9  ... ............
0015350: c92c 20d4 2e7e c52e 5c20 247c 665f 7b78  ., ..~..\ $|f_{x
0015360: 2079 7d28 6e29 202d 2032 5e6e 2028 7820   y}(n) - 2^n (x 
0015370: 7929 7c20 3c20 3124 2e0a e5d3 ccc9 20d7  y)| < 1$...... .
0015380: d7c5 d3d4 c920 cfc2 cfda cec1 dec5 cec9  ..... ..........
0015390: d10a 2557 6520 636c 6169 6d20 7468 6174  ..%We claim that
00153a0: 2024 665f 7b78 2079 7d28 6e29 203d 2028   $f_{x y}(n) = (
00153b0: 665f 7828 6b29 2066 5f79 286c 2929 205c  f_x(k) f_y(l)) \
00153c0: 6d62 6f78 7b20 6e64 6976 207d 2032 5e6d  mbox{ ndiv } 2^m
00153d0: 2420 6861 7320 7468 6520 7269 6768 740a  $ has the right.
00153e0: 2565 7272 6f72 2062 6568 6176 696f 7572  %error behaviour
00153f0: 2c20 692e 652e 2024 7c66 5f7b 7820 797d  , i.e. $|f_{x y}
0015400: 286e 2920 2d20 325e 6e20 2878 2079 297c  (n) - 2^n (x y)|
0015410: 203c 2031 242e 2049 6620 7765 2077 7269   < 1$. If we wri
0015420: 7465 3a0a 250a 5c62 6567 696e 7b65 716e  te:.%.\begin{eqn
0015430: 6172 7261 792a 7d0a 325e 6b20 7820 263d  array*}.2^k x &=
0015440: 2026 665f 7828 6b29 202b 205c 6465 6c74   &f_x(k) + \delt
0015450: 612c 2020 2020 2020 2020 5c5c 0a32 5e6c  a,        \\.2^l
0015460: 2079 2026 3d20 2666 5f79 286c 2920 2b20   y &= &f_y(l) + 
0015470: 5c65 7073 696c 6f6e 2c0a 5c65 6e64 7b65  \epsilon,.\end{e
0015480: 716e 6172 7261 792a 7d0a 250a c7c4 c57e  qnarray*}.%....~
0015490: 247c 5c64 656c 7461 7c20 3c20 3124 20c9  $|\delta| < 1$ .
00154a0: 7e24 7c5c 6570 7369 6c6f 6e7c 203c 2031  ~$|\epsilon| < 1
00154b0: 242c 20d4 cf20 cdd9 20d0 cfcc d5de c9cd  $, .. .. .......
00154c0: 3a0a 255c 6e6f 696e 6465 6e74 2077 6974  :.%\noindent wit
00154d0: 6820 247c 5c64 656c 7461 7c20 3c20 3124  h $|\delta| < 1$
00154e0: 2061 6e64 2024 7c5c 6570 7369 6c6f 6e7c   and $|\epsilon|
00154f0: 203c 2031 242c 2077 6520 6861 7665 3a0a   < 1$, we have:.
0015500: 250a 5c62 6567 696e 7b65 716e 6172 7261  %.\begin{eqnarra
0015510: 792a 7d0a 7c66 5f7b 7820 797d 286e 2920  y*}.|f_{x y}(n) 
0015520: 2d20 325e 6e20 2878 2079 297c 0a20 265c  - 2^n (x y)|. &\
0015530: 6c65 7120 267b 3120 5c6f 7665 7220 327d  leq &{1 \over 2}
0015540: 202b 207c 7b66 5f78 286b 2920 665f 7928   + |{f_x(k) f_y(
0015550: 6c29 205c 6f76 6572 2032 5e6d 7d20 2d20  l) \over 2^m} - 
0015560: 2032 5e6e 2028 7820 7929 7c20 2020 2020   2^n (x y)|     
0015570: 2020 2020 2020 2020 2020 205c 5c0a 2026             \\. &
0015580: 3d20 267b 3120 5c6f 7665 7220 327d 202b  = &{1 \over 2} +
0015590: 2032 5e7b 2d6d 7d20 7c66 5f78 286b 2920   2^{-m} |f_x(k) 
00155a0: 665f 7928 6c29 202d 2032 5e7b 6b2b 6c7d  f_y(l) - 2^{k+l}
00155b0: 2078 2079 7c20 2020 2020 2020 2020 2020   x y|           
00155c0: 2020 2020 2020 2020 2020 2020 5c5c 0a20              \\. 
00155d0: 263d 2026 7b31 205c 6f76 6572 2032 7d20  &= &{1 \over 2} 
00155e0: 2b20 325e 7b2d 6d7d 207c 665f 7828 6b29  + 2^{-m} |f_x(k)
00155f0: 2066 5f79 286c 2920 2d20 2866 5f78 286b   f_y(l) - (f_x(k
0015600: 2920 2b20 5c64 656c 7461 2920 2866 5f79  ) + \delta) (f_y
0015610: 286c 2920 2b20 5c65 7073 696c 6f6e 297c  (l) + \epsilon)|
0015620: 2020 205c 5c0a 2026 3d20 267b 3120 5c6f     \\. &= &{1 \o
0015630: 7665 7220 327d 202b 2032 5e7b 2d6d 7d20  ver 2} + 2^{-m} 
0015640: 7c5c 6465 6c74 6120 665f 7928 6c29 202b  |\delta f_y(l) +
0015650: 205c 6570 7369 6c6f 6e20 665f 7828 6b29   \epsilon f_x(k)
0015660: 202b 205c 6465 6c74 6120 5c65 7073 696c   + \delta \epsil
0015670: 6f6e 7c20 5c5c 0a20 265c 6c65 7120 267b  on| \\. &\leq &{
0015680: 3120 5c6f 7665 7220 327d 202b 2032 5e7b  1 \over 2} + 2^{
0015690: 2d6d 7d20 287c 5c64 656c 7461 2066 5f79  -m} (|\delta f_y
00156a0: 286c 297c 202b 207c 5c65 7073 696c 6f6e  (l)| + |\epsilon
00156b0: 2066 5f78 286b 297c 0a20 2020 2020 2020   f_x(k)|.       
00156c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00156d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
00156e0: 2020 2020 2020 2b20 7c5c 6465 6c74 6120        + |\delta 
00156f0: 5c65 7073 696c 6f6e 7c29 2020 2020 2020  \epsilon|)      
0015700: 2020 205c 5c0a 2026 5c6c 6571 2026 7b31     \\. &\leq &{1
0015710: 205c 6f76 6572 2032 7d20 2b20 325e 7b2d   \over 2} + 2^{-
0015720: 6d7d 2028 7c66 5f79 286c 297c 202b 207c  m} (|f_y(l)| + |
0015730: 665f 7828 6b29 7c20 202b 207c 5c64 656c  f_x(k)|  + |\del
0015740: 7461 205c 6570 7369 6c6f 6e7c 2920 2020  ta \epsilon|)   
0015750: 2020 205c 5c0a 2026 3c20 267b 3120 5c6f     \\. &< &{1 \o
0015760: 7665 7220 327d 202b 2032 5e7b 2d6d 7d20  ver 2} + 2^{-m} 
0015770: 287c 665f 7928 6c29 7c20 2b20 7c66 5f78  (|f_y(l)| + |f_x
0015780: 286b 297c 202b 2031 290a 5c65 6e64 7b65  (k)| + 1).\end{e
0015790: 716e 6172 7261 792a 7d0a 250a efd4 d3c0  qnarray*}.%.....
00157a0: c4c1 20c9 cdc5 c5cd 7e24 7c66 5f78 2872  .. .....~$|f_x(r
00157b0: 297c 205c 6c65 7120 325e 7024 2c20 d4c1  )| \leq 2^p$, ..
00157c0: cb20 ded4 cf7e 247c 325e 7220 787c 203c  . ...~$|2^r x| <
00157d0: 2032 5e70 202b 2031 242e 20f3 ccc5 c4cf   2^p + 1$. .....
00157e0: d7c1 d4c5 ccd8 cecf 2c0a 247c 325e 6b20  ........,.$|2^k 
00157f0: 787c 203c 2032 5e7b 712b 317d 2028 325e  x| < 2^{q+1} (2^
0015800: 7020 2b20 3129 242c 20cf d4cb d5c4 c17e  p + 1)$, ......~
0015810: 247c 665f 7828 6b29 7c20 3c20 325e 7b71  $|f_x(k)| < 2^{q
0015820: 2b31 7d20 2832 5e70 202b 2031 2920 2b20  +1} (2^p + 1) + 
0015830: 3124 2c0a d42e 7ec5 2e7e 247c 665f 7828  1$,...~..~$|f_x(
0015840: 6b29 7c20 5c6c 6571 2032 5e7b 712b 317d  k)| \leq 2^{q+1}
0015850: 2028 325e 7020 2b20 3129 242e 20e1 cec1   (2^p + 1)$. ...
0015860: cccf c7c9 dece cf20 c4cf cbc1 dad9 d7c1  ....... ........
0015870: c5d4 d3d1 200a d3d0 d2c1 d7c5 c4cc c9d7  .... ...........
0015880: cfd3 d4d8 7e24 7c66 5f79 286c 297c 205c  ....~$|f_y(l)| \
0015890: 6c65 7120 325e 7b70 2b31 7d20 2832 5e71  leq 2^{p+1} (2^q
00158a0: 202b 2031 2924 2e20 f4c1 cbc9 cd20 cfc2   + 1)$. ..... ..
00158b0: d2c1 dacf cd2c 0a25 4e6f 7720 7765 2068  .....,.%Now we h
00158c0: 6176 6520 247c 665f 7828 7229 7c20 5c6c  ave $|f_x(r)| \l
00158d0: 6571 2032 5e70 242c 2073 6f20 247c 325e  eq 2^p$, so $|2^
00158e0: 7220 787c 203c 2032 5e70 202b 2031 242e  r x| < 2^p + 1$.
00158f0: 2054 6875 7320 247c 325e 6b20 787c 203c   Thus $|2^k x| <
0015900: 2032 5e7b 712b 317d 2028 0a25 325e 7020   2^{q+1} (.%2^p 
0015910: 2b20 3129 242c 2073 6f20 247c 665f 7828  + 1)$, so $|f_x(
0015920: 6b29 7c20 3c20 325e 7b71 2b31 7d20 2832  k)| < 2^{q+1} (2
0015930: 5e70 202b 2031 2920 2b20 3124 2c20 692e  ^p + 1) + 1$, i.
0015940: 652e 2024 7c66 5f78 286b 297c 205c 6c65  e. $|f_x(k)| \le
0015950: 7120 325e 7b71 2b31 7d20 2832 5e70 202b  q 2^{q+1} (2^p +
0015960: 0a25 3129 242e 2053 696d 696c 6172 6c79  .%1)$. Similarly
0015970: 2024 7c66 5f79 286c 297c 205c 6c65 7120   $|f_y(l)| \leq 
0015980: 325e 7b70 2b31 7d20 2832 5e71 202b 2031  2^{p+1} (2^q + 1
0015990: 2924 2e20 436f 6e73 6571 7565 6e74 6c79  )$. Consequently
00159a0: 3a0a 250a 5c62 6567 696e 7b65 716e 6172  :.%.\begin{eqnar
00159b0: 7261 792a 7d0a 7c66 5f79 286c 297c 202b  ray*}.|f_y(l)| +
00159c0: 207c 665f 7828 6b29 7c20 2b20 310a 265c   |f_x(k)| + 1.&\
00159d0: 6c65 7120 2632 5e7b 702b 317d 2028 325e  leq &2^{p+1} (2^
00159e0: 7120 2b20 3129 202b 2032 5e7b 712b 317d  q + 1) + 2^{q+1}
00159f0: 2028 325e 7020 2b20 3129 202b 2031 2020   (2^p + 1) + 1  
0015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
0015a10: 2020 2020 5c5c 0a26 3d20 2632 5e7b 702b      \\.&= &2^{p+
0015a20: 712b 317d 202b 2032 5e7b 702b 317d 202b  q+1} + 2^{p+1} +
0015a30: 2032 5e7b 702b 712b 317d 202b 2032 5e7b   2^{p+q+1} + 2^{
0015a40: 712b 317d 202b 2031 2020 2020 2020 2020  q+1} + 1        
0015a50: 2020 2020 2020 2020 2020 2020 205c 5c0a               \\.
0015a60: 263d 2026 325e 7b70 2b71 2b32 7d20 2b20  &= &2^{p+q+2} + 
0015a70: 325e 7b70 2b31 7d20 2b20 325e 7b71 2b31  2^{p+1} + 2^{q+1
0015a80: 7d20 2b20 312e 0a5c 656e 647b 6571 6e61  } + 1..\end{eqna
0015a90: 7272 6179 2a7d 0a0a e4cc d120 d0cf ccd5  rray*}..... ....
0015aa0: dec5 cec9 d120 d4d2 c5c2 d5c5 cdcf ca20  ..... ......... 
0015ab0: cdc1 cbd3 c9cd c1cc d8ce cfca 20d0 cfc7  ............ ...
0015ac0: d2c5 dbce cfd3 d4c9 20d7 d7c5 c4a3 cd20  ........ ...... 
0015ad0: 0acf c7d2 c1ce c9de c5ce c9c5 7e24 7c66  ............~$|f
0015ae0: 5f79 286c 297c 202b 207c 665f 7828 6b29  _y(l)| + |f_x(k)
0015af0: 7c20 2b20 3120 5c6c 6571 2032 5e7b 6d2d  | + 1 \leq 2^{m-
0015b00: 317d 242c 20cc c9c2 cf2c 20d2 c1da c4c5  1}$, ...., .....
0015b10: ccc9 d720 cec1 7e24 3224 0ac9 20d5 dec9  ... ..~$2$.. ...
0015b20: d4d9 d7c1 d120 c4c9 d3cb d2c5 d4ce cfd3  ..... ..........
0015b30: d4d8 20cd cecf d6c5 d3d4 d7c1 20c3 c5cc  .. ......... ...
0015b40: d9c8 20de c9d3 c5cc 2c0a 254e 6f77 2066  .. .....,.%Now f
0015b50: 6f72 206f 7572 2065 7272 6f72 2062 6f75  or our error bou
0015b60: 6e64 2077 6520 7265 7175 6972 6520 247c  nd we require $|
0015b70: 665f 7928 6c29 7c20 2b20 7c66 5f78 286b  f_y(l)| + |f_x(k
0015b80: 297c 202b 2031 205c 6c65 7120 325e 7b6d  )| + 1 \leq 2^{m
0015b90: 2d31 7d24 2c20 6f72 0a25 6469 7669 6469  -1}$, or.%dividi
0015ba0: 6e67 2062 7920 2432 2420 616e 6420 7573  ng by $2$ and us
0015bb0: 696e 6720 7468 6520 6469 7363 7265 7465  ing the discrete
0015bc0: 6e65 7373 206f 6620 7468 6520 696e 7465  ness of the inte
0015bd0: 6765 7273 3a0a 250a 2424 200a 2020 325e  gers:.%.$$ .  2^
0015be0: 7b70 2b71 2b31 7d20 2b20 325e 7b70 7d20  {p+q+1} + 2^{p} 
0015bf0: 2b20 325e 7b71 7d20 3c20 325e 7b70 202b  + 2^{q} < 2^{p +
0015c00: 2071 202b 2032 7d2e 200a 2424 0a25 0af7   q + 2}. .$$.%..
0015c10: 20d3 d7cf c020 cfde c5d2 c5c4 d82c 20c4   .... ......., .
0015c20: c1ce cecf c520 cfd4 cecf dbc5 cec9 c520  ..... ......... 
0015c30: cdcf d6c5 d420 c2d9 d4d8 20da c1d0 c9d3  ..... .... .....
0015c40: c1ce cf20 0acb c1cb 7e24 2832 5e7b 702b  ... ....~$(2^{p+
0015c50: 717d 202b 2032 5e70 2920 2b20 2832 5e7b  q} + 2^p) + (2^{
0015c60: 702b 717d 202b 2032 5e71 2920 3c20 325e  p+q} + 2^q) < 2^
0015c70: 7b70 202b 2071 202b 2031 7d20 2b20 325e  {p + q + 1} + 2^
0015c80: 7b70 202b 2071 202b 2031 7d24 2e0a e5c7  {p + q + 1}$....
0015c90: cf20 d3d0 d2c1 d7c5 c4cc c9d7 cfd3 d4d8  . ..............
0015ca0: 20d3 ccc5 c4d5 c5d4 20c9 da20 d5d0 cfcd   ....... .. ....
0015cb0: d1ce d5d4 cfc7 cf20 d2c1 cec5 c520 c6c1  ....... ..... ..
0015cc0: cbd4 c12c 20de d4cf 20cc c9c2 cf7e 2470  ..., ... ....~$p
0015cd0: 203e 2030 242c 0acc c9c2 cf7e 2471 203e   > 0$,.....~$q >
0015ce0: 2030 242e 20f4 c1cb c9cd 20cf c2d2 c1da   0$. ..... .....
0015cf0: cfcd 2c20 cdd9 20cf c2cf d3ce cfd7 c1cc  .., .. .........
0015d00: c920 d3cc c5c4 d5c0 ddc5 c520 cfd0 d2c5  . ......... ....
0015d10: c4c5 ccc5 cec9 c53a 0a25 5765 2063 616e  .......:.%We can
0015d20: 2077 7269 7465 2074 6869 7320 6173 2024   write this as $
0015d30: 2832 5e7b 702b 717d 202b 2032 5e70 2920  (2^{p+q} + 2^p) 
0015d40: 2b20 2832 5e7b 702b 717d 202b 2032 5e71  + (2^{p+q} + 2^q
0015d50: 2920 3c20 325e 7b70 202b 2071 202b 2031  ) < 2^{p + q + 1
0015d60: 7d20 2b0a 2532 5e7b 7020 2b20 7120 2b20  } +.%2^{p + q + 
0015d70: 317d 242c 2077 6869 6368 2069 7320 7472  1}$, which is tr
0015d80: 7565 2062 6563 6175 7365 2077 6520 6861  ue because we ha
0015d90: 7665 2065 6974 6865 7220 2470 203e 2030  ve either $p > 0
0015da0: 2420 6f72 2024 7120 3e20 3024 2e20 536f  $ or $q > 0$. So
0015db0: 2061 740a 256c 6173 7420 7765 2061 7265   at.%last we are
0015dc0: 206a 7573 7469 6669 6564 2069 6e20 6465   justified in de
0015dd0: 6669 6e69 6e67 3a0a 250a 5c62 6567 696e  fining:.%.\begin
0015de0: 7b62 6f78 6564 7d5c 6265 6769 6e7b 6c73  {boxed}\begin{ls
0015df0: 746c 6973 7469 6e67 7d0a 2020 6c65 7420  tlisting}.  let 
0015e00: 7265 616c 5f6d 756c 2078 2079 206e 203d  real_mul x y n =
0015e10: 0a20 2020 206c 6574 206e 3220 3d20 6e20  .    let n2 = n 
0015e20: 2b20 3220 696e 0a20 2020 206c 6574 2072  + 2 in.    let r
0015e30: 203d 206e 3220 2f20 3220 696e 0a20 2020   = n2 / 2 in.   
0015e40: 206c 6574 2073 203d 206e 3220 2d20 7220   let s = n2 - r 
0015e50: 696e 0a20 2020 206c 6574 2078 7220 3d20  in.    let xr = 
0015e60: 7828 7229 0a20 2020 2061 6e64 2079 7320  x(r).    and ys 
0015e70: 3d20 7928 7329 2069 6e0a 2020 2020 6c65  = y(s) in.    le
0015e80: 7420 7020 3d20 6c6f 6732 2078 720a 2020  t p = log2 xr.  
0015e90: 2020 616e 6420 7120 3d20 6c6f 6732 2079    and q = log2 y
0015ea0: 7320 696e 0a20 2020 2069 6620 7020 3d20  s in.    if p = 
0015eb0: 3020 2620 7120 3d20 3020 7468 656e 2049  0 & q = 0 then I
0015ec0: 6e74 2030 2065 6c73 650a 2020 2020 6c65  nt 0 else.    le
0015ed0: 7420 6b20 3d20 7120 2b20 7220 2b20 310a  t k = q + r + 1.
0015ee0: 2020 2020 616e 6420 6c20 3d20 7020 2b20      and l = p + 
0015ef0: 7320 2b20 310a 2020 2020 616e 6420 6d20  s + 1.    and m 
0015f00: 3d20 7020 2b20 7120 2b20 3420 696e 0a20  = p + q + 4 in. 
0015f10: 2020 2028 7828 6b29 202a 2f20 7928 6c29     (x(k) */ y(l)
0015f20: 2920 6e64 6976 2028 496e 7420 3220 2a2a  ) ndiv (Int 2 **
0015f30: 2f20 496e 7420 6d29 3b3b 0a5c 656e 647b  / Int m);;.\end{
0015f40: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
0015f50: 626f 7865 647d 0a0a 5c73 7562 7365 6374  boxed}..\subsect
0015f60: 696f 6e7b efc2 d2c1 d4ce d9c5 20de c9d3  ion{........ ...
0015f70: ccc1 7d0a 255c 7375 6273 6563 7469 6f6e  ..}.%\subsection
0015f80: 7b4d 756c 7469 706c 6963 6174 6976 6520  {Multiplicative 
0015f90: 696e 7665 7273 657d 0a0a eec1 dbc9 cd20  inverse}....... 
0015fa0: d3cc c5c4 d5c0 ddc9 cd20 dbc1 c7cf cd20  ......... ..... 
0015fb0: c2d5 c4c5 d420 d2c5 c1cc c9da c1c3 c9d1  ..... ..........
0015fc0: 20d7 d9de c9d3 ccc5 cec9 d120 cfc2 d2c1   .......... ....
0015fd0: d4ce d9c8 20de c9d3 c5cc 2e20 fed4 cfc2  .... ...... ....
0015fe0: d920 0ad0 cfcc d5de c9d4 d820 ccc0 c2d5  . ......... ....
0015ff0: c020 d7c5 d2c8 cec0 c020 cfc3 c5ce cbd5  . ....... ......
0016000: 20cf c2d2 c1d4 cecf c7cf 20de c9d3 ccc1   ......... .....
0016010: 2c20 cec5 20c7 cfd7 cfd2 d120 d5d6 20cf  , .. ...... .. .
0016020: 20c8 cfd2 cfdb c5cd 20c5 c7cf 200a d0d2   ....... ... ...
0016030: c9c2 ccc9 d6c5 cec9 c92c 20d0 cfd4 d2c5  ........., .....
0016040: c2d5 c5d4 d3d1 20cf c3c5 cec9 d4d8 20c1  ...... ....... .
0016050: d2c7 d5cd c5ce d420 7b5c 656d 20d3 cec9  ....... {\em ...
0016060: dad5 7d2e 20f7 20cf c2dd c5cd 20d3 ccd5  ..}. . ..... ...
0016070: dec1 c520 c4cc d120 0adc d4cf c7cf 20ce  ... ... ...... .
0016080: c520 d3d5 ddc5 d3d4 d7d5 c5d4 20cc d5de  . .......... ...
0016090: dbc5 c7cf 20d3 d0cf d3cf c2c1 2c20 dec5  .... ......., ..
00160a0: cd20 d7d9 dec9 d3cc c5ce c9c5 20c1 d2c7  . .......... ...
00160b0: d5cd c5ce d4c1 20d3 20d7 cfda d2c1 d3d4  ...... . .......
00160c0: c1c0 ddc5 ca0a d4cf dece cfd3 d4d8 c02c  ...............,
00160d0: 20d0 cfcb c120 7765 2063 616e 2062 6f75   .... we can bou
00160e0: 6e64 2069 7420 6177 6179 2066 726f 6d20  nd it away from 
00160f0: 7a65 726f 2e20 f3cc c5c4 d5c0 ddc1 d120  zero. ......... 
0016100: ccc5 cdcd c120 d3cc d5d6 c9d4 0acf c2cf  ..... ..........
0016110: d3ce cfd7 c1ce c9c5 cd20 dcd4 cfca 20d0  ......... .... .
0016120: d2cf c3c5 c4d5 d2d9 2e0a 0a25 4e65 7874  ...........%Next
0016130: 2077 6520 7769 6c6c 2064 6566 696e 6520   we will define 
0016140: 7468 6520 6d75 6c74 6970 6c69 6361 7469  the multiplicati
0016150: 7665 2069 6e76 6572 7365 2066 756e 6374  ve inverse funct
0016160: 696f 6e2e 2049 6e20 6f72 6465 7220 746f  ion. In order to
0016170: 2067 6574 2061 6e79 0a25 736f 7274 206f   get any.%sort o
0016180: 6620 7570 7065 7220 626f 756e 6420 6f6e  f upper bound on
0016190: 2074 6869 732c 206c 6574 2061 6c6f 6e65   this, let alone
00161a0: 2061 2067 6f6f 6420 6170 7072 6f78 696d   a good approxim
00161b0: 6174 696f 6e2c 2077 6520 6e65 6564 2074  ation, we need t
00161c0: 6f20 6765 7420 610a 257b 5c65 6d20 6c6f  o get a.%{\em lo
00161d0: 7765 727d 2062 6f75 6e64 2066 6f72 2074  wer} bound for t
00161e0: 6865 2061 7267 756d 656e 742e 2049 6e20  he argument. In 
00161f0: 6765 6e65 7261 6c2c 2074 6865 7265 2069  general, there i
0016200: 7320 6e6f 2062 6574 7465 7220 7761 7920  s no better way 
0016210: 7468 616e 2074 6f0a 256b 6565 7020 6576  than to.%keep ev
0016220: 616c 7561 7469 6e67 2074 6865 2061 7267  aluating the arg
0016230: 756d 656e 7420 7769 7468 2067 7265 6174  ument with great
0016240: 6572 2061 6e64 2067 7265 6174 6572 2061  er and greater a
0016250: 6363 7572 6163 7920 756e 7469 6c20 7765  ccuracy until we
0016260: 2063 616e 0a25 626f 756e 6420 6974 2061   can.%bound it a
0016270: 7761 7920 6672 6f6d 207a 6572 6f2e 2057  way from zero. W
0016280: 6520 7769 6c6c 2075 7365 2074 6865 2066  e will use the f
0016290: 6f6c 6c6f 7769 6e67 206c 656d 6d61 2074  ollowing lemma t
00162a0: 6f20 6a75 7374 6966 7920 7468 650a 2563  o justify the.%c
00162b0: 6f72 7265 6374 6e65 7373 206f 6620 6f75  orrectness of ou
00162c0: 7220 7072 6f63 6564 7572 653a 0a0a 5c62  r procedure:..\b
00162d0: 6567 696e 7b6c 656d 6d61 7d0a f0d5 d3d4  egin{lemma}.....
00162e0: d87e 2432 2065 205c 6765 7120 6e20 2b20  .~$2 e \geq n + 
00162f0: 6b20 2b20 3124 2c20 247c 665f 7828 6b29  k + 1$, $|f_x(k)
0016300: 7c20 5c67 6571 2032 5e65 2420 c97e 247c  | \geq 2^e$ .~$|
0016310: 665f 7828 6b29 202d 2032 5e6b 2078 7c20  f_x(k) - 2^k x| 
0016320: 3c20 3124 2c20 c7c4 c50a 2466 5f78 286b  < 1$, ....$f_x(k
0016330: 2924 7e2d 2d2d 20c3 c5cc cfc5 2c20 c120  )$~--- ....., . 
0016340: 2465 242c 2024 6e24 20c9 7e24 6b24 7e2d  $e$, $n$ .~$k$~-
0016350: 2d2d 20ce c1d4 d5d2 c1cc d8ce d9c5 20de  -- ........... .
0016360: c9d3 ccc1 2e20 e5d3 ccc9 20cd d920 cfd0  ..... .... .. ..
0016370: d2c5 c4c5 ccc9 cd0a 250a 2549 6620 2432  ........%.%If $2
0016380: 2065 205c 6765 7120 6e20 2b20 6b20 2b20   e \geq n + k + 
0016390: 3124 2c20 247c 665f 7828 6b29 7c20 5c67  1$, $|f_x(k)| \g
00163a0: 6571 2032 5e65 2420 616e 6420 247c 665f  eq 2^e$ and $|f_
00163b0: 7828 6b29 202d 2032 5e6b 2078 7c20 3c20  x(k) - 2^k x| < 
00163c0: 3124 2c20 7768 6572 650a 2524 665f 7828  1$, where.%$f_x(
00163d0: 6b29 2420 6973 2061 6e20 696e 7465 6765  k)$ is an intege
00163e0: 7220 616e 6420 2465 242c 2024 6e24 2061  r and $e$, $n$ a
00163f0: 6e64 2024 6b24 2061 7265 206e 6174 7572  nd $k$ are natur
0016400: 616c 206e 756d 6265 7273 2c20 7468 656e  al numbers, then
0016410: 2069 6620 7765 0a25 6465 6669 6e65 0a25   if we.%define.%
0016420: 0a24 2420 0a20 2066 5f79 286e 2920 3d20  .$$ .  f_y(n) = 
0016430: 325e 7b6e 2b6b 7d20 5c6d 626f 787b 206e  2^{n+k} \mbox{ n
0016440: 6469 7620 7d20 665f 7828 6b29 2c0a 2424  div } f_x(k),.$$
0016450: 0a25 0ad4 cf20 d0cf ccd5 dec9 cd7e 247c  .%... .......~$|
0016460: 665f 7928 6e29 202d 2032 5e6e 2078 5e7b  f_y(n) - 2^n x^{
0016470: 2d31 7d7c 203c 2031 242c 20d4 2e7e c52e  -1}| < 1$, ..~..
0016480: 5c20 d4d2 c5c2 d5c5 cdd5 c020 d7c5 d2c8  \ ......... ....
0016490: cec0 c020 cfc3 c5ce cbd5 0ad0 cfc7 d2c5  ... ............
00164a0: dbce cfd3 d4c9 2e0a 255c 6e6f 696e 6465  ........%\noinde
00164b0: 6e74 2077 6520 6861 7665 2024 7c66 5f79  nt we have $|f_y
00164c0: 286e 2920 2d20 325e 6e20 785e 7b2d 317d  (n) - 2^n x^{-1}
00164d0: 7c20 3c20 3124 2c20 692e 652e 2074 6865  | < 1$, i.e. the
00164e0: 2072 6571 7569 7265 6420 626f 756e 642e   required bound.
00164f0: 0a0a 5c70 726f 6f66 20e4 cfcb c1da c1d4  ..\proof .......
0016500: c5cc d8d3 d4d7 cf20 dcd4 cfca 20cc c5cd  ....... .... ...
0016510: cdd9 20c4 cfd3 d4c1 d4cf dece cf20 d5d4  .. .......... ..
0016520: cfcd c9d4 c5cc d8ce cf20 c920 c2d5 c4c5  ......... . ....
0016530: d420 d0d2 c9d7 c5c4 c5ce cf20 dac4 c5d3  . ......... ....
0016540: d80a cec5 20d0 cfcc cecf d3d4 d8c0 2c20  .... ........., 
0016550: c120 ccc9 dbd8 20d7 20d7 c9c4 c520 cfd3  . .... . .... ..
0016560: cecf d7ce d9c8 20d3 cfcf c2d2 c1d6 c5ce  ...... .........
0016570: c9ca 2e20 e5d3 ccc9 7e24 7c66 5f78 286b  ... ....~$|f_x(k
0016580: 297c 203e 2032 5e65 242c 20d4 cf20 0ad2  )| > 2^e$, .. ..
0016590: c5da d5cc d8d4 c1d4 20cf dec5 d7c9 c4ce  ........ .......
00165a0: cf20 d3cc c5c4 d5c5 d420 c9da 20d0 d2cf  . ....... .. ...
00165b0: d3d4 d9c8 20d2 c1d3 d3d5 d6c4 c5ce c9ca  .... ...........
00165c0: 2e20 efcb d2d5 c7cc c5ce c9c5 20d7 20d2  . .......... . .
00165d0: c5da d5cc d8d4 c1d4 c50a d7d9 d0cf ccce  ................
00165e0: c5ce c9d1 20cf d0c5 d2c1 c3c9 c97e 7b5c  .... ........~{\
00165f0: 7474 206e 6469 767d 20c4 c1a3 d420 d0cf  tt ndiv} .... ..
0016600: c7d2 c5db cecf d3d4 d82c 20ce c520 d0d2  ........., .. ..
0016610: c5d7 d9db c1c0 ddd5 c07e 2431 205c 6f76  .........~$1 \ov
0016620: 6572 2032 242c 0ac9 d4cf c7cf d7c1 d120  er 2$,......... 
0016630: d0cf c7d2 c5db cecf d3d4 d820 cdc5 ced8  ........... ....
0016640: dbc5 7e24 3120 5c6f 7665 7220 3224 2e20  ..~$1 \over 2$. 
0016650: e5d3 ccc9 7e24 7c66 5f78 286b 297c 203d  ....~$|f_x(k)| =
0016660: 2032 5e65 242c 20ce cf20 d0d2 c920 0adc   2^e$, .. ... ..
0016670: d4cf cd7e 246e 202b 206b 205c 6765 7120  ...~$n + k \geq 
0016680: 6524 2c20 d4cf 20cd cfd6 cecf 20d0 d2c5  e$, .. ..... ...
0016690: cec5 c2d2 c5de d820 d4c5 cd2c 20de d4cf  ....... ..., ...
00166a0: 20d7 d4cf d2cf ca20 cbcf cdd0 cfce c5ce   ...... ........
00166b0: d420 d0cf c7d2 c5db cecf d3d4 c90a cdcf  . ..............
00166c0: d6c5 d420 c2d9 d4d8 20d7 c4d7 cfc5 20c2  ... .... ..... .
00166d0: cfcc d8db c9cd 2c20 d42e 7ec5 2e5c 20cd  ......, ..~..\ .
00166e0: c5ce d8db c9cd 7e24 3124 7e2d 2d2d 20d7  ......~$1$~--- .
00166f0: 20dc d4cf cd20 d3cc d5de c1c5 20cf dbc9   .... ...... ...
0016700: c2cb c120 cfcb d2d5 c7cc c5ce c9d1 0ac2  ... ............
0016710: d5c4 c5d4 20cf d4d3 d5d4 d3d4 d7cf d7c1  .... ...........
0016720: d4d8 20d0 cfd4 cfcd d52c 20de d4cf 7e24  .. ......, ...~$
0016730: 665f 7828 6b29 203d 205c 706d 2032 5e65  f_x(k) = \pm 2^e
0016740: 2420 c4c5 ccc9 d4d3 d120 cec1 7e24 325e  $ ....... ..~$2^
0016750: 7b6e 2b6b 7d24 20ce c1c3 c5cc cf2e 0a28  {n+k}$ ........(
0016760: f7cf d3d0 cfcc d8da d5c5 cdd3 d120 c6c1  ............. ..
0016770: cbd4 cfcd 2c20 ded4 cf7e 2432 5e65 202d  ...., ...~$2^e -
0016780: 2031 205c 6c65 7120 325e 7b65 2d31 7d24   1 \leq 2^{e-1}$
0016790: 2c20 d0cf d3cb cfcc d8cb d520 0ad0 d2c9  , ......... ....
00167a0: 7e24 3220 6520 5c67 6571 206e 202b 206b  ~$2 e \geq n + k
00167b0: 202b 2031 2420 dace c1de c5ce c9c5 7e24   + 1$ ........~$
00167c0: 6524 20ce c520 cdcf d6c5 d420 d2c1 d7ce  e$ .. ..... ....
00167d0: d1d4 d8d3 d120 ced5 ccc0 2e29 20ee c1cb  ..... .....) ...
00167e0: cfce c5c3 2c0a d0d2 c97e 247c 665f 7828  ....,....~$|f_x(
00167f0: 6b29 7c20 3d20 325e 6524 20c9 7e24 6e20  k)| = 2^e$ .~$n 
0016800: 2b20 6b20 3c20 6524 2c20 cdd9 20c9 cdc5  + k < e$, .. ...
0016810: c5cd 7e24 7c66 5f79 286e 2920 2d20 325e  ..~$|f_y(n) - 2^
0016820: 6e20 7b31 205c 6f76 6572 2078 7d7c 203c  n {1 \over x}| <
0016830: 2031 242c 0ad0 cfd3 cbcf ccd8 cbd5 7e24   1$,..........~$
0016840: 7c66 5f79 286e 297c 205c 6c65 7120 3124  |f_y(n)| \leq 1$
0016850: 20c9 7e24 3020 3c20 7c32 5e6e 207b 3120   .~$0 < |2^n {1 
0016860: 5c6f 7665 7220 787d 7c20 3c20 3124 2c20  \over x}| < 1$, 
0016870: c120 dace c1cb c920 dcd4 c9c8 0ad7 c5cc  . ..... ........
0016880: c9de c9ce 20d3 cfd7 d0c1 c4c1 c0d4 2e20  .... .......... 
0016890: 5c71 6564 0a25 5c70 726f 6f66 2054 6865  \qed.%\proof The
00168a0: 2070 726f 6f66 2069 7320 7261 7468 6572   proof is rather
00168b0: 2074 6564 696f 7573 2061 6e64 2077 696c   tedious and wil
00168c0: 6c20 6e6f 7420 6265 2067 6976 656e 2069  l not be given i
00168d0: 6e20 6675 6c6c 2e20 5765 206a 7573 740a  n full. We just.
00168e0: 2573 6b65 7463 6820 7468 6520 6e65 6365  %sketch the nece
00168f0: 7373 6172 7920 6361 7365 2073 706c 6974  ssary case split
0016900: 732e 2049 6620 247c 665f 7828 6b29 7c20  s. If $|f_x(k)| 
0016910: 3e20 325e 6524 2074 6865 6e20 6120 7374  > 2^e$ then a st
0016920: 7261 6967 6874 666f 7277 6172 640a 2561  raightforward.%a
0016930: 6e61 6c79 7369 7320 6769 7665 7320 7468  nalysis gives th
0016940: 6520 7265 7375 6c74 3b20 7468 6520 726f  e result; the ro
0016950: 756e 6469 6e67 2069 6e20 7b5c 7474 206e  unding in {\tt n
0016960: 6469 767d 2067 6976 6573 2061 6e20 6572  div} gives an er
0016970: 726f 7220 6f66 2061 7420 6d6f 7374 0a25  ror of at most.%
0016980: 2431 205c 6f76 6572 2032 242c 2061 6e64  $1 \over 2$, and
0016990: 2074 6865 2072 656d 6169 6e69 6e67 2065   the remaining e
00169a0: 7272 6f72 2069 7320 243c 207b 3120 5c6f  rror is $< {1 \o
00169b0: 7665 7220 327d 242e 2049 6620 247c 665f  ver 2}$. If $|f_
00169c0: 7828 6b29 7c20 3d20 325e 6524 2062 7574  x(k)| = 2^e$ but
00169d0: 0a25 246e 202b 206b 205c 6765 7120 6524  .%$n + k \geq e$
00169e0: 2c20 7468 656e 2061 6c74 686f 7567 6820  , then although 
00169f0: 7468 6520 7365 636f 6e64 2063 6f6d 706f  the second compo
0016a00: 6e65 6e74 206f 6620 7468 6520 6572 726f  nent of the erro
0016a10: 7220 6d61 7920 6e6f 7720 6265 0a25 7477  r may now be.%tw
0016a20: 6963 6520 6173 206d 7563 682c 2069 2e65  ice as much, i.e
0016a30: 2e20 243c 2031 242c 2074 6865 7265 2069  . $< 1$, there i
0016a40: 7320 6e6f 2072 6f75 6e64 696e 6720 6572  s no rounding er
0016a50: 726f 7220 6265 6361 7573 6520 2466 5f78  ror because $f_x
0016a60: 286b 2920 3d20 5c70 6d20 325e 6524 0a25  (k) = \pm 2^e$.%
0016a70: 6469 7669 6465 7320 696e 746f 2024 325e  divides into $2^
0016a80: 7b6e 2b6b 7d24 2065 7861 6374 6c79 2e20  {n+k}$ exactly. 
0016a90: 2857 6520 7573 6520 6865 7265 2074 6865  (We use here the
0016aa0: 2066 6163 7420 7468 6174 2024 325e 6520   fact that $2^e 
0016ab0: 2d20 3120 5c6c 6571 0a25 325e 7b65 2d31  - 1 \leq.%2^{e-1
0016ac0: 7d24 2c20 6265 6361 7573 6520 7369 6e63  }$, because sinc
0016ad0: 6520 2432 2065 205c 6765 7120 6e20 2b20  e $2 e \geq n + 
0016ae0: 6b20 2b20 3124 2c20 2465 2420 6361 6e6e  k + 1$, $e$ cann
0016af0: 6f74 2062 6520 7a65 726f 2e29 2046 696e  ot be zero.) Fin
0016b00: 616c 6c79 2c20 6966 0a25 247c 665f 7828  ally, if.%$|f_x(
0016b10: 6b29 7c20 3d20 325e 6524 2061 6e64 2024  k)| = 2^e$ and $
0016b20: 6e20 2b20 6b20 3c20 6524 2c20 7765 2068  n + k < e$, we h
0016b30: 6176 6520 247c 665f 7928 6e29 202d 2032  ave $|f_y(n) - 2
0016b40: 5e6e 207b 3120 5c6f 7665 7220 787d 7c20  ^n {1 \over x}| 
0016b50: 3c20 3124 2062 6563 6175 7365 0a25 626f  < 1$ because.%bo
0016b60: 7468 2024 7c66 5f79 286e 297c 205c 6c65  th $|f_y(n)| \le
0016b70: 7120 3124 2061 6e64 2024 3020 3c20 7c32  q 1$ and $0 < |2
0016b80: 5e6e 207b 3120 5c6f 7665 7220 787d 7c20  ^n {1 \over x}| 
0016b90: 3c20 3124 2c20 616e 6420 626f 7468 2074  < 1$, and both t
0016ba0: 6865 7365 206e 756d 6265 7273 0a25 6861  hese numbers.%ha
0016bb0: 7665 2074 6865 2073 616d 6520 7369 676e  ve the same sign
0016bc0: 2e20 5c71 6564 0a0a 5c65 6e64 7b6c 656d  . \qed..\end{lem
0016bd0: 6d61 7d0a 0af0 d2c5 c4d0 cfcc cfd6 c9cd  ma}.............
0016be0: 2c20 ded4 cf20 cec1 cd20 d4d2 c5c2 d5c5  , ... ... ......
0016bf0: d4d3 d120 cec1 cad4 c920 dec9 d3cc cf2c  ... ..... .....,
0016c00: 20cf c2d2 c1d4 cecf c57e 2478 242c 20d3   ........~$x$, .
0016c10: 20d4 cfde cecf d3d4 d8c0 7e24 6e24 2e0a   .........~$n$..
0016c20: f0d2 c5d6 c4c5 20d7 d3c5 c7cf 2c20 d7d9  ...... ....., ..
0016c30: dec9 d3cc c9cd 7e24 665f 7828 3029 242e  ......~$f_x(0)$.
0016c40: 20ee c1cd 20d0 cfd4 d2c5 c2d5 c5d4 d3d1   ... ...........
0016c50: 20d2 c1d3 d3cd cfd4 d2c5 d4d8 20c4 d7c1   ........... ...
0016c60: 20d3 ccd5 dec1 d13a 0a25 4e6f 7720 7375   ......:.%Now su
0016c70: 7070 6f73 6520 7765 2077 6973 6820 746f  ppose we wish to
0016c80: 2066 696e 6420 7468 6520 696e 7665 7273   find the invers
0016c90: 6520 6f66 2024 7824 2074 6f20 6163 6375  e of $x$ to accu
0016ca0: 7261 6379 2024 6e24 2e20 4669 7273 7420  racy $n$. First 
0016cb0: 7765 0a25 6576 616c 7561 7465 2024 665f  we.%evaluate $f_
0016cc0: 7828 3029 242e 2054 6865 7265 2061 7265  x(0)$. There are
0016cd0: 2074 776f 2063 6173 6573 2074 6f20 6469   two cases to di
0016ce0: 7374 696e 6775 6973 683a 0a25 0a5c 6265  stinguish:.%.\be
0016cf0: 6769 6e7b 656e 756d 6572 6174 657d 0a0a  gin{enumerate}..
0016d00: 5c69 7465 6d20 e5d3 ccc9 7e24 7c66 5f78  \item ....~$|f_x
0016d10: 2830 297c 203e 2032 5e72 2420 c4cc d120  (0)| > 2^r$ ... 
0016d20: cec5 cbcf d4cf d2cf c7cf 20ce c1d4 d5d2  .......... .....
0016d30: c1cc d8ce cfc7 cf20 dec9 d3cc c17e 2472  ....... .....~$r
0016d40: 242c 20d4 cf20 d7d9 c2c5 d2c5 cd0a cec1  $, .. ..........
0016d50: c9cd c5ce d8db c5c5 20ce c1d4 d5d2 c1cc  ........ .......
0016d60: d8ce cfc5 20de c9d3 cccf 7e24 6b24 2028  .... .....~$k$ (
0016d70: cbcf d4cf d2cf c520 cdcf d6c5 d420 c2d9  ....... ..... ..
0016d80: d4d8 20c9 20d2 c1d7 ced9 cd20 ced5 ccc0  .. . ...... ....
0016d90: 2920 d4c1 cbcf c52c 0ade d4cf 7e24 3220  ) .....,....~$2 
0016da0: 7220 2b20 6b20 5c67 6571 206e 202b 2031  r + k \geq n + 1
0016db0: 242c 20c9 20d0 cfcc cfd6 c9cd 7e24 6520  $, . .......~$e 
0016dc0: 3d20 7220 2b20 6b24 2e20 f2c5 dad5 ccd8  = r + k$. ......
0016dd0: d4c1 d4cf cd20 d7d9 dec9 d3cc c5ce c9ca  ..... ..........
0016de0: 20d7 20dc d4cf cd0a d3cc d5de c1c5 20c2   . ........... .
0016df0: d5c4 c5d4 7e24 325e 7b6e 2b6b 7d20 5c6d  ....~$2^{n+k} \m
0016e00: 626f 787b 206e 6469 7620 7d20 665f 7828  box{ ndiv } f_x(
0016e10: 6b29 242e 20ec c5c7 cbcf 20d5 c2c5 c4c9  k)$. ..... .....
0016e20: d4d8 d3d1 2c20 ded4 cf20 d5d3 cccf d7c9  ...., ... ......
0016e30: d12c 0ad4 d2c5 c2d5 c5cd d9c5 20cc c5cd  .,.......... ...
0016e40: cdcf ca2c 20d7 d9d0 cfcc ced1 c0d4 d3d1  ..., ...........
0016e50: 2e20 f0cf d3cb cfcc d8cb d57e 247c 665f  . .........~$|f_
0016e60: 7828 3029 7c20 5c67 6571 2032 5e72 202b  x(0)| \geq 2^r +
0016e70: 2031 242c 20cd d920 0ac9 cdc5 c5cd 7e24   1$, .. ......~$
0016e80: 7c78 7c20 3e20 325e 7224 2c20 d4c1 cb20  |x| > 2^r$, ... 
0016e90: ded4 cf7e 247c 325e 6b20 787c 203e 2032  ...~$|2^k x| > 2
0016ea0: 5e7b 7220 2b20 6b7d 242e 20fc d4cf 20da  ^{r + k}$. ... .
0016eb0: cec1 dec9 d42c 200a ded4 cf7e 247c 665f  ....., ....~$|f_
0016ec0: 7828 6b29 7c20 3e20 325e 7b72 2b6b 7d20  x(k)| > 2^{r+k} 
0016ed0: 2d20 3124 2c20 c120 cfd4 d3c0 c4c1 2028  - 1$, . ...... (
0016ee0: d5de c9d4 d9d7 c1d1 20c3 c5cc cfde c9d3  ........ .......
0016ef0: ccc5 cece cfd3 d4d8 7e24 665f 7828 6b29  ........~$f_x(k)
0016f00: 2429 200a d0cf ccd5 dec1 c5cd 20d4 d2c5  $) ......... ...
0016f10: c2d5 c5cd cfc5 20d3 cfcf d4ce cfdb c5ce  ...... .........
0016f20: c9c5 7e24 7c66 5f78 286b 297c 205c 6765  ..~$|f_x(k)| \ge
0016f30: 7120 325e 7b72 202b 206b 7d20 3d20 325e  q 2^{r + k} = 2^
0016f40: 6524 2e0a f5d3 cccf d7c9 c57e 2432 2065  e$.........~$2 e
0016f50: 205c 6765 7120 6e20 3d20 6b20 2b20 3124   \geq n = k + 1$
0016f60: 20cc c5c7 cbcf 20d0 d2cf d7c5 d2c9 d4d8   ..... .........
0016f70: 2e20 efd4 cdc5 d4c9 cd2c 20de d4cf 20c9  . ......., ... .
0016f80: da7e 2472 205c 6765 7120 6e24 200a cec5  .~$r \geq n$ ...
0016f90: d0cf d3d2 c5c4 d3d4 d7c5 cece cf20 d3cc  ............. ..
0016fa0: c5c4 d5c5 d420 cbcf d2d2 c5cb d4ce cfd3  ..... ..........
0016fb0: d4d8 20c1 d0d0 d2cf cbd3 c9cd c1c3 c9c9  .. .............
0016fc0: 7e24 665f 7928 6e29 203d 2030 242e 0a25  ~$f_y(n) = 0$..%
0016fd0: 5c69 7465 6d20 4966 2024 7c66 5f78 2830  \item If $|f_x(0
0016fe0: 297c 203e 2032 5e72 2420 666f 7220 736f  )| > 2^r$ for so
0016ff0: 6d65 206e 6174 7572 616c 206e 756d 6265  me natural numbe
0017000: 7220 2472 242c 2074 6865 6e20 6368 6f6f  r $r$, then choo
0017010: 7365 2074 6865 206c 6561 7374 0a25 6e61  se the least.%na
0017020: 7475 7261 6c20 6e75 6d62 6572 2024 6b24  tural number $k$
0017030: 2028 7768 6963 6820 6d61 7920 7765 6c6c   (which may well
0017040: 2062 6520 7a65 726f 2920 7375 6368 2074   be zero) such t
0017050: 6861 7420 2432 2072 202b 206b 205c 6765  hat $2 r + k \ge
0017060: 7120 6e20 2b20 3124 2c20 616e 640a 2573  q n + 1$, and.%s
0017070: 6574 2024 6520 3d20 7220 2b20 6b24 2e20  et $e = r + k$. 
0017080: 5765 206e 6f77 2072 6574 7572 6e20 2432  We now return $2
0017090: 5e7b 6e2b 6b7d 205c 6d62 6f78 7b20 6e64  ^{n+k} \mbox{ nd
00170a0: 6976 207d 2066 5f78 286b 2924 2e20 4974  iv } f_x(k)$. It
00170b0: 2069 7320 6561 7379 2074 6f0a 2573 6565   is easy to.%see
00170c0: 2074 6861 7420 7468 6520 636f 6e64 6974   that the condit
00170d0: 696f 6e73 206f 6620 7468 6520 6c65 6d6d  ions of the lemm
00170e0: 6120 6172 6520 7361 7469 7366 6965 642e  a are satisfied.
00170f0: 2053 696e 6365 2024 7c66 5f78 2830 297c   Since $|f_x(0)|
0017100: 205c 6765 7120 325e 7220 2b0a 2531 2420   \geq 2^r +.%1$ 
0017110: 7765 2068 6176 6520 247c 787c 203e 2032  we have $|x| > 2
0017120: 5e72 242c 2061 6e64 2073 6f20 247c 325e  ^r$, and so $|2^
0017130: 6b20 787c 203e 2032 5e7b 7220 2b20 6b7d  k x| > 2^{r + k}
0017140: 242e 2054 6869 7320 6d65 616e 7320 247c  $. This means $|
0017150: 665f 7828 6b29 7c20 3e0a 2532 5e7b 722b  f_x(k)| >.%2^{r+
0017160: 6b7d 202d 2031 242c 2061 6e64 2061 7320  k} - 1$, and as 
0017170: 2466 5f78 286b 2924 2069 7320 616e 2069  $f_x(k)$ is an i
0017180: 6e74 6567 6572 2c20 247c 665f 7828 6b29  nteger, $|f_x(k)
0017190: 7c20 5c67 6571 2032 5e7b 7220 2b20 6b7d  | \geq 2^{r + k}
00171a0: 203d 2032 5e65 2420 6173 0a25 7265 7175   = 2^e$ as.%requ
00171b0: 6972 6564 2e20 5468 6520 636f 6e64 6974  ired. The condit
00171c0: 696f 6e20 7468 6174 2024 3220 6520 5c67  ion that $2 e \g
00171d0: 6571 206e 203d 206b 202b 2031 2420 6973  eq n = k + 1$ is
00171e0: 2065 6173 7920 746f 2063 6865 636b 2e20   easy to check. 
00171f0: 4e6f 7465 2074 6861 740a 2569 6620 2472  Note that.%if $r
0017200: 205c 6765 7120 6e24 2077 6520 6361 6e20   \geq n$ we can 
0017210: 696d 6d65 6469 6174 656c 7920 6465 6475  immediately dedu
0017220: 6365 2074 6861 7420 2466 5f79 286e 2920  ce that $f_y(n) 
0017230: 3d20 3024 2069 7320 6120 7661 6c69 640a  = 0$ is a valid.
0017240: 2561 7070 726f 7869 6d61 7469 6f6e 2e0a  %approximation..
0017250: 0a5c 6974 656d 20f0 d2c9 7e24 7c66 5f78  .\item ...~$|f_x
0017260: 2830 297c 205c 6c65 7120 3124 20d7 cfd3  (0)| \leq 1$ ...
0017270: d0cf ccd8 dad5 c5cd d3d1 20c6 d5ce cbc3  .......... .....
0017280: c9c5 ca7e 607b 5c74 7420 6d73 647d 272c  ...~`{\tt msd}',
0017290: 20d7 cfda d7d2 c1dd c1c0 ddc5 ca0a cec1   ...............
00172a0: c9cd c5ce d8db c5c5 7e24 7024 2020 d4c1  ........~$p$  ..
00172b0: cbcf c52c 20de d4cf 7e24 7c66 5f78 2870  ..., ...~$|f_x(p
00172c0: 297c 203e 2031 242e 20ef d4cd c5d4 c9cd  )| > 1$. .......
00172d0: 2c20 ded4 cf20 d0d2 c97e 2478 203d 2030  , ... ...~$x = 0
00172e0: 2420 d0d2 cfc9 dacf cac4 a3d4 200a dac1  $ .......... ...
00172f0: c3c9 cbcc c9d7 c1ce c9c5 2e20 f0cf cccf  ........... ....
0017300: d6c9 d77e 2465 203d 206e 202b 2070 202b  ...~$e = n + p +
0017310: 2031 2420 c97e 246b 203d 2065 202b 2070   1$ .~$k = e + p
0017320: 242c 20cf d0d2 c5c4 c5cc c9cd 20d2 c5da  $, ......... ...
0017330: d5cc d8d4 c1d4 200a cfd0 c5d2 c1c3 c9c9  ...... .........
0017340: 20cb c1cb 7e24 325e 7b6e 2b6b 7d20 5c6d   ...~$2^{n+k} \m
0017350: 626f 787b 206e 6469 7620 7d20 665f 7828  box{ ndiv } f_x(
0017360: 6b29 242e 20f7 20dc d4cf cd20 d3cc d5de  k)$. . .... ....
0017370: c1c5 20d4 c1cb d6c5 20d3 d0d2 c1d7 c5c4  .. ..... .......
0017380: ccc9 d7d9 0ad5 d3cc cfd7 c9d1 2c20 d4d2  ............, ..
0017390: c5c2 d5c5 cdd9 c520 ccc5 cdcd cfca 2e20  ....... ....... 
00173a0: f4c1 cb20 cbc1 cb7e 247c 665f 7828 7029  ... ...~$|f_x(p)
00173b0: 7c20 5c67 6571 2032 242c 20cd d920 c9cd  | \geq 2$, .. ..
00173c0: c5c5 cd7e 247c 325e 7020 787c 203e 2031  ...~$|2^p x| > 1
00173d0: 242c 0ad4 2e7e c52e 7e24 7c78 7c20 3e20  $,...~..~$|x| > 
00173e0: 7b31 205c 6f76 6572 207b 325e 707d 7d24  {1 \over {2^p}}$
00173f0: 2e20 f3cc c5c4 cfd7 c1d4 c5cc d8ce cf7e  . .............~
0017400: 247c 325e 6b20 787c 203e 2032 5e7b 6b2d  $|2^k x| > 2^{k-
0017410: 707d 203d 2032 5e65 242c 200a cfd4 cbd5  p} = 2^e$, .....
0017420: c4c1 7e24 7c66 5f78 286b 297c 203e 2032  ..~$|f_x(k)| > 2
0017430: 5e65 202d 2031 242c 20d4 2e7e c52e 7e24  ^e - 1$, ..~..~$
0017440: 7c66 5f78 286b 297c 205c 6765 7120 325e  |f_x(k)| \geq 2^
0017450: 6524 2e0a 255c 6974 656d 2049 6620 247c  e$..%\item If $|
0017460: 665f 7828 3029 7c20 5c6c 6571 2031 242c  f_x(0)| \leq 1$,
0017470: 2074 6865 6e20 7765 2063 616c 6c20 7468   then we call th
0017480: 6520 6675 6e63 7469 6f6e 2060 7b5c 7474  e function `{\tt
0017490: 206d 7364 7d27 2074 6861 7420 7265 7475   msd}' that retu
00174a0: 726e 730a 2574 6865 206c 6561 7374 2024  rns.%the least $
00174b0: 7024 2073 7563 6820 7468 6174 2024 7c66  p$ such that $|f
00174c0: 5f78 2870 297c 203e 2031 242e 204e 6f74  _x(p)| > 1$. Not
00174d0: 6520 7468 6174 2074 6869 7320 6d61 7920  e that this may 
00174e0: 696e 2067 656e 6572 616c 2066 6169 6c20  in general fail 
00174f0: 746f 0a25 7465 726d 696e 6174 6520 6966  to.%terminate if
0017500: 2024 7820 3d20 3024 2e20 4e6f 7720 7765   $x = 0$. Now we
0017510: 2073 6574 2024 6520 3d20 6e20 2b20 7020   set $e = n + p 
0017520: 2b20 3124 2061 6e64 2024 6b20 3d20 6520  + 1$ and $k = e 
0017530: 2b20 7024 2c20 616e 6420 7265 7475 726e  + p$, and return
0017540: 0a25 2432 5e7b 6e2b 6b7d 205c 6d62 6f78  .%$2^{n+k} \mbox
0017550: 7b20 6e64 6976 207d 2066 5f78 286b 2924  { ndiv } f_x(k)$
0017560: 2e20 4f6e 6365 2061 6761 696e 2074 6865  . Once again the
0017570: 2063 6f6e 6469 7469 6f6e 7320 666f 7220   conditions for 
0017580: 7468 6520 6c65 6d6d 6120 6172 650a 2573  the lemma are.%s
0017590: 6174 6973 6669 6564 2e20 5369 6e63 6520  atisfied. Since 
00175a0: 247c 665f 7828 7029 7c20 5c67 6571 2032  $|f_x(p)| \geq 2
00175b0: 242c 2077 6520 6861 7665 2024 7c32 5e70  $, we have $|2^p
00175c0: 2078 7c20 3e20 3124 2c20 692e 652e 2024   x| > 1$, i.e. $
00175d0: 7c78 7c20 3e20 7b31 205c 6f76 6572 0a25  |x| > {1 \over.%
00175e0: 7b32 5e70 7d7d 242e 2048 656e 6365 2024  {2^p}}$. Hence $
00175f0: 7c32 5e6b 2078 7c20 3e20 325e 7b6b 2d70  |2^k x| > 2^{k-p
0017600: 7d20 3d20 325e 6524 2c20 616e 6420 736f  } = 2^e$, and so
0017610: 2024 7c66 5f78 286b 297c 203e 2032 5e65   $|f_x(k)| > 2^e
0017620: 202d 2031 242c 2069 2e65 2e0a 2524 7c66   - 1$, i.e..%$|f
0017630: 5f78 286b 297c 205c 6765 7120 325e 6524  _x(k)| \geq 2^e$
0017640: 2e0a 5c65 6e64 7b65 6e75 6d65 7261 7465  ..\end{enumerate
0017650: 7d0a 250a f2c5 c1cc c9da c1c3 c9c0 20ce  }.%........... .
0017660: c1de cea3 cd20 d320 c6d5 cecb c3c9 c97e  ..... . .......~
0017670: 7b5c 7474 206d 7364 7d3a 0a25 5c6e 6f69  {\tt msd}:.%\noi
0017680: 6e64 656e 7420 546f 2069 6d70 6c65 6d65  ndent To impleme
0017690: 6e74 2074 6869 732c 2077 6520 6669 7273  nt this, we firs
00176a0: 7420 6465 6669 6e65 2074 6865 207b 5c74  t define the {\t
00176b0: 7420 6d73 647d 2066 756e 6374 696f 6e3a  t msd} function:
00176c0: 0a25 0a5c 6265 6769 6e7b 626f 7865 647d  .%.\begin{boxed}
00176d0: 5c62 6567 696e 7b6c 7374 6c69 7374 696e  \begin{lstlistin
00176e0: 677d 0a20 206c 6574 206d 7364 203d 0a20  g}.  let msd =. 
00176f0: 2020 206c 6574 2072 6563 206d 7364 206e     let rec msd n
0017700: 2078 203d 0a20 2020 2020 2069 6620 6162   x =.      if ab
0017710: 735f 6e75 6d28 7828 6e29 2920 3e2f 2049  s_num(x(n)) >/ I
0017720: 6e74 2031 2074 6865 6e20 6e20 656c 7365  nt 1 then n else
0017730: 206d 7364 2028 6e20 2b20 3129 2078 2069   msd (n + 1) x i
0017740: 6e0a 2020 2020 6d73 6420 303b 3b0a 5c65  n.    msd 0;;.\e
0017750: 6e64 7b6c 7374 6c69 7374 696e 677d 5c65  nd{lstlisting}\e
0017760: 6e64 7b62 6f78 6564 7d0a 250a d0cf d3cc  nd{boxed}.%.....
0017770: c520 dec5 c7cf 20d7 cfd0 cccf d4c9 cd20  . .... ........ 
0017780: c9da cccf d6c5 cece d9c5 20d7 d9db c520  .......... .... 
0017790: d4c5 cfd2 c5d4 c9de c5d3 cbc9 c520 d2c1  ............. ..
00177a0: d3d3 d5d6 c4c5 cec9 d120 d720 d7c9 c4c5  ......... . ....
00177b0: 0ad0 d2cf d3d4 cfca 20d0 d2cf c7d2 c1cd  ........ .......
00177c0: cdd9 3a0a 255c 6e6f 696e 6465 6e74 2061  ..:.%\noindent a
00177d0: 6e64 2074 6865 6e20 7472 616e 736c 6174  nd then translat
00177e0: 6520 7468 6520 6162 6f76 6520 6d61 7468  e the above math
00177f0: 656d 6174 6963 7320 696e 746f 2061 2073  ematics into a s
0017800: 696d 706c 6520 7072 6f67 7261 6d3a 0a25  imple program:.%
0017810: 0a5c 6265 6769 6e7b 626f 7865 647d 5c62  .\begin{boxed}\b
0017820: 6567 696e 7b6c 7374 6c69 7374 696e 677d  egin{lstlisting}
0017830: 0a20 206c 6574 2072 6561 6c5f 696e 7620  .  let real_inv 
0017840: 7820 6e20 3d0a 2020 2020 6c65 7420 7830  x n =.    let x0
0017850: 203d 2078 2830 2920 696e 0a20 2020 206c   = x(0) in.    l
0017860: 6574 206b 203d 0a20 2020 2020 2069 6620  et k =.      if 
0017870: 7830 203e 2f20 496e 7420 3120 7468 656e  x0 >/ Int 1 then
0017880: 0a20 2020 2020 2020 206c 6574 2072 203d  .        let r =
0017890: 206c 6f67 3220 7830 202d 2031 2069 6e0a   log2 x0 - 1 in.
00178a0: 2020 2020 2020 2020 6c65 7420 6b30 203d          let k0 =
00178b0: 206e 202b 2031 202d 2032 202a 2072 2069   n + 1 - 2 * r i
00178c0: 6e0a 2020 2020 2020 2020 6966 206b 3020  n.        if k0 
00178d0: 3c20 3020 7468 656e 2030 2065 6c73 6520  < 0 then 0 else 
00178e0: 6b30 0a20 2020 2020 2065 6c73 650a 2020  k0.      else.  
00178f0: 2020 2020 2020 6c65 7420 7020 3d20 6d73        let p = ms
0017900: 6420 7820 696e 0a20 2020 2020 2020 206e  d x in.        n
0017910: 202b 2032 202a 2070 202b 2031 2069 6e0a   + 2 * p + 1 in.
0017920: 2020 2020 2849 6e74 2032 202a 2a2f 2049      (Int 2 **/ I
0017930: 6e74 2028 6e20 2b20 6b29 2920 6e64 6976  nt (n + k)) ndiv
0017940: 2028 7828 6b29 293b 3b0a 5c65 6e64 7b6c   (x(k));;.\end{l
0017950: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
0017960: 6f78 6564 7d0a 250a f720 c9d4 cfc7 c520  oxed}.%.. ..... 
0017970: cfd0 d2c5 c4c5 ccc5 cec9 c520 cfd0 c5d2  ........... ....
0017980: c1c3 c9c9 20c4 c5cc c5ce c9d1 20d3 d4c1  .... ....... ...
0017990: cecf d7c9 d4d3 d120 d4d2 c9d7 c9c1 ccd8  ....... ........
00179a0: ced9 cd3a 0a25 5c6e 6f69 6e64 656e 7420  ...:.%\noindent 
00179b0: 4e6f 772c 206f 6620 636f 7572 7365 2c20  Now, of course, 
00179c0: 6974 2069 7320 7374 7261 6967 6874 666f  it is straightfo
00179d0: 7277 6172 6420 746f 2064 6566 696e 6520  rward to define 
00179e0: 6469 7669 7369 6f6e 3a0a 250a 5c62 6567  division:.%.\beg
00179f0: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
0017a00: 6c73 746c 6973 7469 6e67 7d0a 2020 6c65  lstlisting}.  le
0017a10: 7420 7265 616c 5f64 6976 2078 2079 203d  t real_div x y =
0017a20: 2072 6561 6c5f 6d75 6c20 7820 2872 6561   real_mul x (rea
0017a30: 6c5f 696e 7620 7929 3b3b 0a5c 656e 647b  l_inv y);;.\end{
0017a40: 6c73 746c 6973 7469 6e67 7d5c 656e 647b  lstlisting}\end{
0017a50: 626f 7865 647d 0a0a 5c73 7562 7365 6374  boxed}..\subsect
0017a60: 696f 6e7b efd4 cecf dbc5 cec9 d120 d0cf  ion{......... ..
0017a70: d2d1 c4cb c17d 0a25 5c73 7562 7365 6374  .....}.%\subsect
0017a80: 696f 6e7b 4f72 6465 7269 6e67 2072 656c  ion{Ordering rel
0017a90: 6174 696f 6e73 7d0a f0d2 c9cd c5de c1d4  ations}.........
0017aa0: c5cc d8ce d9cd 20d3 d7cf cad3 d4d7 cfcd  ...... .........
0017ab0: 20cf d4ce cfdb c5ce c9ca 20d0 cfd2 d1c4   ......... .....
0017ac0: cbc1 20d1 d7cc d1c5 d4d3 d120 d4cf 2c20  .. ........ .., 
0017ad0: ded4 cf20 c9c8 20d7 d9de c9d3 ccc5 cec9  ... .. .........
0017ae0: c520 0ad7 20cf c2dd c5cd 20d3 ccd5 dec1  . .. ..... .....
0017af0: c520 c1cc c7cf d2c9 d4cd c9de c5d3 cbc9  . ..............
0017b00: 20ce c5d2 c1da d2c5 dbc9 cdcf 2e20 f720   ............ . 
0017b10: cfd3 cecf d7c5 20d4 c1cb cfc7 cf20 d7d9  ...... ...... ..
0017b20: d7cf c4c1 20cc c5d6 c9d4 200a cec5 d7cf  .... ..... .....
0017b30: dacd cfd6 cecf d3d4 d820 d5d3 d4c1 cecf  ......... ......
0017b40: d7c9 d4d8 20d7 20cf c2dd c5cd 20d3 ccd5  .... . ..... ...
0017b50: dec1 c520 d2c1 d7c5 ced3 d4d7 cf20 c4c1  ... ......... ..
0017b60: cece cfc7 cf20 dec9 d3cc c120 ced5 ccc0  ..... ..... ....
0017b70: 2e20 e5d3 ccc9 0ad0 cfd3 ccc5 c4cf d7c1  . ..............
0017b80: d4c5 ccd8 cecf c520 d7d9 dec9 d3cc c5ce  ....... ........
0017b90: c9c5 20d3 20d5 d7c5 ccc9 dec5 cec9 c5cd  .. . ...........
0017ba0: 20d4 d2c5 c2d5 c5cd cfca 20d4 cfde cecf   ......... .....
0017bb0: d3d4 c920 d0d2 cfc4 cfcc d6c1 c5d4 200a  ... .......... .
0017bc0: d7d9 c4c1 d7c1 d4d8 7e24 3024 2c20 dcd4  ........~$0$, ..
0017bd0: cf20 c5dd a320 cec5 20d3 ccd5 d6c9 d420  . ... .. ...... 
0017be0: c7c1 d2c1 ced4 c9c5 ca20 d4cf c7cf 2c20  ......... ...., 
0017bf0: ded4 cf20 d720 c4c1 ccd8 cec5 cadb c5cd  ... . ..........
0017c00: 20cd d920 cec5 20d0 cfcc d5de c9cd 0ace   .. .. .........
0017c10: c5ce d5cc c5d7 cfca 20d2 c5da d5cc d8d4  ........ .......
0017c20: c1d4 2e25 0a5c 666f 6f74 6e6f 7465 7be4  ...%.\footnote{.
0017c30: cfcb c1da c1d4 c5cc d8d3 d4d7 cf20 c1cc  ............. ..
0017c40: c7cf d2c9 d4cd c9de c5d3 cbcf ca20 cec5  ............. ..
0017c50: d2c1 dad2 c5db c9cd cfd3 d4c9 20dc d4cf  ............ ...
0017c60: ca20 dac1 c4c1 dec9 20d3 d7cf c4c9 d4d3  . ...... .......
0017c70: d10a cb20 d0d2 cfc2 ccc5 cdc5 20da c1d7  ... ........ ...
0017c80: c5d2 dbc9 cdcf d3d4 c93a 20d0 d5d3 d4d8  .........: .....
0017c90: 7e24 6628 6e29 203d 2031 242c 20c5 d3cc  ~$f(n) = 1$, ...
0017ca0: c920 cec5 cbcf d4cf d2c1 d120 cdc1 dbc9  . ......... ....
0017cb0: cec1 20f4 d8c0 d2c9 cec7 c10a dac1 d7c5  .. .............
0017cc0: d2db c1c5 d420 d2c1 c2cf d4d5 20ce c520  ..... ...... .. 
0017cd0: c2cf ccc5 c520 dec5 cd20 dac1 2024 6e24  ..... ... .. $n$
0017ce0: 7ec9 d4c5 d2c1 c3c9 ca2c 20c9 2024 6628  ~........, . $f(
0017cf0: 6e29 203d 2030 2420 d720 d0d2 cfd4 c9d7  n) = 0$ . ......
0017d00: cecf cd20 d3cc d5de c1c5 2e7d 200a e5d3  ... .......} ...
0017d10: ccc9 20da cec1 dec5 cec9 c57e 2478 2420  .. ........~$x$ 
0017d20: cec5 20d2 c1d7 cecf 20ce d5cc c02c 20d0  .. ..... ...., .
0017d30: cfc9 d3cb 20d0 c5d2 d7cf c7cf 20ce c5ce  .... ....... ...
0017d40: d5cc c5d7 cfc7 cf20 d2c1 dad2 d1c4 c120  ....... ....... 
0017d50: dec9 d3cc c120 0acb cfc7 c4c1 2dcc c9c2  ..... ......-...
0017d60: cf20 dac1 d7c5 d2db c9d4 d3d1 2c20 cecf  . .........., ..
0017d70: 20d7 20d3 ccd5 dec1 c57e 2478 3d30 2420   . ......~$x=0$ 
0017d80: cfce 20c2 d5c4 c5d4 20c4 ccc9 d4d8 d3d1  .. ..... .......
0017d90: 20d7 c5de cecf 2e0a 2554 6865 2069 6e74   .......%The int
0017da0: 6572 6573 7469 6e67 2074 6869 6e67 7320  eresting things 
0017db0: 6162 6f75 7420 616c 6c20 7468 6573 6520  about all these 
0017dc0: 6675 6e63 7469 6f6e 7320 6973 2074 6861  functions is tha
0017dd0: 7420 7468 6579 2061 7265 2069 6e20 6661  t they are in fa
0017de0: 6374 0a25 756e 636f 6d70 7574 6162 6c65  ct.%uncomputable
0017df0: 2069 6e20 6765 6e65 7261 6c2e 2054 6865   in general. The
0017e00: 2065 7373 656e 7469 616c 2070 6f69 6e74   essential point
0017e10: 2069 7320 7468 6174 2069 7420 6973 2069   is that it is i
0017e20: 6d70 6f73 7369 626c 6520 746f 2064 6563  mpossible to dec
0017e30: 6964 650a 2577 6865 7468 6572 2061 2067  ide.%whether a g
0017e40: 6976 656e 206e 756d 6265 7220 6973 207a  iven number is z
0017e50: 6572 6f2e 2057 6520 6361 6e20 6b65 6570  ero. We can keep
0017e60: 2061 7070 726f 7869 6d61 7469 6e67 2069   approximating i
0017e70: 7420 746f 2067 7265 6174 6572 2061 6e64  t to greater and
0017e80: 0a25 6772 6561 7465 7220 6163 6375 7261  .%greater accura
0017e90: 6379 2c20 6275 7420 6966 2074 6865 2061  cy, but if the a
0017ea0: 7070 726f 7869 6d61 7469 6f6e 7320 616c  pproximations al
0017eb0: 7761 7973 2072 6574 7572 6e20 2430 242c  ways return $0$,
0017ec0: 2077 6520 6361 6e6e 6f74 2074 656c 6c0a   we cannot tell.
0017ed0: 2577 6865 7468 6572 2069 7420 6973 2067  %whether it is g
0017ee0: 6f69 6e67 2074 6f20 646f 2073 6f20 696e  oing to do so in
0017ef0: 6465 6669 6e69 7465 6c79 206f 7220 7768  definitely or wh
0017f00: 6574 6865 7220 7468 6520 6e65 7874 2073  ether the next s
0017f10: 7465 7020 7769 6c6c 2067 6976 6520 610a  tep will give a.
0017f20: 256e 6f6e 7a65 726f 2061 6e73 7765 722e  %nonzero answer.
0017f30: 5c66 6f6f 746e 6f74 657b 466f 7220 6120  \footnote{For a 
0017f40: 7072 6f6f 6620 7468 6174 2069 7420 6973  proof that it is
0017f50: 2075 6e63 6f6d 7075 7461 626c 652c 2073   uncomputable, s
0017f60: 696d 706c 7920 7772 6170 2075 700a 2574  imply wrap up.%t
0017f70: 6865 2068 616c 7469 6e67 2070 726f 626c  he halting probl
0017f80: 656d 2c20 6279 2064 6566 696e 696e 6720  em, by defining 
0017f90: 2466 286e 2920 3d20 3124 2069 6620 6120  $f(n) = 1$ if a 
0017fa0: 6365 7274 6169 6e20 5475 7269 6e67 206d  certain Turing m
0017fb0: 6163 6869 6e65 2068 6173 0a25 6861 6c74  achine has.%halt
0017fc0: 6564 2061 6674 6572 206e 6f20 6d6f 7265  ed after no more
0017fd0: 2074 6861 6e20 246e 2420 6974 6572 6174   than $n$ iterat
0017fe0: 696f 6e73 2c20 616e 6420 2466 286e 2920  ions, and $f(n) 
0017ff0: 3d20 3024 206f 7468 6572 7769 7365 2e7d  = 0$ otherwise.}
0018000: 2049 6620 2478 2420 6973 0a25 6e6f 7420   If $x$ is.%not 
0018010: 7a65 726f 2c20 7468 656e 2074 6865 2073  zero, then the s
0018020: 6561 7263 6820 7769 6c6c 2065 7665 6e74  earch will event
0018030: 7561 6c6c 7920 7465 726d 696e 6174 652c  ually terminate,
0018040: 2062 7574 2069 6620 2478 2420 6973 207a   but if $x$ is z
0018050: 6572 6f2c 2069 740a 2577 696c 6c20 7275  ero, it.%will ru
0018060: 6e20 666f 7265 7665 722e 0a0a f0d2 c9ce  n forever.......
0018070: c9cd c1d1 20d7 cf20 d7ce c9cd c1ce c9c5  .... .. ........
0018080: 20d3 cbc1 dac1 cece cfc5 20d7 d9db c52c   ......... ....,
0018090: 20ce c5d3 cccf d6ce cf20 d2c5 c1cc c9da   ........ ......
00180a0: cfd7 c1d4 d820 cfd4 cecf dbc5 cec9 d120  ..... ......... 
00180b0: d0cf d2d1 c4cb c12e 0ae4 ccd1 20cf d0d2  ............ ...
00180c0: c5c4 c5cc c5ce c9d1 20d7 dac1 c9cd cecf  ........ .......
00180d0: c7cf 20d0 cfd2 d1c4 cbc1 20de c9d3 c5cc  .. ....... .....
00180e0: 7e24 7824 20c9 7e24 7924 20c4 cfd3 d4c1  ~$x$ .~$y$ .....
00180f0: d4cf dece cf20 cec1 cad4 c97e 246e 2420  ..... .....~$n$ 
0018100: d4c1 cbcf c52c 0ade d4cf 7e24 7c78 5f6e  .....,....~$|x_n
0018110: 202d 2079 5f6e 7c20 5c67 6571 2032 242e   - y_n| \geq 2$.
0018120: 20ee c1d0 d2c9 cdc5 d22c 20c4 ccd1 7e24   ........, ...~$
0018130: 785f 6e20 5c67 6571 2079 5f6e 202b 2032  x_n \geq y_n + 2
0018140: 2420 cdd9 20c9 cdc5 c5cd 0a24 2420 0a20  $ .. ......$$ . 
0018150: 2032 5e6e 2078 203e 2078 5f6e 202d 2031   2^n x > x_n - 1
0018160: 205c 6765 7120 795f 6e20 2b20 3120 3e20   \geq y_n + 1 > 
0018170: 325e 6e20 792e 0a24 240a cfd4 cbd5 c4c1  2^n y..$$.......
0018180: 20c4 c5cc c1c5 cd20 d7d9 d7cf c42c 20de   ...... ....., .
0018190: d4cf 7e24 7820 3e20 7924 2e20 f0d2 c5d6  ..~$x > y$. ....
00181a0: c4c5 20d7 d3c5 c7cf 2c20 d0d2 c9d7 c5c4  .. ....., ......
00181b0: c5cd 20cf c2dd d5c0 20d0 d2cf c3c5 c4d5  .. ..... .......
00181c0: d2d5 200a d7d9 dec9 d3cc c5ce c9d1 7e24  .. ...........~$
00181d0: 6e24 2c20 d0cf d3cc c520 dec5 c7cf 20d7  n$, ..... .... .
00181e0: d3c5 20cf d4ce cfdb c5ce c9d1 20d0 cfd2  .. ......... ...
00181f0: d1c4 cbc1 20cd cfc7 d5d4 20c2 d9d4 d820  .... ..... .... 
0018200: d7d9 d2c1 d6c5 ced9 20d3 20c5 a30a c9d3  ........ . .....
0018210: d0cf ccd8 dacf d7c1 cec9 c5cd 2e20 efd4  ............. ..
0018220: cdc5 d4c9 cd2c 20de d4cf 20c5 c4c9 ced3  ....., ... .....
0018230: d4d7 c5ce ced9 cd20 d3d0 cfd3 cfc2 cfcd  ....... ........
0018240: 20d2 c5c1 ccc9 dac1 c3c9 c920 d2c5 c6cc   .......... ....
0018250: c5cb d3c9 d7ce d9c8 200a cfd4 cecf dbc5  ........ .......
0018260: cec9 ca20 c2d5 c4c5 d420 d0cf cccf d6c9  ... ..... ......
0018270: d4d8 20c9 c820 d4cf d6c4 c5d3 d4d7 c5ce  .. .. ..........
0018280: ced9 cdc9 20d3 cfcf d4d7 c5d4 d3d4 d7d5  .... ...........
0018290: c0dd c9cd 20ce c5d2 c5c6 ccc5 cbd3 c9d7  .... ...........
00182a0: ced9 cd20 0acf d4ce cfdb c5ce c9d1 cd21  ... ...........!
00182b0: 0a25 4163 6365 7074 696e 6720 7468 6973  .%Accepting this
00182c0: 2c20 6974 2069 7320 6e6f 7420 6469 6666  , it is not diff
00182d0: 6963 756c 7420 746f 2064 6566 696e 6520  icult to define 
00182e0: 7468 6520 7265 6c61 7469 6f6e 616c 206f  the relational o
00182f0: 7065 7261 746f 7273 2e20 546f 0a25 6465  perators. To.%de
0018300: 6369 6465 2074 6865 206f 7264 6572 696e  cide the orderin
0018310: 6720 7265 6c61 7469 6f6e 206f 6620 2478  g relation of $x
0018320: 2420 616e 6420 2479 2420 6974 2073 7566  $ and $y$ it suf
0018330: 6669 6365 7320 746f 2066 696e 6420 616e  fices to find an
0018340: 2024 6e24 2073 7563 680a 2574 6861 7420   $n$ such.%that 
0018350: 247c 785f 6e20 2d20 795f 6e7c 205c 6765  $|x_n - y_n| \ge
0018360: 7120 3224 2e20 466f 7220 6578 616d 706c  q 2$. For exampl
0018370: 652c 2069 6620 2478 5f6e 205c 6765 7120  e, if $x_n \geq 
0018380: 795f 6e20 2b20 3224 2077 6520 6861 7665  y_n + 2$ we have
0018390: 0a25 0a25 2424 2032 5e6e 2078 203e 2078  .%.%$$ 2^n x > x
00183a0: 5f6e 202d 2031 205c 6765 7120 795f 6e20  _n - 1 \geq y_n 
00183b0: 2b20 3120 3e20 325e 6e20 7920 2424 0a25  + 1 > 2^n y $$.%
00183c0: 0a25 5c6e 6f69 6e64 656e 7420 616e 6420  .%\noindent and 
00183d0: 736f 2024 7820 3e20 7924 2e20 5765 2066  so $x > y$. We f
00183e0: 6972 7374 2077 7269 7465 2061 2067 656e  irst write a gen
00183f0: 6572 616c 2070 726f 6365 6475 7265 2074  eral procedure t
0018400: 6f20 7065 7266 6f72 6d20 7468 6973 0a25  o perform this.%
0018410: 7365 6172 6368 2c20 616e 6420 7468 656e  search, and then
0018420: 2064 6566 696e 6520 616c 6c20 7468 6520   define all the 
0018430: 6f72 6465 7269 6e67 7320 696e 2074 6572  orderings in ter
0018440: 6d73 206f 6620 6974 2e20 4e6f 7465 2074  ms of it. Note t
0018450: 6861 7420 7468 6520 6f6e 6c79 0a25 7761  hat the only.%wa
0018460: 7920 746f 2061 7272 6976 6520 6174 2074  y to arrive at t
0018470: 6865 2072 6566 6c65 7869 7665 206f 7264  he reflexive ord
0018480: 6572 696e 6773 2069 7320 746f 206a 7573  erings is to jus
0018490: 7469 6679 2074 6865 2069 7272 6566 6c65  tify the irrefle
00184a0: 7869 7665 2076 6572 7369 6f6e 210a 5c62  xive version!.\b
00184b0: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
00184c0: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
00184d0: 6c65 7420 7365 7061 7261 7465 203d 200a  let separate = .
00184e0: 2020 2020 6c65 7420 7265 6320 7365 7061      let rec sepa
00184f0: 7261 7465 206e 2078 2079 203d 0a20 2020  rate n x y =.   
0018500: 2020 206c 6574 2064 203d 2078 286e 2920     let d = x(n) 
0018510: 2d2f 2079 286e 2920 696e 0a20 2020 2020  -/ y(n) in.     
0018520: 2069 6620 6162 735f 6e75 6d28 6429 203e   if abs_num(d) >
0018530: 2f20 496e 7420 3120 7468 656e 2064 0a20  / Int 1 then d. 
0018540: 2020 2020 2065 6c73 6520 7365 7061 7261       else separa
0018550: 7465 2028 6e20 2b20 3129 2078 2079 2069  te (n + 1) x y i
0018560: 6e0a 2020 7365 7061 7261 7465 2030 3b3b  n.  separate 0;;
0018570: 0a0a 2020 6c65 7420 7265 616c 5f67 7420  ..  let real_gt 
0018580: 7820 7920 3d20 7365 7061 7261 7465 2078  x y = separate x
0018590: 2079 203e 2f20 496e 7420 303b 3b0a 2020   y >/ Int 0;;.  
00185a0: 6c65 7420 7265 616c 5f67 6520 7820 7920  let real_ge x y 
00185b0: 3d20 7265 616c 5f67 7420 7820 793b 3b0a  = real_gt x y;;.
00185c0: 2020 6c65 7420 7265 616c 5f6c 7420 7820    let real_lt x 
00185d0: 7920 3d20 7365 7061 7261 7465 2078 2079  y = separate x y
00185e0: 203c 2f20 496e 7420 303b 3b0a 2020 6c65   </ Int 0;;.  le
00185f0: 7420 7265 616c 5f6c 6520 7820 7920 3d20  t real_le x y = 
0018600: 7265 616c 5f6c 7420 7820 793b 3b0a 5c65  real_lt x y;;.\e
0018610: 6e64 7b6c 7374 6c69 7374 696e 677d 5c65  nd{lstlisting}\e
0018620: 6e64 7b62 6f78 6564 7d0a 0a5c 7375 6273  nd{boxed}..\subs
0018630: 6563 7469 6f6e 7beb dcdb c9d2 cfd7 c1ce  ection{.........
0018640: c9c5 7d0a 255c 7375 6273 6563 7469 6f6e  ..}.%\subsection
0018650: 7b43 6163 6869 6e67 7d0a fed4 cfc2 d920  {Caching}...... 
0018660: d0d2 cfd4 c5d3 d4c9 d2cf d7c1 d4d8 20cf  .............. .
0018670: d0d2 c5c4 c5cc a3ce ced9 c520 cec1 cdc9  ........... ....
0018680: 20c6 d5ce cbc3 c9c9 2c20 d0cf d4d2 c5c2   ......., ......
0018690: d5c5 d4d3 d120 d7cf dacd cfd6 cecf d3d4  ..... ..........
00186a0: d820 d7d9 d7cf c4c1 0ace c5cb cfd4 cfd2  . ..............
00186b0: cfc7 cf20 d0d2 c9c2 ccc9 d6a3 cece cfc7  ... ............
00186c0: cf20 dace c1de c5ce c9d1 20d7 c5dd c5d3  . ........ .....
00186d0: d4d7 c5ce cecf c7cf 20de c9d3 ccc1 20d7  ........ ..... .
00186e0: 20c4 c5d3 d1d4 c5d2 c9de cecf ca20 d3c9   ............ ..
00186f0: d3d4 c5cd c50a d3de c9d3 ccc5 cec9 d12e  ................
0018700: 20f7 cfda cdcf d6ce cfd3 d4c9 20d3 d4c1   ........... ...
0018710: cec4 c1d2 d4ce cfca 20c2 c9c2 ccc9 cfd4  ........ .......
0018720: c5cb c920 4341 4d4c 20c4 c5cc c1c0 d420  ... CAML ...... 
0018730: dcd4 d520 dac1 c4c1 ded5 20ce c5d3 cccf  ... ...... .....
0018740: d6ce cfca 2e0a e5d3 ccc9 20ce c1cd 20d4  .......... ... .
0018750: d2c5 c2d5 c5d4 d3d1 20d7 d9d7 c5d3 d4c9  ........ .......
0018760: 2024 6424 7ec4 c5d3 d1d4 c9de ced9 c820   $d$~.......... 
0018770: dace c1cb cfd7 20de c9d3 ccc1 2c20 d0cf  ...... ....., ..
0018780: cccf d6c9 cd20 d4cf dece cfd3 d4d8 200a  ..... ........ .
0018790: d7d9 dec9 d3cc c5ce c9ca 7e24 6e24 20d4  ..........~$n$ .
00187a0: c1cb cfca 2c20 ded4 cfc2 d97e 2432 5e6e  ...., .....~$2^n
00187b0: 203e 2031 305e 6424 2c20 d42e 7ec5 2e5c   > 10^d$, ..~..\
00187c0: 20d4 cfde cecf d3d4 d820 d7d9 dec9 d3cc   ........ ......
00187d0: c5ce c9ca 20c2 d9cc c120 c2d9 0ace c520  .... .... ..... 
00187e0: cdc5 ced8 dbc5 ca2c 20de c5cd 20cb cfcc  ......., ... ...
00187f0: c9de c5d3 d4d7 cf20 d7d9 d7cf c4c9 cdd9  ....... ........
0018800: c820 c3c9 c6d2 2e0a 2549 6e20 6f72 6465  . ......%In orde
0018810: 7220 746f 2074 7279 206f 7574 2061 6c6c  r to try out all
0018820: 2074 6865 2061 626f 7665 2066 756e 6374   the above funct
0018830: 696f 6e73 2c20 7765 2077 6f75 6c64 206c  ions, we would l
0018840: 696b 6520 746f 2062 6520 6162 6c65 2074  ike to be able t
0018850: 6f20 7072 696e 740a 256f 7574 2061 2064  o print.%out a d
0018860: 6563 696d 616c 2072 6570 7265 7365 6e74  ecimal represent
0018870: 6174 696f 6e20 6f66 2073 6f6d 6520 6170  ation of some ap
0018880: 7072 6f78 696d 6174 696f 6e20 746f 2061  proximation to a
0018890: 2072 6561 6c2e 2054 6869 7320 6973 206e   real. This is n
00188a0: 6f74 2068 6172 642c 0a25 7573 696e 6720  ot hard,.%using 
00188b0: 736f 6d65 206d 6f72 6520 7374 616e 6461  some more standa
00188c0: 7264 2066 6163 696c 6974 6965 7320 696e  rd facilities in
00188d0: 2074 6865 2043 414d 4c20 6c69 6272 6172   the CAML librar
00188e0: 792e 2049 6620 2464 2420 6465 6369 6d61  y. If $d$ decima
00188f0: 6c20 706c 6163 6573 0a25 6172 6520 6465  l places.%are de
0018900: 7369 7265 642c 2074 6865 6e20 7765 206d  sired, then we m
0018910: 616b 6520 246e 2420 7375 6368 2074 6861  ake $n$ such tha
0018920: 7420 2432 5e6e 203e 2031 305e 6424 2061  t $2^n > 10^d$ a
0018930: 6e64 2068 656e 6365 2074 6865 2061 6363  nd hence the acc
0018940: 7572 6163 790a 2563 6f72 7265 7370 6f6e  uracy.%correspon
0018950: 6473 2061 7420 6c65 6173 7420 746f 2074  ds at least to t
0018960: 6865 206e 756d 6265 7220 6f66 2064 6967  he number of dig
0018970: 6974 7320 7072 696e 7465 642e 0a0a 5c62  its printed...\b
0018980: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
0018990: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
00189a0: 6c65 7420 7669 6577 2078 2064 203d 0a20  let view x d =. 
00189b0: 2020 206c 6574 206e 203d 2034 202a 2064     let n = 4 * d
00189c0: 2069 6e0a 2020 2020 6c65 7420 6f75 7420   in.    let out 
00189d0: 3d20 7828 6e29 202f 2f20 2849 6e74 2032  = x(n) // (Int 2
00189e0: 202a 2a2f 2049 6e74 206e 2920 696e 0a20   **/ Int n) in. 
00189f0: 2020 2061 7070 726f 785f 6e75 6d5f 6669     approx_num_fi
0018a00: 7820 6420 6f75 743b 3b0a 5c65 6e64 7b6c  x d out;;.\end{l
0018a10: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
0018a20: 6f78 6564 7d0a 0aee c1de cea3 cd20 d320  oxed}........ . 
0018a30: d0d2 cfd3 d4d9 c820 d0d2 c9cd c5d2 cfd7  ....... ........
0018a40: 2c20 cbcf d4cf d2d9 c520 d2c1 c2cf d4c1  , ....... ......
0018a50: c0d4 2c20 cbc1 cb20 cfd6 c9c4 c1c5 d4d3  .., ... ........
0018a60: d13a 0a25 4e6f 7720 7765 2063 616e 2074  .:.%Now we can t
0018a70: 6573 7420 6f75 7420 736f 6d65 2073 696d  est out some sim
0018a80: 706c 6520 6578 616d 706c 6573 2c20 7768  ple examples, wh
0018a90: 6963 6820 7365 656d 2074 6f20 776f 726b  ich seem to work
0018aa0: 3a0a 250a 5c62 6567 696e 7b62 6f78 6564  :.%.\begin{boxed
0018ab0: 7d5c 6265 6769 6e7b 7665 7262 6174 696d  }\begin{verbatim
0018ac0: 7d0a 2020 236c 6574 2078 203d 2072 6561  }.  #let x = rea
0018ad0: 6c5f 6f66 5f69 6e74 2033 3b3b 0a20 2078  l_of_int 3;;.  x
0018ae0: 203a 2069 6e74 202d 3e20 6e75 6d20 3d20   : int -> num = 
0018af0: 3c66 756e 3e0a 2020 236c 6574 2078 6920  <fun>.  #let xi 
0018b00: 3d20 7265 616c 5f69 6e76 2078 3b3b 0a20  = real_inv x;;. 
0018b10: 2078 6920 3a20 696e 7420 2d3e 206e 756d   xi : int -> num
0018b20: 203d 203c 6675 6e3e 0a20 2023 6c65 7420   = <fun>.  #let 
0018b30: 7775 6e20 3d20 7265 616c 5f6d 756c 2078  wun = real_mul x
0018b40: 2078 693b 3b0a 2020 7775 6e20 3a20 696e   xi;;.  wun : in
0018b50: 7420 2d3e 206e 756d 203d 203c 6675 6e3e  t -> num = <fun>
0018b60: 0a20 2023 7669 6577 2078 2032 303b 3b0a  .  #view x 20;;.
0018b70: 2020 6974 203a 2073 7472 696e 6720 3d20    it : string = 
0018b80: 2233 2e30 3030 3030 3030 3030 3030 3030  "3.0000000000000
0018b90: 3030 3030 3030 3022 0a20 2023 7669 6577  0000000".  #view
0018ba0: 2078 6920 3230 3b3b 0a20 2069 7420 3a20   xi 20;;.  it : 
0018bb0: 7374 7269 6e67 203d 2022 2e33 3333 3333  string = ".33333
0018bc0: 3333 3333 3333 3333 3333 3333 3333 3322  333333333333333"
0018bd0: 0a20 2023 7669 6577 2077 756e 2032 303b  .  #view wun 20;
0018be0: 3b0a 2020 6974 203a 2073 7472 696e 6720  ;.  it : string 
0018bf0: 3d20 2231 2e30 3030 3030 3030 3030 3030  = "1.00000000000
0018c00: 3030 3030 3030 3030 3022 0a5c 656e 647b  000000000".\end{
0018c10: 7665 7262 6174 696d 7d5c 656e 647b 626f  verbatim}\end{bo
0018c20: 7865 647d 0a0a efc4 cec1 cbcf 2c20 c4c1  xed}........, ..
0018c30: ccd8 cec5 cadb c5c5 20d4 c5d3 d4c9 d2cf  ........ .......
0018c40: d7c1 cec9 c520 cfc2 cec1 d2d5 d6c9 d7c1  ..... ..........
0018c50: c5d4 20d7 20ce c1db c5ca 20d2 c5c1 ccc9  .. . ..... .....
0018c60: dac1 c3c9 c920 d3c5 d2d8 a3da ced5 c00a  ..... ..........
0018c70: d4d2 d5c4 cecf d5cc cfd7 c9cd d5c0 20d0  .............. .
0018c80: d2cf c2cc c5cd d52c 20cb cfd4 cfd2 c1d1  ......., .......
0018c90: 20d0 d2cf d1d7 ccd1 c5d4 d3d1 20d3 20d2   ........... . .
0018ca0: cfd3 d4cf cd20 d3cc cfd6 cecf d3d4 c920  ..... ......... 
0018cb0: dac1 c4c1 de2e 0afc d4c1 20d0 d2cf c2cc  .......... .....
0018cc0: c5cd c17e 2d2d 2d20 cdce cfc7 cfcb d2c1  ...~--- ........
0018cd0: d4ce cfc5 20d7 d9de c9d3 ccc5 cec9 c520  .... .......... 
0018ce0: cfc4 cec9 c820 c920 d4c5 c820 d6c5 20da  ..... . ... .. .
0018cf0: cec1 dec5 cec9 ca2e 20f0 cfcd c9cd cf0a  ........ .......
0018d00: cfde c5d7 c9c4 cecf c7cf 20d3 ccd5 dec1  .......... .....
0018d10: d17e 2d2d 2d20 d1d7 cecf c7cf 20ce c1cc  .~--- ...... ...
0018d20: c9de c9d1 20cf c2dd c9c8 20d0 cfc4 d7d9  .... ..... .....
0018d30: d2c1 d6c5 cec9 ca2c 20cd cecf c7cf cbd2  ......., .......
0018d40: c1d4 cecf c520 0ad7 d9de c9d3 ccc5 cec9  ..... ..........
0018d50: c520 cfc4 cec9 c820 c920 d4c5 c820 d6c5  . ..... . ... ..
0018d60: 20d7 d9d2 c1d6 c5ce c9ca 20d3 20d2 c1da   ......... . ...
0018d70: ccc9 dece cfca 20d4 cfde cecf d3d4 d8c0  ...... .........
0018d80: 20d4 d2c5 c2d5 c5d4 d3d1 20d7 200a c1cc   ......... . ...
0018d90: c7cf d2c9 d4cd c1c8 20d5 cdce cfd6 c5ce  ........ .......
0018da0: c9d1 20c9 2c20 d720 cfd3 cfc2 c5ce cecf  .. ., . ........
0018db0: d3d4 c92c 20d7 d9de c9d3 ccc5 cec9 d120  ..., .......... 
0018dc0: cfc2 d2c1 d4ce cfc7 cf20 dec9 d3cc c12e  ......... ......
0018dd0: 20eb cfcc c9de c5d3 d4d7 cf0a cfc2 d2c1   ...............
0018de0: ddc5 cec9 ca20 cb20 cfc4 cecf cdd5 20c9  ..... . ...... .
0018df0: 20d4 cfcd d520 d6c5 20d0 cfc4 d7d9 d2c1   .... .. .......
0018e00: d6c5 cec9 c020 dac1 d7c9 d3c9 d420 cfd4  ..... ....... ..
0018e10: 20c7 ccd5 c2c9 ced9 20c5 c7cf 20d7 cccf   ....... ... ...
0018e20: d6c5 cece cfd3 d4c9 0ad7 20c9 d3c8 cfc4  .......... .....
0018e30: cecf c520 d7d9 d2c1 d6c5 cec9 c520 c920  ... ......... . 
0018e40: cdcf d6c5 d420 d2c1 d3d4 c920 dccb d3d0  ..... ..... ....
0018e50: cfce c5ce c3c9 c1cc d8ce cf3a 0a25 486f  ...........:.%Ho
0018e60: 7765 7665 7220 7468 6572 6520 6973 2061  wever there is a
0018e70: 2073 7562 746c 6520 616e 6420 7365 7269   subtle and seri
0018e80: 6f75 7320 6275 6720 696e 206f 7572 2069  ous bug in our i
0018e90: 6d70 6c65 6d65 6e74 6174 696f 6e2c 2077  mplementation, w
0018ea0: 6869 6368 2073 686f 7773 0a25 6974 7365  hich shows.%itse
0018eb0: 6c66 2069 6620 7765 2074 7279 206c 6172  lf if we try lar
0018ec0: 6765 7220 6578 7072 6573 7369 6f6e 732e  ger expressions.
0018ed0: 2054 6865 2070 726f 626c 656d 2069 7320   The problem is 
0018ee0: 7468 6174 2073 7562 6578 7072 6573 7369  that subexpressi
0018ef0: 6f6e 7320 6361 6e20 6265 0a25 6576 616c  ons can be.%eval
0018f00: 7561 7465 6420 6d61 6e79 2074 696d 6573  uated many times
0018f10: 2e20 4d6f 7374 206f 6276 696f 7573 6c79  . Most obviously
0018f20: 2c20 7468 6973 2068 6170 7065 6e73 2069  , this happens i
0018f30: 6620 7468 6579 206f 6363 7572 2073 6576  f they occur sev
0018f40: 6572 616c 2074 696d 6573 0a25 696e 2074  eral times.%in t
0018f50: 6865 2069 6e70 7574 2065 7870 7265 7373  he input express
0018f60: 696f 6e2e 2042 7574 2065 7665 6e20 6966  ion. But even if
0018f70: 2074 6865 7920 646f 6e27 742c 2074 6865   they don't, the
0018f80: 206d 756c 7469 706c 6963 6174 696f 6e2c   multiplication,
0018f90: 2061 6e64 2065 7665 6e0a 256d 6f72 6520   and even.%more 
0018fa0: 736f 2c20 7468 6520 696e 7665 7273 652c  so, the inverse,
0018fb0: 2072 6571 7569 7265 2074 7269 616c 2065   require trial e
0018fc0: 7661 6c75 6174 696f 6e73 2061 7420 6469  valuations at di
0018fd0: 6666 6572 696e 6720 6163 6375 7261 6369  ffering accuraci
0018fe0: 6573 2e20 4173 2074 6865 0a25 6576 616c  es. As the.%eval
0018ff0: 7561 7469 6f6e 2070 726f 7061 6761 7465  uation propagate
0019000: 7320 646f 776e 2074 6f20 7468 6520 626f  s down to the bo
0019010: 7474 6f6d 206c 6576 656c 2c20 7468 6572  ttom level, ther
0019020: 6520 6973 206f 6674 656e 2061 6e20 6578  e is often an ex
0019030: 706f 6e65 6e74 6961 6c0a 2562 7569 6c64  ponential.%build
0019040: 7570 206f 6620 7265 6576 616c 7561 7469  up of reevaluati
0019050: 6f6e 732e 2046 6f72 2065 7861 6d70 6c65  ons. For example
0019060: 2c20 7468 6520 666f 6c6c 6f77 696e 6720  , the following 
0019070: 6973 2073 6c6f 7720 2d2d 2d20 6974 2074  is slow --- it t
0019080: 616b 6573 0a25 7365 7665 7261 6c20 7365  akes.%several se
0019090: 636f 6e64 732e 0a25 0a5c 6265 6769 6e7b  conds..%.\begin{
00190a0: 626f 7865 647d 5c62 6567 696e 7b76 6572  boxed}\begin{ver
00190b0: 6261 7469 6d7d 0a20 2023 6c65 7420 7831  batim}.  #let x1
00190c0: 203d 2072 6561 6c5f 6f66 5f69 6e74 2031   = real_of_int 1
00190d0: 2069 6e0a 2020 206c 6574 2078 3220 3d20   in.   let x2 = 
00190e0: 7265 616c 5f6d 756c 2078 3120 7831 2069  real_mul x1 x1 i
00190f0: 6e0a 2020 206c 6574 2078 3320 3d20 7265  n.   let x3 = re
0019100: 616c 5f6d 756c 2078 3220 7832 2069 6e0a  al_mul x2 x2 in.
0019110: 2020 206c 6574 2078 3420 3d20 7265 616c     let x4 = real
0019120: 5f6d 756c 2078 3320 7833 2069 6e0a 2020  _mul x3 x3 in.  
0019130: 206c 6574 2078 3520 3d20 7265 616c 5f6d   let x5 = real_m
0019140: 756c 2078 3420 7834 2069 6e0a 2020 206c  ul x4 x4 in.   l
0019150: 6574 2078 3620 3d20 7265 616c 5f6d 756c  et x6 = real_mul
0019160: 2078 3520 7835 2069 6e0a 2020 206c 6574   x5 x5 in.   let
0019170: 2078 3720 3d20 7265 616c 5f6d 756c 2078   x7 = real_mul x
0019180: 3620 7836 2069 6e0a 2020 2076 6965 7720  6 x6 in.   view 
0019190: 7837 2031 303b 3b0a 2020 202d 203a 2073  x7 10;;.   - : s
00191a0: 7472 696e 6720 3d20 222b 312e 3030 3030  tring = "+1.0000
00191b0: 3030 3030 3030 220a 5c65 6e64 7b76 6572  000000".\end{ver
00191c0: 6261 7469 6d7d 5c65 6e64 7b62 6f78 6564  batim}\end{boxed
00191d0: 7d0a 250a f7d9 dec9 d3cc c5ce c9c5 20dc  }.%........... .
00191e0: d4cf c7cf 20d0 d2c9 cdc5 d2c1 20cd cfd6  .... ....... ...
00191f0: c5d4 20da c1ce d1d4 d820 cec5 d3cb cfcc  .. ...... ......
0019200: d8cb cf20 d3c5 cbd5 cec4 2e0a 0ae4 ccd1  ... ............
0019210: 20d2 c5db c5ce c9d1 20d0 d2cf c2cc c5cd   ....... .......
0019220: d920 d7cf d3d0 cfcc d8da d5c5 cdd3 d120  . ............. 
0019230: c9c4 c5c5 ca20 7b5c 656d 20cb dcdb c9d2  ..... {\em .....
0019240: cfd7 c1ce c9d1 7d20 c9cc c90a 7b5c 656d  ......} ....{\em
0019250: 20c6 d5ce cbc3 c9ca 20d3 20d0 c1cd d1d4   ....... . .....
0019260: d8c0 7d20 5c63 6974 657b 6d69 6368 6965  ..} \cite{michie
0019270: 2d6d 656d 6f7d 2e20 ebc1 d6c4 cfca 20c6  -memo}. ...... .
0019280: d5ce cbc3 c9c9 20d0 cfd3 d4c1 d7c9 cd20  ...... ........ 
0019290: d720 0ad3 cfcf d4d7 c5d4 d3d4 d7c9 c520  . ............. 
00192a0: d1de c5ca cbd5 20d0 c1cd d1d4 c92c 2028  ...... ......, (
00192b0: 3f3f 3f72 6566 2e20 6365 6c6c 2920 d720  ???ref. cell) . 
00192c0: cbcf d4cf d2cf ca20 c2d5 c4c5 cd20 c8d2  ....... ..... ..
00192d0: c1ce c9d4 d820 c5a3 20da cec1 dec5 cec9  ..... .. .......
00192e0: c52c 200a d7d9 dec9 d3cc c5ce cecf c520  ., ............ 
00192f0: d320 cec1 c9c2 cfcc d8db c5ca 20ce c120  . .......... .. 
0019300: c4c1 cece d9ca 20cd cfcd c5ce d420 d4cf  ...... ...... ..
0019310: dece cfd3 d4d8 c02e 20f0 d2c9 20cf dec5  ........ ... ...
0019320: d2c5 c4ce cfcd 20cf c2d2 c1dd c5ce c9c9  ...... .........
0019330: 200a cb20 c6d5 cecb c3c9 c920 d320 d4cf   .. ....... . ..
0019340: ca20 d6c5 20d3 c1cd cfca 20d4 d2c5 c2d5  . .. ..... .....
0019350: c5cd cfca 20d4 cfde cecf d3d4 d8c0 20dc  .... ......... .
0019360: d4cf 20da cec1 dec5 cec9 c520 cdcf d6c5  .. ........ ....
0019370: d420 c2d9 d4d8 200a d7cf dad7 d2c1 ddc5  . .... .........
0019380: cecf 20ce c5cd c5c4 ccc5 cece cf2c 20c2  .. .........., .
0019390: c5da 20cb c1cb c9c8 2dcc c9c2 cf20 d0cf  .. .....-.... ..
00193a0: d7d4 cfd2 ced9 c820 d7d9 dec9 d3cc c5ce  ....... ........
00193b0: c9ca 2e20 ebd2 cfcd c520 d4cf c7cf 2c20  ... ..... ...., 
00193c0: cdc5 cec5 c520 0ad4 cfde cec1 d120 c1d0  ..... ....... ..
00193d0: d0d2 cfcb d3c9 cdc1 c3c9 d120 28ce c1d0  ........... (...
00193e0: d2c9 cdc5 d22c 20d0 cfd2 d1c4 cbc1 7e24  ....., .......~$
00193f0: 6e24 2920 d7d3 c5c7 c4c1 20cd cfd6 c5d4  n$) ...... .....
0019400: 20c2 d9d4 d820 d0cf ccd5 dec5 cec1 20c9   .... ........ .
0019410: da20 0ac2 cfcc c5c5 20d4 cfde cecf ca20  . ...... ...... 
0019420: 2824 6e20 2b20 6b24 2c20 c7c4 c57e 246b  ($n + k$, ...~$k
0019430: 205c 6765 7120 3124 292e 20e5 d3cc c920   \geq 1$). .... 
0019440: cec1 cd20 c9da d7c5 d3d4 cecf 2c20 0ade  ... ........, ..
0019450: d4cf 7e24 7c66 5f78 286e 202b 206b 2920  ..~$|f_x(n + k) 
0019460: 2d20 325e 7b6e 202b 206b 7d20 787c 203c  - 2^{n + k} x| <
0019470: 2031 242c 20c9 da20 dcd4 cfc7 cf20 d3cc   1$, .. ..... ..
0019480: c5c4 d5c5 d43a 0a25 5765 2063 616e 2066  .....:.%We can f
0019490: 6978 2074 6869 7320 7072 6f62 6c65 6d20  ix this problem 
00194a0: 7573 696e 6720 7468 6520 6964 6561 206f  using the idea o
00194b0: 6620 7b5c 656d 2063 6163 6869 6e67 7d20  f {\em caching} 
00194c0: 6f72 207b 5c65 6d20 6d65 6d6f 0a25 6675  or {\em memo.%fu
00194d0: 6e63 7469 6f6e 737d 205c 6369 7465 7b6d  nctions} \cite{m
00194e0: 6963 6869 652d 6d65 6d6f 7d2e 2057 6520  ichie-memo}. We 
00194f0: 6769 7665 2065 6163 6820 6675 6e63 7469  give each functi
0019500: 6f6e 2061 2072 6566 6572 656e 6365 2063  on a reference c
0019510: 656c 6c20 746f 0a25 7265 6d65 6d62 6572  ell to.%remember
0019520: 2074 6865 206d 6f73 7420 6163 6375 7261   the most accura
0019530: 7465 2076 6572 7369 6f6e 2061 6c72 6561  te version alrea
0019540: 6479 2063 616c 6375 6c61 7465 642e 2049  dy calculated. I
0019550: 6620 7468 6572 6520 6973 2061 2073 6563  f there is a sec
0019560: 6f6e 640a 2572 6571 7565 7374 2066 6f72  ond.%request for
0019570: 2074 6865 2073 616d 6520 6163 6375 7261   the same accura
0019580: 6379 2c20 6974 2063 616e 2062 6520 7265  cy, it can be re
0019590: 7475 726e 6564 2069 6d6d 6564 6961 7465  turned immediate
00195a0: 6c79 2077 6974 686f 7574 2066 7572 7468  ly without furth
00195b0: 6572 0a25 6576 616c 7561 7469 6f6e 2e20  er.%evaluation. 
00195c0: 5768 6174 2773 206d 6f72 652c 2077 6520  What's more, we 
00195d0: 6361 6e20 616c 7761 7973 2063 6f6e 7374  can always const
00195e0: 7275 6374 2061 206c 6f77 6572 2d6c 6576  ruct a lower-lev
00195f0: 656c 2061 7070 726f 7869 6d61 7469 6f6e  el approximation
0019600: 2c0a 2573 6179 2024 6e24 2c20 6672 6f6d  ,.%say $n$, from
0019610: 2061 2068 6967 6865 7220 6f6e 652c 2073   a higher one, s
0019620: 6179 2024 6e20 2b20 6b24 2077 6974 6820  ay $n + k$ with 
0019630: 246b 205c 6765 7120 3124 2e20 4966 2077  $k \geq 1$. If w
0019640: 6520 6b6e 6f77 2074 6861 740a 2524 7c66  e know that.%$|f
0019650: 5f78 286e 202b 206b 2920 2d20 325e 7b6e  _x(n + k) - 2^{n
0019660: 202b 206b 7d20 787c 203c 2031 2420 7468   + k} x| < 1$ th
0019670: 656e 2077 6520 6861 7665 3a0a 250a 5c62  en we have:.%.\b
0019680: 6567 696e 7b65 716e 6172 7261 792a 7d0a  egin{eqnarray*}.
0019690: 7c66 5f78 286e 202b 206b 2920 5c6d 626f  |f_x(n + k) \mbo
00196a0: 787b 206e 6469 7620 7d20 325e 206b 202d  x{ ndiv } 2^ k -
00196b0: 2032 5e6e 2078 7c0a 2620 5c6c 6571 2026   2^n x|.& \leq &
00196c0: 207b 3120 5c6f 7665 7220 327d 202b 207c   {1 \over 2} + |
00196d0: 7b66 5f78 286e 202b 206b 2920 5c6f 7665  {f_x(n + k) \ove
00196e0: 7220 325e 6b7d 202d 2032 5e6e 2078 7c20  r 2^k} - 2^n x| 
00196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
0019700: 5c5c 0a26 203d 2020 2020 2620 7b31 205c  \\.& =    & {1 \
0019710: 6f76 6572 2032 7d20 2b20 7b31 205c 6f76  over 2} + {1 \ov
0019720: 6572 2032 5e6b 7d20 7c66 5f78 286e 202b  er 2^k} |f_x(n +
0019730: 206b 2920 2d20 325e 7b6e 202b 206b 7d20   k) - 2^{n + k} 
0019740: 787c 2020 2020 2020 2020 205c 5c0a 2620  x|         \\.& 
0019750: 3c20 2020 2026 207b 3120 5c6f 7665 7220  <    & {1 \over 
0019760: 327d 202b 207b 3120 5c6f 7665 7220 325e  2} + {1 \over 2^
0019770: 6b7d 2020 2020 2020 2020 2020 2020 2020  k}              
0019780: 2020 2020 2020 2020 2020 2020 2020 2020                  
0019790: 2020 2020 2020 5c5c 0a26 205c 6c65 7120        \\.& \leq 
00197a0: 2620 312e 0a5c 656e 647b 6571 6e61 7272  & 1..\end{eqnarr
00197b0: 6179 2a7d 0a25 0af4 c1cb c9cd 20cf c2d2  ay*}.%...... ...
00197c0: c1da cfcd 2c20 c9d3 d0cf ccd8 dacf d7c1  ...., ..........
00197d0: cec9 c57e 2466 5f78 286e 202b 206b 2920  ...~$f_x(n + k) 
00197e0: 5c6d 626f 787b 206e 6469 7620 7d20 325e  \mbox{ ndiv } 2^
00197f0: 6b24 20d7 20cb c1de c5d3 d4d7 c50a c1d0  k$ . ...........
0019800: d0d2 cfcb d3c9 cdc1 c3c9 c920 d0cf d2d1  ........... ....
0019810: c4cb c17e 246e 2420 cfc2 cfd3 cecf d7c1  ...~$n$ ........
0019820: cecf 2e0a 0ae4 ccd1 20d2 c5c1 ccc9 dac1  ........ .......
0019830: c3c9 c920 c6d5 cecb c3c9 ca20 d320 d0c1  ... ....... . ..
0019840: cdd1 d4d8 c020 d7cf d3d0 cfcc d8da d5c5  ..... ..........
0019850: cdd3 d120 cfc2 cfc2 dda3 cece cfca 20c6  ... .......... .
0019860: d5ce cbc3 c9c5 ca7e 7b5c 7474 206d 656d  .......~{\tt mem
0019870: 6f7d 2c0a cbcf d4cf d2d5 c020 d4d2 c5c2  o},........ ....
0019880: d5c5 d4d3 d120 c4cf c2c1 d7c9 d4d8 20d7  ..... ........ .
0019890: cf20 d7d3 c520 cfd0 d2c5 c4c5 cca3 cece  . ... ..........
00198a0: d9c5 20d2 c1ce c5c5 20cf d0c5 d2c1 c3c9  .. ..... .......
00198b0: c920 cec1 c420 d7c5 ddc5 d3d4 d7c5 cece  . ... ..........
00198c0: d9cd c920 0ade c9d3 ccc1 cdc9 3a0a 2548  ... ........:.%H
00198d0: 656e 6365 2077 6520 6172 6520 616c 7761  ence we are alwa
00198e0: 7973 2073 6166 6520 696e 2072 6574 7572  ys safe in retur
00198f0: 6e69 6e67 2024 665f 7828 6e20 2b20 6b29  ning $f_x(n + k)
0019900: 205c 6d62 6f78 7b20 6e64 6976 207d 2032   \mbox{ ndiv } 2
0019910: 5e6b 242e 2057 6520 6361 6e0a 2569 6d70  ^k$. We can.%imp
0019920: 6c65 6d65 6e74 2074 6869 7320 6d65 6d6f  lement this memo
0019930: 2074 6563 686e 6971 7565 2076 6961 2061   technique via a
0019940: 2067 656e 6572 6963 2066 756e 6374 696f   generic functio
0019950: 6e20 7b5c 7474 206d 656d 6f7d 2074 6f20  n {\tt memo} to 
0019960: 6265 2069 6e73 6572 7465 640a 2569 6e20  be inserted.%in 
0019970: 6561 6368 206f 6620 7468 6520 7072 6576  each of the prev
0019980: 696f 7573 2066 756e 6374 696f 6e73 3a0a  ious functions:.
0019990: 250a 5c62 6567 696e 7b62 6f78 6564 7d5c  %.\begin{boxed}\
00199a0: 6265 6769 6e7b 6c73 746c 6973 7469 6e67  begin{lstlisting
00199b0: 7d0a 2020 6c65 7420 7265 616c 5f6f 665f  }.  let real_of_
00199c0: 696e 7420 6b20 3d20 6d65 6d6f 2028 6675  int k = memo (fu
00199d0: 6e20 6e20 2d3e 2028 496e 7420 3220 2a2a  n n -> (Int 2 **
00199e0: 2f20 496e 7420 6e29 202a 2f20 496e 7420  / Int n) */ Int 
00199f0: 6b29 3b3b 0a0a 2020 6c65 7420 7265 616c  k);;..  let real
0019a00: 5f6e 6567 2066 203d 206d 656d 6f20 2866  _neg f = memo (f
0019a10: 756e 206e 202d 3e20 6d69 6e75 735f 6e75  un n -> minus_nu
0019a20: 6d28 6620 6e29 293b 3b0a 0a20 206c 6574  m(f n));;..  let
0019a30: 2072 6561 6c5f 6162 7320 6620 3d20 6d65   real_abs f = me
0019a40: 6d6f 2028 6675 6e20 6e20 2d3e 2061 6273  mo (fun n -> abs
0019a50: 5f6e 756d 2028 6620 6e29 293b 3b0a 0a20  _num (f n));;.. 
0019a60: 206c 6574 2072 6561 6c5f 6164 6420 6620   let real_add f 
0019a70: 6720 3d20 6d65 6d6f 2028 6675 6e20 6e20  g = memo (fun n 
0019a80: 2d3e 0a20 2020 2020 2866 286e 202b 2032  ->.     (f(n + 2
0019a90: 2920 2b2f 2067 286e 202b 2032 2929 206e  ) +/ g(n + 2)) n
0019aa0: 6469 7620 2849 6e74 2034 2929 3b3b 0a0a  div (Int 4));;..
0019ab0: 2020 6c65 7420 7265 616c 5f73 7562 2066    let real_sub f
0019ac0: 2067 203d 2072 6561 6c5f 6164 6420 6620   g = real_add f 
0019ad0: 2872 6561 6c5f 6e65 6720 6729 3b3b 0a0a  (real_neg g);;..
0019ae0: 2020 6c65 7420 7265 616c 5f69 6e74 6d75    let real_intmu
0019af0: 6c20 6d20 7820 3d20 6d65 6d6f 2028 6675  l m x = memo (fu
0019b00: 6e20 6e20 2d3e 0a20 2020 2020 6c65 7420  n n ->.     let 
0019b10: 7020 3d20 6c6f 6732 2028 6162 735f 6e75  p = log2 (abs_nu
0019b20: 6d20 6d29 2069 6e0a 2020 2020 206c 6574  m m) in.     let
0019b30: 2070 3120 3d20 7020 2b20 3120 696e 0a20   p1 = p + 1 in. 
0019b40: 2020 2020 286d 202a 2f20 7828 6e20 2b20      (m */ x(n + 
0019b50: 7031 2929 206e 6469 7620 2849 6e74 2032  p1)) ndiv (Int 2
0019b60: 202a 2a2f 2049 6e74 2070 3129 293b 3b0a   **/ Int p1));;.
0019b70: 0a20 206c 6574 2072 6561 6c5f 696e 7464  .  let real_intd
0019b80: 6976 206d 2078 203d 206d 656d 6f20 2866  iv m x = memo (f
0019b90: 756e 206e 202d 3e0a 2020 2020 2078 286e  un n ->.     x(n
0019ba0: 2920 6e64 6976 2028 496e 7420 6d29 293b  ) ndiv (Int m));
0019bb0: 3b0a 0a20 206c 6574 2072 6561 6c5f 6d75  ;..  let real_mu
0019bc0: 6c20 7820 7920 3d20 6d65 6d6f 2028 6675  l x y = memo (fu
0019bd0: 6e20 6e20 2d3e 0a20 2020 206c 6574 206e  n n ->.    let n
0019be0: 3220 3d20 6e20 2b20 3220 696e 0a20 2020  2 = n + 2 in.   
0019bf0: 206c 6574 2072 203d 206e 3220 2f20 3220   let r = n2 / 2 
0019c00: 696e 0a20 2020 206c 6574 2073 203d 206e  in.    let s = n
0019c10: 3220 2d20 7220 696e 0a20 2020 206c 6574  2 - r in.    let
0019c20: 2078 7220 3d20 7828 7229 0a20 2020 2061   xr = x(r).    a
0019c30: 6e64 2079 7320 3d20 7928 7329 2069 6e0a  nd ys = y(s) in.
0019c40: 2020 2020 6c65 7420 7020 3d20 6c6f 6732      let p = log2
0019c50: 2078 720a 2020 2020 616e 6420 7120 3d20   xr.    and q = 
0019c60: 6c6f 6732 2079 7320 696e 0a20 2020 2069  log2 ys in.    i
0019c70: 6620 7020 3d20 3020 2620 7120 3d20 3020  f p = 0 & q = 0 
0019c80: 7468 656e 2049 6e74 2030 2065 6c73 650a  then Int 0 else.
0019c90: 2020 2020 6c65 7420 6b20 3d20 7120 2b20      let k = q + 
0019ca0: 7220 2b20 310a 2020 2020 616e 6420 6c20  r + 1.    and l 
0019cb0: 3d20 7020 2b20 7320 2b20 310a 2020 2020  = p + s + 1.    
0019cc0: 616e 6420 6d20 3d20 7020 2b20 7120 2b20  and m = p + q + 
0019cd0: 3420 696e 0a20 2020 2028 7828 6b29 202a  4 in.    (x(k) *
0019ce0: 2f20 7928 6c29 2920 6e64 6976 2028 496e  / y(l)) ndiv (In
0019cf0: 7420 3220 2a2a 2f20 496e 7420 6d29 293b  t 2 **/ Int m));
0019d00: 3b0a 0a20 206c 6574 2072 6561 6c5f 696e  ;..  let real_in
0019d10: 7620 7820 3d20 6d65 6d6f 2028 6675 6e20  v x = memo (fun 
0019d20: 6e20 2d3e 0a20 2020 206c 6574 2078 3020  n ->.    let x0 
0019d30: 3d20 7828 3029 2069 6e0a 2020 2020 6c65  = x(0) in.    le
0019d40: 7420 6b20 3d0a 2020 2020 2020 6966 2078  t k =.      if x
0019d50: 3020 3e2f 2049 6e74 2031 2074 6865 6e0a  0 >/ Int 1 then.
0019d60: 2020 2020 2020 2020 6c65 7420 7220 3d20          let r = 
0019d70: 6c6f 6732 2078 3020 2d20 3120 696e 0a20  log2 x0 - 1 in. 
0019d80: 2020 2020 2020 206c 6574 206b 3020 3d20         let k0 = 
0019d90: 6e20 2b20 3120 2d20 3220 2a20 7220 696e  n + 1 - 2 * r in
0019da0: 0a20 2020 2020 2020 2069 6620 6b30 203c  .        if k0 <
0019db0: 2030 2074 6865 6e20 3020 656c 7365 206b   0 then 0 else k
0019dc0: 300a 2020 2020 2020 656c 7365 0a20 2020  0.      else.   
0019dd0: 2020 2020 206c 6574 2070 203d 206d 7364       let p = msd
0019de0: 2078 2069 6e0a 2020 2020 2020 2020 6e20   x in.        n 
0019df0: 2b20 3220 2a20 7020 2b20 3120 696e 0a20  + 2 * p + 1 in. 
0019e00: 2020 2028 496e 7420 3220 2a2a 2f20 496e     (Int 2 **/ In
0019e10: 7420 286e 202b 206b 2929 206e 6469 7620  t (n + k)) ndiv 
0019e20: 2878 286b 2929 293b 3b0a 0a20 206c 6574  (x(k)));;..  let
0019e30: 2072 6561 6c5f 6469 7620 7820 7920 3d20   real_div x y = 
0019e40: 7265 616c 5f6d 756c 2078 2028 7265 616c  real_mul x (real
0019e50: 5f69 6e76 2079 293b 3b0a 5c65 6e64 7b6c  _inv y);;.\end{l
0019e60: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
0019e70: 6f78 6564 7d0a 250a c7c4 c50a 255c 6e6f  oxed}.%.....%\no
0019e80: 696e 6465 6e74 2077 6865 7265 0a25 0a5c  indent where.%.\
0019e90: 6265 6769 6e7b 626f 7865 647d 5c62 6567  begin{boxed}\beg
0019ea0: 696e 7b6c 7374 6c69 7374 696e 677d 0a20  in{lstlisting}. 
0019eb0: 206c 6574 206d 656d 6f20 6620 3d0a 2020   let memo f =.  
0019ec0: 2020 6c65 7420 6d65 6d20 3d20 7265 6620    let mem = ref 
0019ed0: 282d 312c 496e 7420 3029 2069 6e0a 2020  (-1,Int 0) in.  
0019ee0: 2020 6675 6e20 6e20 2d3e 206c 6574 2028    fun n -> let (
0019ef0: 6d2c 7265 7329 203d 2021 6d65 6d20 696e  m,res) = !mem in
0019f00: 0a20 2020 2020 2020 2020 2020 2020 6966  .             if
0019f10: 206e 203c 3d20 6d20 7468 656e 0a20 2020   n <= m then.   
0019f20: 2020 2020 2020 2020 2020 2020 6966 206d              if m
0019f30: 203d 206e 2074 6865 6e20 7265 730a 2020   = n then res.  
0019f40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
0019f50: 6520 7265 7320 6e64 6976 2028 496e 7420  e res ndiv (Int 
0019f60: 3220 2a2a 2f20 496e 7428 6d20 2d20 6e29  2 **/ Int(m - n)
0019f70: 290a 2020 2020 2020 2020 2020 2020 2065  ).             e
0019f80: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
0019f90: 2020 206c 6574 2072 6573 203d 2066 206e     let res = f n
0019fa0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
0019fb0: 2020 206d 656d 203a 3d20 286e 2c72 6573     mem := (n,res
0019fc0: 293b 2072 6573 3b3b 0a5c 656e 647b 6c73  ); res;;.\end{ls
0019fd0: 746c 6973 7469 6e67 7d5c 656e 647b 626f  tlisting}\end{bo
0019fe0: 7865 647d 0a0a f0d2 cfd7 c5c4 c5ce cec1  xed}............
0019ff0: d120 cfd0 d4c9 cdc9 dac1 c3c9 d120 c4c5  . ........... ..
001a000: ccc1 c5d4 20d7 d9de c9d3 ccc5 cec9 c520  .... .......... 
001a010: d5d0 cfcd d1ce d5d4 cfc7 cf20 d7d9 dbc5  ........... ....
001a020: 20d0 d2cf c9da d7c5 c4c5 cec9 d120 0ad0   ............ ..
001a030: d2c1 cbd4 c9de c5d3 cbc9 20cd c7ce cfd7  .......... .....
001a040: c5ce ced9 cd2e 20f2 c1d3 d3cd cfd4 d2c9  ...... .........
001a050: cd20 c5dd c520 cec5 d3cb cfcc d8cb cf20  . ... ......... 
001a060: d0d2 c9cd c5d2 cfd7 3a0a 254e 6f77 2074  ........:.%Now t
001a070: 6865 2061 626f 7665 2073 6571 7565 6e63  he above sequenc
001a080: 6520 6f66 206d 756c 7469 706c 6963 6174  e of multiplicat
001a090: 696f 6e73 2069 7320 696e 7374 616e 7461  ions is instanta
001a0a0: 6e65 6f75 732e 2048 6572 6520 6172 6520  neous. Here are 
001a0b0: 6120 6665 7720 6d6f 7265 0a25 6578 616d  a few more.%exam
001a0c0: 706c 6573 3a0a 250a 5c62 6567 696e 7b62  ples:.%.\begin{b
001a0d0: 6f78 6564 7d5c 6265 6769 6e7b 7665 7262  oxed}\begin{verb
001a0e0: 6174 696d 7d0a 2020 236c 6574 2070 6931  atim}.  #let pi1
001a0f0: 203d 2072 6561 6c5f 6469 7620 2872 6561   = real_div (rea
001a100: 6c5f 6f66 5f69 6e74 2032 3229 2028 7265  l_of_int 22) (re
001a110: 616c 5f6f 665f 696e 7420 3729 3b3b 0a20  al_of_int 7);;. 
001a120: 2070 6931 203a 2069 6e74 202d 3e20 6e75   pi1 : int -> nu
001a130: 6d20 3d20 3c66 756e 3e0a 2020 2376 6965  m = <fun>.  #vie
001a140: 7720 7069 3120 3130 3b3b 0a20 2069 7420  w pi1 10;;.  it 
001a150: 3a20 7374 7269 6e67 203d 2022 2b33 2e31  : string = "+3.1
001a160: 3432 3835 3731 3432 3922 0a20 2023 6c65  428571429".  #le
001a170: 7420 7069 3220 3d20 7265 616c 5f64 6976  t pi2 = real_div
001a180: 2028 7265 616c 5f6f 665f 696e 7420 3335   (real_of_int 35
001a190: 3529 2028 7265 616c 5f6f 665f 696e 7420  5) (real_of_int 
001a1a0: 3131 3329 3b3b 0a20 2070 6932 203a 2069  113);;.  pi2 : i
001a1b0: 6e74 202d 3e20 6e75 6d20 3d20 3c66 756e  nt -> num = <fun
001a1c0: 3e0a 2020 2376 6965 7720 7069 3220 3130  >.  #view pi2 10
001a1d0: 3b3b 0a20 2069 7420 3a20 7374 7269 6e67  ;;.  it : string
001a1e0: 203d 2022 2b33 2e31 3431 3539 3239 3230   = "+3.141592920
001a1f0: 3422 0a20 2023 6c65 7420 7069 6469 6666  4".  #let pidiff
001a200: 203d 2072 6561 6c5f 7375 6220 7069 3120   = real_sub pi1 
001a210: 7069 323b 3b0a 2020 7069 6469 6666 203a  pi2;;.  pidiff :
001a220: 2069 6e74 202d 3e20 6e75 6d20 3d20 3c66   int -> num = <f
001a230: 756e 3e0a 2020 2376 6965 7720 7069 6469  un>.  #view pidi
001a240: 6666 2032 303b 3b0a 2020 6974 203a 2073  ff 20;;.  it : s
001a250: 7472 696e 6720 3d20 222b 302e 3030 3132  tring = "+0.0012
001a260: 3634 3232 3235 3033 3136 3035 3536 3236  6422250316055626
001a270: 220a 2020 236c 6574 2069 7069 6469 6666  ".  #let ipidiff
001a280: 203d 2072 6561 6c5f 696e 7620 7069 6469   = real_inv pidi
001a290: 6666 3b3b 0a20 2069 7069 6469 6666 203a  ff;;.  ipidiff :
001a2a0: 2069 6e74 202d 3e20 6e75 6d20 3d20 3c66   int -> num = <f
001a2b0: 756e 3e0a 2020 2376 6965 7720 6970 6964  un>.  #view ipid
001a2c0: 6966 6620 3230 3b3b 0a20 2069 7420 3a20  iff 20;;.  it : 
001a2d0: 7374 7269 6e67 203d 2022 2b37 3931 2e30  string = "+791.0
001a2e0: 3030 3030 3030 3030 3030 3030 3030 3030  0000000000000000
001a2f0: 3030 3022 0a5c 656e 647b 7665 7262 6174  000".\end{verbat
001a300: 696d 7d5c 656e 647b 626f 7865 647d 0a0a  im}\end{boxed}..
001a310: f720 dac1 cbcc c0de c5ce c9c5 20cf d4cd  . .......... ...
001a320: c5d4 c9cd 2c20 ded4 cf20 d7d3 c520 d2c1  ...., ... ... ..
001a330: d3de c5d4 d92c 20d0 d2c9 d7c5 c4c5 cece  ....., .........
001a340: d9c5 20d7 20c4 c1ce cecf cd20 d2c1 dac4  .. . ...... ....
001a350: c5cc c52c 20cd cfd6 cecf 2c0a c2c5 dad5  ..., .....,.....
001a360: d3cc cfd7 cecf 2c20 d0d2 cfc4 c5cc c1d4  ......, ........
001a370: d820 c920 d720 d2c1 c3c9 cfce c1cc d8ce  . . . ..........
001a380: cfca 20c1 d2c9 c6cd c5d4 c9cb c52e 20ee  .. ........... .
001a390: cf20 cec1 20c4 c5cc c520 cdcf d6c5 d420  . .. .... ..... 
001a3a0: cfcb c1da c1d4 d8d3 d12c 200a ded4 cf20  ........., .... 
001a3b0: cec1 db20 d0cf c4c8 cfc4 20c2 cfcc c5c5  ... ...... .....
001a3c0: 20dc c6c6 c5cb d4c9 d7c5 ce20 d720 cec5   .......... . ..
001a3d0: cbcf d4cf d2d9 c820 d3c9 d4d5 c1c3 c9d1  ....... ........
001a3e0: c82c 20d4 c1cb 20cb c1cb 20cf ce20 200a  ., ... ... ..  .
001a3f0: c9da c2c1 d7cc d1c5 d420 cfd4 20d3 d7cf  ......... .. ...
001a400: cad3 d4d7 c5ce cecf c7cf 20d7 d9de c9d3  .......... .....
001a410: ccc5 cec9 d1cd 20d7 20d2 c1c3 c9cf cec1  ...... . .......
001a420: ccd8 ced9 c820 dec9 d3cc c1c8 20cc c1d7  ..... ...... ...
001a430: c9ce cfcf c2d2 c1da cecf c7cf 200a d2cf  ............ ...
001a440: d3d4 c120 dec9 d3cc c9d4 c5cc c5ca 20c9  ... .......... .
001a450: 20da cec1 cdc5 cec1 d4c5 ccc5 ca2c 20cb   ............, .
001a460: cfd4 cfd2 d9ca 20c1 c2d3 cfcc c0d4 cecf  ...... .........
001a470: 20c9 dac2 d9d4 cfde c5ce 2c20 cbcf c7c4   ........., ....
001a480: c120 cec1 cd0a ced5 d6ce cf20 ccc9 dbd8  . ......... ....
001a490: 20d0 d2c9 c2cc c9d6 c5ce cecf c520 dace   ............ ..
001a4a0: c1de c5ce c9c5 20d2 c5da d5cc d8d4 c1d4  ...... .........
001a4b0: c12e 20ef c4ce c1cb cf2c 20d0 d2c5 c4cc  .. ......, .....
001a4c0: cfd6 c5ce ced9 ca20 cdc5 d4cf c420 0ad2  ....... ..... ..
001a4d0: c1d3 cbd2 d9d7 c1c5 d420 d720 d0cf ccce  ......... . ....
001a4e0: cfca 20cd c5d2 c520 d3d7 cfc9 20c4 cfd3  .. .... .... ...
001a4f0: d4cf c9ce d3d4 d7c1 20cc c9db d820 d4cf  ........ .... ..
001a500: c7c4 c12c 20cb cfc7 c4c1 20ce c1cd 20d0  ..., ..... ... .
001a510: cfd4 d2c5 c2d5 c5d4 d3d1 0ad7 d7c5 d3d4  ................
001a520: c920 d4d2 c1ce d3c3 c5ce c4c5 ced4 ced9  . ..............
001a530: c520 c6d5 cecb c3c9 c920 cec1 d0cf c4cf  . ....... ......
001a540: c2c9 c57e 245c 6578 7024 2c20 245c 7369  ...~$\exp$, $\si
001a550: 6e24 20c9 7ed4 2e7e c42e 20fc d4cf d420  n$ .~..~.. .... 
001a560: d7cf d0d2 cfd3 0ada c4c5 d3d8 20d2 c1d3  ............ ...
001a570: d3cd c1d4 d2c9 d7c1 d4d8 d3d1 20ce c520  ............ .. 
001a580: c2d5 c4c5 d420 d7d7 c9c4 d520 cfc7 d2c1  ..... ..... ....
001a590: cec9 dec5 cec9 ca20 cec1 20cf c2df c5cd  ....... .. .....
001a5a0: 20cb d5d2 d3c1 2c20 cecf 20cd cfd6 c5d4   ....., .. .....
001a5b0: 0acf cbc1 dac1 d4d8 d3d1 20c9 ced4 c5d2  .......... .....
001a5c0: c5d3 ced9 cd20 d720 cbc1 dec5 d3d4 d7c5  ..... . ........
001a5d0: 20d5 d0d2 c1d6 cec5 cec9 d12e 20ef c4ce   ........... ...
001a5e0: c9cd 20c9 da20 d0cf c4c8 cfc4 cfd7 20d1  .. .. ........ .
001a5f0: d7cc d1c5 d4d3 d120 0ad0 d2c9 cdc5 cec5  ....... ........
001a600: cec9 c520 dec1 d3d4 c9de ced9 c820 d3d5  ... ......... ..
001a610: cdcd 20d3 cfcf d4d7 c5d4 d3d4 d7d5 c0dd  .. .............
001a620: c9c8 20d2 d1c4 cfd7 20f4 c5ca cccf d2c1  .. ..... .......
001a630: 2e20 efd4 cdc5 d4c9 cd2c 20de d4cf 20cb  . ......., ... .
001a640: cfce c5de ced9 c50a d3d5 cdcd d920 cdcf  ............. ..
001a650: c7d5 d420 c2d9 d4d8 20d7 d9de c9d3 ccc5  ... .... .......
001a660: ced9 20ce c1d0 d2d1 cdd5 c020 d7cd c5d3  .. ........ ....
001a670: d4cf 20c9 d4c5 d2c1 d4c9 d7ce cfc7 cf20  .. ............ 
001a680: d0d2 c9cd c5ce c5ce c9d1 20c6 d5ce cbc3  .......... .....
001a690: c9c9 0ad3 cccf d6c5 cec9 d17e 2d2d 2d20  ...........~--- 
001a6a0: dcd4 cf20 d3d5 ddc5 d3d4 d7c5 cece cf20  ... ........... 
001a6b0: d5cc d5de dbc1 c5d4 20c9 c820 d4cf dece  ........ .. ....
001a6c0: cfd3 d4d8 2e0a 254f 6620 636f 7572 7365  ......%Of course
001a6d0: 2c20 6576 6572 7974 6869 6e67 2077 6520  , everything we 
001a6e0: 6861 7665 2064 6f6e 6520 746f 2064 6174  have done to dat
001a6f0: 6520 636f 756c 6420 6265 2064 6f6e 6520  e could be done 
001a700: 7769 7468 2072 6174 696f 6e61 6c0a 2561  with rational.%a
001a710: 7269 7468 6d65 7469 632e 2041 6374 7561  rithmetic. Actua
001a720: 6c6c 792c 2069 7420 6d61 7920 6861 7070  lly, it may happ
001a730: 656e 2074 6861 7420 6f75 7220 6170 7072  en that our appr
001a740: 6f61 6368 2069 7320 6d6f 7265 2065 6666  oach is more eff
001a750: 6963 6965 6e74 2069 6e0a 2563 6572 7461  icient in.%certa
001a760: 696e 2073 6974 7561 7469 6f6e 7320 7369  in situations si
001a770: 6e63 6520 7765 2061 766f 6964 2063 616c  nce we avoid cal
001a780: 6375 6c61 7469 6e67 206e 756d 6265 7273  culating numbers
001a790: 2074 6861 7420 6d69 6768 7420 6861 7665   that might have
001a7a0: 2069 6d6d 656e 7365 0a25 6e75 6d65 7261   immense.%numera
001a7b0: 746f 7273 2061 6e64 2064 656e 6f6d 696e  tors and denomin
001a7c0: 6174 6f72 7320 7768 656e 2077 6520 6a75  ators when we ju
001a7d0: 7374 206e 6565 6420 616e 2061 7070 726f  st need an appro
001a7e0: 7869 6d61 7469 6f6e 2e20 4e65 7665 7274  ximation. Nevert
001a7f0: 6865 6c65 7373 2c0a 2574 6865 2070 7265  heless,.%the pre
001a800: 7365 6e74 2061 7070 726f 6163 6820 7265  sent approach re
001a810: 616c 6c79 2063 6f6d 6573 2069 6e74 6f20  ally comes into 
001a820: 6974 7320 6f77 6e20 7768 656e 2077 6520  its own when we 
001a830: 7761 6e74 2074 6f20 6465 6669 6e65 0a25  want to define.%
001a840: 7472 616e 7363 656e 6465 6e74 616c 2066  transcendental f
001a850: 756e 6374 696f 6e73 206c 696b 6520 2465  unctions like $e
001a860: 7870 242c 2024 7369 6e24 2065 7463 2e20  xp$, $sin$ etc. 
001a870: 5765 2077 696c 6c20 6e6f 7420 636f 7665  We will not cove
001a880: 7220 7468 6973 2069 6e0a 2564 6574 6169  r this in.%detai
001a890: 6c20 666f 7220 6c61 636b 206f 6620 7370  l for lack of sp
001a8a0: 6163 652c 2062 7574 2069 7420 6d61 6b65  ace, but it make
001a8b0: 7320 616e 2069 6e74 6572 6573 7469 6e67  s an interesting
001a8c0: 2065 7865 7263 6973 652e 204f 6e65 2061   exercise. One a
001a8d0: 7070 726f 6163 6820 6973 0a25 746f 2075  pproach is.%to u
001a8e0: 7365 2074 7275 6e63 6174 6564 2054 6179  se truncated Tay
001a8f0: 6c6f 7220 7365 7269 6573 2e20 4e6f 7465  lor series. Note
001a900: 2074 6861 7420 6669 6e69 7465 2073 756d   that finite sum
001a910: 6d61 7469 6f6e 7320 6361 6e20 6265 2065  mations can be e
001a920: 7661 6c75 6174 6564 0a25 6469 7265 6374  valuated.%direct
001a930: 6c79 2072 6174 6865 7220 7468 616e 2062  ly rather than b
001a940: 7920 6974 6572 6174 696e 6720 7468 6520  y iterating the 
001a950: 6164 6469 7469 6f6e 2066 756e 6374 696f  addition functio
001a960: 6e3b 2074 6869 7320 6c65 6164 7320 746f  n; this leads to
001a970: 206d 7563 680a 2562 6574 7465 7220 6572   much.%better er
001a980: 726f 7220 6265 6861 7669 6f75 722e 0a0a  ror behaviour...
001a990: 5c73 6563 7469 6f6e 7b50 726f 6c6f 6720  \section{Prolog 
001a9a0: 616e 6420 7468 656f 7265 6d20 7072 6f76  and theorem prov
001a9b0: 696e 677d 0a0a 5468 6520 6c61 6e67 7561  ing}..The langua
001a9c0: 6765 2050 726f 6c6f 6720 6973 2070 6f70  ge Prolog is pop
001a9d0: 756c 6172 2069 6e20 4172 7469 6669 6369  ular in Artifici
001a9e0: 616c 2049 6e74 656c 6c69 6765 6e63 6520  al Intelligence 
001a9f0: 7265 7365 6172 6368 2c20 616e 6420 6973  research, and is
001aa00: 2075 7365 640a 696e 2076 6172 696f 7573   used.in various
001aa10: 2070 7261 6374 6963 616c 2061 7070 6c69   practical appli
001aa20: 6361 7469 6f6e 7320 7375 6368 2061 7320  cations such as 
001aa30: 6578 7065 7274 2073 7973 7465 6d73 2061  expert systems a
001aa40: 6e64 2069 6e74 656c 6c69 6765 6e74 0a64  nd intelligent.d
001aa50: 6174 6162 6173 6573 2e20 4865 7265 2077  atabases. Here w
001aa60: 6520 7769 6c6c 2073 686f 7720 686f 7720  e will show how 
001aa70: 7468 6520 6d61 696e 206d 6563 6861 6e69  the main mechani
001aa80: 736d 206f 6620 5072 6f6c 6f67 2c20 6e61  sm of Prolog, na
001aa90: 6d65 6c79 0a64 6570 7468 2d66 6972 7374  mely.depth-first
001aaa0: 2073 6561 7263 6820 7468 726f 7567 6820   search through 
001aab0: 6120 6461 7461 6261 7365 206f 6620 7275  a database of ru
001aac0: 6c65 7320 7573 696e 6720 756e 6966 6963  les using unific
001aad0: 6174 696f 6e20 616e 640a 6261 636b 7472  ation and.backtr
001aae0: 6163 6b69 6e67 2c20 6361 6e20 6265 2069  acking, can be i
001aaf0: 6d70 6c65 6d65 6e74 6564 2069 6e20 4d4c  mplemented in ML
001ab00: 2e20 5765 2064 6f20 6e6f 7420 7072 6574  . We do not pret
001ab10: 656e 6420 7468 6174 2074 6869 7320 6973  end that this is
001ab20: 2061 0a66 756c 6c2d 626c 6f77 6e20 696d   a.full-blown im
001ab30: 706c 656d 656e 7461 7469 6f6e 206f 6620  plementation of 
001ab40: 5072 6f6c 6f67 2c20 6275 7420 6974 2067  Prolog, but it g
001ab50: 6976 6573 2061 6e20 6163 6375 7261 7465  ives an accurate
001ab60: 2070 6963 7475 7265 206f 6620 7468 650a   picture of the.
001ab70: 6765 6e65 7261 6c20 666c 6176 6f75 7220  general flavour 
001ab80: 6f66 2074 6865 206c 616e 6775 6167 652c  of the language,
001ab90: 2061 6e64 2077 6520 7769 6c6c 2062 6520   and we will be 
001aba0: 6162 6c65 2074 6f20 7275 6e20 736f 6d65  able to run some
001abb0: 2073 696d 706c 650a 6578 616d 706c 6573   simple.examples
001abc0: 2069 6e20 6f75 7220 7379 7374 656d 2e0a   in our system..
001abd0: 0a5c 7375 6273 6563 7469 6f6e 7b50 726f  .\subsection{Pro
001abe0: 6c6f 6720 7465 726d 737d 0a0a 5072 6f6c  log terms}..Prol
001abf0: 6f67 2063 6f64 6520 616e 6420 6461 7461  og code and data
001ac00: 2069 7320 7265 7072 6573 656e 7465 6420   is represented 
001ac10: 7573 696e 6720 6120 756e 6966 6f72 6d20  using a uniform 
001ac20: 7379 7374 656d 206f 6620 6669 7273 7420  system of first 
001ac30: 6f72 6465 720a 7465 726d 732e 2057 6520  order.terms. We 
001ac40: 6861 7665 2061 6c72 6561 6479 2064 6566  have already def
001ac50: 696e 6564 2061 2074 7970 6520 6f66 2074  ined a type of t
001ac60: 6572 6d73 2066 6f72 206f 7572 206d 6174  erms for our mat
001ac70: 6865 6d61 7469 6361 6c0a 6578 7072 6573  hematical.expres
001ac80: 7369 6f6e 732c 2061 6e64 2061 7373 6f63  sions, and assoc
001ac90: 6961 7465 6420 7061 7273 6572 7320 616e  iated parsers an
001aca0: 6420 7072 696e 7465 7273 2e20 4865 7265  d printers. Here
001acb0: 2077 6520 7769 6c6c 2075 7365 2073 6f6d   we will use som
001acc0: 6574 6869 6e67 0a73 696d 696c 6172 2c20  ething.similar, 
001acd0: 6275 7420 6e6f 7420 7175 6974 6520 7468  but not quite th
001ace0: 6520 7361 6d65 2e20 4669 7273 7420 6f66  e same. First of
001acf0: 2061 6c6c 2c20 6974 2073 696d 706c 6966   all, it simplif
001ad00: 6965 7320 736f 6d65 206f 6620 7468 6520  ies some of the 
001ad10: 636f 6465 0a69 6620 7765 2074 7265 6174  code.if we treat
001ad20: 2063 6f6e 7374 616e 7473 2061 7320 6e75   constants as nu
001ad30: 6c6c 6172 7920 6675 6e63 7469 6f6e 732c  llary functions,
001ad40: 2069 2e65 2e20 6675 6e63 7469 6f6e 7320   i.e. functions 
001ad50: 7468 6174 2074 616b 6520 616e 2065 6d70  that take an emp
001ad60: 7479 0a6c 6973 7420 6f66 2061 7267 756d  ty.list of argum
001ad70: 656e 7473 2e20 4163 636f 7264 696e 676c  ents. Accordingl
001ad80: 7920 7765 2064 6566 696e 653a 0a0a 5c62  y we define:..\b
001ad90: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
001ada0: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
001adb0: 7479 7065 2074 6572 6d20 3d20 5661 7220  type term = Var 
001adc0: 6f66 2073 7472 696e 670a 2020 2020 2020  of string.      
001add0: 2020 2020 2020 7c20 466e 206f 6620 7374        | Fn of st
001ade0: 7269 6e67 202a 2028 7465 726d 206c 6973  ring * (term lis
001adf0: 7429 3b3b 0a5c 656e 647b 6c73 746c 6973  t);;.\end{lstlis
001ae00: 7469 6e67 7d5c 656e 647b 626f 7865 647d  ting}\end{boxed}
001ae10: 0a0a 5768 6572 6520 7765 2077 6f75 6c64  ..Where we would
001ae20: 2066 6f72 6d65 726c 7920 6861 7665 2075   formerly have u
001ae30: 7365 6420 7b5c 7665 7262 2b43 6f6e 7374  sed {\verb+Const
001ae40: 2073 2b7d 2c20 7765 2077 696c 6c20 6e6f   s+}, we will no
001ae50: 7720 7573 650a 7b5c 7665 7262 2b46 6e28  w use.{\verb+Fn(
001ae60: 732c 5b5d 292b 7d2e 204e 6f74 6520 7468  s,[])+}. Note th
001ae70: 6174 2077 6520 7769 6c6c 2074 7265 6174  at we will treat
001ae80: 2066 756e 6374 696f 6e73 206f 6620 6469   functions of di
001ae90: 6666 6572 656e 7420 6172 6974 6965 730a  fferent arities.
001aea0: 2864 6966 6665 7265 6e74 206e 756d 6265  (different numbe
001aeb0: 7273 206f 6620 6172 6775 6d65 6e74 7329  rs of arguments)
001aec0: 2061 7320 6469 7374 696e 6374 2c20 6576   as distinct, ev
001aed0: 656e 2069 6620 7468 6579 2068 6176 6520  en if they have 
001aee0: 7468 6520 7361 6d65 206e 616d 652e 0a54  the same name..T
001aef0: 6875 7320 7468 6572 6520 6973 206e 6f20  hus there is no 
001af00: 6461 6e67 6572 206f 6620 6f75 7220 636f  danger of our co
001af10: 6e66 7573 696e 6720 636f 6e73 7461 6e74  nfusing constant
001af20: 7320 7769 7468 2074 7275 6520 6675 6e63  s with true func
001af30: 7469 6f6e 732e 0a0a 5c73 7562 7365 6374  tions...\subsect
001af40: 696f 6e7b 4c65 7869 6361 6c20 616e 616c  ion{Lexical anal
001af50: 7973 6973 7d0a 0a49 6e20 6f72 6465 7220  ysis}..In order 
001af60: 746f 2066 6f6c 6c6f 7720 5072 6f6c 6f67  to follow Prolog
001af70: 2063 6f6e 7665 6e74 696f 6e73 2c20 7768   conventions, wh
001af80: 6963 6820 696e 636c 7564 6520 6361 7365  ich include case
001af90: 2073 656e 7369 7469 7669 7479 2c20 7765   sensitivity, we
001afa0: 2061 6c73 6f0a 6d6f 6469 6679 206c 6578   also.modify lex
001afb0: 6963 616c 2061 6e61 6c79 7369 732e 2057  ical analysis. W
001afc0: 6520 7769 6c6c 206e 6f74 2061 7474 656d  e will not attem
001afd0: 7074 2074 6f20 636f 6e66 6f72 6d20 6578  pt to conform ex
001afe0: 6163 746c 7920 746f 2074 6865 2066 756c  actly to the ful
001aff0: 6c0a 6465 7461 696c 7320 6f66 2050 726f  l.details of Pro
001b000: 6c6f 672c 2062 7574 206f 6e65 2066 6561  log, but one fea
001b010: 7475 7265 2069 7320 7665 7279 2069 6d70  ture is very imp
001b020: 6f72 7461 6e74 3a20 616c 7068 616e 756d  ortant: alphanum
001b030: 6572 6963 2069 6465 6e74 6966 6965 7273  eric identifiers
001b040: 0a74 6861 7420 6265 6769 6e20 7769 7468  .that begin with
001b050: 2061 6e20 7b5c 656d 2075 7070 6572 2063   an {\em upper c
001b060: 6173 657d 206c 6574 7465 7220 6f72 2061  ase} letter or a
001b070: 6e20 756e 6465 7273 636f 7265 2061 7265  n underscore are
001b080: 2074 7265 6174 6564 2061 730a 7661 7269   treated as.vari
001b090: 6162 6c65 732c 2077 6869 6c65 206f 7468  ables, while oth
001b0a0: 6572 2061 6c70 6861 6e75 6d65 7269 6320  er alphanumeric 
001b0b0: 6964 656e 7469 6669 6572 732c 2061 6c6f  identifiers, alo
001b0c0: 6e67 2077 6974 6820 6e75 6d65 7261 6c73  ng with numerals
001b0d0: 2c20 6172 650a 7472 6561 7465 6420 6173  , are.treated as
001b0e0: 2063 6f6e 7374 616e 7473 2e20 466f 7220   constants. For 
001b0f0: 6578 616d 706c 6520 7b5c 7665 7262 2b58  example {\verb+X
001b100: 2b7d 2061 6e64 207b 5c76 6572 622b 416e  +} and {\verb+An
001b110: 7377 6572 2b7d 2061 7265 2076 6172 6961  swer+} are varia
001b120: 626c 6573 0a77 6869 6c65 207b 5c76 6572  bles.while {\ver
001b130: 622b 782b 7d20 616e 6420 7b5c 7665 7262  b+x+} and {\verb
001b140: 2b6a 6f68 6e2b 7d20 6172 6520 636f 6e73  +john+} are cons
001b150: 7461 6e74 732e 2057 6520 7769 6c6c 206c  tants. We will l
001b160: 756d 7020 616c 6c20 7379 6d62 6f6c 6963  ump all symbolic
001b170: 0a69 6465 6e74 6966 6965 7273 2074 6f67  .identifiers tog
001b180: 6574 6865 7220 6173 2063 6f6e 7374 616e  ether as constan
001b190: 7473 2074 6f6f 2c20 6275 7420 7765 2077  ts too, but we w
001b1a0: 696c 6c20 6469 7374 696e 6775 6973 6820  ill distinguish 
001b1b0: 7468 6520 7075 6e63 7475 6174 696f 6e0a  the punctuation.
001b1c0: 7379 6d62 6f6c 733a 206c 6566 7420 616e  symbols: left an
001b1d0: 6420 7269 6768 7420 6272 6163 6b65 7473  d right brackets
001b1e0: 2c20 636f 6d6d 6173 2061 6e64 2073 656d  , commas and sem
001b1f0: 6963 6f6c 6f6e 732e 204e 6f6e 2d70 756e  icolons. Non-pun
001b200: 6374 7561 7469 6f6e 0a73 796d 626f 6c73  ctuation.symbols
001b210: 2061 7265 2063 6f6c 6c65 6374 6564 2074   are collected t
001b220: 6f67 6574 6865 7220 696e 746f 2074 6865  ogether into the
001b230: 206c 6f6e 6765 7374 2073 7472 696e 6773   longest strings
001b240: 2070 6f73 7369 626c 652c 2073 6f20 7379   possible, so sy
001b250: 6d62 6f6c 6963 0a69 6465 6e74 6966 6965  mbolic.identifie
001b260: 7273 206e 6565 6420 6e6f 7420 636f 6e73  rs need not cons
001b270: 6973 7420 6f6e 6c79 206f 6620 6f6e 6520  ist only of one 
001b280: 6368 6172 6163 7465 722e 0a0a 5c62 6567  character...\beg
001b290: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
001b2a0: 6c73 746c 6973 7469 6e67 7d0a 2020 7479  lstlisting}.  ty
001b2b0: 7065 2074 6f6b 656e 203d 2056 6172 6961  pe token = Varia
001b2c0: 626c 6520 6f66 2073 7472 696e 670a 2020  ble of string.  
001b2d0: 2020 2020 2020 2020 2020 207c 2043 6f6e             | Con
001b2e0: 7374 616e 7420 6f66 2073 7472 696e 670a  stant of string.
001b2f0: 2020 2020 2020 2020 2020 2020 207c 2050               | P
001b300: 756e 6374 206f 6620 7374 7269 6e67 3b3b  unct of string;;
001b310: 0a5c 656e 647b 6c73 746c 6973 7469 6e67  .\end{lstlisting
001b320: 7d5c 656e 647b 626f 7865 647d 0a0a 5c6e  }\end{boxed}..\n
001b330: 6f69 6e64 656e 7420 5468 6520 6c65 7865  oindent The lexe
001b340: 7220 7468 6572 6566 6f72 6520 6c6f 6f6b  r therefore look
001b350: 7320 6c69 6b65 2074 6869 733a 0a0a 5c62  s like this:..\b
001b360: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
001b370: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
001b380: 6c65 7420 6c65 7820 3d0a 2020 2020 6c65  let lex =.    le
001b390: 7420 7365 7665 7261 6c20 7020 3d20 6d61  t several p = ma
001b3a0: 6e79 2028 736f 6d65 2070 2920 696e 0a20  ny (some p) in. 
001b3b0: 2020 206c 6574 2063 6f6c 6c65 6374 2868     let collect(h
001b3c0: 2c74 2920 3d20 685e 2869 746c 6973 7420  ,t) = h^(itlist 
001b3d0: 2870 7265 6669 7820 5e29 2074 2022 2229  (prefix ^) t "")
001b3e0: 2069 6e0a 2020 2020 6c65 7420 7570 7065   in.    let uppe
001b3f0: 725f 616c 7068 6120 7320 3d20 2241 2220  r_alpha s = "A" 
001b400: 3c3d 2073 2026 2073 203c 3d20 225a 2220  <= s & s <= "Z" 
001b410: 6f72 2073 203d 2022 5f22 0a20 2020 2061  or s = "_".    a
001b420: 6e64 206c 6f77 6572 5f61 6c70 6861 2073  nd lower_alpha s
001b430: 203d 2022 6122 203c 3d20 7320 2620 7320   = "a" <= s & s 
001b440: 3c3d 2022 7a22 206f 7220 2230 2220 3c3d  <= "z" or "0" <=
001b450: 2073 2026 2073 203c 3d20 2239 220a 2020   s & s <= "9".  
001b460: 2020 616e 6420 7075 6e63 7420 7320 3d20    and punct s = 
001b470: 7320 3d20 2228 2220 6f72 2073 203d 2022  s = "(" or s = "
001b480: 2922 206f 7220 7320 3d20 225b 2220 6f72  )" or s = "[" or
001b490: 2073 203d 2022 5d22 0a20 2020 2020 2020   s = "]".       
001b4a0: 2020 2020 2020 2020 2020 206f 7220 7320             or s 
001b4b0: 3d20 222c 2220 6f72 2073 203d 2022 2e22  = "," or s = "."
001b4c0: 0a20 2020 2061 6e64 2073 7061 6365 2073  .    and space s
001b4d0: 203d 2073 203d 2022 2022 206f 7220 7320   = s = " " or s 
001b4e0: 3d20 225c 6e22 206f 7220 7320 3d20 225c  = "\n" or s = "\
001b4f0: 7422 2069 6e0a 2020 2020 6c65 7420 616c  t" in.    let al
001b500: 7068 616e 756d 6572 6963 2073 203d 2075  phanumeric s = u
001b510: 7070 6572 5f61 6c70 6861 2073 206f 7220  pper_alpha s or 
001b520: 6c6f 7765 725f 616c 7068 6120 7320 696e  lower_alpha s in
001b530: 0a20 2020 206c 6574 2073 796d 626f 6c69  .    let symboli
001b540: 6320 7320 3d20 6e6f 7420 7370 6163 6520  c s = not space 
001b550: 7320 2620 6e6f 7420 616c 7068 616e 756d  s & not alphanum
001b560: 6572 6963 2073 2026 206e 6f74 2070 756e  eric s & not pun
001b570: 6374 2073 2069 6e0a 2020 2020 6c65 7420  ct s in.    let 
001b580: 7261 7776 6172 6961 626c 6520 3d0a 2020  rawvariable =.  
001b590: 2020 2020 736f 6d65 2075 7070 6572 5f61      some upper_a
001b5a0: 6c70 6861 202b 2b20 7365 7665 7261 6c20  lpha ++ several 
001b5b0: 616c 7068 616e 756d 6572 6963 203e 3e20  alphanumeric >> 
001b5c0: 2856 6172 6961 626c 6520 6f20 636f 6c6c  (Variable o coll
001b5d0: 6563 7429 0a20 2020 2061 6e64 2072 6177  ect).    and raw
001b5e0: 636f 6e73 7461 6e74 203d 0a20 2020 2020  constant =.     
001b5f0: 2028 736f 6d65 206c 6f77 6572 5f61 6c70   (some lower_alp
001b600: 6861 202b 2b20 7365 7665 7261 6c20 616c  ha ++ several al
001b610: 7068 616e 756d 6572 6963 207c 7c0a 2020  phanumeric ||.  
001b620: 2020 2020 2073 6f6d 6520 7379 6d62 6f6c       some symbol
001b630: 6963 202b 2b20 7365 7665 7261 6c20 7379  ic ++ several sy
001b640: 6d62 6f6c 6963 2920 3e3e 2028 436f 6e73  mbolic) >> (Cons
001b650: 7461 6e74 206f 2063 6f6c 6c65 6374 290a  tant o collect).
001b660: 2020 2020 616e 6420 7261 7770 756e 6374      and rawpunct
001b670: 203d 2073 6f6d 6520 7075 6e63 7420 3e3e   = some punct >>
001b680: 2020 5075 6e63 7420 696e 0a20 2020 206c    Punct in.    l
001b690: 6574 2074 6f6b 656e 203d 0a20 2020 2020  et token =.     
001b6a0: 2028 7261 7776 6172 6961 626c 6520 7c7c   (rawvariable ||
001b6b0: 2072 6177 636f 6e73 7461 6e74 207c 7c20   rawconstant || 
001b6c0: 7261 7770 756e 6374 2920 2b2b 0a20 2020  rawpunct) ++.   
001b6d0: 2020 2073 6576 6572 616c 2073 7061 6365     several space
001b6e0: 203e 3e20 6673 7420 696e 0a20 2020 206c   >> fst in.    l
001b6f0: 6574 2074 6f6b 656e 7320 3d20 2873 6576  et tokens = (sev
001b700: 6572 616c 2073 7061 6365 202b 2b20 6d61  eral space ++ ma
001b710: 6e79 2074 6f6b 656e 2920 3e3e 2073 6e64  ny token) >> snd
001b720: 2069 6e0a 2020 2020 6c65 7420 616c 6c74   in.    let allt
001b730: 6f6b 656e 7320 3d20 2874 6f6b 656e 7320  okens = (tokens 
001b740: 2b2b 2066 696e 6973 6865 6429 203e 3e20  ++ finished) >> 
001b750: 6673 7420 696e 0a20 2020 2066 7374 206f  fst in.    fst o
001b760: 2061 6c6c 746f 6b65 6e73 206f 2065 7870   alltokens o exp
001b770: 6c6f 6465 3b3b 0a5c 656e 647b 6c73 746c  lode;;.\end{lstl
001b780: 6973 7469 6e67 7d5c 656e 647b 626f 7865  isting}\end{boxe
001b790: 647d 0a0a 5c6e 6f69 6e64 656e 7420 466f  d}..\noindent Fo
001b7a0: 7220 6578 616d 706c 653a 0a0a 5c62 6567  r example:..\beg
001b7b0: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
001b7c0: 7665 7262 6174 696d 7d0a 2020 236c 6578  verbatim}.  #lex
001b7d0: 2022 6164 6428 582c 592c 5a29 203a 2d20   "add(X,Y,Z) :- 
001b7e0: 5820 6973 2059 2b5a 2e22 3b3b 0a20 202d  X is Y+Z.";;.  -
001b7f0: 203a 2074 6f6b 656e 206c 6973 7420 3d0a   : token list =.
001b800: 2020 205b 436f 6e73 7461 6e74 2022 6164     [Constant "ad
001b810: 6422 3b20 5075 6e63 7420 2228 223b 2056  d"; Punct "("; V
001b820: 6172 6961 626c 6520 2258 223b 2050 756e  ariable "X"; Pun
001b830: 6374 2022 2c22 3b0a 2020 2020 5661 7269  ct ",";.    Vari
001b840: 6162 6c65 2022 5922 3b20 5075 6e63 7420  able "Y"; Punct 
001b850: 222c 223b 2056 6172 6961 626c 6520 225a  ","; Variable "Z
001b860: 223b 2050 756e 6374 2022 2922 3b0a 2020  "; Punct ")";.  
001b870: 2020 436f 6e73 7461 6e74 2022 3a2d 223b    Constant ":-";
001b880: 2056 6172 6961 626c 6520 2258 223b 2043   Variable "X"; C
001b890: 6f6e 7374 616e 7420 2269 7322 3b20 5661  onstant "is"; Va
001b8a0: 7269 6162 6c65 2022 5922 3b0a 2020 2020  riable "Y";.    
001b8b0: 436f 6e73 7461 6e74 2022 2b22 3b20 5661  Constant "+"; Va
001b8c0: 7269 6162 6c65 2022 5a22 3b20 5075 6e63  riable "Z"; Punc
001b8d0: 7420 222e 225d 0a5c 656e 647b 7665 7262  t "."].\end{verb
001b8e0: 6174 696d 7d5c 656e 647b 626f 7865 647d  atim}\end{boxed}
001b8f0: 0a0a 5c73 7562 7365 6374 696f 6e7b 5061  ..\subsection{Pa
001b900: 7273 696e 677d 0a0a 5468 6520 6261 7369  rsing}..The basi
001b910: 6320 7061 7273 6572 2069 7320 7072 6574  c parser is pret
001b920: 7479 206d 7563 6820 7468 6520 7361 6d65  ty much the same
001b930: 2061 7320 6265 666f 7265 3b20 7468 6520   as before; the 
001b940: 7072 696e 7465 7220 6973 2065 7861 6374  printer is exact
001b950: 6c79 2074 6865 0a73 616d 652e 2054 6865  ly the.same. The
001b960: 206d 6169 6e20 6d6f 6469 6669 6361 7469   main modificati
001b970: 6f6e 2074 6f20 7468 6520 7072 696e 7465  on to the printe
001b980: 7220 6973 2074 6861 7420 7765 2061 6c6c  r is that we all
001b990: 6f77 2050 726f 6c6f 6720 6c69 7374 7320  ow Prolog lists 
001b9a0: 746f 2062 650a 7772 6974 7465 6e20 696e  to be.written in
001b9b0: 2061 206d 6f72 6520 636f 6e76 656e 6965   a more convenie
001b9c0: 6e74 206e 6f74 6174 696f 6e2e 2050 726f  nt notation. Pro
001b9d0: 6c6f 6720 6861 7320 602e 2720 616e 6420  log has `.' and 
001b9e0: 606e 696c 2720 636f 7272 6573 706f 6e64  `nil' correspond
001b9f0: 696e 670a 746f 204d 4c27 7320 607b 5c74  ing.to ML's `{\t
001ba00: 7420 3a3a 7d27 2061 6e64 2060 7b5c 7474  t ::}' and `{\tt
001ba10: 205b 5d7d 272c 2061 6e64 2077 6520 7365   []}', and we se
001ba20: 7420 7570 2074 6865 2070 6172 7365 7220  t up the parser 
001ba30: 736f 2074 6861 7420 6c69 7374 7320 6361  so that lists ca
001ba40: 6e0a 6265 2077 7269 7474 656e 206d 7563  n.be written muc
001ba50: 6820 6173 2069 6e20 4d4c 2c20 652e 672e  h as in ML, e.g.
001ba60: 2060 7b5c 7474 205b 312c 322c 335d 7d27   `{\tt [1,2,3]}'
001ba70: 2e20 5765 2061 6c73 6f20 616c 6c6f 7720  . We also allow 
001ba80: 7468 6520 5072 6f6c 6f67 0a6e 6f74 6174  the Prolog.notat
001ba90: 696f 6e20 607b 5c76 6572 622b 5b48 7c54  ion `{\verb+[H|T
001baa0: 5d2b 7d27 2069 6e73 7465 6164 206f 6620  ]+}' instead of 
001bab0: 607b 5c76 6572 622b 636f 6e73 2848 2c54  `{\verb+cons(H,T
001bac0: 292b 7d27 2c20 7479 7069 6361 6c6c 7920  )+}', typically 
001bad0: 7573 6564 2066 6f72 0a70 6174 7465 726e  used for.pattern
001bae0: 2d6d 6174 6368 696e 672e 2041 6674 6572  -matching. After
001baf0: 2074 6865 2062 6173 6963 2066 756e 6374   the basic funct
001bb00: 696f 6e73 3a0a 0a5c 6265 6769 6e7b 626f  ions:..\begin{bo
001bb10: 7865 647d 5c62 6567 696e 7b6c 7374 6c69  xed}\begin{lstli
001bb20: 7374 696e 677d 0a20 206c 6574 2076 6172  sting}.  let var
001bb30: 6961 626c 6520 3d0a 2020 2020 6675 6e20  iable =.    fun 
001bb40: 2856 6172 6961 626c 6520 733a 3a72 6573  (Variable s::res
001bb50: 7429 202d 3e20 732c 7265 7374 0a20 2020  t) -> s,rest.   
001bb60: 2020 207c 205f 202d 3e20 7261 6973 6520     | _ -> raise 
001bb70: 4e6f 7061 7273 653b 3b0a 0a20 206c 6574  Noparse;;..  let
001bb80: 2063 6f6e 7374 616e 7420 3d0a 2020 2020   constant =.    
001bb90: 6675 6e20 2843 6f6e 7374 616e 7420 733a  fun (Constant s:
001bba0: 3a72 6573 7429 202d 3e20 732c 7265 7374  :rest) -> s,rest
001bbb0: 0a20 2020 2020 207c 205f 202d 3e20 7261  .      | _ -> ra
001bbc0: 6973 6520 4e6f 7061 7273 653b 3b0a 5c65  ise Noparse;;.\e
001bbd0: 6e64 7b6c 7374 6c69 7374 696e 677d 5c65  nd{lstlisting}\e
001bbe0: 6e64 7b62 6f78 6564 7d0a 0a5c 6e6f 696e  nd{boxed}..\noin
001bbf0: 6465 6e74 2077 6520 6861 7665 2061 2070  dent we have a p
001bc00: 6172 7365 7220 666f 7220 7465 726d 7320  arser for terms 
001bc10: 616e 6420 616c 736f 2066 6f72 2050 726f  and also for Pro
001bc20: 6c6f 6720 7275 6c65 732c 206f 6620 7468  log rules, of th
001bc30: 6573 6520 666f 726d 733a 0a0a 5c62 6567  ese forms:..\beg
001bc40: 696e 7b65 716e 6172 7261 792a 7d0a 7465  in{eqnarray*}.te
001bc50: 726d 5c6d 626f 787b 2e7d 2020 2020 2620  rm\mbox{.}    & 
001bc60: 2620 2020 2020 2020 2020 2020 2020 2020  &               
001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
001bc80: 2020 2020 2020 2020 2020 2020 2020 5c5c                \\
001bc90: 0a74 6572 6d20 2020 2020 2020 2020 2020  .term           
001bca0: 2026 205c 6d62 6f78 7b20 3a2d 207d 2026   & \mbox{ :- } &
001bcb0: 2074 6572 6d2c 5c6c 646f 7473 2c74 6572   term,\ldots,ter
001bcc0: 6d5c 6d62 6f78 7b2e 7d0a 5c65 6e64 7b65  m\mbox{.}.\end{e
001bcd0: 716e 6172 7261 792a 7d0a 0a5c 6e6f 696e  qnarray*}..\noin
001bce0: 6465 6e74 2054 6865 2070 6172 7365 7273  dent The parsers
001bcf0: 2061 7265 2061 7320 666f 6c6c 6f77 733a   are as follows:
001bd00: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
001bd10: 6265 6769 6e7b 6c73 746c 6973 7469 6e67  begin{lstlisting
001bd20: 7d0a 2020 6c65 7420 7265 6320 6174 6f6d  }.  let rec atom
001bd30: 2069 6e70 7574 0a20 2020 2020 2020 2020   input.         
001bd40: 3d20 2863 6f6e 7374 616e 7420 2b2b 2061  = (constant ++ a
001bd50: 2028 5075 6e63 7420 2228 2229 202b 2b20   (Punct "(") ++ 
001bd60: 7465 726d 6c69 7374 202b 2b20 6120 2850  termlist ++ a (P
001bd70: 756e 6374 2022 2922 290a 2020 2020 2020  unct ")").      
001bd80: 2020 2020 2020 2020 2020 3e3e 2028 6675            >> (fu
001bd90: 6e20 2828 286e 616d 652c 5f29 2c61 7267  n (((name,_),arg
001bda0: 7329 2c5f 2920 2d3e 2046 6e28 6e61 6d65  s),_) -> Fn(name
001bdb0: 2c61 7267 7329 290a 2020 2020 2020 2020  ,args)).        
001bdc0: 207c 7c20 636f 6e73 7461 6e74 0a20 2020   || constant.   
001bdd0: 2020 2020 2020 2020 2020 2020 203e 3e20               >> 
001bde0: 2866 756e 2073 202d 3e20 466e 2873 2c5b  (fun s -> Fn(s,[
001bdf0: 5d29 290a 2020 2020 2020 2020 207c 7c20  ])).         || 
001be00: 7661 7269 6162 6c65 0a20 2020 2020 2020  variable.       
001be10: 2020 2020 2020 2020 203e 3e20 2866 756e           >> (fun
001be20: 2073 202d 3e20 5661 7220 7329 0a20 2020   s -> Var s).   
001be30: 2020 2020 2020 7c7c 2061 2028 5075 6e63        || a (Punc
001be40: 7420 2228 2229 202b 2b20 7465 726d 202b  t "(") ++ term +
001be50: 2b20 6120 2850 756e 6374 2022 2922 290a  + a (Punct ")").
001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
001be70: 3e3e 2028 736e 6420 6f20 6673 7429 0a20  >> (snd o fst). 
001be80: 2020 2020 2020 2020 7c7c 2061 2028 5075          || a (Pu
001be90: 6e63 7420 225b 2229 202b 2b20 6c69 7374  nct "[") ++ list
001bea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
001beb0: 203e 3e20 736e 6429 2069 6e70 7574 0a20   >> snd) input. 
001bec0: 2020 2061 6e64 2074 6572 6d20 696e 7075     and term inpu
001bed0: 7420 3d20 7072 6563 6564 656e 6365 2028  t = precedence (
001bee0: 2169 6e66 6978 6573 2920 6174 6f6d 2069  !infixes) atom i
001bef0: 6e70 7574 0a20 2020 2061 6e64 2074 6572  nput.    and ter
001bf00: 6d6c 6973 7420 696e 7075 740a 2020 2020  mlist input.    
001bf10: 2020 2020 203d 2028 7465 726d 202b 2b20       = (term ++ 
001bf20: 6120 2850 756e 6374 2022 2c22 2920 2b2b  a (Punct ",") ++
001bf30: 2074 6572 6d6c 6973 740a 2020 2020 2020   termlist.      
001bf40: 2020 2020 2020 2020 2020 3e3e 2028 6675            >> (fu
001bf50: 6e20 2828 682c 5f29 2c74 2920 2d3e 2068  n ((h,_),t) -> h
001bf60: 3a3a 7429 0a20 2020 2020 2020 2020 7c7c  ::t).         ||
001bf70: 2074 6572 6d0a 2020 2020 2020 2020 2020   term.          
001bf80: 2020 2020 2020 3e3e 2028 6675 6e20 6820        >> (fun h 
001bf90: 2d3e 205b 685d 2929 2069 6e70 7574 0a20  -> [h])) input. 
001bfa0: 2020 2061 6e64 206c 6973 7420 696e 7075     and list inpu
001bfb0: 740a 2020 2020 2020 2020 203d 2028 7465  t.         = (te
001bfc0: 726d 202b 2b20 2861 2028 436f 6e73 7461  rm ++ (a (Consta
001bfd0: 6e74 2022 7c22 2920 2b2b 2074 6572 6d20  nt "|") ++ term 
001bfe0: 2b2b 2061 2028 5075 6e63 7420 225d 2229  ++ a (Punct "]")
001bff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
001c000: 2020 2020 2020 2020 2020 203e 3e20 2873             >> (s
001c010: 6e64 206f 2066 7374 290a 2020 2020 2020  nd o fst).      
001c020: 2020 2020 2020 2020 2020 2020 7c7c 2061              || a
001c030: 2028 5075 6e63 7420 222c 2229 202b 2b20   (Punct ",") ++ 
001c040: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
001c060: 3e3e 2073 6e64 0a20 2020 2020 2020 2020  >> snd.         
001c070: 2020 2020 2020 2020 207c 7c20 6120 2850           || a (P
001c080: 756e 6374 2022 5d22 290a 2020 2020 2020  unct "]").      
001c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
001c0a0: 2020 2020 3e3e 2028 4b20 2846 6e28 225b      >> (K (Fn("[
001c0b0: 5d22 2c5b 5d29 2929 290a 2020 2020 2020  ]",[])))).      
001c0c0: 2020 2020 2020 2020 2020 3e3e 2028 6675            >> (fu
001c0d0: 6e20 2868 2c74 2920 2d3e 2046 6e28 222e  n (h,t) -> Fn(".
001c0e0: 222c 5b68 3b20 745d 2929 0a20 2020 2020  ",[h; t])).     
001c0f0: 2020 2020 7c7c 2061 2028 5075 6e63 7420      || a (Punct 
001c100: 225d 2229 0a20 2020 2020 2020 2020 2020  "]").           
001c110: 2020 2020 203e 3e20 284b 2028 466e 2822       >> (K (Fn("
001c120: 5b5d 222c 5b5d 2929 2929 2069 6e70 7574  []",[])))) input
001c130: 0a20 2020 2061 6e64 2072 756c 6520 696e  .    and rule in
001c140: 7075 740a 2020 2020 2020 2020 3d20 2874  put.        = (t
001c150: 6572 6d20 2b2b 2028 6120 2850 756e 6374  erm ++ (a (Punct
001c160: 2022 2e22 290a 2020 2020 2020 2020 2020   ".").          
001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
001c180: 3e3e 2028 4b20 5b5d 290a 2020 2020 2020  >> (K []).      
001c190: 2020 2020 2020 2020 2020 207c 7c20 6120             || a 
001c1a0: 2843 6f6e 7374 616e 7420 223a 2d22 2920  (Constant ":-") 
001c1b0: 2b2b 2074 6572 6d20 2b2b 0a20 2020 2020  ++ term ++.     
001c1c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
001c1d0: 616e 7920 2861 2028 5075 6e63 7420 222c  any (a (Punct ",
001c1e0: 2229 202b 2b20 7465 726d 203e 3e20 736e  ") ++ term >> sn
001c1f0: 6429 202b 2b0a 2020 2020 2020 2020 2020  d) ++.          
001c200: 2020 2020 2020 2020 2020 6120 2850 756e            a (Pun
001c210: 6374 2022 2e22 290a 2020 2020 2020 2020  ct ".").        
001c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
001c230: 2020 3e3e 2028 6675 6e20 2828 285f 2c68    >> (fun (((_,h
001c240: 292c 7429 2c5f 2920 2d3e 2068 3a3a 7429  ),t),_) -> h::t)
001c250: 2929 2069 6e70 7574 3b3b 0a0a 2020 6c65  )) input;;..  le
001c260: 7420 7061 7273 655f 7465 726d 203d 2066  t parse_term = f
001c270: 7374 206f 2028 7465 726d 202b 2b20 6669  st o (term ++ fi
001c280: 6e69 7368 6564 203e 3e20 6673 7429 206f  nished >> fst) o
001c290: 206c 6578 3b3b 0a0a 2020 6c65 7420 7061   lex;;..  let pa
001c2a0: 7273 655f 7275 6c65 7320 3d20 6673 7420  rse_rules = fst 
001c2b0: 6f20 286d 616e 7920 7275 6c65 202b 2b20  o (many rule ++ 
001c2c0: 6669 6e69 7368 6564 203e 3e20 6673 7429  finished >> fst)
001c2d0: 206f 206c 6578 3b3b 0a5c 656e 647b 6c73   o lex;;.\end{ls
001c2e0: 746c 6973 7469 6e67 7d5c 656e 647b 626f  tlisting}\end{bo
001c2f0: 7865 647d 0a0a 5c73 7562 7365 6374 696f  xed}..\subsectio
001c300: 6e7b 556e 6966 6963 6174 696f 6e7d 0a0a  n{Unification}..
001c310: 5072 6f6c 6f67 2075 7365 7320 6120 7365  Prolog uses a se
001c320: 7420 6f66 2072 756c 6573 2074 6f20 736f  t of rules to so
001c330: 6c76 6520 6120 6375 7272 656e 7420 7b5c  lve a current {\
001c340: 656d 2067 6f61 6c7d 2062 7920 7472 7969  em goal} by tryi
001c350: 6e67 2074 6f20 6d61 7463 6820 6f6e 650a  ng to match one.
001c360: 6f66 2074 6865 2072 756c 6573 2061 6761  of the rules aga
001c370: 696e 7374 2074 6865 2067 6f61 6c2e 2041  inst the goal. A
001c380: 2072 756c 6520 636f 6e73 6973 7469 6e67   rule consisting
001c390: 206f 6620 6120 7369 6e67 6c65 2074 6572   of a single ter
001c3a0: 6d20 6361 6e20 736f 6c76 6520 610a 676f  m can solve a.go
001c3b0: 616c 2069 6d6d 6564 6961 7465 6c79 2e20  al immediately. 
001c3c0: 496e 2074 6865 2063 6173 6520 6f66 2061  In the case of a
001c3d0: 2072 756c 6520 2474 6572 6d20 5c6d 626f   rule $term \mbo
001c3e0: 787b 203a 2d20 7d0a 7465 726d 5f31 2c5c  x{ :- }.term_1,\
001c3f0: 6c64 6f74 732c 7465 726d 5f6e 5c6d 626f  ldots,term_n\mbo
001c400: 787b 2e7d 242c 2069 6620 7468 6520 676f  x{.}$, if the go
001c410: 616c 206d 6174 6368 6573 2024 7465 726d  al matches $term
001c420: 242c 2074 6865 6e20 5072 6f6c 6f67 206e  $, then Prolog n
001c430: 6565 6473 2074 6f0a 736f 6c76 6520 6561  eeds to.solve ea
001c440: 6368 2024 7465 726d 5f69 2420 6173 2061  ch $term_i$ as a
001c450: 2073 7562 676f 616c 2069 6e20 6f72 6465   subgoal in orde
001c460: 7220 746f 2066 696e 6973 6820 7468 6520  r to finish the 
001c470: 6f72 6967 696e 616c 2067 6f61 6c2e 0a0a  original goal...
001c480: 486f 7765 7665 722c 2067 6f61 6c73 2061  However, goals a
001c490: 6e64 2072 756c 6573 2064 6f20 6e6f 7420  nd rules do not 
001c4a0: 6861 7665 2074 6f20 6265 2065 7861 6374  have to be exact
001c4b0: 6c79 2074 6865 2073 616d 652e 2049 6e73  ly the same. Ins
001c4c0: 7465 6164 2c20 5072 6f6c 6f67 0a61 7373  tead, Prolog.ass
001c4d0: 6967 6e73 2076 6172 6961 626c 6573 2069  igns variables i
001c4e0: 6e20 626f 7468 2074 6865 2067 6f61 6c20  n both the goal 
001c4f0: 616e 6420 7468 6520 7275 6c65 2074 6f20  and the rule to 
001c500: 6d61 6b65 2074 6865 6d20 6d61 7463 6820  make them match 
001c510: 7570 2c20 610a 7072 6f63 6573 7320 6b6e  up, a.process kn
001c520: 6f77 6e20 6173 207b 5c65 6d20 756e 6966  own as {\em unif
001c530: 6963 6174 696f 6e7d 2e20 5468 6973 206d  ication}. This m
001c540: 6561 6e73 2074 6861 7420 7765 2063 616e  eans that we can
001c550: 2065 6e64 2075 7020 7072 6f76 696e 6720   end up proving 
001c560: 610a 7370 6563 6961 6c20 6361 7365 206f  a.special case o
001c570: 6620 7468 6520 6f72 6967 696e 616c 2067  f the original g
001c580: 6f61 6c2c 2065 2e67 2e20 2450 2866 2858  oal, e.g. $P(f(X
001c590: 2929 2420 696e 7374 6561 6420 6f66 0a24  ))$ instead of.$
001c5a0: 5028 5929 242e 2046 6f72 2065 7861 6d70  P(Y)$. For examp
001c5b0: 6c65 3a0a 0a5c 6265 6769 6e7b 6974 656d  le:..\begin{item
001c5c0: 697a 657d 0a0a 5c69 7465 6d20 546f 2075  ize}..\item To u
001c5d0: 6e69 6679 2024 6628 6728 5829 2c59 2924  nify $f(g(X),Y)$
001c5e0: 2061 6e64 2024 6628 6728 6129 2c58 2924   and $f(g(a),X)$
001c5f0: 2077 6520 6361 6e20 7365 740a 2458 203d   we can set.$X =
001c600: 2061 2420 616e 6420 2459 203d 2061 242e   a$ and $Y = a$.
001c610: 2054 6865 6e20 626f 7468 2074 6572 6d73   Then both terms
001c620: 2061 7265 2024 6628 6728 6129 2c61 2924   are $f(g(a),a)$
001c630: 2e0a 0a5c 6974 656d 2054 6f20 756e 6966  ...\item To unif
001c640: 7920 2466 2861 2c58 2c59 2924 2061 6e64  y $f(a,X,Y)$ and
001c650: 2024 6628 582c 612c 5a29 2420 7765 2063   $f(X,a,Z)$ we c
001c660: 616e 2073 6574 2024 580a 3d20 6124 2061  an set $X.= a$ a
001c670: 6e64 2024 5920 3d20 5a24 2c20 616e 6420  nd $Y = Z$, and 
001c680: 7468 656e 2062 6f74 6820 7465 726d 7320  then both terms 
001c690: 6172 6520 2466 2861 2c61 2c5a 2924 2e0a  are $f(a,a,Z)$..
001c6a0: 0a5c 6974 656d 2049 7420 6973 2069 6d70  .\item It is imp
001c6b0: 6f73 7369 626c 6520 746f 2075 6e69 6679  ossible to unify
001c6c0: 2024 6628 5829 2420 616e 6420 2458 242e   $f(X)$ and $X$.
001c6d0: 0a0a 5c65 6e64 7b69 7465 6d69 7a65 7d0a  ..\end{itemize}.
001c6e0: 0a49 6e20 6765 6e65 7261 6c2c 2075 6e69  .In general, uni
001c6f0: 6669 6572 7320 6172 6520 6e6f 7420 756e  fiers are not un
001c700: 6971 7565 2e20 466f 7220 6578 616d 706c  ique. For exampl
001c710: 652c 2069 6e20 7468 6520 7365 636f 6e64  e, in the second
001c720: 2065 7861 6d70 6c65 2077 650a 636f 756c   example we.coul
001c730: 6420 6368 6f6f 7365 2074 6f20 7365 7420  d choose to set 
001c740: 2459 203d 2066 2862 2924 2061 6e64 2024  $Y = f(b)$ and $
001c750: 5a20 3d20 6628 6229 242e 2048 6f77 6576  Z = f(b)$. Howev
001c760: 6572 206f 6e65 2063 616e 2061 6c77 6179  er one can alway
001c770: 7320 6368 6f6f 7365 0a6f 6e65 2074 6861  s choose.one tha
001c780: 7420 6973 207b 5c65 6d20 6d6f 7374 2067  t is {\em most g
001c790: 656e 6572 616c 7d2c 2069 2e65 2e20 616e  eneral}, i.e. an
001c7a0: 7920 6f74 6865 7220 756e 6966 6963 6174  y other unificat
001c7b0: 696f 6e20 6361 6e20 6265 2072 6561 6368  ion can be reach
001c7c0: 6564 2066 726f 6d0a 6974 2062 7920 6675  ed from.it by fu
001c7d0: 7274 6865 7220 696e 7374 616e 7469 6174  rther instantiat
001c7e0: 696f 6e20 2863 6f6d 7061 7265 206d 6f73  ion (compare mos
001c7f0: 7420 6765 6e65 7261 6c20 7479 7065 7320  t general types 
001c800: 696e 204d 4c29 2e20 496e 206f 7264 6572  in ML). In order
001c810: 2074 6f0a 6669 6e64 2069 742c 2072 6f75   to.find it, rou
001c820: 6768 6c79 2073 7065 616b 696e 672c 206f  ghly speaking, o
001c830: 6e65 206e 6565 6420 6f6e 6c79 2064 6573  ne need only des
001c840: 6365 6e64 2074 6865 2074 776f 2074 6572  cend the two ter
001c850: 6d73 2072 6563 7572 7369 7665 6c79 0a69  ms recursively.i
001c860: 6e20 7061 7261 6c6c 656c 2c20 616e 6420  n parallel, and 
001c870: 6f6e 2066 696e 6469 6e67 2061 2076 6172  on finding a var
001c880: 6961 626c 6520 6f6e 2065 6974 6865 7220  iable on either 
001c890: 7369 6465 2c20 6173 7369 676e 7320 6974  side, assigns it
001c8a0: 2074 6f20 7768 6174 6576 6572 0a74 6865   to whatever.the
001c8b0: 2074 6572 6d20 6f6e 2074 6865 206f 7468   term on the oth
001c8c0: 6572 2073 6964 6520 6973 2e20 4f6e 6520  er side is. One 
001c8d0: 616c 736f 206e 6565 6473 2074 6f20 6368  also needs to ch
001c8e0: 6563 6b20 7468 6174 2074 6865 2076 6172  eck that the var
001c8f0: 6961 626c 6520 6861 736e 2774 0a61 6c72  iable hasn't.alr
001c900: 6561 6479 2062 6565 6e20 6173 7369 676e  eady been assign
001c910: 6564 2074 6f20 736f 6d65 7468 696e 6720  ed to something 
001c920: 656c 7365 2c20 616e 6420 7468 6174 2069  else, and that i
001c930: 7420 646f 6573 6e27 7420 6f63 6375 7220  t doesn't occur 
001c940: 696e 2074 6865 2074 6572 6d0a 6265 696e  in the term.bein
001c950: 6720 6173 7369 676e 6564 2074 6f20 6974  g assigned to it
001c960: 2028 6173 2069 6e20 7468 6520 6c61 7374   (as in the last
001c970: 2065 7861 6d70 6c65 2061 626f 7665 292e   example above).
001c980: 2041 2073 696d 706c 6520 696d 706c 656d   A simple implem
001c990: 656e 7461 7469 6f6e 206f 660a 7468 6973  entation of.this
001c9a0: 2069 6465 6120 666f 6c6c 6f77 732e 2057   idea follows. W
001c9b0: 6520 6d61 696e 7461 696e 2061 6e20 6173  e maintain an as
001c9c0: 736f 6369 6174 696f 6e20 6c69 7374 2067  sociation list g
001c9d0: 6976 696e 6720 696e 7374 616e 7469 6174  iving instantiat
001c9e0: 696f 6e73 0a61 6c72 6561 6479 206d 6164  ions.already mad
001c9f0: 652c 2061 6e64 2077 6520 6c6f 6f6b 2065  e, and we look e
001ca00: 6163 6820 7661 7269 6162 6c65 2075 7020  ach variable up 
001ca10: 746f 2073 6565 2069 6620 6974 2069 7320  to see if it is 
001ca20: 616c 7265 6164 7920 6173 7369 676e 6564  already assigned
001ca30: 0a62 6566 6f72 6520 7072 6f63 6565 6469  .before proceedi
001ca40: 6e67 2e20 5765 2075 7365 2074 6865 2065  ng. We use the e
001ca50: 7869 7374 696e 6720 696e 7374 616e 7469  xisting instanti
001ca60: 6174 696f 6e73 2061 7320 616e 2061 6363  ations as an acc
001ca70: 756d 756c 6174 6f72 2e0a 0a5c 6265 6769  umulator...\begi
001ca80: 6e7b 626f 7865 647d 5c62 6567 696e 7b6c  n{boxed}\begin{l
001ca90: 7374 6c69 7374 696e 677d 0a20 206c 6574  stlisting}.  let
001caa0: 2072 6563 2075 6e69 6679 2074 6d31 2074   rec unify tm1 t
001cab0: 6d32 2069 6e73 7473 203d 0a20 2020 206d  m2 insts =.    m
001cac0: 6174 6368 2074 6d31 2077 6974 680a 2020  atch tm1 with.  
001cad0: 2020 2020 5661 7228 7829 202d 3e0a 2020      Var(x) ->.  
001cae0: 2020 2020 2020 2874 7279 206c 6574 2074        (try let t
001caf0: 6d31 2720 3d20 6173 736f 6320 7820 696e  m1' = assoc x in
001cb00: 7374 7320 696e 0a20 2020 2020 2020 2020  sts in.         
001cb10: 2020 2020 756e 6966 7920 746d 3127 2074      unify tm1' t
001cb20: 6d32 2069 6e73 7473 0a20 2020 2020 2020  m2 insts.       
001cb30: 2020 7769 7468 204e 6f74 5f66 6f75 6e64    with Not_found
001cb40: 202d 3e0a 2020 2020 2020 2020 2020 2020   ->.            
001cb50: 2061 7567 6d65 6e74 2028 782c 746d 3229   augment (x,tm2)
001cb60: 2069 6e73 7473 290a 2020 2020 7c20 466e   insts).    | Fn
001cb70: 2866 312c 6172 6773 3129 202d 3e0a 2020  (f1,args1) ->.  
001cb80: 2020 2020 2020 6d61 7463 6820 746d 3220        match tm2 
001cb90: 7769 7468 0a20 2020 2020 2020 2020 2056  with.          V
001cba0: 6172 2879 2920 2d3e 0a20 2020 2020 2020  ar(y) ->.       
001cbb0: 2020 2020 2028 7472 7920 6c65 7420 746d       (try let tm
001cbc0: 3227 203d 2061 7373 6f63 2079 2069 6e73  2' = assoc y ins
001cbd0: 7473 2069 6e0a 2020 2020 2020 2020 2020  ts in.          
001cbe0: 2020 2020 2020 2075 6e69 6679 2074 6d31         unify tm1
001cbf0: 2074 6d32 2720 696e 7374 730a 2020 2020   tm2' insts.    
001cc00: 2020 2020 2020 2020 2077 6974 6820 4e6f           with No
001cc10: 745f 666f 756e 6420 2d3e 0a20 2020 2020  t_found ->.     
001cc20: 2020 2020 2020 2020 2020 2020 6175 676d              augm
001cc30: 656e 7420 2879 2c74 6d31 2920 696e 7374  ent (y,tm1) inst
001cc40: 7329 0a20 2020 2020 2020 207c 2046 6e28  s).        | Fn(
001cc50: 6632 2c61 7267 7332 2920 2d3e 0a20 2020  f2,args2) ->.   
001cc60: 2020 2020 2020 2020 2069 6620 6631 203d           if f1 =
001cc70: 2066 320a 2020 2020 2020 2020 2020 2020   f2.            
001cc80: 7468 656e 2069 746c 6973 7432 2075 6e69  then itlist2 uni
001cc90: 6679 2061 7267 7331 2061 7267 7332 2069  fy args1 args2 i
001cca0: 6e73 7473 0a20 2020 2020 2020 2020 2020  nsts.           
001ccb0: 2065 6c73 6520 7261 6973 6520 2865 7272   else raise (err
001ccc0: 6f72 2022 6675 6e63 7469 6f6e 7320 646f  or "functions do
001ccd0: 206e 6f74 206d 6174 6368 2229 3b3b 0a5c   not match");;.\
001cce0: 656e 647b 6c73 746c 6973 7469 6e67 7d5c  end{lstlisting}\
001ccf0: 656e 647b 626f 7865 647d 0a0a 5c6e 6f69  end{boxed}..\noi
001cd00: 6e64 656e 7420 7768 6572 6520 7468 6520  ndent where the 
001cd10: 696e 7374 616e 7469 6174 696f 6e20 6c69  instantiation li
001cd20: 7374 7320 6e65 6564 2074 6f20 6265 2061  sts need to be a
001cd30: 7567 6d65 6e74 6564 2077 6974 6820 736f  ugmented with so
001cd40: 6d65 2063 6172 6520 746f 0a61 766f 6964  me care to.avoid
001cd50: 2074 6865 2073 6f2d 6361 6c6c 6564 2060   the so-called `
001cd60: 6f63 6375 7273 2063 6865 636b 2720 7072  occurs check' pr
001cd70: 6f62 6c65 6d2e 2057 6520 6d75 7374 2064  oblem. We must d
001cd80: 6973 616c 6c6f 7720 696e 7374 616e 7469  isallow instanti
001cd90: 6174 696f 6e20 6f66 0a24 5824 2074 6f20  ation of.$X$ to 
001cda0: 6120 6e6f 6e74 7269 7669 616c 2074 6572  a nontrivial ter
001cdb0: 6d20 696e 766f 6c76 696e 6720 2458 242c  m involving $X$,
001cdc0: 2061 7320 696e 2074 6865 2074 6869 7264   as in the third
001cdd0: 2065 7861 6d70 6c65 2061 626f 7665 2e20   example above. 
001cde0: 4d6f 7374 0a72 6561 6c20 5072 6f6c 6f67  Most.real Prolog
001cdf0: 7320 6967 6e6f 7265 2074 6869 732c 2065  s ignore this, e
001ce00: 6974 6865 7220 666f 7220 2863 6c61 696d  ither for (claim
001ce10: 6564 2920 6566 6669 6369 656e 6379 2072  ed) efficiency r
001ce20: 6561 736f 6e73 206f 7220 696e 206f 7264  easons or in ord
001ce30: 6572 0a74 6f20 616c 6c6f 7720 7765 6972  er.to allow weir
001ce40: 6420 6379 636c 6963 2064 6174 6173 7472  d cyclic datastr
001ce50: 7563 7475 7265 7320 696e 7374 6561 6420  uctures instead 
001ce60: 6f66 2073 696d 706c 6520 6669 7273 7420  of simple first 
001ce70: 6f72 6465 7220 7465 726d 732e 0a0a 5c62  order terms...\b
001ce80: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
001ce90: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
001cea0: 6c65 7420 7265 6320 6f63 6375 7273 5f69  let rec occurs_i
001ceb0: 6e20 7820 3d0a 2020 2020 6675 6e20 2856  n x =.    fun (V
001cec0: 6172 2079 2920 2d3e 2078 203d 2079 0a20  ar y) -> x = y. 
001ced0: 2020 2020 207c 2028 466e 285f 2c61 7267       | (Fn(_,arg
001cee0: 7329 2920 2d3e 2065 7869 7374 7320 286f  s)) -> exists (o
001cef0: 6363 7572 735f 696e 2078 2920 6172 6773  ccurs_in x) args
001cf00: 3b3b 0a0a 2020 6c65 7420 7265 6320 7375  ;;..  let rec su
001cf10: 6273 7420 696e 7374 7320 3d20 6675 6e0a  bst insts = fun.
001cf20: 2020 2020 2028 5661 7220 7929 202d 3e20       (Var y) -> 
001cf30: 2874 7279 2061 7373 6f63 2079 2069 6e73  (try assoc y ins
001cf40: 7473 2077 6974 6820 4e6f 745f 666f 756e  ts with Not_foun
001cf50: 6420 2d3e 2074 6d29 0a20 2020 7c20 2846  d -> tm).   | (F
001cf60: 6e28 662c 6172 6773 2929 202d 3e20 466e  n(f,args)) -> Fn
001cf70: 2866 2c6d 6170 2028 7375 6273 7420 696e  (f,map (subst in
001cf80: 7374 7329 2061 7267 7329 3b3b 0a0a 2020  sts) args);;..  
001cf90: 6c65 7420 7261 775f 6175 676d 656e 7420  let raw_augment 
001cfa0: 3d0a 2020 2020 6c65 7420 6175 676d 656e  =.    let augmen
001cfb0: 7431 2074 6865 7461 2028 782c 7329 203d  t1 theta (x,s) =
001cfc0: 0a20 2020 2020 206c 6574 2073 2720 3d20  .      let s' = 
001cfd0: 7375 6273 7420 7468 6574 6120 7320 696e  subst theta s in
001cfe0: 0a20 2020 2020 2069 6620 6f63 6375 7273  .      if occurs
001cff0: 5f69 6e20 7820 7320 2620 6e6f 7428 7320  _in x s & not(s 
001d000: 3d20 5661 7228 7829 290a 2020 2020 2020  = Var(x)).      
001d010: 7468 656e 2072 6169 7365 2028 6572 726f  then raise (erro
001d020: 7220 224f 6363 7572 7320 6368 6563 6b22  r "Occurs check"
001d030: 290a 2020 2020 2020 656c 7365 2028 782c  ).      else (x,
001d040: 7327 2920 696e 0a20 2020 2066 756e 2070  s') in.    fun p
001d050: 2069 6e73 7473 202d 3e20 703a 3a28 6d61   insts -> p::(ma
001d060: 7020 2861 7567 6d65 6e74 3120 5b70 5d29  p (augment1 [p])
001d070: 2069 6e73 7473 293b 3b0a 0a20 206c 6574   insts);;..  let
001d080: 2061 7567 6d65 6e74 2028 762c 7429 2069   augment (v,t) i
001d090: 6e73 7473 203d 0a20 2020 206c 6574 2074  nsts =.    let t
001d0a0: 2720 3d20 7375 6273 7420 696e 7374 7320  ' = subst insts 
001d0b0: 7420 696e 206d 6174 6368 2074 2720 7769  t in match t' wi
001d0c0: 7468 0a20 2020 2020 2056 6172 2877 2920  th.      Var(w) 
001d0d0: 2d3e 2069 6620 7720 3c3d 2076 2074 6865  -> if w <= v the
001d0e0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
001d0f0: 2020 2020 6966 2077 203d 2076 2074 6865      if w = v the
001d100: 6e20 696e 7374 730a 2020 2020 2020 2020  n insts.        
001d110: 2020 2020 2020 2020 2020 656c 7365 2072            else r
001d120: 6177 5f61 7567 6d65 6e74 2028 762c 7427  aw_augment (v,t'
001d130: 2920 696e 7374 730a 2020 2020 2020 2020  ) insts.        
001d140: 2020 2020 2020 2020 656c 7365 2072 6177          else raw
001d150: 5f61 7567 6d65 6e74 2028 772c 5661 7228  _augment (w,Var(
001d160: 7629 2920 696e 7374 730a 2020 2020 7c20  v)) insts.    | 
001d170: 5f20 2d3e 2069 6620 6f63 6375 7273 5f69  _ -> if occurs_i
001d180: 6e20 7620 7427 0a20 2020 2020 2020 2020  n v t'.         
001d190: 2020 7468 656e 2072 6169 7365 2028 6572    then raise (er
001d1a0: 726f 7220 224f 6363 7572 7320 6368 6563  ror "Occurs chec
001d1b0: 6b22 290a 2020 2020 2020 2020 2020 2065  k").           e
001d1c0: 6c73 6520 7261 775f 6175 676d 656e 7420  lse raw_augment 
001d1d0: 2876 2c74 2729 2069 6e73 7473 3b3b 0a5c  (v,t') insts;;.\
001d1e0: 656e 647b 6c73 746c 6973 7469 6e67 7d5c  end{lstlisting}\
001d1f0: 656e 647b 626f 7865 647d 0a0a 5c73 7562  end{boxed}..\sub
001d200: 7365 6374 696f 6e7b 4261 636b 7472 6163  section{Backtrac
001d210: 6b69 6e67 7d0a 0a50 726f 6c6f 6720 7072  king}..Prolog pr
001d220: 6f63 6565 6473 2062 7920 6465 7074 682d  oceeds by depth-
001d230: 6669 7273 7420 7365 6172 6368 2c20 6275  first search, bu
001d240: 7420 6974 206d 6179 2062 6163 6b74 7261  t it may backtra
001d250: 636b 3a20 6576 656e 2069 6620 6120 7275  ck: even if a ru
001d260: 6c65 0a75 6e69 6669 6573 2073 7563 6365  le.unifies succe
001d270: 7373 6675 6c6c 792c 2069 6620 616c 6c20  ssfully, if all 
001d280: 7468 6520 7265 6d61 696e 696e 6720 676f  the remaining go
001d290: 616c 7320 6361 6e6e 6f74 2062 6520 736f  als cannot be so
001d2a0: 6c76 6564 2075 6e64 6572 2074 6865 0a72  lved under the.r
001d2b0: 6573 756c 7469 6e67 2069 6e73 7461 6e74  esulting instant
001d2c0: 6961 7469 6f6e 732c 2074 6865 6e20 616e  iations, then an
001d2d0: 6f74 6865 7220 696e 6974 6961 6c20 7275  other initial ru
001d2e0: 6c65 2069 7320 7472 6965 642e 2054 6875  le is tried. Thu
001d2f0: 7320 7765 2063 6f6e 7369 6465 720a 7468  s we consider.th
001d300: 6520 7768 6f6c 6520 6c69 7374 206f 6620  e whole list of 
001d310: 676f 616c 7320 7261 7468 6572 2074 6861  goals rather tha
001d320: 6e20 6f6e 6520 6174 2061 2074 696d 652c  n one at a time,
001d330: 2074 6f20 6769 7665 2074 6865 2072 6967   to give the rig
001d340: 6874 2063 6f6e 7472 6f6c 0a73 7472 6174  ht control.strat
001d350: 6567 792e 0a0a 5c62 6567 696e 7b62 6f78  egy...\begin{box
001d360: 6564 7d5c 6265 6769 6e7b 6c73 746c 6973  ed}\begin{lstlis
001d370: 7469 6e67 7d0a 2020 6c65 7420 7265 6320  ting}.  let rec 
001d380: 6669 7273 7420 6620 3d0a 2020 2020 6675  first f =.    fu
001d390: 6e20 5b5d 202d 3e20 7261 6973 6520 2865  n [] -> raise (e
001d3a0: 7272 6f72 2022 4e6f 2072 756c 6573 2061  rror "No rules a
001d3b0: 7070 6c69 6361 626c 6522 290a 2020 2020  pplicable").    
001d3c0: 2020 7c20 2868 3a3a 7429 202d 3e20 7472    | (h::t) -> tr
001d3d0: 7920 6620 6820 7769 7468 2065 7272 6f72  y f h with error
001d3e0: 205f 202d 3e20 6669 7273 7420 6620 743b   _ -> first f t;
001d3f0: 3b0a 0a20 206c 6574 2072 6563 2065 7870  ;..  let rec exp
001d400: 616e 6420 6e20 7275 6c65 7320 696e 7374  and n rules inst
001d410: 7320 676f 616c 7320 3d0a 2020 2020 6669  s goals =.    fi
001d420: 7273 7420 2866 756e 2072 756c 6520 2d3e  rst (fun rule ->
001d430: 0a20 2020 2020 2069 6620 676f 616c 7320  .      if goals 
001d440: 3d20 5b5d 2074 6865 6e20 696e 7374 7320  = [] then insts 
001d450: 656c 7365 0a20 2020 2020 206c 6574 2063  else.      let c
001d460: 6f6e 632c 6173 6d73 203d 0a20 2020 2020  onc,asms =.     
001d470: 2020 2072 656e 616d 655f 7275 6c65 2028     rename_rule (
001d480: 7374 7269 6e67 5f6f 665f 696e 7420 6e29  string_of_int n)
001d490: 2072 756c 6520 696e 0a20 2020 2020 206c   rule in.      l
001d4a0: 6574 2069 6e73 7473 2720 3d20 756e 6966  et insts' = unif
001d4b0: 7920 636f 6e63 2028 6864 2067 6f61 6c73  y conc (hd goals
001d4c0: 2920 696e 7374 7320 696e 0a20 2020 2020  ) insts in.     
001d4d0: 206c 6574 206c 6f63 616c 2c67 6c6f 6261   let local,globa
001d4e0: 6c20 3d20 7061 7274 6974 696f 6e0a 2020  l = partition.  
001d4f0: 2020 2020 2020 2866 756e 2028 762c 5f29        (fun (v,_)
001d500: 202d 3e20 6f63 6375 7273 5f69 6e20 7620   -> occurs_in v 
001d510: 636f 6e63 206f 720a 2020 2020 2020 2020  conc or.        
001d520: 2020 2020 2020 2020 6578 6973 7473 2028          exists (
001d530: 6f63 6375 7273 5f69 6e20 7629 2061 736d  occurs_in v) asm
001d540: 7329 2069 6e73 7473 2720 696e 0a20 2020  s) insts' in.   
001d550: 2020 206c 6574 2067 6f61 6c73 2720 3d20     let goals' = 
001d560: 286d 6170 2028 7375 6273 7420 6c6f 6361  (map (subst loca
001d570: 6c29 2061 736d 7329 2040 0a20 2020 2020  l) asms) @.     
001d580: 2020 2020 2020 2020 2020 2020 2020 2874                (t
001d590: 6c20 676f 616c 7329 2069 6e0a 2020 2020  l goals) in.    
001d5a0: 2020 6578 7061 6e64 2028 6e20 2b20 3129    expand (n + 1)
001d5b0: 2072 756c 6573 2067 6c6f 6261 6c20 676f   rules global go
001d5c0: 616c 7327 2920 7275 6c65 733b 3b0a 5c65  als') rules;;.\e
001d5d0: 6e64 7b6c 7374 6c69 7374 696e 677d 5c65  nd{lstlisting}\e
001d5e0: 6e64 7b62 6f78 6564 7d0a 0a48 6572 6520  nd{boxed}..Here 
001d5f0: 7765 2075 7365 2061 2066 756e 6374 696f  we use a functio
001d600: 6e20 6072 656e 616d 6527 2074 6f20 6765  n `rename' to ge
001d610: 6e65 7261 7465 2066 7265 7368 2076 6172  nerate fresh var
001d620: 6961 626c 6573 2066 6f72 2074 6865 2072  iables for the r
001d630: 756c 6573 2065 6163 680a 7469 6d65 3a0a  ules each.time:.
001d640: 0a5c 6265 6769 6e7b 626f 7865 647d 5c62  .\begin{boxed}\b
001d650: 6567 696e 7b76 6572 6261 7469 6d7d 0a20  egin{verbatim}. 
001d660: 206c 6574 2072 6563 2072 656e 616d 6520   let rec rename 
001d670: 7320 3d0a 2020 2020 6675 6e20 2856 6172  s =.    fun (Var
001d680: 2076 2920 2d3e 2056 6172 2822 7e22 5e76   v) -> Var("~"^v
001d690: 5e73 290a 2020 2020 2020 7c20 2846 6e28  ^s).      | (Fn(
001d6a0: 662c 6172 6773 2929 202d 3e20 466e 2866  f,args)) -> Fn(f
001d6b0: 2c6d 6170 2028 7265 6e61 6d65 2073 2920  ,map (rename s) 
001d6c0: 6172 6773 293b 3b0a 0a20 206c 6574 2072  args);;..  let r
001d6d0: 656e 616d 655f 7275 6c65 2073 2028 636f  ename_rule s (co
001d6e0: 6e63 2c61 736d 7329 203d 0a20 2020 2028  nc,asms) =.    (
001d6f0: 7265 6e61 6d65 2073 2063 6f6e 632c 6d61  rename s conc,ma
001d700: 7020 2872 656e 616d 6520 7329 2061 736d  p (rename s) asm
001d710: 7329 3b3b 0a5c 656e 647b 7665 7262 6174  s);;.\end{verbat
001d720: 696d 7d5c 656e 647b 626f 7865 647d 0a0a  im}\end{boxed}..
001d730: 4669 6e61 6c6c 792c 2077 6520 6361 6e20  Finally, we can 
001d740: 7061 636b 6167 6520 6576 6572 7974 6869  package everythi
001d750: 6e67 2074 6f67 6574 6865 7220 696e 2061  ng together in a
001d760: 2066 756e 6374 696f 6e20 7b5c 7474 2070   function {\tt p
001d770: 726f 6c6f 677d 2074 6861 740a 7472 6965  rolog} that.trie
001d780: 7320 746f 2073 6f6c 7665 2061 2067 6976  s to solve a giv
001d790: 656e 2067 6f61 6c20 7573 696e 6720 7468  en goal using th
001d7a0: 6520 6769 7665 6e20 7275 6c65 733a 0a0a  e given rules:..
001d7b0: 5c62 6567 696e 7b62 6f78 6564 7d5c 6265  \begin{boxed}\be
001d7c0: 6769 6e7b 7665 7262 6174 696d 7d0a 2020  gin{verbatim}.  
001d7d0: 7479 7065 206f 7574 636f 6d65 203d 204e  type outcome = N
001d7e0: 6f20 7c20 5965 7320 6f66 2028 7374 7269  o | Yes of (stri
001d7f0: 6e67 202a 2074 6572 6d29 206c 6973 743b  ng * term) list;
001d800: 3b0a 0a20 206c 6574 2070 726f 6c6f 6720  ;..  let prolog 
001d810: 7275 6c65 7320 676f 616c 203d 0a20 2020  rules goal =.   
001d820: 2074 7279 206c 6574 2069 6e73 7473 203d   try let insts =
001d830: 2065 7870 616e 6420 3020 7275 6c65 7320   expand 0 rules 
001d840: 5b5d 205b 676f 616c 5d20 696e 0a20 2020  [] [goal] in.   
001d850: 2020 2020 2059 6573 2866 696c 7465 7220       Yes(filter 
001d860: 2866 756e 2028 762c 5f29 202d 3e20 6f63  (fun (v,_) -> oc
001d870: 6375 7273 5f69 6e20 7620 676f 616c 290a  curs_in v goal).
001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
001d890: 2020 2069 6e73 7473 290a 2020 2020 7769     insts).    wi
001d8a0: 7468 2065 7272 6f72 205f 202d 3e20 4e6f  th error _ -> No
001d8b0: 3b3b 0a5c 656e 647b 7665 7262 6174 696d  ;;.\end{verbatim
001d8c0: 7d5c 656e 647b 626f 7865 647d 0a0a 5468  }\end{boxed}..Th
001d8d0: 6973 2073 6179 7320 6569 7468 6572 2074  is says either t
001d8e0: 6861 7420 7468 6520 676f 616c 2063 616e  hat the goal can
001d8f0: 6e6f 7420 6265 2073 6f6c 7665 642c 206f  not be solved, o
001d900: 7220 7468 6174 2069 7420 6361 6e20 6265  r that it can be
001d910: 2073 6f6c 7665 6420 7769 7468 0a74 6865   solved with.the
001d920: 2067 6976 656e 2069 6e73 7461 6e74 6961   given instantia
001d930: 7469 6f6e 732e 204e 6f74 6520 7468 6174  tions. Note that
001d940: 2077 6520 6f6e 6c79 2072 6574 7572 6e20   we only return 
001d950: 6f6e 6520 616e 7377 6572 2069 6e20 7468  one answer in th
001d960: 6973 206c 6174 7465 720a 6361 7365 2c20  is latter.case, 
001d970: 6275 7420 7468 6973 2069 7320 6561 7379  but this is easy
001d980: 2074 6f20 6368 616e 6765 2069 6620 6465   to change if de
001d990: 7369 7265 642e 0a0a 5c73 7562 7365 6374  sired...\subsect
001d9a0: 696f 6e7b 4578 616d 706c 6573 7d0a 0a57  ion{Examples}..W
001d9b0: 6520 6361 6e20 7573 6520 7468 6520 5072  e can use the Pr
001d9c0: 6f6c 6f67 2069 6e74 6572 7072 6574 6572  olog interpreter
001d9d0: 206a 7573 7420 7772 6974 7465 6e20 746f   just written to
001d9e0: 2074 7279 2073 6f6d 6520 7369 6d70 6c65   try some simple
001d9f0: 2065 7861 6d70 6c65 7320 6672 6f6d 0a50   examples from.P
001da00: 726f 6c6f 6720 7465 7874 626f 6f6b 732e  rolog textbooks.
001da10: 2046 6f72 2065 7861 6d70 6c65 3a0a 0a5c   For example:..\
001da20: 6265 6769 6e7b 626f 7865 647d 5c62 6567  begin{boxed}\beg
001da30: 696e 7b76 6572 6261 7469 6d7d 0a20 2023  in{verbatim}.  #
001da40: 6c65 7420 7275 6c65 7320 3d20 7061 7273  let rules = pars
001da50: 655f 7275 6c65 730a 2020 2020 226d 616c  e_rules.    "mal
001da60: 6528 616c 6265 7274 292e 0a20 2020 2020  e(albert)..     
001da70: 6d61 6c65 2865 6477 6172 6429 2e0a 2020  male(edward)..  
001da80: 2020 2066 656d 616c 6528 616c 6963 6529     female(alice)
001da90: 2e0a 2020 2020 2066 656d 616c 6528 7669  ..     female(vi
001daa0: 6374 6f72 6961 292e 0a20 2020 2020 7061  ctoria)..     pa
001dab0: 7265 6e74 7328 6564 7761 7264 2c76 6963  rents(edward,vic
001dac0: 746f 7269 612c 616c 6265 7274 292e 0a20  toria,albert).. 
001dad0: 2020 2020 7061 7265 6e74 7328 616c 6963      parents(alic
001dae0: 652c 7669 6374 6f72 6961 2c61 6c62 6572  e,victoria,alber
001daf0: 7429 2e0a 2020 2020 2073 6973 7465 725f  t)..     sister_
001db00: 6f66 2858 2c59 2920 3a2d 0a20 2020 2020  of(X,Y) :-.     
001db10: 2020 6665 6d61 6c65 2858 292c 0a20 2020    female(X),.   
001db20: 2020 2020 7061 7265 6e74 7328 582c 4d2c      parents(X,M,
001db30: 4629 2c0a 2020 2020 2020 2070 6172 656e  F),.       paren
001db40: 7473 2859 2c4d 2c46 292e 223b 3b0a 2020  ts(Y,M,F).";;.  
001db50: 7275 6c65 7320 3a20 2874 6572 6d20 2a20  rules : (term * 
001db60: 7465 726d 206c 6973 7429 206c 6973 7420  term list) list 
001db70: 3d0a 2020 205b 606d 616c 6528 616c 6265  =.   [`male(albe
001db80: 7274 2960 2c20 5b5d 3b20 606d 616c 6528  rt)`, []; `male(
001db90: 6564 7761 7264 2960 2c20 5b5d 3b0a 2020  edward)`, [];.  
001dba0: 2020 6066 656d 616c 6528 616c 6963 6529    `female(alice)
001dbb0: 602c 205b 5d3b 2060 6665 6d61 6c65 2876  `, []; `female(v
001dbc0: 6963 746f 7269 6129 602c 205b 5d3b 0a20  ictoria)`, [];. 
001dbd0: 2020 2060 7061 7265 6e74 7328 6564 7761     `parents(edwa
001dbe0: 7264 2c76 6963 746f 7269 612c 616c 6265  rd,victoria,albe
001dbf0: 7274 2960 2c20 5b5d 3b0a 2020 2020 6070  rt)`, [];.    `p
001dc00: 6172 656e 7473 2861 6c69 6365 2c76 6963  arents(alice,vic
001dc10: 746f 7269 612c 616c 6265 7274 2960 2c20  toria,albert)`, 
001dc20: 5b5d 3b0a 2020 2020 6073 6973 7465 725f  [];.    `sister_
001dc30: 6f66 2858 2c59 2960 2c0a 2020 2020 2020  of(X,Y)`,.      
001dc40: 5b60 6665 6d61 6c65 2858 2960 3b20 6070  [`female(X)`; `p
001dc50: 6172 656e 7473 2858 2c4d 2c46 2960 3b20  arents(X,M,F)`; 
001dc60: 6070 6172 656e 7473 2859 2c4d 2c46 2960  `parents(Y,M,F)`
001dc70: 5d5d 0a20 2023 7072 6f6c 6f67 2072 756c  ]].  #prolog rul
001dc80: 6573 2028 2273 6973 7465 725f 6f66 2861  es ("sister_of(a
001dc90: 6c69 6365 2c65 6477 6172 6429 2229 3b3b  lice,edward)");;
001dca0: 0a20 202d 203a 206f 7574 636f 6d65 203d  .  - : outcome =
001dcb0: 2059 6573 205b 5d0a 2020 2370 726f 6c6f   Yes [].  #prolo
001dcc0: 6720 7275 6c65 7320 2870 6172 7365 5f74  g rules (parse_t
001dcd0: 6572 6d20 2273 6973 7465 725f 6f66 2861  erm "sister_of(a
001dce0: 6c69 6365 2c58 2922 293b 3b0a 2020 2d20  lice,X)");;.  - 
001dcf0: 3a20 6f75 7463 6f6d 6520 3d20 5965 7320  : outcome = Yes 
001dd00: 5b22 5822 2c20 6065 6477 6172 6460 5d0a  ["X", `edward`].
001dd10: 2020 2370 726f 6c6f 6720 7275 6c65 7320    #prolog rules 
001dd20: 2870 6172 7365 5f74 6572 6d20 2273 6973  (parse_term "sis
001dd30: 7465 725f 6f66 2858 2c59 2922 293b 3b0a  ter_of(X,Y)");;.
001dd40: 2020 2d20 3a20 6f75 7463 6f6d 6520 3d20    - : outcome = 
001dd50: 5965 7320 5b22 5922 2c20 6065 6477 6172  Yes ["Y", `edwar
001dd60: 6460 3b20 2258 222c 2060 616c 6963 6560  d`; "X", `alice`
001dd70: 5d0a 5c65 6e64 7b76 6572 6261 7469 6d7d  ].\end{verbatim}
001dd80: 5c65 6e64 7b62 6f78 6564 7d0a 0a54 6865  \end{boxed}..The
001dd90: 2066 6f6c 6c6f 7769 6e67 2061 7265 2073   following are s
001dda0: 696d 696c 6172 2074 6f20 736f 6d65 2065  imilar to some e
001ddb0: 6c65 6d65 6e74 6172 7920 4d4c 206c 6973  lementary ML lis
001ddc0: 7420 6f70 6572 6174 696f 6e73 2e20 5369  t operations. Si
001ddd0: 6e63 6520 5072 6f6c 6f67 0a69 7320 7265  nce Prolog.is re
001dde0: 6c61 7469 6f6e 616c 2072 6174 6865 7220  lational rather 
001ddf0: 7468 616e 2066 756e 6374 696f 6e61 6c2c  than functional,
001de00: 2069 7420 6973 2070 6f73 7369 626c 6520   it is possible 
001de10: 746f 2075 7365 2050 726f 6c6f 6720 7175  to use Prolog qu
001de20: 6572 6965 7320 696e 2061 0a6d 6f72 6520  eries in a.more 
001de30: 666c 6578 6962 6c65 2077 6179 2c20 652e  flexible way, e.
001de40: 672e 2061 736b 2077 6861 7420 6172 6775  g. ask what argu
001de50: 6d65 6e74 7320 776f 756c 6420 6769 7665  ments would give
001de60: 2061 2063 6572 7461 696e 2072 6573 756c   a certain resul
001de70: 742c 2072 6174 6865 720a 7468 616e 2076  t, rather.than v
001de80: 6963 6520 7665 7273 613a 0a0a 5c62 6567  ice versa:..\beg
001de90: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
001dea0: 7665 7262 6174 696d 7d0a 2020 236c 6574  verbatim}.  #let
001deb0: 2072 203d 2070 6172 7365 5f72 756c 6573   r = parse_rules
001dec0: 0a20 2020 2022 6170 7065 6e64 285b 5d2c  .    "append([],
001ded0: 4c2c 4c29 2e0a 2020 2020 2061 7070 656e  L,L)..     appen
001dee0: 6428 5b48 7c54 5d2c 4c2c 5b48 7c41 5d29  d([H|T],L,[H|A])
001def0: 203a 2d20 6170 7065 6e64 2854 2c4c 2c41   :- append(T,L,A
001df00: 292e 223b 3b0a 2020 7220 3a20 2874 6572  ).";;.  r : (ter
001df10: 6d20 2a20 7465 726d 206c 6973 7429 206c  m * term list) l
001df20: 6973 7420 3d0a 2020 205b 6061 7070 656e  ist =.   [`appen
001df30: 6428 5b5d 2c4c 2c4c 2960 2c20 5b5d 3b0a  d([],L,L)`, [];.
001df40: 2020 2020 6061 7070 656e 6428 4820 2e20      `append(H . 
001df50: 542c 4c2c 4820 2e20 4129 602c 205b 6061  T,L,H . A)`, [`a
001df60: 7070 656e 6428 542c 4c2c 4129 605d 5d0a  ppend(T,L,A)`]].
001df70: 2020 2370 726f 6c6f 6720 7220 2870 6172    #prolog r (par
001df80: 7365 5f74 6572 6d20 2261 7070 656e 6428  se_term "append(
001df90: 5b31 2c32 5d2c 5b33 5d2c 5b31 2c32 2c33  [1,2],[3],[1,2,3
001dfa0: 5d29 2229 3b3b 0a20 202d 203a 206f 7574  ])");;.  - : out
001dfb0: 636f 6d65 203d 2059 6573 205b 5d0a 2020  come = Yes [].  
001dfc0: 2370 726f 6c6f 6720 7220 2870 6172 7365  #prolog r (parse
001dfd0: 5f74 6572 6d20 2261 7070 656e 6428 5b31  _term "append([1
001dfe0: 2c32 5d2c 5b33 2c34 5d2c 5829 2229 3b3b  ,2],[3,4],X)");;
001dff0: 0a20 202d 203a 206f 7574 636f 6d65 203d  .  - : outcome =
001e000: 2059 6573 205b 2258 222c 2060 3120 2e20   Yes ["X", `1 . 
001e010: 2832 202e 2028 3320 2e20 2834 202e 205b  (2 . (3 . (4 . [
001e020: 5d29 2929 605d 0a20 2023 7072 6f6c 6f67  ])))`].  #prolog
001e030: 2072 2028 7061 7273 655f 7465 726d 2022   r (parse_term "
001e040: 6170 7065 6e64 285b 332c 345d 2c58 2c58  append([3,4],X,X
001e050: 2922 293b 3b0a 2020 2d20 3a20 6f75 7463  )");;.  - : outc
001e060: 6f6d 6520 3d20 4e6f 0a20 2023 7072 6f6c  ome = No.  #prol
001e070: 6f67 2072 2028 7061 7273 655f 7465 726d  og r (parse_term
001e080: 2022 6170 7065 6e64 285b 312c 325d 2c58   "append([1,2],X
001e090: 2c59 2922 293b 3b0a 2020 2d20 3a20 6f75  ,Y)");;.  - : ou
001e0a0: 7463 6f6d 6520 3d20 5965 7320 5b22 5922  tcome = Yes ["Y"
001e0b0: 2c20 6031 202e 2028 3220 2e20 5829 605d  , `1 . (2 . X)`]
001e0c0: 0a5c 656e 647b 7665 7262 6174 696d 7d5c  .\end{verbatim}\
001e0d0: 656e 647b 626f 7865 647d 0a0a 496e 2073  end{boxed}..In s
001e0e0: 7563 6820 6361 7365 732c 2050 726f 6c6f  uch cases, Prolo
001e0f0: 6720 7365 656d 7320 746f 2062 6520 7368  g seems to be sh
001e100: 6f77 696e 6720 616e 2069 6d70 7265 7373  owing an impress
001e110: 6976 6520 6465 6772 6565 206f 6620 696e  ive degree of in
001e120: 7465 6c6c 6967 656e 6365 2e0a 486f 7765  telligence..Howe
001e130: 7665 7220 756e 6465 7220 7468 6520 7375  ver under the su
001e140: 7266 6163 6520 6974 2069 7320 6a75 7374  rface it is just
001e150: 2075 7369 6e67 2061 2073 696d 706c 6520   using a simple 
001e160: 7365 6172 6368 2073 7472 6174 6567 792c  search strategy,
001e170: 2061 6e64 2074 6869 730a 6361 6e20 6561   and this.can ea
001e180: 7369 6c79 2062 6520 7468 7761 7274 6564  sily be thwarted
001e190: 2e20 466f 7220 6578 616d 706c 652c 2074  . For example, t
001e1a0: 6865 2066 6f6c 6c6f 7769 6e67 206c 6f6f  he following loo
001e1b0: 7073 2069 6e64 6566 696e 6974 656c 793a  ps indefinitely:
001e1c0: 0a0a 5c62 6567 696e 7b62 6f78 6564 7d5c  ..\begin{boxed}\
001e1d0: 6265 6769 6e7b 7665 7262 6174 696d 7d0a  begin{verbatim}.
001e1e0: 2020 2370 726f 6c6f 6720 7220 2870 6172    #prolog r (par
001e1f0: 7365 5f74 6572 6d20 2261 7070 656e 6428  se_term "append(
001e200: 582c 5b33 2c34 5d2c 5829 2229 3b3b 0a5c  X,[3,4],X)");;.\
001e210: 656e 647b 7665 7262 6174 696d 7d5c 656e  end{verbatim}\en
001e220: 647b 626f 7865 647d 0a0a 5c73 7562 7365  d{boxed}..\subse
001e230: 6374 696f 6e7b 5468 656f 7265 6d20 7072  ction{Theorem pr
001e240: 6f76 696e 677d 0a0a 5072 6f6c 6f67 2069  oving}..Prolog i
001e250: 7320 6163 7469 6e67 2061 7320 6120 7369  s acting as a si
001e260: 6d70 6c65 2074 6865 6f72 656d 2070 726f  mple theorem pro
001e270: 7665 722c 2075 7369 6e67 2061 2064 6174  ver, using a dat
001e280: 6162 6173 6520 6f66 206c 6f67 6963 616c  abase of logical
001e290: 2066 6163 7473 0a28 7468 6520 7275 6c65   facts.(the rule
001e2a0: 7329 2069 6e20 6f72 6465 7220 746f 2070  s) in order to p
001e2b0: 726f 7665 2061 2067 6f61 6c2e 2048 6f77  rove a goal. How
001e2c0: 6576 6572 2069 7420 6973 2072 6174 6865  ever it is rathe
001e2d0: 7220 6c69 6d69 7465 6420 696e 2074 6865  r limited in the
001e2e0: 2066 6163 7473 0a69 7420 6361 6e20 7072   facts.it can pr
001e2f0: 6f76 652c 2070 6172 746c 7920 6265 6361  ove, partly beca
001e300: 7573 6520 6974 7320 6465 7074 682d 6669  use its depth-fi
001e310: 7273 7420 7365 6172 6368 2073 7472 6174  rst search strat
001e320: 6567 7920 6973 2069 6e63 6f6d 706c 6574  egy is incomplet
001e330: 652c 2061 6e64 0a70 6172 746c 7920 6265  e, and.partly be
001e340: 6361 7573 6520 6974 2063 616e 206f 6e6c  cause it can onl
001e350: 7920 6d61 6b65 206c 6f67 6963 616c 2064  y make logical d
001e360: 6564 7563 7469 6f6e 7320 696e 2063 6572  eductions in cer
001e370: 7461 696e 2070 6174 7465 726e 732e 2049  tain patterns. I
001e380: 7420 6973 0a70 6f73 7369 626c 6520 746f  t is.possible to
001e390: 206d 616b 6520 5072 6f6c 6f67 2d6c 696b   make Prolog-lik
001e3a0: 6520 7379 7374 656d 7320 7468 6174 2061  e systems that a
001e3b0: 7265 206d 6f72 6520 706f 7765 7266 756c  re more powerful
001e3c0: 2c20 652e 672e 2073 6565 0a5c 6369 7465  , e.g. see.\cite
001e3d0: 4e7b 7374 6963 6b65 6c2d 7074 7470 7d2e  N{stickel-pttp}.
001e3e0: 2049 6e20 7768 6174 2066 6f6c 6c6f 7773   In what follows
001e3f0: 2c20 7765 2077 696c 6c20 6a75 7374 2073  , we will just s
001e400: 686f 7720 686f 7720 746f 2062 7569 6c64  how how to build
001e410: 2061 206d 6f72 650a 6361 7061 626c 6520   a more.capable 
001e420: 7468 656f 7265 6d20 7072 6f76 6572 2075  theorem prover u
001e430: 7369 6e67 2065 7373 656e 7469 616c 6c79  sing essentially
001e440: 2073 696d 696c 6172 2074 6563 686e 6f6c   similar technol
001e450: 6f67 792c 2069 6e63 6c75 6469 6e67 2074  ogy, including t
001e460: 6865 0a75 6e69 6669 6361 7469 6f6e 2063  he.unification c
001e470: 6f64 6520 616e 6420 616e 2069 6465 6e74  ode and an ident
001e480: 6963 616c 2062 6163 6b74 7261 636b 696e  ical backtrackin
001e490: 6720 7374 7261 7465 6779 2e0a 0a49 6e20  g strategy...In 
001e4a0: 7061 7274 6963 756c 6172 2c20 756e 6966  particular, unif
001e4b0: 6963 6174 696f 6e20 6973 2061 6e20 6566  ication is an ef
001e4c0: 6665 6374 6976 6520 7761 7920 6f66 2064  fective way of d
001e4d0: 6563 6964 696e 6720 686f 7720 746f 2073  eciding how to s
001e4e0: 7065 6369 616c 697a 650a 756e 6976 6572  pecialize.univer
001e4f0: 7361 6c6c 7920 7175 616e 7469 6669 6564  sally quantified
001e500: 2076 6172 6961 626c 6573 2e20 466f 7220   variables. For 
001e510: 6578 616d 706c 652c 2067 6976 656e 2074  example, given t
001e520: 6865 2066 6163 7473 2074 6861 740a 245c  he facts that.$\
001e530: 616c 6c7b 587d 2070 2858 2920 5c49 6d70  all{X} p(X) \Imp
001e540: 2071 2858 2924 2061 6e64 2024 7028 6628   q(X)$ and $p(f(
001e550: 6129 2924 2c20 7765 2063 616e 2075 6e69  a))$, we can uni
001e560: 6679 2074 6865 2074 776f 0a65 7870 7265  fy the two.expre
001e570: 7373 696f 6e73 2069 6e76 6f6c 7669 6e67  ssions involving
001e580: 2024 7024 2061 6e64 2074 6875 7320 6469   $p$ and thus di
001e590: 7363 6f76 6572 2074 6861 7420 7765 206e  scover that we n
001e5a0: 6565 6420 746f 2073 6574 0a24 5824 2074  eed to set.$X$ t
001e5b0: 6f20 2466 2861 2924 2e20 4279 2063 6f6e  o $f(a)$. By con
001e5c0: 7472 6173 742c 2074 6865 2076 6572 7920  trast, the very 
001e5d0: 6561 726c 6965 7374 2074 6865 6f72 656d  earliest theorem
001e5e0: 2070 726f 7665 7273 2074 7269 6564 2061   provers tried a
001e5f0: 6c6c 0a70 6f73 7369 626c 6520 7465 726d  ll.possible term
001e600: 7320 6275 696c 7420 7570 2066 726f 6d20  s built up from 
001e610: 7468 6520 6176 6169 6c61 626c 6520 636f  the available co
001e620: 6e73 7461 6e74 7320 616e 6420 6675 6e63  nstants and func
001e630: 7469 6f6e 7320 2874 6865 0a60 4865 7262  tions (the.`Herb
001e640: 7261 6e64 2062 6173 6527 292e 0a0a 5573  rand base')...Us
001e650: 7561 6c6c 792c 2064 6570 7468 2d66 6972  ually, depth-fir
001e660: 7374 2073 6561 7263 6820 776f 756c 6420  st search would 
001e670: 676f 2069 6e74 6f20 616e 2069 6e66 696e  go into an infin
001e680: 6974 6520 6c6f 6f70 2c20 736f 2077 6520  ite loop, so we 
001e690: 6e65 6564 2074 6f0a 6d6f 6469 6679 2074  need to.modify t
001e6a0: 6865 2050 726f 6c6f 6720 7374 7261 7465  he Prolog strate
001e6b0: 6779 2073 6c69 6768 746c 792e 2057 6520  gy slightly. We 
001e6c0: 7769 6c6c 2075 7365 207b 5c65 6d20 6465  will use {\em de
001e6d0: 7074 6820 6669 7273 7420 6974 6572 6174  pth first iterat
001e6e0: 6976 650a 6465 6570 656e 696e 677d 2e20  ive.deepening}. 
001e6f0: 5468 6973 206d 6561 6e73 2074 6861 7420  This means that 
001e700: 7468 6520 7365 6172 6368 2064 6570 7468  the search depth
001e710: 2068 6173 2061 2068 6172 6420 6c69 6d69   has a hard limi
001e720: 742c 2061 6e64 2061 7474 656d 7074 7320  t, and attempts 
001e730: 746f 0a65 7863 6565 6420 6974 2063 6175  to.exceed it cau
001e740: 7365 2062 6163 6b74 7261 636b 696e 672e  se backtracking.
001e750: 2048 6f77 6576 6572 2c20 6966 206e 6f20   However, if no 
001e760: 7072 6f6f 6620 6973 2066 6f75 6e64 2061  proof is found a
001e770: 7420 6120 6769 7665 6e20 6465 7074 682c  t a given depth,
001e780: 0a74 6865 2062 6f75 6e64 2069 7320 696e  .the bound is in
001e790: 6372 6561 7365 6420 616e 6420 616e 6f74  creased and anot
001e7a0: 6865 7220 6174 7465 6d70 7420 6973 206d  her attempt is m
001e7b0: 6164 652e 2054 6875 732c 2066 6972 7374  ade. Thus, first
001e7c0: 206f 6e65 2073 6561 7263 6865 730a 666f   one searches.fo
001e7d0: 7220 7072 6f6f 6673 206f 6620 6465 7074  r proofs of dept
001e7e0: 6820 2431 242c 2061 6e64 2069 6620 7468  h $1$, and if th
001e7f0: 6174 2066 6169 6c73 2c20 7365 6172 6368  at fails, search
001e800: 6573 2066 6f72 206f 6e65 206f 6620 6465  es for one of de
001e810: 7074 6820 2432 242c 2074 6865 6e0a 6465  pth $2$, then.de
001e820: 7074 6820 2433 2420 616e 6420 736f 206f  pth $3$ and so o
001e830: 6e2e 2046 6f72 2060 6465 7074 6827 206f  n. For `depth' o
001e840: 6e65 2063 616e 2075 7365 2076 6172 696f  ne can use vario
001e850: 7573 2070 6172 616d 6574 6572 732c 2065  us parameters, e
001e860: 2e67 2e20 7468 650a 6865 6967 6874 206f  .g. the.height o
001e870: 7220 6f76 6572 616c 6c20 7369 7a65 206f  r overall size o
001e880: 6620 7468 6520 7365 6172 6368 2074 7265  f the search tre
001e890: 653b 2077 6520 7769 6c6c 2075 7365 2074  e; we will use t
001e8a0: 6865 206e 756d 6265 7220 6f66 2075 6e69  he number of uni
001e8b0: 6669 6162 6c65 0a76 6172 6961 626c 6573  fiable.variables
001e8c0: 2069 6e74 726f 6475 6365 642e 0a0a 5c73   introduced...\s
001e8d0: 7562 7375 6273 6563 7469 6f6e 2a7b 4d61  ubsubsection*{Ma
001e8e0: 6e69 7075 6c61 7469 6e67 2066 6f72 6d75  nipulating formu
001e8f0: 6c61 737d 0a0a 5765 2077 696c 6c20 7369  las}..We will si
001e900: 6d70 6c79 2075 7365 206f 7572 2073 7461  mply use our sta
001e910: 6e64 6172 6420 6669 7273 7420 6f72 6465  ndard first orde
001e920: 7220 7465 726d 7320 746f 2064 656e 6f74  r terms to denot
001e930: 6520 666f 726d 756c 6173 2c0a 696e 7472  e formulas,.intr
001e940: 6f64 7563 696e 6720 6e65 7720 636f 6e73  oducing new cons
001e950: 7461 6e74 7320 666f 7220 7468 6520 6c6f  tants for the lo
001e960: 6769 6361 6c20 6f70 6572 6174 6f72 732e  gical operators.
001e970: 204d 616e 7920 6f66 2074 6865 7365 2061   Many of these a
001e980: 7265 2077 7269 7474 656e 0a69 6e66 6978  re written.infix
001e990: 2e0a 0a5c 6265 6769 6e7b 6365 6e74 6572  ...\begin{center
001e9a0: 7d0a 5c62 6567 696e 7b74 6162 756c 6172  }.\begin{tabular
001e9b0: 7d7b 7c6c 7c6c 7c7d 0a5c 686c 696e 650a  }{|l|l|}.\hline.
001e9c0: 4f70 6572 6174 6f72 2020 2026 204d 6561  Operator   & Mea
001e9d0: 6e69 6e67 2020 2020 2020 2020 2020 2020  ning            
001e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
001e9f0: 205c 5c0a 5c68 6c69 6e65 0a7b 5c76 6572   \\.\hline.{\ver
001ea00: 622b 7e2b 7d28 7029 2020 2020 2620 6e6f  b+~+}(p)    & no
001ea10: 7420 7020 2020 2020 2020 2020 2020 2020  t p             
001ea20: 2020 2020 2020 2020 2020 2020 5c5c 0a70              \\.p
001ea30: 207b 5c76 6572 622b 262b 7d20 7120 2020   {\verb+&+} q   
001ea40: 2620 7020 616e 6420 7120 2020 2020 2020  & p and q       
001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
001ea60: 5c5c 0a70 207b 5c76 6572 622b 7c2b 7d20  \\.p {\verb+|+} 
001ea70: 7120 2020 2620 7020 6f72 2071 2020 2020  q   & p or q    
001ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
001ea90: 2020 2020 5c5c 0a70 207b 5c76 6572 622b      \\.p {\verb+
001eaa0: 2d2d 3e2b 7d20 7120 2620 7020 696d 706c  -->+} q & p impl
001eab0: 6965 7320 7120 2020 2020 2020 2020 2020  ies q           
001eac0: 2020 2020 2020 2020 5c5c 0a70 207b 5c76          \\.p {\v
001ead0: 6572 622b 3c2d 3e2b 7d20 7120 2620 7020  erb+<->+} q & p 
001eae0: 6966 2061 6e64 206f 6e6c 7920 6966 2071  if and only if q
001eaf0: 2020 2020 2020 2020 2020 2020 5c5c 0a66              \\.f
001eb00: 6f72 616c 6c28 582c 7029 2020 2020 2020  orall(X,p)      
001eb10: 2620 666f 7220 616c 6c20 582c 2070 2020  & for all X, p  
001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
001eb30: 5c5c 0a65 7869 7374 7328 582c 7029 2020  \\.exists(X,p)  
001eb40: 2020 2020 2620 7468 6572 6520 6578 6973      & there exis
001eb50: 7473 2061 6e20 5820 7375 6368 2074 6861  ts an X such tha
001eb60: 7420 7020 5c5c 0a5c 686c 696e 650a 5c65  t p \\.\hline.\e
001eb70: 6e64 7b74 6162 756c 6172 7d0a 5c65 6e64  nd{tabular}.\end
001eb80: 7b63 656e 7465 727d 0a0a 416e 2061 6c74  {center}..An alt
001eb90: 6572 6e61 7469 7665 2077 6f75 6c64 2062  ernative would b
001eba0: 6520 746f 2069 6e74 726f 6475 6365 2061  e to introduce a
001ebb0: 2073 6570 6172 6174 6520 7479 7065 206f   separate type o
001ebc0: 6620 666f 726d 756c 6173 2c20 6275 7420  f formulas, but 
001ebd0: 7468 6973 0a77 6f75 6c64 2072 6571 7569  this.would requi
001ebe0: 7265 2073 6570 6172 6174 6520 7061 7273  re separate pars
001ebf0: 696e 6720 616e 6420 7072 696e 7469 6e67  ing and printing
001ec00: 2073 7570 706f 7274 2e20 5765 2077 696c   support. We wil
001ec10: 6c20 6176 6f69 6420 7468 6973 2c20 666f  l avoid this, fo
001ec20: 720a 7468 6520 7361 6b65 206f 6620 7369  r.the sake of si
001ec30: 6d70 6c69 6369 7479 2e0a 0a5c 7375 6273  mplicity...\subs
001ec40: 7562 7365 6374 696f 6e2a 7b50 7265 7072  ubsection*{Prepr
001ec50: 6f63 6573 7369 6e67 2066 6f72 6d75 6c61  ocessing formula
001ec60: 737d 0a0a 4974 2773 2063 6f6e 7665 6e69  s}..It's conveni
001ec70: 656e 7420 6966 2074 6865 206d 6169 6e20  ent if the main 
001ec80: 7061 7274 206f 6620 7468 6520 7072 6f76  part of the prov
001ec90: 6572 206e 6565 6420 6e6f 7420 636f 7065  er need not cope
001eca0: 2077 6974 6820 696d 706c 6963 6174 696f   with implicatio
001ecb0: 6e73 0a61 6e64 2060 6966 2061 6e64 206f  ns.and `if and o
001ecc0: 6e6c 7920 6966 2773 2e20 5468 6572 6566  nly if's. Theref
001ecd0: 6f72 6520 7765 2066 6972 7374 2064 6566  ore we first def
001ece0: 696e 6520 6120 6675 6e63 7469 6f6e 2074  ine a function t
001ecf0: 6861 7420 656c 696d 696e 6174 6573 0a74  hat eliminates.t
001ed00: 6865 7365 2069 6e20 6661 766f 7572 206f  hese in favour o
001ed10: 6620 7468 6520 6f74 6865 7220 636f 6e6e  f the other conn
001ed20: 6563 7469 7665 732e 0a0a 5c62 6567 696e  ectives...\begin
001ed30: 7b62 6f78 6564 7d5c 6265 6769 6e7b 6c73  {boxed}\begin{ls
001ed40: 746c 6973 7469 6e67 7d0a 2020 6c65 7420  tlisting}.  let 
001ed50: 7265 6320 7072 6f63 2074 6d20 3d0a 2020  rec proc tm =.  
001ed60: 2020 6d61 7463 6820 746d 2077 6974 680a    match tm with.
001ed70: 2020 2020 2020 466e 2822 7e22 2c5b 745d        Fn("~",[t]
001ed80: 2920 2d3e 2046 6e28 227e 222c 5b70 726f  ) -> Fn("~",[pro
001ed90: 6320 745d 290a 2020 2020 7c20 466e 2822  c t]).    | Fn("
001eda0: 2622 2c5b 7431 3b20 7432 5d29 202d 3e20  &",[t1; t2]) -> 
001edb0: 466e 2822 2622 2c5b 7072 6f63 2074 313b  Fn("&",[proc t1;
001edc0: 2070 726f 6320 7432 5d29 0a20 2020 207c   proc t2]).    |
001edd0: 2046 6e28 227c 222c 5b74 313b 2074 325d   Fn("|",[t1; t2]
001ede0: 2920 2d3e 2046 6e28 227c 222c 5b70 726f  ) -> Fn("|",[pro
001edf0: 6320 7431 3b20 7072 6f63 2074 325d 290a  c t1; proc t2]).
001ee00: 2020 2020 7c20 466e 2822 2d2d 3e22 2c5b      | Fn("-->",[
001ee10: 7431 3b20 7432 5d29 202d 3e0a 2020 2020  t1; t2]) ->.    
001ee20: 2020 2020 2020 7072 6f63 2028 466e 2822        proc (Fn("
001ee30: 7c22 2c5b 466e 2822 7e22 2c5b 7431 5d29  |",[Fn("~",[t1])
001ee40: 3b20 7432 5d29 290a 2020 2020 7c20 466e  ; t2])).    | Fn
001ee50: 2822 3c2d 3e22 2c5b 7431 3b20 7432 5d29  ("<->",[t1; t2])
001ee60: 202d 3e0a 2020 2020 2020 2020 2020 7072   ->.          pr
001ee70: 6f63 2028 466e 2822 2622 2c5b 466e 2822  oc (Fn("&",[Fn("
001ee80: 2d2d 3e22 2c5b 7431 3b20 7432 5d29 3b0a  -->",[t1; t2]);.
001ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
001eea0: 2020 2020 2020 2020 466e 2822 2d2d 3e22          Fn("-->"
001eeb0: 2c5b 7432 3b20 7431 5d29 5d29 290a 2020  ,[t2; t1])])).  
001eec0: 2020 7c20 466e 2822 666f 7261 6c6c 222c    | Fn("forall",
001eed0: 5b78 3b20 745d 2920 2d3e 2046 6e28 2266  [x; t]) -> Fn("f
001eee0: 6f72 616c 6c22 2c5b 783b 2070 726f 6320  orall",[x; proc 
001eef0: 745d 290a 2020 2020 7c20 466e 2822 6578  t]).    | Fn("ex
001ef00: 6973 7473 222c 5b78 3b20 745d 2920 2d3e  ists",[x; t]) ->
001ef10: 2046 6e28 2265 7869 7374 7322 2c5b 783b   Fn("exists",[x;
001ef20: 2070 726f 6320 745d 290a 2020 2020 7c20   proc t]).    | 
001ef30: 7420 2d3e 2074 3b3b 0a5c 656e 647b 6c73  t -> t;;.\end{ls
001ef40: 746c 6973 7469 6e67 7d5c 656e 647b 626f  tlisting}\end{bo
001ef50: 7865 647d 0a0a 5468 6520 6e65 7874 2073  xed}..The next s
001ef60: 7465 7020 6973 2074 6f20 7075 7368 2074  tep is to push t
001ef70: 6865 206e 6567 6174 696f 6e73 2064 6f77  he negations dow
001ef80: 6e20 7468 6520 666f 726d 756c 612c 2070  n the formula, p
001ef90: 7574 7469 6e67 2069 7420 696e 746f 0a73  utting it into.s
001efa0: 6f2d 6361 6c6c 6564 2060 6e65 6761 7469  o-called `negati
001efb0: 6f6e 206e 6f72 6d61 6c20 666f 726d 2720  on normal form' 
001efc0: 284e 4e46 292e 2057 6520 6465 6669 6e65  (NNF). We define
001efd0: 2074 776f 206d 7574 7561 6c6c 7920 7265   two mutually re
001efe0: 6375 7273 6976 650a 6675 6e63 7469 6f6e  cursive.function
001eff0: 7320 7468 6174 2063 7265 6174 6520 4e4e  s that create NN
001f000: 4620 666f 7220 6120 666f 726d 756c 612c  F for a formula,
001f010: 2061 6e64 0a69 7473 206e 6567 6174 696f   and.its negatio
001f020: 6e2e 0a0a 5c62 6567 696e 7b62 6f78 6564  n...\begin{boxed
001f030: 7d5c 6265 6769 6e7b 6c73 746c 6973 7469  }\begin{lstlisti
001f040: 6e67 7d0a 2020 6c65 7420 7265 6320 6e6e  ng}.  let rec nn
001f050: 665f 7020 746d 203d 0a20 2020 206d 6174  f_p tm =.    mat
001f060: 6368 2074 6d20 7769 7468 0a20 2020 2020  ch tm with.     
001f070: 2046 6e28 227e 222c 5b74 5d29 202d 3e20   Fn("~",[t]) -> 
001f080: 6e6e 665f 6e20 740a 2020 2020 7c20 466e  nnf_n t.    | Fn
001f090: 2822 2622 2c5b 7431 3b20 7432 5d29 202d  ("&",[t1; t2]) -
001f0a0: 3e20 466e 2822 2622 2c5b 6e6e 665f 7020  > Fn("&",[nnf_p 
001f0b0: 7431 3b20 6e6e 665f 7020 7432 5d29 0a20  t1; nnf_p t2]). 
001f0c0: 2020 207c 2046 6e28 227c 222c 5b74 313b     | Fn("|",[t1;
001f0d0: 2074 325d 2920 2d3e 2046 6e28 227c 222c   t2]) -> Fn("|",
001f0e0: 5b6e 6e66 5f70 2074 313b 206e 6e66 5f70  [nnf_p t1; nnf_p
001f0f0: 2074 325d 290a 2020 2020 7c20 466e 2822   t2]).    | Fn("
001f100: 666f 7261 6c6c 222c 5b78 3b20 745d 2920  forall",[x; t]) 
001f110: 2d3e 2046 6e28 2266 6f72 616c 6c22 2c5b  -> Fn("forall",[
001f120: 783b 206e 6e66 5f70 2074 5d29 0a20 2020  x; nnf_p t]).   
001f130: 207c 2046 6e28 2265 7869 7374 7322 2c5b   | Fn("exists",[
001f140: 783b 2074 5d29 202d 3e20 466e 2822 6578  x; t]) -> Fn("ex
001f150: 6973 7473 222c 5b78 3b20 6e6e 665f 7020  ists",[x; nnf_p 
001f160: 745d 290a 2020 2020 7c20 7420 2d3e 2074  t]).    | t -> t
001f170: 0a0a 2020 616e 6420 6e6e 665f 6e20 746d  ..  and nnf_n tm
001f180: 203d 0a20 2020 206d 6174 6368 2074 6d20   =.    match tm 
001f190: 7769 7468 0a20 2020 2020 2046 6e28 227e  with.      Fn("~
001f1a0: 222c 5b74 5d29 202d 3e20 6e6e 665f 7020  ",[t]) -> nnf_p 
001f1b0: 740a 2020 2020 7c20 466e 2822 2622 2c5b  t.    | Fn("&",[
001f1c0: 7431 3b20 7432 5d29 202d 3e20 466e 2822  t1; t2]) -> Fn("
001f1d0: 7c22 2c5b 6e6e 665f 6e20 7431 3b20 6e6e  |",[nnf_n t1; nn
001f1e0: 665f 6e20 7432 5d29 0a20 2020 207c 2046  f_n t2]).    | F
001f1f0: 6e28 227c 222c 5b74 313b 2074 325d 2920  n("|",[t1; t2]) 
001f200: 2d3e 2046 6e28 2226 222c 5b6e 6e66 5f6e  -> Fn("&",[nnf_n
001f210: 2074 313b 206e 6e66 5f6e 2074 325d 290a   t1; nnf_n t2]).
001f220: 2020 2020 7c20 466e 2822 666f 7261 6c6c      | Fn("forall
001f230: 222c 5b78 3b20 745d 2920 2d3e 2046 6e28  ",[x; t]) -> Fn(
001f240: 2265 7869 7374 7322 2c5b 783b 206e 6e66  "exists",[x; nnf
001f250: 5f6e 2074 5d29 0a20 2020 207c 2046 6e28  _n t]).    | Fn(
001f260: 2265 7869 7374 7322 2c5b 783b 2074 5d29  "exists",[x; t])
001f270: 202d 3e20 466e 2822 666f 7261 6c6c 222c   -> Fn("forall",
001f280: 5b78 3b20 6e6e 665f 6e20 745d 290a 2020  [x; nnf_n t]).  
001f290: 2020 7c20 7420 2d3e 2046 6e28 227e 222c    | t -> Fn("~",
001f2a0: 5b74 5d29 3b3b 0a5c 656e 647b 6c73 746c  [t]);;.\end{lstl
001f2b0: 6973 7469 6e67 7d5c 656e 647b 626f 7865  isting}\end{boxe
001f2c0: 647d 0a0a 5765 2077 696c 6c20 636f 6e76  d}..We will conv
001f2d0: 6572 7420 7468 6520 6e65 6761 7469 6f6e  ert the negation
001f2e0: 206f 6620 7468 6520 696e 7075 7420 666f   of the input fo
001f2f0: 726d 756c 6120 696e 746f 206e 6567 6174  rmula into negat
001f300: 696f 6e20 6e6f 726d 616c 2066 6f72 6d2c  ion normal form,
001f310: 0a61 6e64 2074 6865 206d 6169 6e20 7072  .and the main pr
001f320: 6f76 6572 2077 696c 6c20 7468 656e 2074  over will then t
001f330: 7279 2074 6f20 6465 7269 7665 2061 2063  ry to derive a c
001f340: 6f6e 7472 6164 6963 7469 6f6e 2066 726f  ontradiction fro
001f350: 6d20 6974 2e20 5468 6973 2077 696c 6c0a  m it. This will.
001f360: 7375 6666 6963 6520 746f 2070 726f 7665  suffice to prove
001f370: 2074 6865 206f 7269 6769 6e61 6c20 666f   the original fo
001f380: 726d 756c 612e 0a0a 5c73 7562 7375 6273  rmula...\subsubs
001f390: 6563 7469 6f6e 2a7b 5468 6520 6d61 696e  ection*{The main
001f3a0: 2070 726f 7665 727d 0a0a 4174 2065 6163   prover}..At eac
001f3b0: 6820 7374 6167 652c 2074 6865 2070 726f  h stage, the pro
001f3c0: 7665 7220 6861 7320 6120 6375 7272 656e  ver has a curren
001f3d0: 7420 666f 726d 756c 612c 2061 206c 6973  t formula, a lis
001f3e0: 7420 6f66 2066 6f72 6d75 6c61 7320 7965  t of formulas ye
001f3f0: 7420 746f 2062 650a 636f 6e73 6964 6572  t to be.consider
001f400: 6564 2c20 616e 6420 6120 6c69 7374 206f  ed, and a list o
001f410: 6620 6c69 7465 7261 6c73 2e20 4974 2069  f literals. It i
001f420: 7320 7472 7969 6e67 2074 6f20 7265 6163  s trying to reac
001f430: 6820 6120 636f 6e74 7261 6469 6374 696f  h a contradictio
001f440: 6e2e 2054 6865 0a66 6f6c 6c6f 7769 6e67  n. The.following
001f450: 2073 7472 6174 6567 7920 6973 2065 6d70   strategy is emp
001f460: 6c6f 7965 643a 0a0a 5c62 6567 696e 7b69  loyed:..\begin{i
001f470: 7465 6d69 7a65 7d0a 0a5c 6974 656d 2049  temize}..\item I
001f480: 6620 7468 6520 6375 7272 656e 7420 666f  f the current fo
001f490: 726d 756c 6120 6973 2060 7020 7b5c 7665  rmula is `p {\ve
001f4a0: 7262 2b26 2b7d 2071 272c 2074 6865 6e20  rb+&+} q', then 
001f4b0: 636f 6e73 6964 6572 0a60 7027 2061 6e64  consider.`p' and
001f4c0: 2060 7127 2073 6570 6172 6174 656c 792c   `q' separately,
001f4d0: 2069 2e65 2e20 6d61 6b65 2060 7027 2074   i.e. make `p' t
001f4e0: 6865 2063 7572 7265 6e74 2066 6f72 6d75  he current formu
001f4f0: 6c61 2061 6e64 2061 6464 0a60 7127 2074  la and add.`q' t
001f500: 6f20 7468 6520 666f 726d 756c 6173 2074  o the formulas t
001f510: 6f20 6265 2063 6f6e 7369 6465 7265 642e  o be considered.
001f520: 0a0a 5c69 7465 6d20 4966 2074 6865 2063  ..\item If the c
001f530: 7572 7265 6e74 2066 6f72 6d75 6c61 2069  urrent formula i
001f540: 7320 6070 207b 5c76 6572 622b 7c2b 7d20  s `p {\verb+|+} 
001f550: 7127 2c20 7468 656e 2074 7279 2074 6f20  q', then try to 
001f560: 6765 7420 610a 636f 6e74 7261 6469 6374  get a.contradict
001f570: 696f 6e20 6672 6f6d 2060 7027 2061 6e64  ion from `p' and
001f580: 2074 6865 6e20 6f6e 6520 6672 6f6d 2060   then one from `
001f590: 7127 2e0a 0a5c 6974 656d 2049 6620 7468  q'...\item If th
001f5a0: 6520 6375 7272 656e 7420 666f 726d 756c  e current formul
001f5b0: 6120 6973 2060 666f 7261 6c6c 2858 2c70  a is `forall(X,p
001f5c0: 2927 2c20 696e 7665 6e74 2061 206e 6577  )', invent a new
001f5d0: 2076 6172 6961 626c 6520 746f 0a72 6570   variable to.rep
001f5e0: 6c61 6365 2060 5827 3a20 7468 6520 7269  lace `X': the ri
001f5f0: 6768 7420 7661 6c75 6520 6361 6e20 6265  ght value can be
001f600: 2064 6973 636f 7665 7265 6420 6c61 7465   discovered late
001f610: 7220 6279 2075 6e69 6669 6361 7469 6f6e  r by unification
001f620: 2e0a 0a5c 6974 656d 2049 6620 7468 6520  ...\item If the 
001f630: 6375 7272 656e 7420 666f 726d 756c 6120  current formula 
001f640: 6973 2060 6578 6973 7473 2858 2c70 2927  is `exists(X,p)'
001f650: 2c20 696e 7665 6e74 2061 206e 6577 2063  , invent a new c
001f660: 6f6e 7374 616e 7420 746f 0a72 6570 6c61  onstant to.repla
001f670: 6365 2060 5827 2e0a 0a5c 6974 656d 204f  ce `X'...\item O
001f680: 7468 6572 7769 7365 2c20 7468 6520 666f  therwise, the fo
001f690: 726d 756c 6120 6d75 7374 2062 6520 6120  rmula must be a 
001f6a0: 6c69 7465 7261 6c2c 2073 6f20 7472 7920  literal, so try 
001f6b0: 746f 2075 6e69 6679 2069 7420 7769 7468  to unify it with
001f6c0: 2061 0a63 6f6e 7472 6164 6963 746f 7279   a.contradictory
001f6d0: 206c 6974 6572 616c 2e0a 0a5c 6974 656d   literal...\item
001f6e0: 2049 6620 7468 6973 2066 6169 6c73 2c20   If this fails, 
001f6f0: 6164 6420 6974 2074 6f20 7468 6520 6c69  add it to the li
001f700: 7374 206f 6620 6c69 7465 7261 6c73 2c20  st of literals, 
001f710: 616e 6420 7072 6f63 6565 6420 7769 7468  and proceed with
001f720: 2074 6865 206e 6578 740a 666f 726d 756c   the next.formul
001f730: 612e 0a0a 5c65 6e64 7b69 7465 6d69 7a65  a...\end{itemize
001f740: 7d0a 0a57 6520 6465 7369 7265 2061 2073  }..We desire a s
001f750: 696d 696c 6172 2062 6163 6b74 7261 636b  imilar backtrack
001f760: 696e 6720 7374 7261 7465 6779 2074 6f20  ing strategy to 
001f770: 5072 6f6c 6f67 3a20 6f6e 6c79 2069 6620  Prolog: only if 
001f780: 7468 6520 6375 7272 656e 740a 696e 7374  the current.inst
001f790: 616e 7469 6174 696f 6e20 616c 6c6f 7720  antiation allow 
001f7a0: 616c 6c20 7265 6d61 696e 696e 6720 676f  all remaining go
001f7b0: 616c 7320 746f 2062 6520 736f 6c76 6564  als to be solved
001f7c0: 2064 6f20 7765 2061 6363 6570 7420 6974   do we accept it
001f7d0: 2e20 5765 2063 6f75 6c64 0a75 7365 206c  . We could.use l
001f7e0: 6973 7473 2061 6761 696e 2c20 6275 7420  ists again, but 
001f7f0: 696e 7374 6561 6420 7765 2075 7365 207b  instead we use {
001f800: 5c65 6d20 636f 6e74 696e 7561 7469 6f6e  \em continuation
001f810: 737d 2e20 4120 636f 6e74 696e 7561 7469  s}. A continuati
001f820: 6f6e 2069 7320 610a 6675 6e63 7469 6f6e  on is a.function
001f830: 2074 6861 7420 6973 2070 6173 7365 6420   that is passed 
001f840: 746f 2061 6e6f 7468 6572 2066 756e 6374  to another funct
001f850: 696f 6e20 616e 6420 6361 6e20 6265 2063  ion and can be c
001f860: 616c 6c65 6420 6672 6f6d 2077 6974 6869  alled from withi
001f870: 6e20 6974 2074 6f0a 6070 6572 666f 726d  n it to.`perform
001f880: 2074 6865 2072 6573 7420 6f66 2074 6865   the rest of the
001f890: 2063 6f6d 7075 7461 7469 6f6e 272e 2049   computation'. I
001f8a0: 6e20 6f75 7220 6361 7365 2c20 6974 2074  n our case, it t
001f8b0: 616b 6573 2061 206c 6973 7420 6f66 0a69  akes a list of.i
001f8c0: 6e73 7461 6e74 6961 7469 6f6e 7320 616e  nstantiations an
001f8d0: 6420 7472 6965 7320 746f 2073 6f6c 7665  d tries to solve
001f8e0: 2074 6865 2072 656d 6169 6e69 6e67 2067   the remaining g
001f8f0: 6f61 6c73 2075 6e64 6572 2074 6865 7365  oals under these
001f900: 0a69 6e73 7461 6e74 6961 7469 6f6e 732e  .instantiations.
001f910: 2054 6875 732c 2072 6174 6865 7220 7468   Thus, rather th
001f920: 616e 2065 7870 6c69 6369 746c 7920 7472  an explicitly tr
001f930: 7969 6e67 2074 6f20 736f 6c76 6520 616c  ying to solve al
001f940: 6c20 7265 6d61 696e 696e 670a 676f 616c  l remaining.goal
001f950: 732c 2077 6520 7369 6d70 6c79 2074 7279  s, we simply try
001f960: 2063 616c 6c69 6e67 2074 6865 2063 6f6e   calling the con
001f970: 7469 6e75 6174 696f 6e2e 0a0a 5c62 6567  tinuation...\beg
001f980: 696e 7b62 6f78 6564 7d5c 6265 6769 6e7b  in{boxed}\begin{
001f990: 6c73 746c 6973 7469 6e67 7d0a 2020 6c65  lstlisting}.  le
001f9a0: 7420 7265 6320 7072 6f76 6520 666d 2075  t rec prove fm u
001f9b0: 6e65 7870 2070 6c20 6e6c 206e 2063 6f6e  nexp pl nl n con
001f9c0: 7420 6920 3d0a 2020 2020 6966 206e 203c  t i =.    if n <
001f9d0: 2030 2074 6865 6e20 7261 6973 6520 2865   0 then raise (e
001f9e0: 7272 6f72 2022 4e6f 2070 726f 6f66 2229  rror "No proof")
001f9f0: 2065 6c73 650a 2020 2020 6d61 7463 6820   else.    match 
001fa00: 666d 2077 6974 680a 2020 2020 2020 466e  fm with.      Fn
001fa10: 2822 2622 2c5b 703b 715d 2920 2d3e 0a20  ("&",[p;q]) ->. 
001fa20: 2020 2020 2020 2020 2070 726f 7665 2070           prove p
001fa30: 2028 713a 3a75 6e65 7870 2920 706c 206e   (q::unexp) pl n
001fa40: 6c20 6e20 636f 6e74 2069 0a20 2020 207c  l n cont i.    |
001fa50: 2046 6e28 227c 222c 5b70 3b71 5d29 202d   Fn("|",[p;q]) -
001fa60: 3e0a 2020 2020 2020 2020 2020 7072 6f76  >.          prov
001fa70: 6520 7020 756e 6578 7020 706c 206e 6c20  e p unexp pl nl 
001fa80: 6e0a 2020 2020 2020 2020 2020 2870 726f  n.          (pro
001fa90: 7665 2071 2075 6e65 7870 2070 6c20 6e6c  ve q unexp pl nl
001faa0: 206e 2063 6f6e 7429 2069 0a20 2020 207c   n cont) i.    |
001fab0: 2046 6e28 2266 6f72 616c 6c22 2c5b 5661   Fn("forall",[Va
001fac0: 7220 783b 2070 5d29 202d 3e0a 2020 2020  r x; p]) ->.    
001fad0: 2020 2020 2020 6c65 7420 7620 3d20 6d6b        let v = mk
001fae0: 7661 7228 2920 696e 0a20 2020 2020 2020  var() in.       
001faf0: 2020 2070 726f 7665 2028 7375 6273 7420     prove (subst 
001fb00: 5b78 2c56 6172 2076 5d20 7029 2028 756e  [x,Var v] p) (un
001fb10: 6578 7040 5b66 6d5d 2920 706c 206e 6c20  exp@[fm]) pl nl 
001fb20: 286e 202d 2031 2920 636f 6e74 2069 0a20  (n - 1) cont i. 
001fb30: 2020 207c 2046 6e28 2265 7869 7374 7322     | Fn("exists"
001fb40: 2c5b 5661 7220 783b 2070 5d29 202d 3e0a  ,[Var x; p]) ->.
001fb50: 2020 2020 2020 2020 2020 6c65 7420 7620            let v 
001fb60: 3d20 6d6b 7661 7228 2920 696e 0a20 2020  = mkvar() in.   
001fb70: 2020 2020 2020 2070 726f 7665 2028 7375         prove (su
001fb80: 6273 7420 5b78 2c46 6e28 762c 5b5d 295d  bst [x,Fn(v,[])]
001fb90: 2070 2920 756e 6578 7020 706c 206e 6c20   p) unexp pl nl 
001fba0: 286e 202d 2031 2920 636f 6e74 2069 0a20  (n - 1) cont i. 
001fbb0: 2020 207c 2046 6e28 227e 222c 5b74 5d29     | Fn("~",[t])
001fbc0: 202d 3e0a 2020 2020 2020 2020 2020 2874   ->.          (t
001fbd0: 7279 2066 6972 7374 2028 6675 6e20 7427  ry first (fun t'
001fbe0: 202d 3e20 6c65 7420 6927 203d 2075 6e69   -> let i' = uni
001fbf0: 6679 2074 2074 2720 6920 696e 0a20 2020  fy t t' i in.   
001fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
001fc10: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
001fc20: 7420 6927 2920 706c 0a20 2020 2020 2020  t i') pl.       
001fc30: 2020 2020 7769 7468 2065 7272 6f72 205f      with error _
001fc40: 202d 3e0a 2020 2020 2020 2020 2020 2020   ->.            
001fc50: 2020 7072 6f76 6520 2868 6420 756e 6578    prove (hd unex
001fc60: 7029 2028 746c 2075 6e65 7870 2920 706c  p) (tl unexp) pl
001fc70: 2028 743a 3a6e 6c29 206e 2063 6f6e 7420   (t::nl) n cont 
001fc80: 6929 0a20 2020 207c 2074 202d 3e0a 2020  i).    | t ->.  
001fc90: 2020 2020 2020 2020 2874 7279 2066 6972          (try fir
001fca0: 7374 2028 6675 6e20 7427 202d 3e20 6c65  st (fun t' -> le
001fcb0: 7420 6927 203d 2075 6e69 6679 2074 2074  t i' = unify t t
001fcc0: 2720 6920 696e 0a20 2020 2020 2020 2020  ' i in.         
001fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
001fce0: 2020 2020 2020 2063 6f6e 7420 6927 2920         cont i') 
001fcf0: 6e6c 0a20 2020 2020 2020 2020 2020 7769  nl.           wi
001fd00: 7468 2065 7272 6f72 205f 202d 3e0a 2020  th error _ ->.  
001fd10: 2020 2020 2020 2020 2020 2020 7072 6f76              prov
001fd20: 6520 2868 6420 756e 6578 7029 2028 746c  e (hd unexp) (tl
001fd30: 2075 6e65 7870 2920 2874 3a3a 706c 2920   unexp) (t::pl) 
001fd40: 6e6c 206e 2063 6f6e 7420 6929 3b3b 0a5c  nl n cont i);;.\
001fd50: 656e 647b 6c73 746c 6973 7469 6e67 7d5c  end{lstlisting}\
001fd60: 656e 647b 626f 7865 647d 0a0a 5c6e 6f69  end{boxed}..\noi
001fd70: 6e64 656e 7420 5765 2073 6574 2075 7020  ndent We set up 
001fd80: 7468 6520 6669 6e61 6c20 7072 6f76 6572  the final prover
001fd90: 2061 7320 666f 6c6c 6f77 733a 0a0a 5c62   as follows:..\b
001fda0: 6567 696e 7b62 6f78 6564 7d5c 6265 6769  egin{boxed}\begi
001fdb0: 6e7b 6c73 746c 6973 7469 6e67 7d0a 2020  n{lstlisting}.  
001fdc0: 6c65 7420 7072 6f76 6572 203d 0a20 2020  let prover =.   
001fdd0: 206c 6574 2072 6563 2070 726f 7665 5f69   let rec prove_i
001fde0: 7465 7220 6e20 7420 3d0a 2020 2020 2020  ter n t =.      
001fdf0: 7472 7920 6c65 7420 696e 7374 7320 3d20  try let insts = 
001fe00: 7072 6f76 6520 7420 5b5d 205b 5d20 5b5d  prove t [] [] []
001fe10: 206e 2049 205b 5d20 696e 0a20 2020 2020   n I [] in.     
001fe20: 2020 2020 206c 6574 2067 6c6f 6269 6e73       let globins
001fe30: 7473 203d 2066 696c 7465 720a 2020 2020  ts = filter.    
001fe40: 2020 2020 2020 2020 2866 756e 2028 762c          (fun (v,
001fe50: 5f29 202d 3e20 6f63 6375 7273 5f69 6e20  _) -> occurs_in 
001fe60: 7620 7429 2069 6e73 7473 2069 6e0a 2020  v t) insts in.  
001fe70: 2020 2020 2020 2020 6e2c 676c 6f62 696e          n,globin
001fe80: 7374 730a 2020 2020 2020 7769 7468 2065  sts.      with e
001fe90: 7272 6f72 205f 202d 3e20 7072 6f76 655f  rror _ -> prove_
001fea0: 6974 6572 2028 6e20 2b20 3129 2074 2069  iter (n + 1) t i
001feb0: 6e0a 2020 2020 6675 6e20 7420 2d3e 2070  n.    fun t -> p
001fec0: 726f 7665 5f69 7465 7220 3020 286e 6e66  rove_iter 0 (nnf
001fed0: 5f6e 2870 726f 6328 7061 7273 655f 7465  _n(proc(parse_te
001fee0: 726d 2074 2929 293b 3b0a 5c65 6e64 7b6c  rm t)));;.\end{l
001fef0: 7374 6c69 7374 696e 677d 5c65 6e64 7b62  stlisting}\end{b
001ff00: 6f78 6564 7d0a 0a54 6869 7320 696d 706c  oxed}..This impl
001ff10: 656d 656e 7473 2074 6865 2069 7465 7261  ements the itera
001ff20: 7469 7665 2064 6565 7065 6e69 6e67 2073  tive deepening s
001ff30: 7472 6174 6567 792e 2049 7420 7472 6965  trategy. It trie
001ff40: 7320 746f 2066 696e 6420 7468 6520 7072  s to find the pr
001ff50: 6f6f 660a 7769 7468 2074 6865 2066 6577  oof.with the few
001ff60: 6573 7420 756e 6976 6572 7361 6c20 696e  est universal in
001ff70: 7374 616e 7469 6174 696f 6e73 3b20 6966  stantiations; if
001ff80: 2069 7420 7375 6363 6565 6473 2c20 6974   it succeeds, it
001ff90: 2072 6574 7572 6e73 2074 6865 206e 756d   returns the num
001ffa0: 6265 720a 7265 7175 6972 6564 2061 6e64  ber.required and
001ffb0: 2061 6e79 2074 6f70 6c65 7665 6c20 696e   any toplevel in
001ffc0: 7374 616e 7469 6174 696f 6e73 2c20 7468  stantiations, th
001ffd0: 726f 7769 6e67 2061 7761 7920 696e 7374  rowing away inst
001ffe0: 616e 7469 6174 696f 6e73 2066 6f72 0a69  antiations for.i
001fff0: 6e74 6572 6e61 6c6c 7920 6372 6561 7465  nternally create
0020000: 6420 7661 7269 6162 6c65 732e 0a0a 5c73  d variables...\s
0020010: 7562 7375 6273 6563 7469 6f6e 2a7b 4578  ubsubsection*{Ex
0020020: 616d 706c 6573 7d0a 0a48 6572 6520 6172  amples}..Here ar
0020030: 6520 736f 6d65 2073 696d 706c 6520 6578  e some simple ex
0020040: 616d 706c 6573 2066 726f 6d20 5c63 6974  amples from \cit
0020050: 654e 7b70 656c 6c65 7469 6572 2d70 726f  eN{pelletier-pro
0020060: 626c 656d 737d 2e0a 0a5c 6265 6769 6e7b  blems}...\begin{
0020070: 626f 7865 647d 5c62 6567 696e 7b76 6572  boxed}\begin{ver
0020080: 6261 7469 6d7d 0a20 2023 6c65 7420 5031  batim}.  #let P1
0020090: 203d 2070 726f 7665 7220 2270 202d 2d3e   = prover "p -->
00200a0: 2071 203c 2d3e 207e 2871 2920 2d2d 3e20   q <-> ~(q) --> 
00200b0: 7e28 7029 223b 3b0a 2020 5031 203a 2069  ~(p)";;.  P1 : i
00200c0: 6e74 202a 2028 7374 7269 6e67 202a 2074  nt * (string * t
00200d0: 6572 6d29 206c 6973 7420 3d20 302c 205b  erm) list = 0, [
00200e0: 5d0a 2020 236c 6574 2050 3133 203d 2070  ].  #let P13 = p
00200f0: 726f 7665 7220 2270 207c 2071 2026 2072  rover "p | q & r
0020100: 203c 2d3e 2028 7020 7c20 7129 2026 2028   <-> (p | q) & (
0020110: 7020 7c20 7229 223b 3b0a 2020 5031 3320  p | r)";;.  P13 
0020120: 3a20 696e 7420 2a20 2873 7472 696e 6720  : int * (string 
0020130: 2a20 7465 726d 2920 6c69 7374 203d 2030  * term) list = 0
0020140: 2c20 5b5d 0a20 2023 6c65 7420 5031 3620  , [].  #let P16 
0020150: 3d20 7072 6f76 6572 2022 2870 202d 2d3e  = prover "(p -->
0020160: 2071 2920 7c20 2871 202d 2d3e 2070 2922   q) | (q --> p)"
0020170: 3b3b 0a20 2050 3136 203a 2069 6e74 202a  ;;.  P16 : int *
0020180: 2028 7374 7269 6e67 202a 2074 6572 6d29   (string * term)
0020190: 206c 6973 7420 3d20 302c 205b 5d0a 2020   list = 0, [].  
00201a0: 236c 6574 2050 3138 203d 2070 726f 7665  #let P18 = prove
00201b0: 7220 2265 7869 7374 7328 592c 666f 7261  r "exists(Y,fora
00201c0: 6c6c 2858 2c70 2859 292d 2d3e 7028 5829  ll(X,p(Y)-->p(X)
00201d0: 2929 223b 3b0a 2020 5031 3820 3a20 696e  ))";;.  P18 : in
00201e0: 7420 2a20 2873 7472 696e 6720 2a20 7465  t * (string * te
00201f0: 726d 2920 6c69 7374 203d 2032 2c20 5b5d  rm) list = 2, []
0020200: 0a20 2023 6c65 7420 5031 3920 3d20 7072  .  #let P19 = pr
0020210: 6f76 6572 2022 6578 6973 7473 2858 2c66  over "exists(X,f
0020220: 6f72 616c 6c28 592c 666f 7261 6c6c 285a  orall(Y,forall(Z
0020230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
0020240: 2020 2020 2870 2859 292d 2d3e 7128 5a29      (p(Y)-->q(Z)
0020250: 292d 2d3e 7028 5829 2d2d 3e71 2858 2929  )-->p(X)-->q(X))
0020260: 2929 223b 3b0a 2020 5031 3920 3a20 696e  ))";;.  P19 : in
0020270: 7420 2a20 2873 7472 696e 6720 2a20 7465  t * (string * te
0020280: 726d 2920 6c69 7374 203d 2036 2c20 5b5d  rm) list = 6, []
0020290: 0a5c 656e 647b 7665 7262 6174 696d 7d5c  .\end{verbatim}\
00202a0: 656e 647b 626f 7865 647d 0a0a 5c6e 6f69  end{boxed}..\noi
00202b0: 6e64 656e 7420 4120 6269 6767 6572 2065  ndent A bigger e
00202c0: 7861 6d70 6c65 2069 7320 7468 6520 666f  xample is the fo
00202d0: 6c6c 6f77 696e 673a 0a0a 5c62 6567 696e  llowing:..\begin
00202e0: 7b62 6f78 6564 7d5c 6265 6769 6e7b 7665  {boxed}\begin{ve
00202f0: 7262 6174 696d 7d0a 2020 236c 6574 2050  rbatim}.  #let P
0020300: 3535 203d 2070 726f 7665 720a 2020 2020  55 = prover.    
0020310: 226c 6976 6573 2861 6761 7468 6129 2026  "lives(agatha) &
0020320: 206c 6976 6573 2862 7574 6c65 7229 2026   lives(butler) &
0020330: 206c 6976 6573 2863 6861 726c 6573 2920   lives(charles) 
0020340: 260a 2020 2020 2028 6b69 6c6c 6564 2861  &.     (killed(a
0020350: 6761 7468 612c 6167 6174 6861 2920 7c20  gatha,agatha) | 
0020360: 6b69 6c6c 6564 2862 7574 6c65 722c 6167  killed(butler,ag
0020370: 6174 6861 2920 7c0a 2020 2020 2020 6b69  atha) |.      ki
0020380: 6c6c 6564 2863 6861 726c 6573 2c61 6761  lled(charles,aga
0020390: 7468 6129 2920 260a 2020 2020 2028 666f  tha)) &.     (fo
00203a0: 7261 6c6c 2858 2c66 6f72 616c 6c28 592c  rall(X,forall(Y,
00203b0: 0a20 2020 2020 2020 6b69 6c6c 6564 2858  .       killed(X
00203c0: 2c59 2920 2d2d 3e20 6861 7465 7328 582c  ,Y) --> hates(X,
00203d0: 5929 2026 207e 2872 6963 6865 7228 582c  Y) & ~(richer(X,
00203e0: 5929 2929 2929 2026 0a20 2020 2020 2866  Y))))) &.     (f
00203f0: 6f72 616c 6c28 582c 6861 7465 7328 6167  orall(X,hates(ag
0020400: 6174 6861 2c58 290a 2020 2020 2020 2020  atha,X).        
0020410: 2020 2020 2020 202d 2d3e 207e 2868 6174         --> ~(hat
0020420: 6573 2863 6861 726c 6573 2c58 2929 2929  es(charles,X))))
0020430: 2026 0a20 2020 2020 2868 6174 6573 2861   &.     (hates(a
0020440: 6761 7468 612c 6167 6174 6861 2920 2620  gatha,agatha) & 
0020450: 6861 7465 7328 6167 6174 6861 2c63 6861  hates(agatha,cha
0020460: 726c 6573 2929 2026 0a20 2020 2020 2866  rles)) &.     (f
0020470: 6f72 616c 6c28 582c 6c69 7665 7328 5829  orall(X,lives(X)
0020480: 2026 207e 2872 6963 6865 7228 582c 6167   & ~(richer(X,ag
0020490: 6174 6861 2929 0a20 2020 2020 2020 2020  atha)).         
00204a0: 2020 2020 2020 2d2d 3e20 6861 7465 7328        --> hates(
00204b0: 6275 746c 6572 2c58 2929 2920 260a 2020  butler,X))) &.  
00204c0: 2020 2028 666f 7261 6c6c 2858 2c68 6174     (forall(X,hat
00204d0: 6573 2861 6761 7468 612c 5829 202d 2d3e  es(agatha,X) -->
00204e0: 2068 6174 6573 2862 7574 6c65 722c 5829   hates(butler,X)
00204f0: 2929 2026 0a20 2020 2020 2866 6f72 616c  )) &.     (foral
0020500: 6c28 582c 7e28 6861 7465 7328 582c 6167  l(X,~(hates(X,ag
0020510: 6174 6861 2929 207c 207e 2868 6174 6573  atha)) | ~(hates
0020520: 2858 2c62 7574 6c65 7229 290a 2020 2020  (X,butler)).    
0020530: 2020 2020 2020 2020 2020 207c 207e 2868             | ~(h
0020540: 6174 6573 2858 2c63 6861 726c 6573 2929  ates(X,charles))
0020550: 2929 0a20 2020 2020 2d2d 3e20 6b69 6c6c  )).     --> kill
0020560: 6564 2861 6761 7468 612c 6167 6174 6861  ed(agatha,agatha
0020570: 2922 3b3b 0a20 2050 3535 203a 2069 6e74  )";;.  P55 : int
0020580: 202a 2028 7374 7269 6e67 202a 2074 6572   * (string * ter
0020590: 6d29 206c 6973 7420 3d20 362c 205b 5d0a  m) list = 6, [].
00205a0: 5c65 6e64 7b76 6572 6261 7469 6d7d 5c65  \end{verbatim}\e
00205b0: 6e64 7b62 6f78 6564 7d0a 0a5c 6e6f 696e  nd{boxed}..\noin
00205c0: 6465 6e74 2049 6e20 6661 6374 2c20 7468  dent In fact, th
00205d0: 6520 7072 6f76 6572 2063 616e 2077 6f72  e prover can wor
00205e0: 6b20 6f75 7420 6077 686f 6475 6e69 7427  k out `whodunit'
00205f0: 3a0a 0a5c 6265 6769 6e7b 626f 7865 647d  :..\begin{boxed}
0020600: 5c62 6567 696e 7b76 6572 6261 7469 6d7d  \begin{verbatim}
0020610: 0a20 2023 6c65 7420 5035 3527 203d 2070  .  #let P55' = p
0020620: 726f 7665 720a 2020 2020 226c 6976 6573  rover.    "lives
0020630: 2861 6761 7468 6129 2026 206c 6976 6573  (agatha) & lives
0020640: 2862 7574 6c65 7229 2026 206c 6976 6573  (butler) & lives
0020650: 2863 6861 726c 6573 2920 260a 2020 2020  (charles) &.    
0020660: 2028 6b69 6c6c 6564 2861 6761 7468 612c   (killed(agatha,
0020670: 6167 6174 6861 2920 7c20 6b69 6c6c 6564  agatha) | killed
0020680: 2862 7574 6c65 722c 6167 6174 6861 2920  (butler,agatha) 
0020690: 7c0a 2020 2020 2020 6b69 6c6c 6564 2863  |.      killed(c
00206a0: 6861 726c 6573 2c61 6761 7468 6129 2920  harles,agatha)) 
00206b0: 260a 2020 2020 2028 666f 7261 6c6c 2858  &.     (forall(X
00206c0: 2c66 6f72 616c 6c28 592c 0a20 2020 2020  ,forall(Y,.     
00206d0: 2020 6b69 6c6c 6564 2858 2c59 2920 2d2d    killed(X,Y) --
00206e0: 3e20 6861 7465 7328 582c 5929 2026 207e  > hates(X,Y) & ~
00206f0: 2872 6963 6865 7228 582c 5929 2929 2929  (richer(X,Y)))))
0020700: 2026 0a20 2020 2020 2866 6f72 616c 6c28   &.     (forall(
0020710: 582c 6861 7465 7328 6167 6174 6861 2c58  X,hates(agatha,X
0020720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
0020730: 202d 2d3e 207e 2868 6174 6573 2863 6861   --> ~(hates(cha
0020740: 726c 6573 2c58 2929 2929 2026 0a20 2020  rles,X)))) &.   
0020750: 2020 2868 6174 6573 2861 6761 7468 612c    (hates(agatha,
0020760: 6167 6174 6861 2920 2620 6861 7465 7328  agatha) & hates(
0020770: 6167 6174 6861 2c63 6861 726c 6573 2929  agatha,charles))
0020780: 2026 0a20 2020 2020 2866 6f72 616c 6c28   &.     (forall(
0020790: 582c 6c69 7665 7328 5829 2026 207e 2872  X,lives(X) & ~(r
00207a0: 6963 6865 7228 582c 6167 6174 6861 2929  icher(X,agatha))
00207b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
00207c0: 2d2d 3e20 6861 7465 7328 6275 746c 6572  --> hates(butler
00207d0: 2c58 2929 2920 260a 2020 2020 2028 666f  ,X))) &.     (fo
00207e0: 7261 6c6c 2858 2c68 6174 6573 2861 6761  rall(X,hates(aga
00207f0: 7468 612c 5829 202d 2d3e 2068 6174 6573  tha,X) --> hates
0020800: 2862 7574 6c65 722c 5829 2929 2026 0a20  (butler,X))) &. 
0020810: 2020 2020 2866 6f72 616c 6c28 582c 7e28      (forall(X,~(
0020820: 6861 7465 7328 582c 6167 6174 6861 2929  hates(X,agatha))
0020830: 207c 207e 2868 6174 6573 2858 2c62 7574   | ~(hates(X,but
0020840: 6c65 7229 290a 2020 2020 2020 2020 2020  ler)).          
0020850: 2020 2020 207c 207e 2868 6174 6573 2858       | ~(hates(X
0020860: 2c63 6861 726c 6573 2929 2929 0a20 2020  ,charles)))).   
0020870: 2020 2d2d 3e20 6b69 6c6c 6564 2858 2c61    --> killed(X,a
0020880: 6761 7468 6129 223b 3b0a 2020 5035 3527  gatha)";;.  P55'
0020890: 203a 2069 6e74 202a 2028 7374 7269 6e67   : int * (string
00208a0: 202a 2074 6572 6d29 206c 6973 7420 3d20   * term) list = 
00208b0: 362c 205b 2258 222c 2060 6167 6174 6861  6, ["X", `agatha
00208c0: 605d 0a5c 656e 647b 7665 7262 6174 696d  `].\end{verbatim
00208d0: 7d5c 656e 647b 626f 7865 647d 0a0a 5c73  }\end{boxed}..\s
00208e0: 6563 7469 6f6e 2a7b 4675 7274 6865 7220  ection*{Further 
00208f0: 7265 6164 696e 677d 0a0a 5379 6d62 6f6c  reading}..Symbol
0020900: 6963 2064 6966 6665 7265 6e74 6961 7469  ic differentiati
0020910: 6f6e 2069 7320 6120 636c 6173 7369 6320  on is a classic 
0020920: 6170 706c 6963 6174 696f 6e20 6f66 2066  application of f
0020930: 756e 6374 696f 6e61 6c20 6c61 6e67 7561  unctional langua
0020940: 6765 732e 0a4f 7468 6572 2073 796d 626f  ges..Other symbo
0020950: 6c69 6320 6f70 6572 6174 696f 6e73 2061  lic operations a
0020960: 7265 206d 616a 6f72 2072 6573 6561 7263  re major researc
0020970: 6820 6973 7375 6573 2069 6e20 7468 6569  h issues in thei
0020980: 7220 6f77 6e20 7269 6768 7420 2d2d 2d0a  r own right ---.
0020990: 5c63 6974 654e 7b64 6176 656e 706f 7274  \citeN{davenport
00209a0: 2d63 617d 2067 6976 6520 6120 7265 6164  -ca} give a read
00209b0: 6162 6c65 206f 7665 7276 6965 7720 6f66  able overview of
00209c0: 2077 6861 7420 636f 6d70 7574 6572 2061   what computer a
00209d0: 6c67 6562 7261 2073 7973 7465 6d73 0a63  lgebra systems.c
00209e0: 616e 2064 6f20 616e 6420 686f 7720 7468  an do and how th
00209f0: 6579 2077 6f72 6b2e 205c 6369 7465 4e7b  ey work. \citeN{
0020a00: 7061 756c 736f 6e2d 7265 7772 6974 696e  paulson-rewritin
0020a10: 677d 2064 6973 6375 7373 6573 2074 6865  g} discusses the
0020a20: 206b 696e 6420 6f66 0a73 696d 706c 6966   kind of.simplif
0020a30: 6963 6174 696f 6e20 7374 7261 7465 6779  ication strategy
0020a40: 2077 6520 7573 6520 6865 7265 2069 6e20   we use here in 
0020a50: 6120 6d75 6368 206d 6f72 6520 6765 6e65  a much more gene
0020a60: 7261 6c20 7365 7474 696e 672e 0a0a 5061  ral setting...Pa
0020a70: 7273 696e 6720 7769 7468 2068 6967 6865  rsing with highe
0020a80: 7220 6f72 6465 7220 6675 6e63 7469 6f6e  r order function
0020a90: 7320 6973 2061 6e6f 7468 6572 2070 6f70  s is another pop
0020aa0: 756c 6172 2065 7861 6d70 6c65 2e20 4974  ular example. It
0020ab0: 2073 6565 6d73 2074 6f0a 6861 7665 2065   seems to.have e
0020ac0: 7869 7374 6564 2069 6e20 7468 6520 6675  xisted in the fu
0020ad0: 6e63 7469 6f6e 616c 2070 726f 6772 616d  nctional program
0020ae0: 6d69 6e67 2066 6f6c 6b6c 6f72 6520 666f  ming folklore fo
0020af0: 7220 6120 6c6f 6e67 2074 696d 653b 2061  r a long time; a
0020b00: 6e20 6561 726c 790a 7472 6561 746d 656e  n early.treatmen
0020b10: 7420 6973 2067 6976 656e 2062 7920 5c63  t is given by \c
0020b20: 6974 654e 7b62 7572 6765 2d72 6563 7572  iteN{burge-recur
0020b30: 7369 7665 7d2e 204f 7572 2070 7265 7365  sive}. Our prese
0020b40: 6e74 6174 696f 6e20 6861 7320 6265 656e  ntation has been
0020b50: 0a69 6e66 6c75 656e 6365 6420 6279 2074  .influenced by t
0020b60: 6865 2074 7265 6174 6d65 6e74 7320 696e  he treatments in
0020b70: 205c 6369 7465 4e7b 7061 756c 736f 6e2d   \citeN{paulson-
0020b80: 6d6c 7d20 616e 6420 5c63 6974 654e 7b72  ml} and \citeN{r
0020b90: 6561 6465 2d65 6670 7d2e 0a0a 5468 6520  eade-efp}...The 
0020ba0: 6669 7273 7420 6465 6669 6e69 7469 6f6e  first definition
0020bb0: 206f 6620 6063 6f6d 7075 7461 626c 6520   of `computable 
0020bc0: 7265 616c 206e 756d 6265 7227 2069 6e20  real number' in 
0020bd0: 6f75 7220 7365 6e73 6520 7761 7320 696e  our sense was in
0020be0: 2074 6865 0a6f 7269 6769 6e61 6c20 7061   the.original pa
0020bf0: 7065 7220 6f66 205c 6369 7465 4e7b 7475  per of \citeN{tu
0020c00: 7269 6e67 7d2e 2048 6973 2061 7070 726f  ring}. His appro
0020c10: 6163 6820 7761 7320 6261 7365 6420 6f6e  ach was based on
0020c20: 2064 6563 696d 616c 2065 7870 616e 7369   decimal expansi
0020c30: 6f6e 732c 0a62 7574 2068 6520 6e65 6564  ons,.but he need
0020c40: 6564 2074 6f20 6d6f 6469 6679 2069 7420  ed to modify it 
0020c50: 5c63 6974 657b 7475 7269 6e67 327d 2066  \cite{turing2} f
0020c60: 6f72 2072 6561 736f 6e73 2065 7870 6c6f  or reasons explo
0020c70: 7265 6420 696e 2074 6865 2065 7865 7263  red in the exerc
0020c80: 6973 6573 0a62 656c 6f77 2e20 5468 6520  ises.below. The 
0020c90: 6170 7072 6f61 6368 2074 6f20 7265 616c  approach to real
0020ca0: 2061 7269 7468 6d65 7469 6320 6769 7665   arithmetic give
0020cb0: 6e20 6865 7265 2066 6f6c 6c6f 7773 2074  n here follows t
0020cc0: 6865 2077 6f72 6b20 6f66 0a5c 6369 7465  he work of.\cite
0020cd0: 4e7b 626f 6568 6d2d 6361 7274 7772 6967  N{boehm-cartwrig
0020ce0: 6874 7d2e 204d 6f72 6520 7265 6365 6e74  ht}. More recent
0020cf0: 6c79 2061 2068 6967 682d 7065 7266 6f72  ly a high-perfor
0020d00: 6d61 6e63 6520 696d 706c 656d 656e 7461  mance implementa
0020d10: 7469 6f6e 2069 6e0a 4341 4d4c 204c 6967  tion in.CAML Lig
0020d20: 6874 2068 6173 2062 6565 6e20 7772 6974  ht has been writ
0020d30: 7465 6e20 6279 205c 6369 7465 4e7b 6d65  ten by \citeN{me
0020d40: 6e69 7373 652d 7468 6573 6973 7d2c 2077  nisse-thesis}, w
0020d50: 686f 7365 2074 6865 7369 7320 2869 6e20  hose thesis (in 
0020d60: 4672 656e 6368 290a 636f 6e74 6169 6e73  French).contains
0020d70: 2064 6574 6169 6c65 6420 7072 6f6f 6673   detailed proofs
0020d80: 206f 6620 636f 7272 6563 746e 6573 7320   of correctness 
0020d90: 666f 7220 616c 6c20 7468 6520 616c 676f  for all the algo
0020da0: 7269 7468 6d73 2066 6f72 2065 6c65 6d65  rithms for eleme
0020db0: 6e74 6172 790a 7472 616e 7363 656e 6465  ntary.transcende
0020dc0: 6e74 616c 2066 756e 6374 696f 6e73 2e20  ntal functions. 
0020dd0: 466f 7220 616e 2061 6c74 6572 6e61 7469  For an alternati
0020de0: 7665 2061 7070 726f 6163 6820 7573 696e  ve approach usin
0020df0: 6720 606c 696e 6561 7220 6672 6163 7469  g `linear fracti
0020e00: 6f6e 616c 0a74 7261 6e73 666f 726d 6174  onal.transformat
0020e10: 696f 6e73 272c 2073 6565 205c 6369 7465  ions', see \cite
0020e20: 4e7b 706f 7474 732d 7468 6573 6973 7d2e  N{potts-thesis}.
0020e30: 0a0a 4f75 7220 6170 7072 6f61 6368 2074  ..Our approach t
0020e40: 6f20 5072 6f6c 6f67 2073 6561 7263 6820  o Prolog search 
0020e50: 616e 6420 6261 636b 7472 6163 6b69 6e67  and backtracking
0020e60: 2c20 6569 7468 6572 2075 7369 6e67 206c  , either using l
0020e70: 6973 7473 206f 720a 636f 6e74 696e 7561  ists or.continua
0020e80: 7469 6f6e 732c 2069 7320 6661 6972 6c79  tions, is fairly
0020e90: 2073 7461 6e64 6172 642e 2046 6f72 206d   standard. For m
0020ea0: 6f72 6520 6f6e 2069 6d70 6c65 6d65 6e74  ore on implement
0020eb0: 696e 6720 5072 6f6c 6f67 2c20 7365 6520  ing Prolog, see 
0020ec0: 666f 720a 6578 616d 706c 6520 5c63 6974  for.example \cit
0020ed0: 654e 7b62 6f69 7a75 6d61 756c 742d 7072  eN{boizumault-pr
0020ee0: 6f6c 6f67 7d2c 2077 6869 6c65 2066 6f72  olog}, while for
0020ef0: 206d 6f72 6520 6f6e 2074 6865 2061 6374   more on the act
0020f00: 7561 6c20 7573 6520 6f66 2074 6865 0a6c  ual use of the.l
0020f10: 616e 6775 6167 652c 2074 6865 2063 6c61  anguage, the cla
0020f20: 7373 6963 2074 6578 7420 6279 205c 6369  ssic text by \ci
0020f30: 7465 4e7b 636c 6f63 6b73 696e 2d6d 656c  teN{clocksin-mel
0020f40: 6c69 7368 7d20 6973 2072 6563 6f6d 6d65  lish} is recomme
0020f50: 6e64 6564 2e20 410a 6465 7461 696c 6564  nded. A.detailed
0020f60: 2064 6973 6375 7373 696f 6e20 6f66 2063   discussion of c
0020f70: 6f6e 7469 6e75 6174 696f 6e73 2069 6e20  ontinuations in 
0020f80: 7468 6569 7220 6d61 6e79 2067 7569 7365  their many guise
0020f90: 7320 6973 2067 6976 656e 2062 790a 5c63  s is given by.\c
0020fa0: 6974 654e 7b72 6579 6e6f 6c64 732d 636f  iteN{reynolds-co
0020fb0: 6e74 696e 7561 7469 6f6e 737d 2e20 5468  ntinuations}. Th
0020fc0: 6520 756e 6966 6963 6174 696f 6e20 616c  e unification al
0020fd0: 676f 7269 7468 6d20 6769 7665 6e20 6865  gorithm given he
0020fe0: 7265 2069 7320 7369 6d70 6c65 0a61 6e64  re is simple.and
0020ff0: 2070 7572 656c 7920 6675 6e63 7469 6f6e   purely function
0021000: 616c 2c20 6275 7420 7261 7468 6572 2069  al, but rather i
0021010: 6e65 6666 6963 6965 6e74 2e20 466f 7220  nefficient. For 
0021020: 6661 7374 6572 2069 6d70 6572 6174 6976  faster imperativ
0021030: 650a 616c 676f 7269 7468 6d73 2c20 7365  e.algorithms, se
0021040: 6520 5c63 6974 654e 7b6d 6172 7465 6c6c  e \citeN{martell
0021050: 692d 6d6f 6e74 616e 6172 697d 2e20 4f75  i-montanari}. Ou
0021060: 7220 7468 656f 7265 6d20 7072 6f76 6572  r theorem prover
0021070: 2069 7320 6261 7365 6420 6f6e 0a5c 6d62   is based on.\mb
0021080: 6f78 7b7b 5c73 6620 6c65 616e 7d24 545e  ox{{\sf lean}$T^
0021090: 7b5c 215c 215c 7465 7874 7374 796c 6520  {\!\!\textstyle 
00210a0: 417d 5c21 5c21 5024 7d20 5c63 6974 657b  A}\!\!P$} \cite{
00210b0: 6265 636b 6572 742d 706f 7365 6767 617d  beckert-posegga}
00210c0: 2e20 466f 720a 616e 6f74 6865 7220 696d  . For.another im
00210d0: 706f 7274 616e 7420 7468 656f 7265 6d20  portant theorem 
00210e0: 7072 6f76 696e 6720 6d65 7468 6f64 2063  proving method c
00210f0: 6f6e 7665 6e69 656e 746c 7920 6261 7365  onveniently base
0021100: 6420 6f6e 2050 726f 6c6f 672d 7374 796c  d on Prolog-styl
0021110: 650a 7365 6172 6368 2c20 6c6f 6f6b 2061  e.search, look a
0021120: 7420 7468 6520 5072 6f6c 6f67 2054 6563  t the Prolog Tec
0021130: 686e 6f6c 6f67 7920 5468 656f 7265 6d20  hnology Theorem 
0021140: 5072 6f76 6572 205c 6369 7465 7b73 7469  Prover \cite{sti
0021150: 636b 656c 2d70 7474 707d 2e0a 0a5c 7365  ckel-pttp}...\se
0021160: 6374 696f 6e2a 7b45 7865 7263 6973 6573  ction*{Exercises
0021170: 7d0a 0a5c 6265 6769 6e7b 656e 756d 6572  }..\begin{enumer
0021180: 6174 657d 0a0a 5c69 7465 6d20 4d6f 6469  ate}..\item Modi
0021190: 6679 2074 6865 2070 7269 6e74 6572 2073  fy the printer s
00211a0: 6f20 7468 6174 2065 6163 6820 6f70 6572  o that each oper
00211b0: 6174 6f72 2068 6173 2061 6e20 6173 736f  ator has an asso
00211c0: 6369 6174 6976 6974 792c 2075 7365 6420  ciativity, used 
00211d0: 7768 656e 0a70 7269 6e74 696e 6720 6974  when.printing it
00211e0: 6572 6174 6564 2063 6173 6573 206f 6620  erated cases of 
00211f0: 7468 6520 6f70 6572 6174 6f72 2074 6f20  the operator to 
0021200: 6176 6f69 6420 6578 6365 7373 6976 6520  avoid excessive 
0021210: 7061 7265 6e74 6865 7365 732e 0a0a 5c69  parentheses...\i
0021220: 7465 6d20 5468 6520 6469 6666 6572 656e  tem The differen
0021230: 7469 6174 696f 6e20 7275 6c65 7320 666f  tiation rules fo
0021240: 7220 696e 7665 7273 6573 2024 3120 2f20  r inverses $1 / 
0021250: 6728 7829 2420 616e 6420 7175 6f74 6965  g(x)$ and quotie
0021260: 6e74 7320 2466 2878 2920 2f0a 6728 7829  nts $f(x) /.g(x)
0021270: 2420 6172 6520 6e6f 7420 7661 6c69 6420  $ are not valid 
0021280: 7768 656e 2024 6728 7829 203d 2030 242e  when $g(x) = 0$.
0021290: 2053 6576 6572 616c 206f 7468 6572 7320   Several others 
00212a0: 666f 7220 6675 6e63 7469 6f6e 7320 6c69  for functions li
00212b0: 6b65 2024 6c6e 2420 6172 650a 616c 736f  ke $ln$ are.also
00212c0: 2074 7275 6520 6f6e 6c79 2075 6e64 6572   true only under
00212d0: 2063 6572 7461 696e 2063 6f6e 6469 7469   certain conditi
00212e0: 6f6e 732e 2041 6374 7561 6c6c 7920 6d6f  ons. Actually mo
00212f0: 7374 2063 6f6d 6d65 7263 6961 6c20 636f  st commercial co
0021300: 6d70 7574 6572 0a61 6c67 6562 7261 2073  mputer.algebra s
0021310: 7973 7465 6d73 2069 676e 6f72 6520 7468  ystems ignore th
0021320: 6973 2066 6163 742e 2048 6f77 6576 6572  is fact. However
0021330: 2c20 7472 7920 746f 2064 6f20 6265 7474  , try to do bett
0021340: 6572 2c20 6279 2077 7269 7469 6e67 2061  er, by writing a
0021350: 206e 6577 0a76 6572 7369 6f6e 206f 6620   new.version of 
0021360: 7468 6520 6469 6666 6572 656e 7469 6174  the differentiat
0021370: 6f72 2074 6861 7420 6e6f 7420 6f6e 6c79  or that not only
0021380: 2070 726f 6475 6365 7320 7468 6520 6465   produces the de
0021390: 7269 7661 7469 7665 2062 7574 2061 6c73  rivative but als
00213a0: 6f20 610a 6c69 7374 206f 6620 636f 6e64  o a.list of cond
00213b0: 6974 696f 6e73 2074 6861 7420 6d75 7374  itions that must
00213c0: 2062 6520 6173 7375 6d65 6420 666f 7220   be assumed for 
00213d0: 7468 6520 6465 7269 7661 7469 7665 2074  the derivative t
00213e0: 6f20 6265 2076 616c 6964 2e0a 0a5c 6974  o be valid...\it
00213f0: 656d 2054 7279 2070 726f 6772 616d 6d69  em Try programmi
0021400: 6e67 2061 2073 696d 706c 6520 7072 6f63  ng a simple proc
0021410: 6564 7572 6520 666f 7220 696e 6465 6669  edure for indefi
0021420: 6e69 7465 2069 6e74 6567 7261 7469 6f6e  nite integration
0021430: 2e20 496e 0a67 656e 6572 616c 2c20 6974  . In.general, it
0021440: 2077 696c 6c20 6e6f 7420 6265 2061 626c   will not be abl
0021450: 6520 746f 2064 6f20 6576 6572 7920 696e  e to do every in
0021460: 7465 6772 616c 2c20 6275 7420 7472 7920  tegral, but try 
0021470: 746f 206d 616b 6520 6974 0a75 6e64 6572  to make it.under
0021480: 7374 616e 6420 6120 6665 7720 6261 7369  stand a few basi
0021490: 6320 7072 696e 6369 706c 6573 2e5c 666f  c principles.\fo
00214a0: 6f74 6e6f 7465 7b49 6e20 6661 6374 2074  otnote{In fact t
00214b0: 6865 7265 2061 7265 2061 6c67 6f72 6974  here are algorit
00214c0: 686d 7320 7468 6174 0a63 616e 2069 6e74  hms that.can int
00214d0: 6567 7261 7465 2061 6c6c 2061 6c67 6562  egrate all algeb
00214e0: 7261 6963 2065 7870 7265 7373 696f 6e73  raic expressions
00214f0: 2028 6e6f 7420 696e 766f 6c76 696e 6720   (not involving 
0021500: 2473 696e 242c 2024 6c6e 2420 6574 632e  $sin$, $ln$ etc.
0021510: 2920 2d2d 2d0a 7365 6520 5c63 6974 654e  ) ---.see \citeN
0021520: 7b64 6176 656e 706f 7274 2d69 6e74 6567  {davenport-integ
0021530: 7261 7469 6f6e 7d2e 7d0a 0a5c 6974 656d  ration}.}..\item
0021540: 2052 6561 6420 7468 6520 646f 6375 6d65   Read the docume
0021550: 6e74 6174 696f 6e20 666f 7220 7468 6520  ntation for the 
0021560: 7b5c 7474 2066 6f72 6d61 747d 206c 6962  {\tt format} lib
0021570: 7261 7279 2c20 616e 6420 7472 7920 746f  rary, and try to
0021580: 2069 6d70 6c65 6d65 6e74 0a61 2070 7269   implement.a pri
0021590: 6e74 6572 2074 6861 7420 6265 6861 7665  nter that behave
00215a0: 7320 6265 7474 6572 2077 6865 6e20 7468  s better when th
00215b0: 6520 6f75 7470 7574 2069 7320 6c6f 6e67  e output is long
00215c0: 6572 2074 6861 6e20 6f6e 6520 6c69 6e65  er than one line
00215d0: 2e0a 0a5c 6974 656d 2057 6861 7420 6861  ...\item What ha
00215e0: 7070 656e 7320 6966 2074 6865 2070 6172  ppens if the par
00215f0: 7365 7220 6675 6e63 7469 6f6e 7320 6c69  ser functions li
0021600: 6b65 207b 5c74 7420 7465 726d 7d2c 207b  ke {\tt term}, {
0021610: 5c74 7420 6174 6f6d 7d20 6574 632e 2061  \tt atom} etc. a
0021620: 7265 0a61 6c6c 2065 7461 2d72 6564 7563  re.all eta-reduc
0021630: 6564 2062 7920 6465 6c65 7469 6e67 2074  ed by deleting t
0021640: 6865 2077 6f72 6420 7b5c 7474 2069 6e70  he word {\tt inp
0021650: 7574 7d3f 2057 6861 7420 6861 7070 656e  ut}? What happen
0021660: 7320 6966 0a7b 5c74 7420 7072 6563 6564  s if.{\tt preced
0021670: 656e 6365 7d20 6973 2063 6f6e 7369 7374  ence} is consist
0021680: 656e 746c 7920 6574 612d 7265 6475 6365  ently eta-reduce
0021690: 6420 6279 2064 656c 6574 696e 6720 7b5c  d by deleting {\
00216a0: 7474 2069 6e70 7574 7d3f 0a0a 5c69 7465  tt input}?..\ite
00216b0: 6d20 486f 7720 7765 6c6c 2064 6f20 7072  m How well do pr
00216c0: 6563 6564 656e 6365 2070 6172 7365 7273  ecedence parsers
00216d0: 2067 656e 6572 6174 6564 2062 7920 7b5c   generated by {\
00216e0: 7474 2070 7265 6365 6465 6e63 657d 2074  tt precedence} t
00216f0: 7265 6174 0a64 6973 7469 6e63 7420 6f70  reat.distinct op
0021700: 6572 6174 6f72 7320 7769 7468 2074 6865  erators with the
0021710: 2073 616d 6520 7072 6563 6564 656e 6365   same precedence
0021720: 3f20 486f 7720 6361 6e20 7468 6520 6265  ? How can the be
0021730: 6861 7669 6f75 7220 6265 2069 6d70 726f  haviour be impro
0021740: 7665 643f 0a43 616e 2079 6f75 2065 7874  ved?.Can you ext
0021750: 656e 6420 6974 2074 6f20 616c 6c6f 7720  end it to allow 
0021760: 6120 6d69 7820 6f66 206c 6566 7420 616e  a mix of left an
0021770: 6420 7269 6768 7420 6173 736f 6369 6174  d right associat
0021780: 6976 6520 6f70 6572 6174 6f72 733f 2046  ive operators? F
0021790: 6f72 0a65 7861 6d70 6c65 2c20 6f6e 6520  or.example, one 
00217a0: 7265 616c 6c79 2077 616e 7473 2073 7562  really wants sub
00217b0: 7472 6163 7469 6f6e 2074 6f20 6173 736f  traction to asso
00217c0: 6369 6174 6520 746f 2074 6865 206c 6566  ciate to the lef
00217d0: 742e 0a0a 5c69 7465 6d20 5265 7772 6974  t...\item Rewrit
00217e0: 6520 7468 6520 7061 7273 6572 2073 6f20  e the parser so 
00217f0: 7468 6174 2069 7420 6769 7665 7320 6865  that it gives he
0021800: 6c70 6675 6c20 6572 726f 7220 6d65 7373  lpful error mess
0021810: 6167 6573 2077 6865 6e20 7061 7273 696e  ages when parsin
0021820: 670a 6661 696c 732e 0a0a 5c69 7465 6d20  g.fails...\item 
0021830: 5472 7920 7265 7072 6573 656e 7469 6e67  Try representing
0021840: 2061 2072 6561 6c20 6e75 6d62 6572 2062   a real number b
0021850: 7920 7468 6520 6675 6e63 7469 6f6e 2074  y the function t
0021860: 6861 7420 6765 6e65 7261 7465 7320 7468  hat generates th
0021870: 6520 6669 7273 740a 246e 2420 6469 6769  e first.$n$ digi
0021880: 7473 2069 6e20 6120 6465 6369 6d61 6c20  ts in a decimal 
0021890: 6578 7061 6e73 696f 6e2e 2043 616e 2079  expansion. Can y
00218a0: 6f75 2069 6d70 6c65 6d65 6e74 2074 6865  ou implement the
00218b0: 2061 6464 6974 696f 6e20 6675 6e63 7469   addition functi
00218c0: 6f6e 3f0a 0a5c 6974 656d 2028 2a29 2048  on?..\item (*) H
00218d0: 6f77 2063 616e 2079 6f75 2072 6574 6169  ow can you retai
00218e0: 6e20 6120 706f 7369 7469 6f6e 616c 2072  n a positional r
00218f0: 6570 7265 7365 6e74 6174 696f 6e20 7768  epresentation wh
0021900: 696c 6520 6d61 6b69 6e67 2074 6865 2062  ile making the b
0021910: 6173 6963 0a6f 7065 7261 7469 6f6e 7320  asic.operations 
0021920: 636f 6d70 7574 6162 6c65 3f0a 0a5c 6974  computable?..\it
0021930: 656d 2049 6d70 6c65 6d65 6e74 206d 756c  em Implement mul
0021940: 7469 7072 6563 6973 696f 6e20 696e 7465  tiprecision inte
0021950: 6765 7220 6172 6974 686d 6574 6963 206f  ger arithmetic o
0021960: 7065 7261 7469 6f6e 7320 796f 7572 7365  perations yourse
0021970: 6c66 2e20 4d61 6b65 0a79 6f75 7220 6d75  lf. Make.your mu
0021980: 6c74 6970 6c69 6361 7469 6f6e 2061 6c67  ltiplication alg
0021990: 6f72 6974 686d 2024 4f28 6e5e 7b6c 6f67  orithm $O(n^{log
00219a0: 5f32 2033 7d29 2420 7768 6572 6520 246e  _2 3})$ where $n
00219b0: 2420 6973 2074 6865 206e 756d 6265 7220  $ is the number 
00219c0: 6f66 0a64 6967 6974 7320 696e 2074 6865  of.digits in the
00219d0: 2061 7267 756d 656e 7473 2e0a 0a5c 6974   arguments...\it
00219e0: 656d 2055 7369 6e67 207b 5c74 7420 6d65  em Using {\tt me
00219f0: 6d6f 7d20 6173 2077 6520 6861 7665 2064  mo} as we have d
0021a00: 6566 696e 6564 2069 742c 2069 7320 6974  efined it, is it
0021a10: 2074 6865 2063 6173 6520 7468 6174 2077   the case that w
0021a20: 6861 7465 7665 720a 7365 7269 6573 206f  hatever.series o
0021a30: 6620 6172 6775 6d65 6e74 7320 6120 6675  f arguments a fu
0021a40: 6e63 7469 6f6e 2069 7320 6170 706c 6965  nction is applie
0021a50: 6420 746f 2c20 6974 2077 696c 6c20 616c  d to, it will al
0021a60: 7761 7973 2067 6976 6520 7468 6520 7361  ways give the sa
0021a70: 6d65 0a61 6e73 7765 7220 666f 7220 7468  me.answer for th
0021a80: 6520 7361 6d65 2061 7267 756d 656e 743f  e same argument?
0021a90: 2054 6861 7420 6973 2c20 6172 6520 7468   That is, are th
0021aa0: 6520 6675 6e63 7469 6f6e 7320 7472 7565  e functions true
0021ab0: 206d 6174 6865 6d61 7469 6361 6c0a 6675   mathematical.fu
0021ac0: 6e63 7469 6f6e 7320 6465 7370 6974 6520  nctions despite 
0021ad0: 7468 6520 696e 7465 726e 616c 2075 7365  the internal use
0021ae0: 206f 6620 7265 6665 7265 6e63 6573 3f0a   of references?.
0021af0: 0a5c 6974 656d 2057 7269 7465 2061 2070  .\item Write a p
0021b00: 6172 7365 722d 6576 616c 7561 746f 7220  arser-evaluator 
0021b10: 746f 2072 6561 6420 7265 616c 2d76 616c  to read real-val
0021b20: 7565 6420 6578 7072 6573 7369 6f6e 7320  ued expressions 
0021b30: 616e 6420 6372 6561 7465 2074 6865 0a66  and create the.f
0021b40: 756e 6374 696f 6e61 6c20 7265 7072 6573  unctional repres
0021b50: 656e 7461 7469 6f6e 2066 6f72 2074 6865  entation for the
0021b60: 2061 6e73 7765 722e 0a0a 5c69 7465 6d20   answer...\item 
0021b70: 282a 2920 4578 7465 6e64 2074 6865 2072  (*) Extend the r
0021b80: 6561 6c20 6172 6974 686d 6574 6963 2072  eal arithmetic r
0021b90: 6f75 7469 6e65 7320 746f 2073 6f6d 6520  outines to some 
0021ba0: 6675 6e63 7469 6f6e 7320 6c69 6b65 2024  functions like $
0021bb0: 6578 7024 2061 6e64 0a24 7369 6e24 2e0a  exp$ and.$sin$..
0021bc0: 0a5c 6974 656d 204f 7572 2070 7265 7072  .\item Our prepr
0021bd0: 6f63 6573 7369 6e67 2061 6e64 206e 6567  ocessing and neg
0021be0: 6174 696f 6e20 6e6f 726d 616c 2066 6f72  ation normal for
0021bf0: 6d20 7072 6f63 6573 7320 6361 6e20 7461  m process can ta
0021c00: 6b65 2065 7870 6f6e 656e 7469 616c 0a74  ke exponential.t
0021c10: 696d 6520 696e 2074 6865 206c 656e 6774  ime in the lengt
0021c20: 6820 6f66 2074 6865 2069 6e70 7574 2069  h of the input i
0021c30: 6e20 7468 6520 6361 7365 206f 6620 6d61  n the case of ma
0021c40: 6e79 2060 6966 2061 6e64 206f 6e6c 7920  ny `if and only 
0021c50: 6966 2773 2e20 4d6f 6469 6679 0a69 7420  if's. Modify.it 
0021c60: 736f 2074 6861 7420 6974 2069 7320 6c69  so that it is li
0021c70: 6e65 6172 2069 6e20 7468 6973 206e 756d  near in this num
0021c80: 6265 722e 0a0a 5c69 7465 6d20 4578 7465  ber...\item Exte
0021c90: 6e64 2074 6865 2069 6e69 7469 616c 2074  nd the initial t
0021ca0: 7261 6e73 666f 726d 6174 696f 6e20 696e  ransformation in
0021cb0: 746f 206e 6567 6174 696f 6e20 6e6f 726d  to negation norm
0021cc0: 616c 2066 6f72 6d20 736f 2074 6861 7420  al form so that 
0021cd0: 6974 0a67 6976 6573 2053 6b6f 6c65 6d20  it.gives Skolem 
0021ce0: 6e6f 726d 616c 2066 6f72 6d2e 5c66 6f6f  normal form.\foo
0021cf0: 746e 6f74 657b 536b 6f6c 656d 206e 6f72  tnote{Skolem nor
0021d00: 6d61 6c20 666f 726d 2069 7320 636f 7665  mal form is cove
0021d10: 7265 6420 696e 206d 6f73 740a 656c 656d  red in most.elem
0021d20: 656e 7461 7279 206c 6f67 6963 2062 6f6f  entary logic boo
0021d30: 6b73 2c20 652e 672e 205c 6369 7465 4e7b  ks, e.g. \citeN{
0021d40: 656e 6465 7274 6f6e 2d6c 6f67 6963 7d2e  enderton-logic}.
0021d50: 7d0a 0a5c 6974 656d 2028 2a29 2049 6d70  }..\item (*) Imp
0021d60: 6c65 6d65 6e74 2061 206d 6f72 6520 6566  lement a more ef
0021d70: 6669 6369 656e 7420 756e 6966 6963 6174  ficient unificat
0021d80: 696f 6e20 616c 676f 7269 7468 6d2c 2065  ion algorithm, e
0021d90: 2e67 2e20 666f 6c6c 6f77 696e 670a 5c63  .g. following.\c
0021da0: 6974 654e 7b6d 6172 7465 6c6c 692d 6d6f  iteN{martelli-mo
0021db0: 6e74 616e 6172 697d 2e0a 0a5c 6974 656d  ntanari}...\item
0021dc0: 2028 2a29 2049 6d70 6c65 6d65 6e74 2061   (*) Implement a
0021dd0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
0021de0: 5072 6f6c 6f67 2054 6563 686e 6f6c 6f67  Prolog Technolog
0021df0: 7920 5468 656f 7265 6d20 5072 6f76 6572  y Theorem Prover
0021e00: 0a5c 6369 7465 7b73 7469 636b 656c 2d70  .\cite{stickel-p
0021e10: 7474 707d 0a0a 5c65 6e64 7b65 6e75 6d65  ttp}..\end{enume
0021e20: 7261 7465 7d0a 0a25 2525 204c 6f63 616c  rate}..%%% Local
0021e30: 2056 6172 6961 626c 6573 3a0a 2525 2520   Variables:.%%% 
0021e40: 5465 582d 6d61 7374 6572 3a20 2261 6c6c  TeX-master: "all
0021e50: 220a 2525 2520 456e 643a 0a0a            ".%%% End:..
